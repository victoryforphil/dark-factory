generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlite"
}

generator prismabox { 
  provider = "prismabox"
  typeboxImportDependencyName = "elysia"
  typeboxImportVariableName = "t"
  inputModel = true
  output   = "../generated/prismabox"
} 

model Product {
  id          String    @id
  locator     String    @unique
  displayName String?   @map("display_name")
  workspaceLocator String? @map("workspace_locator")
  gitInfo     Json?     @map("git_info")
  variants    Variant[]
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  @@index([locator])
  @@map("products")
}

model Variant {
  id                  String    @id
  productId           String    @map("product_id")
  name                String    @default("default")
  locator             String
  gitInfo             Json?     @map("git_info")
  gitInfoUpdatedAt    DateTime? @map("git_info_updated_at")
  gitInfoLastPolledAt DateTime? @map("git_info_last_polled_at")
  product             Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  actors              Actor[]
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  @@unique([productId, name])
  @@index([productId])
  @@index([locator])
  @@map("variants")
}

model Actor {
  id                String   @id
  variantId         String   @map("variant_id")
  provider          String
  actorLocator      String   @map("actor_locator")
  workingLocator    String   @map("working_locator")
  providerSessionId String?  @map("provider_session_id")
  status            String   @default("unknown")
  title             String?
  description       String?
  connectionInfo    Json?    @map("connection_info")
  attachCommand     String?  @map("attach_command")
  subAgents         Json?    @map("sub_agents")
  metadata          Json?
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  variant Variant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@index([variantId])
  @@index([provider])
  @@index([status])
  @@index([providerSessionId])
  @@unique([variantId, provider, providerSessionId])
  @@map("actors")
}
