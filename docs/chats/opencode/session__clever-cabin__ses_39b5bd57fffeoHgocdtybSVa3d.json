{
  "info": {
    "id": "ses_39b5bd57fffeoHgocdtybSVa3d",
    "slug": "clever-cabin",
    "projectID": "51ce91990cdb80fb62489f7028ffc023d69077fd",
    "directory": "/Users/alex/repos/vfp/dark-factory",
    "title": "Docs-scraping skill: implement or refresh scraper for source with split .ext.md outputs",
    "version": "1.2.5",
    "summary": {
      "additions": 8218,
      "deletions": 0,
      "files": 46
    },
    "time": {
      "created": 1771215006336,
      "updated": 1771215312954
    }
  },
  "messages": [
    {
      "info": {
        "role": "user",
        "time": {
          "created": 1771215006348
        },
        "summary": {
          "title": "Docs-scraping: scrape_docs.sh.ts workflow and outputs",
          "diffs": [
            {
              "file": "scripts/scrape_opencode_docs.sh.ts",
              "before": "",
              "after": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};\n\nconst SOURCE_KEY = \"opencode\";\nconst DOCS_ROOT = \"https://opencode.ai/docs\";\nconst SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\nconst DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\nconst CONCURRENCY = 4;\nconst SUMMARY_MAX_CHARS = 240;\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replaceAll(\"&amp;\", \"&\")\n    .replaceAll(\"&quot;\", '\"')\n    .replaceAll(\"&apos;\", \"'\")\n    .replaceAll(\"&#x27;\", \"'\")\n    .replaceAll(\"&#39;\", \"'\")\n    .replaceAll(\"&nbsp;\", \" \")\n    .replaceAll(\"&lt;\", \"<\")\n    .replaceAll(\"&gt;\", \">\");\n}\n\nfunction stripJinaEnvelope(markdown: string): string {\n  return markdown\n    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n    .trim();\n}\n\nfunction stripTags(value: string): string {\n  return value.replace(/<[^>]+>/g, \"\");\n}\n\nfunction plainTextFromHtml(value: string): string {\n  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n}\n\nfunction extractMainHtml(html: string): string {\n  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n  if (articleMatch?.[1]) {\n    return articleMatch[1];\n  }\n\n  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n  if (mainMatch?.[1]) {\n    return mainMatch[1];\n  }\n\n  return html;\n}\n\nfunction htmlToMarkdown(html: string): string {\n  let content = extractMainHtml(html);\n\n  content = content\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n\n  content = content.replace(\n    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n    (_match, code) => {\n      const normalizedCode = decodeEntities(\n        stripTags(code)\n          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n          .replace(/\\n{3,}/g, \"\\n\\n\")\n          .trim(),\n      );\n\n      if (!normalizedCode) {\n        return \"\";\n      }\n\n      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n    },\n  );\n\n  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n    const normalizedCode = decodeEntities(stripTags(code)).trim();\n    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n  });\n\n  content = content.replace(\n    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n    (_match, href, label) => {\n      const text = plainTextFromHtml(label);\n      if (!text) {\n        return \"\";\n      }\n\n      return `[${text}](${decodeEntities(href)})`;\n    },\n  );\n\n  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n    const heading = plainTextFromHtml(inner);\n    if (!heading) {\n      return \"\";\n    }\n\n    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n  });\n\n  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n    const line = plainTextFromHtml(inner);\n    return line ? `- ${line}\\n` : \"\";\n  });\n\n  content = content\n    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n      const cell = plainTextFromHtml(inner);\n      return cell ? `${cell} ` : \"\";\n    });\n\n  content = decodeEntities(content)\n    .replace(/<[^>]+>/g, \"\")\n    .replace(/[ \\t]+\\n/g, \"\\n\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .trim();\n\n  return content;\n}\n\nfunction sanitizeSegment(value: string): string {\n  const clean = decodeURIComponent(value)\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return clean || \"page\";\n}\n\nfunction sourcePathFromUrl(url: string): string {\n  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n  return pathname;\n}\n\nfunction fileStemFromUrl(url: string): string {\n  const sourcePath = sourcePathFromUrl(url);\n\n  if (sourcePath === \"/docs\") {\n    return \"docs\";\n  }\n\n  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n  const segments = relative\n    .split(\"/\")\n    .filter(Boolean)\n    .map(sanitizeSegment);\n\n  if (segments.length === 0) {\n    return \"docs\";\n  }\n\n  return [\"docs\", ...segments].join(\"__\");\n}\n\nfunction extractSummary(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  let inCodeBlock = false;\n\n  for (const rawLine of lines) {\n    const line = rawLine.trim();\n\n    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n      inCodeBlock = !inCodeBlock;\n      continue;\n    }\n\n    if (inCodeBlock) {\n      continue;\n    }\n\n    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n      continue;\n    }\n\n    if (line.length <= 25) {\n      continue;\n    }\n\n    if (line.length > SUMMARY_MAX_CHARS) {\n      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n    }\n\n    return line;\n  }\n\n  return \"OpenCode documentation page snapshot.\";\n}\n\nfunction keywordsForPath(sourcePath: string): string {\n  const dynamic = sourcePath\n    .split(\"/\")\n    .filter(Boolean)\n    .slice(1)\n    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n    .filter(Boolean)\n    .join(\", \");\n\n  const base = \"opencode, docs, ai coding assistant, cli\";\n  return dynamic ? `${base}, ${dynamic}` : base;\n}\n\nfunction buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n  const pageSummary = result.ok\n    ? extractSummary(result.markdown ?? \"\")\n    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  const pageBody = result.ok\n    ? result.markdown?.trim() ?? \"\"\n    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  return [\n    \"----\",\n    \"## External Docs Snapshot // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Source page: ${result.sourcePath}`,\n    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n    `- Summary: ${pageSummary}`,\n    \"----\",\n    \"\",\n    `Source: ${result.url}`,\n    \"\",\n    pageBody,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Collection method: sitemap discovery + markdown conversion.\",\n    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nfunction buildIndexMarkdown(\n  artifacts: PageArtifact[],\n  capturedAt: string,\n  outputDirRelative: string,\n): string {\n  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n  const failureCount = artifacts.length - successCount;\n\n  const pageList = artifacts\n    .map((artifact) => {\n      const status = artifact.ok ? \"ok\" : \"failed\";\n      const mode = artifact.mode ?? \"unknown\";\n      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n    })\n    .join(\"\\n\");\n\n  return [\n    \"----\",\n    \"## External Docs Index // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Output directory: ${outputDirRelative}`,\n    `- Scope: ${artifacts.length} pages under /docs`,\n    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n    \"----\",\n    \"\",\n    \"## Pages\",\n    \"\",\n    pageList,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nasync function fetchText(url: string): Promise<string> {\n  const response = await fetch(url, {\n    headers: {\n      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Request failed (${response.status}) for ${url}`);\n  }\n\n  return await response.text();\n}\n\nfunction extractLocUrls(xml: string): string[] {\n  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n    decodeEntities(match[1]?.trim() ?? \"\"),\n  ).filter(Boolean);\n}\n\nasync function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n  const visited = new Set<string>();\n  const pending: string[] = [sitemapUrl];\n  const docsUrls = new Set<string>();\n\n  while (pending.length > 0) {\n    const current = pending.pop();\n    if (!current || visited.has(current)) {\n      continue;\n    }\n\n    visited.add(current);\n\n    let xml: string;\n    try {\n      xml = await fetchText(current);\n    } catch {\n      continue;\n    }\n\n    const locUrls = extractLocUrls(xml);\n    for (const locUrl of locUrls) {\n      if (locUrl.endsWith(\".xml\")) {\n        if (!visited.has(locUrl)) {\n          pending.push(locUrl);\n        }\n        continue;\n      }\n\n      if (!locUrl.startsWith(DOCS_ROOT)) {\n        continue;\n      }\n\n      if (locUrl.includes(\"#\")) {\n        continue;\n      }\n\n      docsUrls.add(locUrl);\n    }\n  }\n\n  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n}\n\nasync function mapConcurrent<T, R>(\n  values: T[],\n  limit: number,\n  map: (value: T, index: number) => Promise<R>,\n): Promise<R[]> {\n  const results = new Array<R>(values.length);\n  let index = 0;\n\n  async function worker(): Promise<void> {\n    while (true) {\n      const currentIndex = index;\n      index += 1;\n\n      if (currentIndex >= values.length) {\n        return;\n      }\n\n      results[currentIndex] = await map(values[currentIndex], currentIndex);\n    }\n  }\n\n  const workerCount = Math.min(limit, values.length);\n  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n  return results;\n}\n\nasync function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n\n  try {\n    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n\n    try {\n      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n      if (markdown) {\n        return {\n          url,\n          ok: true,\n          markdown,\n          mode: \"jina\",\n        };\n      }\n    } catch {\n      // Fall through to direct HTML scrape.\n    }\n\n    const html = await fetchText(url);\n    const markdown = htmlToMarkdown(html);\n\n    if (!markdown) {\n      return {\n        url,\n        ok: false,\n        error: \"No markdown content returned from HTML fallback\",\n      };\n    }\n\n    return {\n      url,\n      ok: true,\n      markdown,\n      mode: \"html\",\n    };\n  } catch (error) {\n    return {\n      url,\n      ok: false,\n      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n    };\n  }\n}\n\nfunction resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n  if (!outputArg) {\n    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n  }\n\n  const resolved = resolve(repoRoot, outputArg);\n  if (resolved.endsWith(\".md\")) {\n    return dirname(resolved);\n  }\n\n  return resolved;\n}\n\nfunction clearExistingExtFiles(outputDir: string): void {\n  if (!existsSync(outputDir)) {\n    return;\n  }\n\n  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n    if (!entry.isFile()) {\n      continue;\n    }\n\n    if (!entry.name.endsWith(\".ext.md\")) {\n      continue;\n    }\n\n    rmSync(resolve(outputDir, entry.name));\n  }\n}\n\nconst repoRoot = findRepoRoot(import.meta.dir);\nconst outputArg = Bun.argv[2];\nconst outputDir = resolveOutputDirectory(repoRoot, outputArg);\nconst outputDirRelative = outputDir.startsWith(repoRoot)\n  ? outputDir.slice(repoRoot.length + 1)\n  : outputDir;\n\nmkdirSync(outputDir, { recursive: true });\nclearExistingExtFiles(outputDir);\n\nconst docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n\nif (docsUrls.length === 0) {\n  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n}\n\nconst scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n  scrapeDocsPage(url, index + 1, docsUrls.length),\n);\n\nconst usedNames = new Map<string, number>();\nconst artifacts: PageArtifact[] = scrapeResults.map((result) => {\n  const stem = fileStemFromUrl(result.url);\n  const seen = usedNames.get(stem) ?? 0;\n  usedNames.set(stem, seen + 1);\n\n  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n  const fileName = `${stem}${suffix}.ext.md`;\n\n  return {\n    ...result,\n    fileName,\n    sourcePath: sourcePathFromUrl(result.url),\n  };\n});\n\nconst capturedAt = new Date().toISOString();\n\nfor (const artifact of artifacts) {\n  const pagePath = resolve(outputDir, artifact.fileName);\n  const pageContent = buildPageMarkdown(artifact, capturedAt);\n  await Bun.write(pagePath, pageContent);\n}\n\nconst indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\nawait Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n\nconst successCount = artifacts.filter((artifact) => artifact.ok).length;\nconst failureCount = artifacts.length - successCount;\nconst blockedPages = artifacts\n  .filter((artifact) => !artifact.ok)\n  .map((artifact) => artifact.sourcePath)\n  .join(\",\");\n\nconsole.log(\n  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n);\n",
              "additions": 528,
              "deletions": 0,
              "status": "added"
            }
          ]
        },
        "agent": "build",
        "model": {
          "providerID": "openai",
          "modelID": "gpt-5.3-codex"
        },
        "variant": "low",
        "id": "msg_c64a42a82001VxLufzWxER91hc",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "text",
          "text": "Use the `docs-scraping` skill from `.opencode/skills/docs-scraping/SKILL.md`.\n\nGoal:\n\n- Implement or refresh a reusable scraper script for the requested docs source.\n- Generate split page snapshots in `docs/external/<source>/` as `.ext.md` files plus `index.ext.md`.\n\nProcess:\n\n1. Extract request metadata:\n   - source key (for folder and script naming)\n   - docs root URL\n   - page discovery strategy (`sitemap.xml` preferred)\n2. Create or update `scripts/scrape_<source>_docs.sh.ts`.\n3. Reuse helpers under `scripts/helpers/` and keep script conventions (`#!/usr/bin/env bun`, `*.sh.ts`).\n4. Implement resilient scraping:\n   - primary: `r.jina.ai` markdown proxy\n   - fallback: direct HTML conversion to markdown\n5. Write split page outputs to `docs/external/<source>/` and include `index.ext.md`.\n6. Report capture totals (`pages`, `ok`, `failed`) and blocked pages.\n7. Update `README.md` and/or `AGENTS.md` if new entrypoints or conventions were added.\n\nExample usage:\n\n- Request example: \"Scrape https://moonrepo.dev/docs into docs/external/moonrepo as split `.ext.md` pages with index.\"\n- Expected script: `scripts/scrape_moon_docs.sh.ts`\n- Expected outputs:\n  - `docs/external/moonrepo/index.ext.md`\n  - `docs/external/moonrepo/docs.ext.md`\n  - `docs/external/moonrepo/docs__install.ext.md`\n  - additional page-level `*.ext.md` files\n\nReturn:\n\n- Script path(s) added/updated\n- Output directory generated\n- Discovery strategy used\n- Capture totals and notable failures\n- Exact rerun command (`bun scripts/scrape_<source>_docs.sh.ts`)\n\nhttps://opencode.ai/docs/",
          "id": "prt_c64a42a8d001TEQPTAMh7ejLgl",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a42a82001VxLufzWxER91hc"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215006356,
          "completed": 1771215012396
        },
        "parentID": "msg_c64a42a82001VxLufzWxER91hc",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 16275,
          "input": 16172,
          "output": 103,
          "reasoning": 81,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a42a94001f7vVJBnuwhT5Zl",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fc048a8afcda575cde9221fbaa918e5f21eda0a5",
          "id": "prt_c64a433a2001BSvWp7SS0oYFux",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a42a94001f7vVJBnuwhT5Zl"
        },
        {
          "type": "reasoning",
          "text": "**Preparing to implement docs scraping**",
          "metadata": {
            "openai": {
              "itemId": "rs_03c71e8a3586d45801699298a275208196bf29a7ace2553c48",
              "reasoningEncryptedContent": "gAAAAABpkpikZdBr6XwxuLmqCNemE47IPbfVZWuSToWD6yfK4qxh6LvO18SoBBOTKvCL2SlfFePEvi9rTGLdvV-qwe8hBDf9oOgr0HDCRhiDlZ0adSXSC40zFg6wIszFXzscVYbFl_jglhCvnq3ucqgsWQqYP-MkZYVg_uQAR0k4jMTJEzRIediQ9JQYR5-hJHLK7nEXejHym1d3FKc9VCL4XEpfX1AfXCDEA9ahxnCKPFav9fXhK4u-huWA3pFfp2E-rAgb-LR9ZP4EYSPKl69siUluQ5UnmC2dKgKC9RkVMGgOO1iwRJz1hw8V_cbqrtLfAVNkgTrC7QmijQ-yXYn8TyhrupAHecU7kc4R2hHYy8Uc8IVkOE-Rcz0MckIUXj_1Ay4cVGgoZnTKINJeAMEAOHidU2yWdIm1167sDS_L7C7rZXIvroty2wsgmJrwo27IAM7o0BM3ApEdZU1OZArbJC3ZiKie4InuPmd80XclFVEWuWccTPCoyI0WHbJ0oJthSX2q6iQ9PdHxYQGUJjyJo9wcUy7QK77Fnv2fr9dGTxL1ViymWlIu8mF0dI5I-KCjq-vXfxqQ129f_CcBEJbfydOvyxYYP8wDw9qeJ6jLKZNz1xV_rFO6gLNpYVUI_HNKCc6ipE7nMHxwC9oTX1T1DNDFIvHBJqKgWiOC2ZbGVQwYLCnfY3L1O8bp-VYqXyYSAKICVcHcMDRlo-5A9yWZd4TvVd-0YaCphmfRUpcGcBnFYbYDUSitD20_TNhR6uVpAogT5OPlyS4BHEa4liGY9FkWvqbvJcVanDrK1h3WqqoJHqT6FzsgIBoSfyjZ_zFcVNdzwUiD4Km70WM6-DrDLEr-UIdQcYB4F0Q2dOl0fYpcLzdyrOe2uqInX-NETHfnH0nyxURvoXKW1kUV2lTHaX9o0PsGu2jGRZsl0tte0uTZydMGx46lV1W5iEmEHznvmGda3J2T6jtmG7R3aSzMdfgu0li-HPIiCbPTXhrezzpSlRt61LOi1iIvEoBO1inZFn2QC72zT2RmtM8OezdPgf1NvmhGbDLMm0miBDYtc41U1JuTf0kVdo9eS6sGEe1szbdET6VDldeq-e2nI5owFNetAzQ6uG4hT6R3KgSgXdygj-z4yR9yL3lJ3D_MYGR7pFy9MpdRQE1tEqavQjYON_7YqS0_fDEluflCRLr25jamYMebBG4xsSTwHtRxUct16DrOVoWGuXV8CUaZMN9heJE_6C2Dk_4wAxzezIBNvWELq6_HOjNleQIqhp222rLaDwWjrDB43SBPXAwDjWcEwychW5Biuk9c4THhHgKyZKM8pXf3e4ahvyAdGnc_51gmmvGBLWiT0Dp9HqBzOeIL6hNpfrHtoVpOb4ACFskQuv6A_0aSXTQ="
            }
          },
          "time": {
            "start": 1771215010538,
            "end": 1771215012221
          },
          "id": "prt_c64a43aea0017tL3SZ3XxYLbN6",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a42a94001f7vVJBnuwhT5Zl"
        },
        {
          "type": "tool",
          "callID": "call_A1B15lwnUv1LgU1rP4x1RtqR",
          "tool": "skill",
          "state": {
            "status": "completed",
            "input": {
              "name": "docs-scraping"
            },
            "output": "<skill_content name=\"docs-scraping\">\n# Skill: docs-scraping\n\n## What I do\n\n- Turn a user docs scraping request into a reusable script and generated docs snapshot output.\n- Standardize output under `docs/external/<source>/` with one page-level `.ext.md` file per discovered page.\n- Ensure each generated page has a metadata header and notes footer, and create an `index.ext.md` manifest.\n\n## Accepted request patterns\n\nUse this skill when the request includes one or more of:\n\n- A docs root URL (for example `https://example.dev/docs`)\n- A source/domain name (for example `moonrepo`, `astro`, `pnpm`)\n- A request to \"scrape\", \"snapshot\", \"mirror\", or \"refresh\" external docs\n\n## Output contract\n\n- Script: `scripts/scrape_<source>_docs.sh.ts`\n- Output directory: `docs/external/<source>/`\n- Output files:\n  - Per-page files: `<stable-page-stem>.ext.md`\n  - Index file: `index.ext.md`\n\n## Behavior requirements\n\n1. Resolve source metadata from the user request:\n   - `source` key (safe folder/script slug)\n   - docs root URL\n   - discovery method (`sitemap.xml` preferred)\n2. Reuse project script conventions:\n   - Bun shebang (`#!/usr/bin/env bun`)\n   - `*.sh.ts` naming\n   - helpers under `scripts/helpers/`\n3. Use resilient scraping strategy:\n   - Primary: `r.jina.ai` markdown proxy\n   - Fallback: direct HTML fetch + conversion to markdown\n4. Normalize filenames from docs paths:\n   - deterministic flattening (for example `docs__guides__intro.ext.md`)\n5. Regenerate output cleanly:\n   - remove old `*.ext.md` in target source directory\n   - write fresh per-page files and `index.ext.md`\n\n## Generated page format\n\n- Top `----` section with summary metadata:\n  - captured timestamp\n  - source root\n  - source page URL/path\n  - keywords\n  - concise summary\n- Middle body with markdown content snapshot\n- Bottom `----` notes/comments/lessons section\n\n## Index format\n\n- Top `----` section with source/capture metadata and summary totals\n- Full page inventory with links to local page files and capture status\n- Bottom `----` notes/comments/lessons section\n\n## Implementation workflow\n\n1. Inspect existing scraper scripts for reuse patterns (`scripts/scrape_*.sh.ts`).\n2. Create or update `scripts/scrape_<source>_docs.sh.ts`.\n3. Run the script once to generate docs output.\n4. Report totals (`pages`, `ok`, `failed`) and notable blocked pages.\n5. If a new script entrypoint was introduced, update `README.md` and `AGENTS.md`.\n\n## Safety constraints\n\n- Never embed secrets, auth headers, or private tokens in script or output files.\n- Skip private/authenticated docs pages unless explicit credentials handling is requested and safe.\n- Keep scripts idempotent and deterministic where practical.\n\n## Return checklist\n\n- Script path(s) added/updated\n- Output directory generated/refreshed\n- Discovery strategy used\n- Capture totals and notable failures\n- Exact rerun command (`bun scripts/scrape_<source>_docs.sh.ts`)\n\nBase directory for this skill: file:///Users/alex/repos/vfp/dark-factory/.opencode/skills/docs-scraping\nRelative paths in this skill (e.g., scripts/, reference/) are relative to this base directory.\nNote: file list is sampled.\n\n<skill_files>\n\n</skill_files>\n</skill_content>",
            "title": "Loaded skill: docs-scraping",
            "metadata": {
              "name": "docs-scraping",
              "dir": "/Users/alex/repos/vfp/dark-factory/.opencode/skills/docs-scraping",
              "truncated": false
            },
            "time": {
              "start": 1771215012296,
              "end": 1771215012307
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_03c71e8a3586d45801699298a42c988196a6d26f4f36582af8"
            }
          },
          "id": "prt_c64a4417e001S7t1DlNwpCmFaR",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a42a94001f7vVJBnuwhT5Zl"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "fc048a8afcda575cde9221fbaa918e5f21eda0a5",
          "cost": 0,
          "tokens": {
            "total": 16275,
            "input": 16172,
            "output": 103,
            "reasoning": 81,
            "cache": {
              "read": 0,
              "write": 0
            }
          },
          "id": "prt_c64a441fa001FRIL8VK7fixV5u",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a42a94001f7vVJBnuwhT5Zl"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215012397,
          "completed": 1771215019466
        },
        "parentID": "msg_c64a42a82001VxLufzWxER91hc",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 17210,
          "input": 921,
          "output": 161,
          "reasoning": 25,
          "cache": {
            "read": 16128,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a4422d001z46sZnsEaCovmT",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fc048a8afcda575cde9221fbaa918e5f21eda0a5",
          "id": "prt_c64a44a43001dM1CzdQIUMnErL",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a4422d001z46sZnsEaCovmT"
        },
        {
          "type": "reasoning",
          "text": "**Checking for existing scraping scripts**",
          "metadata": {
            "openai": {
              "itemId": "rs_097655494420901801699298a8f8f881968f0177a403900f1c",
              "reasoningEncryptedContent": "gAAAAABpkpir5aKUVGK3Db6nWsPvy0YX_fqSXh0O4HjoRXIXmdX15MFnNXgwTpwPNS6nioinHcd4dMP2hHSPGihB7lhKhSeMfQGeYXW4DpRsrjl_HOWyFaDuQ5IuYFLTPGH6vcubVHd9RRF7cV5M_jL0pdq5_XjdiApBjc6I0Azn9-7PCtIxHD5VZOdEzfC43TxA3JtwKHh0tS8JnyAtECY77SS02iEA2LhSzjyaQkJrHK7alu6lTJ49ZaDU4uh-4ugiobTg4qLKSTrGWLL6js5WyZYA7OsACbi6yw9_yG6WH6Qh71y3dchf9cRN7ctcitvzhHDsXu0cOMPyXAD3j9oTSpuxG-SbbdUq0TBTg_9Z8u6yczLQUnBk0wO3so34Gb01XzUB3QE6HXy8bi5I66dUPTvmmSZqXg_1HHcNcRBRqc9kJnKeI9v4xb23t1e-Rh_NsIgUGxceDIADVMYSgHutxNEZJFFd6C_PmyV4CJWi1rTrSMnyne4pvhjdxch6r2EEmgPj8CVZtOdafvhHHNHTAStkj-r0rFmeIbkd6mbDyyNursgP53gnyHjY2ONlOFxqkcPmNGsyZDGiiXEf6bDGW2RKpk1yKQOT5f_fNZX0iejHQzH2bxnMwDfqCHVERPXTdLIU_UVjr_jR9nKQmdPAweVDu8Jul4DQhjyfX8raFuWKRS3lyzeFsxrzcl07o70ThQdwB3RKmmZ3O_cnGU6FaMYJpUZWR2eYnzaPzrIyqpODTwhkQIGD_lONGSnlX6OJWd_LACHfV-cImc-ByfmxzAUQuksVpz9UAeebPoU_dgCd3cwSoCMapOF0UilGrqOKO4HVoP6-twvCv-6X8L0qFfLUfTUsEp-IFVqomGl_TZYlPKODY9FbCeFjyKMpTP1F7ivRya8s37Y-Fy83DnK3zwU1krFAlxjCPpRNQwrbf4_0SPN6A-kfBo7gnv0C5V42IFv3ygSAq5YhDehw2Ll70d91nEyaKQ=="
            }
          },
          "time": {
            "start": 1771215017011,
            "end": 1771215019404
          },
          "id": "prt_c64a45433001RdJj9zTaXgR7Zo",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a4422d001z46sZnsEaCovmT"
        },
        {
          "type": "tool",
          "callID": "call_g7MZJAb6RaXcYroOFKUMc8xj",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "scripts/**/*.ts",
              "path": "/Users/alex/repos/vfp/dark-factory"
            },
            "output": "/Users/alex/repos/vfp/dark-factory/scripts/scrape_moon_docs.sh.ts\n/Users/alex/repos/vfp/dark-factory/scripts/install.sh.ts\n/Users/alex/repos/vfp/dark-factory/scripts/helpers/run_steps.sh.ts\n/Users/alex/repos/vfp/dark-factory/scripts/proto_install.sh.ts\n/Users/alex/repos/vfp/dark-factory/scripts/helpers/run_root.sh.ts",
            "title": "",
            "metadata": {
              "count": 5,
              "truncated": false
            },
            "time": {
              "start": 1771215019406,
              "end": 1771215019422
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_097655494420901801699298ab38fc8196958141959c2cae5c"
            }
          },
          "id": "prt_c64a45d8d001Ui7S7D2cvFXDVX",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a4422d001z46sZnsEaCovmT"
        },
        {
          "type": "tool",
          "callID": "call_TgE8AkRp54OJ22Nzt097mhUj",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "docs/external/**/*",
              "path": "/Users/alex/repos/vfp/dark-factory"
            },
            "output": "/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__terminology.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/index.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__plugins.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__wasm-plugin.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__tools.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__run-task.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__install.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__non-wasm-plugin.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__use.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__faq.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__config.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__plugin__search.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__unalias.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__uninstall.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__upgrade.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__status.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__run.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__plugin__info.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__plugin__list.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__unpin.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__regen.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__list.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__completions.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__debug.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__debug__env.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__plugin.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__diagnose.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__how-it-works__project-graph.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__migrate__2-0.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__proto__commands__clean.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__how-it-works__task-graph.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__migrate-to-moon.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__root-project.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__vcs-hooks.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__sharing-config.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__how-it-works__action-graph.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__remote-cache.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__profile.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__node__examples.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__open-source.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__javascript__deno-handbook.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__javascript__typescript-eslint.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__vue.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__packemon.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__storybook.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__react.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__remix.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__sveltekit.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__vite.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__eslint.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__jest.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__nuxt.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__guides__examples__angular.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__editors__vscode.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__editors.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__create-task.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__config__template.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__config__project.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__config__toolchain.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__config__extensions.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__config__overview.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__config.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__upgrade.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__concepts__file-group.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__concepts__cache.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__concepts.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__concepts__task.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__concepts__file-pattern.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__concepts__query-lang.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__toolchain.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__sync__projects.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__teardown.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__templates.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__toolchain__info.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__toolchain__add.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__task.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__sync__code-owners.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__query__projects.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__setup.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__projects.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__mcp.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__overview.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__query.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__project-graph.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__query__affected.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__exec.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__extension.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__extension__add.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__extension__info.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__hash.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__generate.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__docker.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__docker__prune.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__docker__setup.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__clean.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__action-graph.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__cheat-sheet.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__ci.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__check.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/moonrepo/docs__commands__bin.ext.md\n\n(Results are truncated: showing first 100 results. Consider using a more specific path or pattern.)",
            "title": "",
            "metadata": {
              "count": 100,
              "truncated": true
            },
            "time": {
              "start": 1771215019407,
              "end": 1771215019424
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_097655494420901801699298ab390c81968ae2eccb7a591541"
            }
          },
          "id": "prt_c64a45d8f001j9e19KGjohrfR9",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a4422d001z46sZnsEaCovmT"
        },
        {
          "type": "tool",
          "callID": "call_WLWOqk99uMVXY9W0oZKV3ioq",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/Users/alex/repos/vfp/dark-factory/README.md"
            },
            "output": "<path>/Users/alex/repos/vfp/dark-factory/README.md</path>\n<type>file</type>\n<content>1: # Dark Factory - Autonomous Agentic Development At Scale\n2: \n3: # Concept\n4: \n5: - A central `dark-factory` \"core\" is used to track `products`\n6: - A `product` is the canonical definition of a code product we want to work on\n7:   - In Stage 0 this is identified by a local path-based locator key\n8:   - Locators are path/url-like identifiers, currently using `@local://{abs_path}`\n9:   - `product` may optionally include a `display_name` for human-friendly rendering\n10: - A `variant` is a spawned instance of a `product` where work actually runs\n11:   - In Stage 0 a product immediately gets one default variant on creation\n12:   - Variant identity follows the same locator pattern with a fragment suffix:\n13:     - `@local://{abs_path}#default`\n14:   - Future variants can use other suffixes (example: `#wt-main`) when we support parallel instances\n15: - Stage 0 topology is intentionally strict and simple:\n16:   - One product locator\n17:   - One default variant locator\n18:   - One actor bound to that variant\n19: - `actor` is a spawned agent that operates on a variant\n20:   - Can be various agent backends (currently scoped in OpenCode, Codex and a custom agent), but first iteration is JUST OpenCode\n21:   - Future work will allow multiple variants per product and multiple actors where operations allow\n22: \n23: # Stack + Tools\n24: \n25: - Agentic Coding: `opencode`\n26: - Main languages: `rust` and `bun` / `typescript`\n27: - Scripting: shebanged Bun TypeScript scripts under `scripts/` (`*.sh.ts`)\n28: - Optional build system: `moon` / `proto`\n29: - Common Schema Definition: `prisma`\n30:   - [ ] TODO: Investigate use of protobuf\n31: \n32: # Scripts\n33: \n34: - Project shell-style scripts are Bun TypeScript files with shebangs: `#!/usr/bin/env bun`.\n35: - Shared helpers live in `scripts/helpers/`.\n36: - `scripts/install.sh.ts` runs an ordered array of install steps from repository root.\n37: - `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n38: - `scripts/scrape_moon_docs.sh.ts` captures moonrepo docs as split per-page `docs/external/moonrepo/*.ext.md` files plus `docs/external/moonrepo/index.ext.md`.\n39: - OpenCode skill reference: `.opencode/skills/proto-install/SKILL.md`.\n40: - OpenCode skill reference: `.opencode/skills/script-authoring/SKILL.md`.\n41: - OpenCode skill reference: `.opencode/skills/docs-scraping/SKILL.md`.\n42: \n43: # Components\n44: \n45: ## Core\n46: \n47: - Central service that manages tracking of all products/variants/actors/settings, etc.\n48:   - TBD: will either be stateless w/ DB and route all commands just to the agents\n49:     - OR: a background API service (REST even) we can query from frontends\n50: - Currently looks like it will be Bun + Elysia JS\n51: \n52: ## Frontends\n53: \n54: - Various frontends that invoke / connect to Core\n55: - Main way of iterating with the system\n56: - Uses the Core API to communicate (REST / WS or GRPC in the future)\n57: - Some Frontends:\n58:   - Rust TUI (Ratatui.rs) - First One\n59:   - Web Client (Bun + Vite + Shadcn + React)\n60:   - Pure CLI (Rust)\n61: \n62: ## Agents\n63: \n64: - Abstracted communication with actual agents doing work\n65: - First is OpenCode\n66: \n\n(End of file - total 66 lines)\n</content>",
            "title": "README.md",
            "metadata": {
              "preview": "# Dark Factory - Autonomous Agentic Development At Scale\n\n# Concept\n\n- A central `dark-factory` \"core\" is used to track `products`\n- A `product` is the canonical definition of a code product we want to work on\n  - In Stage 0 this is identified by a local path-based locator key\n  - Locators are path/url-like identifiers, currently using `@local://{abs_path}`\n  - `product` may optionally include a `display_name` for human-friendly rendering\n- A `variant` is a spawned instance of a `product` where work actually runs\n  - In Stage 0 a product immediately gets one default variant on creation\n  - Variant identity follows the same locator pattern with a fragment suffix:\n    - `@local://{abs_path}#default`\n  - Future variants can use other suffixes (example: `#wt-main`) when we support parallel instances\n- Stage 0 topology is intentionally strict and simple:\n  - One product locator\n  - One default variant locator\n  - One actor bound to that variant\n- `actor` is a spawned agent that operates on a variant\n  - Can be various agent backends (currently scoped in OpenCode, Codex and a custom agent), but first iteration is JUST OpenCode",
              "truncated": false,
              "loaded": []
            },
            "time": {
              "start": 1771215019409,
              "end": 1771215019413
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_097655494420901801699298ab39148196a6fcade18a17157b"
            }
          },
          "id": "prt_c64a45d90001STkZF1law8ek5O",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a4422d001z46sZnsEaCovmT"
        },
        {
          "type": "tool",
          "callID": "call_uLT8TgpYHgq29vQzjN9lwXzZ",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/Users/alex/repos/vfp/dark-factory/AGENTS.md"
            },
            "output": "<path>/Users/alex/repos/vfp/dark-factory/AGENTS.md</path>\n<type>file</type>\n<content>1: # Dark Factory - Agent Operating Guide\n2: \n3: This file is for coding agents working in `dark-factory`.\n4: It reflects only what is currently true in this repository.\n5: \n6: ## 1) Current Repository Context\n7: \n8: - The repo is early-stage and mostly docs/config right now.\n9: - Tracked project files currently include:\n10:   - `README.md`\n11:   - `TODO.md`\n12:   - `AGENTS.md`\n13:   - `opencode.jsonc`\n14:   - `.opencode/agents/gitter.md`\n15:   - `.opencode/skills/gitter-commit/SKILL.md`\n16: - No application code tree is committed yet (`src/`, `apps/`, `crates/`, etc.).\n17: \n18: ## 2) Build/Lint/Test Status (Current Truth)\n19: \n20: - There are no validated build, lint, typecheck, or test commands yet.\n21: - Do not invent or assume project commands in commits or PR notes.\n22: - If new tooling is added, document only commands that are verified in this repo.\n23: \n24: ## 3) Cursor and Copilot Rules\n25: \n26: - Checked and currently absent:\n27:   - `.cursor/rules/`\n28:   - `.cursorrules`\n29:   - `.github/copilot-instructions.md`\n30: - If any of these files appear later, treat them as authoritative and update this guide.\n31: \n32: ## 4) Coding Style (Minimal Baseline)\n33: \n34: Until language/tool-specific configs exist, follow pragmatic defaults:\n35: \n36: - Favor readable, explicit code over clever shortcuts.\n37: - Keep functions focused and avoid hidden side effects.\n38: - Avoid dead code, unused imports, and speculative abstractions.\n39: - Keep naming consistent (`PascalCase` types, `camelCase` values/functions, `UPPER_SNAKE_CASE` constants).\n40: - Handle errors with context; do not swallow exceptions silently.\n41: - Never log secrets or credentials.\n42: - Log messages should follow: `System // Optional Sub system // Message (Metadata)`.\n43:   - Example: `Core // HTTP // Listening (env=development,host=127.0.0.1,port=4150)`.\n44: \n45: ## 5) Git Workflow\n46: \n47: - Commit meaningful units of work; avoid giant mixed commits.\n48: - Do not push unless the user explicitly requests it.\n49: - Commit message format:\n50:   - `{Component/Meta} // {Optional Addition} // {Short Description} (Optional,Tags)`\n51: - Examples:\n52:   - `Docs // Added converted PDF docs`\n53:   - `Pipelines // ODM // Added initial ODM pipeline (WIP)`\n54: - In commit body, add a short rationale and signature when possible:\n55:   - `// Chappie/Model (your model if known)`\n56: \n57: ## 6) OpenCode Integration\n58: \n59: - `.opencode/agents/gitter.md` is the git-focused subagent.\n60: - `.opencode/skills/gitter-commit/SKILL.md` documents when to route commit tasks to `@gitter`.\n61: - `.opencode/skills/proto-install/SKILL.md` documents standardized script-based `proto install` usage.\n62: - `.opencode/skills/protobuf-schema-authoring/SKILL.md` documents how to author proto2/proto3 schemas and provide Rust/TypeScript codegen workflows.\n63: - `.opencode/skills/script-authoring/SKILL.md` documents how to build reusable Bun scripts from prompt/example/bash/context.\n64: - `.opencode/skills/docs-scraping/SKILL.md` documents generic user-request driven external docs scraping workflows.\n65: - Use `@gitter` when the user asks for commit support or cleanup.\n66: \n67: ## 7) Local Fork Workflow (`elysia-protobuf`)\n68: \n69: - `elysia-protobuf` is also cloned locally at `~/repos/vfp/elysia-protobuf`.\n70: - If Core hits a bug in that dependency, patch it in the local fork repo, push the fork, then update the pinned git ref in `core/package.json` and refresh `core/bun.lock`.\n71: - Core currently tracks `elysia-protobuf` from the fork `master` branch in `core/package.json`; after pushing fork changes, refresh `core/bun.lock` in this repo.\n72: \n73: ## 8) Script Conventions\n74: \n75: - Project scripts use shebanged Bun TypeScript files (`#!/usr/bin/env bun`) under `scripts/`.\n76: - Script naming uses `*.sh.ts` to indicate executable shell-style Bun scripts.\n77: - Shared script helpers live under `scripts/helpers/`.\n78: - `scripts/install.sh.ts` runs a reusable ordered list of install steps.\n79: - `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n80: - `scripts/scrape_moon_docs.sh.ts` scrapes moonrepo docs into split per-page `docs/external/moonrepo/*.ext.md` files and writes `docs/external/moonrepo/index.ext.md`.\n81: - After a new command sequence succeeds in a conversation, suggest capturing it into a reusable script via `.opencode/commands/capture_script_from_context.md`.\n82: \n83: ## 9) Keep This File Updated\n84: \n85: - Update this file when real code, tooling, or CI is added.\n86: - Keep instructions tied to verified repository behavior.\n87: - Prefer short, accurate guidance over aspirational process docs.\n88: \n\n(End of file - total 88 lines)\n</content>",
            "title": "AGENTS.md",
            "metadata": {
              "preview": "# Dark Factory - Agent Operating Guide\n\nThis file is for coding agents working in `dark-factory`.\nIt reflects only what is currently true in this repository.\n\n## 1) Current Repository Context\n\n- The repo is early-stage and mostly docs/config right now.\n- Tracked project files currently include:\n  - `README.md`\n  - `TODO.md`\n  - `AGENTS.md`\n  - `opencode.jsonc`\n  - `.opencode/agents/gitter.md`\n  - `.opencode/skills/gitter-commit/SKILL.md`\n- No application code tree is committed yet (`src/`, `apps/`, `crates/`, etc.).\n\n## 2) Build/Lint/Test Status (Current Truth)\n\n- There are no validated build, lint, typecheck, or test commands yet.",
              "truncated": false,
              "loaded": []
            },
            "time": {
              "start": 1771215019410,
              "end": 1771215019414
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_097655494420901801699298ab391c81969a410f2a89707b4b"
            }
          },
          "id": "prt_c64a45d92001xoN7eohP5u9YZc",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a4422d001z46sZnsEaCovmT"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "fc048a8afcda575cde9221fbaa918e5f21eda0a5",
          "cost": 0,
          "tokens": {
            "total": 17210,
            "input": 921,
            "output": 161,
            "reasoning": 25,
            "cache": {
              "read": 16128,
              "write": 0
            }
          },
          "id": "prt_c64a45da1001CA2nkrHuQuIrsL",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a4422d001z46sZnsEaCovmT"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215019467,
          "completed": 1771215024191
        },
        "parentID": "msg_c64a42a82001VxLufzWxER91hc",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 22267,
          "input": 5318,
          "output": 53,
          "reasoning": 14,
          "cache": {
            "read": 16896,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a45dcb001xV6ld55zbyNP6c",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fc048a8afcda575cde9221fbaa918e5f21eda0a5",
          "id": "prt_c64a4661f001SP6bODkvYSxls5",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a45dcb001xV6ld55zbyNP6c"
        },
        {
          "type": "reasoning",
          "text": "**Inspecting existing scraper pattern**",
          "metadata": {
            "openai": {
              "itemId": "rs_082e2ad3f2d886f201699298af39508195926a742361a39bed",
              "reasoningEncryptedContent": "gAAAAABpkpivcAz2EtQc6T6bWp19Wm8FKWCkdmmwpXlNHUNnviWR980JFb7MLjPGieZbeBbvPAuTwXzUaHzXXP_hIHg58753JI9OCwsTYwWHxeVKqpiwfAzoxdsJjw4EUzWR08MNIeR0z6PI9aeuTJdMVTDX3SGZdwZcG-Ucb1icndHUR0bFDLVvU6fWNJQJsWWgSGr9h39EQLPzSjMcjKd3qbhsW1uWdJZps3wrp-emUuFaG-QooRg8YNrxpARUnIaJVvXAOqXLWciAyBxrU5GiM6l3zCx9Uu52UhgXZ0qGiLf0AO3RaAXPGrmRpT8Ha9CrIpJKRO7XUCFfg_AdooFjAtGiL4tnjrBPGf9cduCAnn74B8e_zCtYPzD-apmgOPF6TMi8VV18nZ0Z81wVN6B75gaO8VnfnnJYfrorn0CiANyn-ZF4hCz5ydhWDlZRs6vLxCcX7NW9iikfu-UBsKsNuuPFIiM2nGLLOw42aFOQt0NmZ8dAAPzhZcg3rIJMqQ0cUBNZUstdVHjmfq7CO_97nKCFJXO5YL4RxhYgGMyFXw7yX9KrREFBCUcUuuW533B7pYpkiamD2ccxlJIVOguMzv1SvkuSxRXyetoQ_DOZyayo2_CKVNY0XBM4_FlVyfvL8M0AL7J8ktjQ62qumo7zbfoJxGx9fGIGepPaNe4U-hUFa68zfPuZ9PEXZ21IAY18cHc8IK1JLbobywuw5GsC3psoaNR1ucadLdoNvQKwpUOjM34Pxf7GBzlIGPM2223ar8YuI8kx75NJsdOx6zlEzfgdi0Vv45sru9pL1y_iVRxV2qbCb8uvdXEIgRA3Y0GaMy6HNp5nYDsEX4GcQ161Tx7Mfl4k13b2SQv0Zv9GTPedO1Risx5zCjNmRG8iF9q0MXvNadp8ir2P3G7tavvRuqhrEdOg_A=="
            }
          },
          "time": {
            "start": 1771215023254,
            "end": 1771215023861
          },
          "id": "prt_c64a46c96001qnjTkItiJKBLYH",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a45dcb001xV6ld55zbyNP6c"
        },
        {
          "type": "tool",
          "callID": "call_UAExxbWfhNtSrlppmdTLGlsW",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/Users/alex/repos/vfp/dark-factory/scripts/scrape_moon_docs.sh.ts"
            },
            "output": "<path>/Users/alex/repos/vfp/dark-factory/scripts/scrape_moon_docs.sh.ts</path>\n<type>file</type>\n<content>1: #!/usr/bin/env bun\n2: \n3: import { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\n4: import { dirname, resolve } from \"node:path\";\n5: import { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n6: \n7: type ScrapeMode = \"jina\" | \"html\";\n8: \n9: type ScrapeResult = {\n10:   url: string;\n11:   ok: boolean;\n12:   markdown?: string;\n13:   error?: string;\n14:   mode?: ScrapeMode;\n15: };\n16: \n17: type PageArtifact = ScrapeResult & {\n18:   fileName: string;\n19:   sourcePath: string;\n20: };\n21: \n22: const SITEMAP_URL = \"https://moonrepo.dev/sitemap.xml\";\n23: const DOCS_ROOT = \"https://moonrepo.dev/docs\";\n24: const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/moonrepo\";\n25: const CONCURRENCY = 4;\n26: const SUMMARY_MAX_CHARS = 240;\n27: \n28: function decodeEntities(value: string): string {\n29:   return value\n30:     .replaceAll(\"&amp;\", \"&\")\n31:     .replaceAll(\"&quot;\", '\"')\n32:     .replaceAll(\"&apos;\", \"'\")\n33:     .replaceAll(\"&#x27;\", \"'\")\n34:     .replaceAll(\"&#39;\", \"'\")\n35:     .replaceAll(\"&nbsp;\", \" \")\n36:     .replaceAll(\"&lt;\", \"<\")\n37:     .replaceAll(\"&gt;\", \">\");\n38: }\n39: \n40: function stripJinaEnvelope(markdown: string): string {\n41:   return markdown\n42:     .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n43:     .trim();\n44: }\n45: \n46: function stripTags(value: string): string {\n47:   return value.replace(/<[^>]+>/g, \"\");\n48: }\n49: \n50: function plainTextFromHtml(value: string): string {\n51:   return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n52: }\n53: \n54: function extractMainHtml(html: string): string {\n55:   const markdownBlockMatch = html.match(\n56:     /<div class=\"theme-doc-markdown markdown\">([\\s\\S]*?)<footer class=\"theme-doc-footer/s,\n57:   );\n58: \n59:   if (markdownBlockMatch?.[1]) {\n60:     return markdownBlockMatch[1];\n61:   }\n62: \n63:   const articleMatch = html.match(/<article>([\\s\\S]*?)<\\/article>/s);\n64:   if (articleMatch?.[1]) {\n65:     return articleMatch[1];\n66:   }\n67: \n68:   const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/s);\n69:   return mainMatch?.[1] ?? html;\n70: }\n71: \n72: function htmlToMarkdown(html: string): string {\n73:   let content = extractMainHtml(html);\n74: \n75:   content = content\n76:     .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n77:     .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n78:     .replace(/<a[^>]*class=\"hash-link\"[^>]*>[\\s\\S]*?<\\/a>/gi, \"\")\n79:     .replace(/<span[^>]*aria-hidden=\"true\"[^>]*>[\\s\\S]*?<\\/span>/gi, \"\");\n80: \n81:   content = content.replace(\n82:     /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n83:     (_match, code) => {\n84:       const normalizedCode = decodeEntities(\n85:         stripTags(code)\n86:           .replace(/<br\\s*\\/?>/gi, \"\\n\")\n87:           .replace(/\\n{3,}/g, \"\\n\\n\")\n88:           .trim(),\n89:       );\n90: \n91:       if (!normalizedCode) {\n92:         return \"\";\n93:       }\n94: \n95:       return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n96:     },\n97:   );\n98: \n99:   content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n100:     const normalizedCode = decodeEntities(stripTags(code)).trim();\n101:     return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n102:   });\n103: \n104:   content = content.replace(\n105:     /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n106:     (_match, href, label) => {\n107:       const text = plainTextFromHtml(label);\n108:       if (!text) {\n109:         return \"\";\n110:       }\n111: \n112:       return `[${text}](${decodeEntities(href)})`;\n113:     },\n114:   );\n115: \n116:   content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n117:     const heading = plainTextFromHtml(inner);\n118:     if (!heading) {\n119:       return \"\";\n120:     }\n121: \n122:     return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n123:   });\n124: \n125:   content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n126:     const line = plainTextFromHtml(inner);\n127:     return line ? `- ${line}\\n` : \"\";\n128:   });\n129: \n130:   content = content\n131:     .replace(/<br\\s*\\/?>/gi, \"\\n\")\n132:     .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n133:     .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n134:     .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n135:       const cell = plainTextFromHtml(inner);\n136:       return cell ? `${cell} ` : \"\";\n137:     });\n138: \n139:   content = decodeEntities(content)\n140:     .replace(/<[^>]+>/g, \"\")\n141:     .replace(/[ \\t]+\\n/g, \"\\n\")\n142:     .replace(/\\n{3,}/g, \"\\n\\n\")\n143:     .trim();\n144: \n145:   return content;\n146: }\n147: \n148: function extractDocsUrls(sitemapXml: string): string[] {\n149:   const urls = Array.from(sitemapXml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n150:     decodeEntities(match[1]?.trim() ?? \"\"),\n151:   )\n152:     .filter((url) => url.startsWith(DOCS_ROOT))\n153:     .filter((url) => !url.includes(\"/docs/tags\"))\n154:     .filter((url) => !url.includes(\"#\"));\n155: \n156:   return Array.from(new Set(urls)).sort((a, b) => a.localeCompare(b));\n157: }\n158: \n159: function sanitizeSegment(value: string): string {\n160:   const clean = decodeURIComponent(value)\n161:     .toLowerCase()\n162:     .replace(/[^a-z0-9]+/g, \"-\")\n163:     .replace(/^-+|-+$/g, \"\");\n164: \n165:   return clean || \"page\";\n166: }\n167: \n168: function sourcePathFromUrl(url: string): string {\n169:   const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n170:   return pathname;\n171: }\n172: \n173: function fileStemFromUrl(url: string): string {\n174:   const sourcePath = sourcePathFromUrl(url);\n175: \n176:   if (sourcePath === \"/docs\") {\n177:     return \"docs\";\n178:   }\n179: \n180:   const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n181:   const segments = relative\n182:     .split(\"/\")\n183:     .filter(Boolean)\n184:     .map(sanitizeSegment);\n185: \n186:   if (segments.length === 0) {\n187:     return \"docs\";\n188:   }\n189: \n190:   return [\"docs\", ...segments].join(\"__\");\n191: }\n192: \n193: function extractSummary(markdown: string): string {\n194:   const lines = markdown.split(\"\\n\");\n195:   let inCodeBlock = false;\n196: \n197:   for (const rawLine of lines) {\n198:     const line = rawLine.trim();\n199: \n200:     if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n201:       inCodeBlock = !inCodeBlock;\n202:       continue;\n203:     }\n204: \n205:     if (inCodeBlock) {\n206:       continue;\n207:     }\n208: \n209:     if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n210:       continue;\n211:     }\n212: \n213:     if (line.length <= 25) {\n214:       continue;\n215:     }\n216: \n217:     if (line.length > SUMMARY_MAX_CHARS) {\n218:       return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n219:     }\n220: \n221:     return line;\n222:   }\n223: \n224:   return \"moonrepo documentation page snapshot.\";\n225: }\n226: \n227: function keywordsForPath(sourcePath: string): string {\n228:   const dynamic = sourcePath\n229:     .split(\"/\")\n230:     .filter(Boolean)\n231:     .slice(1)\n232:     .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n233:     .filter(Boolean)\n234:     .join(\", \");\n235: \n236:   const base = \"moon, moonrepo, docs, monorepo, build\";\n237:   return dynamic ? `${base}, ${dynamic}` : base;\n238: }\n239: \n240: function buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n241:   const pageSummary = result.ok\n242:     ? extractSummary(result.markdown ?? \"\")\n243:     : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n244: \n245:   const pageBody = result.ok\n246:     ? result.markdown?.trim() ?? \"\"\n247:     : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n248: \n249:   return [\n250:     \"----\",\n251:     \"## External Docs Snapshot // moonrepo\",\n252:     \"\",\n253:     `- Captured: ${capturedAt}`,\n254:     `- Source root: ${DOCS_ROOT}`,\n255:     `- Source page: ${result.sourcePath}`,\n256:     `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n257:     `- Summary: ${pageSummary}`,\n258:     \"----\",\n259:     \"\",\n260:     `Source: ${result.url}`,\n261:     \"\",\n262:     pageBody,\n263:     \"\",\n264:     \"----\",\n265:     \"## Notes / Comments / Lessons\",\n266:     \"\",\n267:     \"- Collection method: sitemap discovery + markdown conversion.\",\n268:     `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n269:     \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n270:     \"----\",\n271:     \"\",\n272:   ].join(\"\\n\");\n273: }\n274: \n275: function buildIndexMarkdown(\n276:   artifacts: PageArtifact[],\n277:   capturedAt: string,\n278:   outputDirRelative: string,\n279: ): string {\n280:   const successCount = artifacts.filter((artifact) => artifact.ok).length;\n281:   const failureCount = artifacts.length - successCount;\n282: \n283:   const pageList = artifacts\n284:     .map((artifact) => {\n285:       const status = artifact.ok ? \"ok\" : \"failed\";\n286:       const mode = artifact.mode ?? \"unknown\";\n287:       return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n288:     })\n289:     .join(\"\\n\");\n290: \n291:   return [\n292:     \"----\",\n293:     \"## External Docs Index // moonrepo\",\n294:     \"\",\n295:     `- Captured: ${capturedAt}`,\n296:     `- Source root: ${DOCS_ROOT}`,\n297:     `- Output directory: ${outputDirRelative}`,\n298:     `- Scope: ${artifacts.length} pages under /docs (excluding /docs/tags)`,\n299:     \"- Keywords: moon, moonrepo, docs index, monorepo, build system, toolchain, proto\",\n300:     \"- Summary: This index links one `.ext.md` file per docs page snapshot for moonrepo.\",\n301:     \"----\",\n302:     \"\",\n303:     \"## Pages\",\n304:     \"\",\n305:     pageList,\n306:     \"\",\n307:     \"----\",\n308:     \"## Notes / Comments / Lessons\",\n309:     \"\",\n310:     \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n311:     \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n312:     `- Capture results: success=${successCount}, failed=${failureCount}.`,\n313:     \"----\",\n314:     \"\",\n315:   ].join(\"\\n\");\n316: }\n317: \n318: async function fetchText(url: string): Promise<string> {\n319:   const response = await fetch(url, {\n320:     headers: {\n321:       \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n322:     },\n323:   });\n324: \n325:   if (!response.ok) {\n326:     throw new Error(`Request failed (${response.status}) for ${url}`);\n327:   }\n328: \n329:   return await response.text();\n330: }\n331: \n332: async function mapConcurrent<T, R>(\n333:   values: T[],\n334:   limit: number,\n335:   map: (value: T, index: number) => Promise<R>,\n336: ): Promise<R[]> {\n337:   const results = new Array<R>(values.length);\n338:   let index = 0;\n339: \n340:   async function worker(): Promise<void> {\n341:     while (true) {\n342:       const currentIndex = index;\n343:       index += 1;\n344: \n345:       if (currentIndex >= values.length) {\n346:         return;\n347:       }\n348: \n349:       results[currentIndex] = await map(values[currentIndex], currentIndex);\n350:     }\n351:   }\n352: \n353:   const workerCount = Math.min(limit, values.length);\n354:   await Promise.all(Array.from({ length: workerCount }, () => worker()));\n355:   return results;\n356: }\n357: \n358: async function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n359:   const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n360: \n361:   try {\n362:     console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n363: \n364:     try {\n365:       const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n366:       if (markdown) {\n367:         return {\n368:           url,\n369:           ok: true,\n370:           markdown,\n371:           mode: \"jina\",\n372:         };\n373:       }\n374:     } catch {\n375:       // Fall through to direct HTML scrape.\n376:     }\n377: \n378:     const html = await fetchText(url);\n379:     const markdown = htmlToMarkdown(html);\n380: \n381:     if (!markdown) {\n382:       return {\n383:         url,\n384:         ok: false,\n385:         error: \"No markdown content returned from HTML fallback\",\n386:       };\n387:     }\n388: \n389:     return {\n390:       url,\n391:       ok: true,\n392:       markdown,\n393:       mode: \"html\",\n394:     };\n395:   } catch (error) {\n396:     return {\n397:       url,\n398:       ok: false,\n399:       error: error instanceof Error ? error.message : \"Unknown scrape error\",\n400:     };\n401:   }\n402: }\n403: \n404: function resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n405:   if (!outputArg) {\n406:     return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n407:   }\n408: \n409:   const resolved = resolve(repoRoot, outputArg);\n410:   if (resolved.endsWith(\".md\")) {\n411:     return dirname(resolved);\n412:   }\n413: \n414:   return resolved;\n415: }\n416: \n417: function clearExistingExtFiles(outputDir: string): void {\n418:   if (!existsSync(outputDir)) {\n419:     return;\n420:   }\n421: \n422:   for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n423:     if (!entry.isFile()) {\n424:       continue;\n425:     }\n426: \n427:     if (!entry.name.endsWith(\".ext.md\")) {\n428:       continue;\n429:     }\n430: \n431:     rmSync(resolve(outputDir, entry.name));\n432:   }\n433: }\n434: \n435: const repoRoot = findRepoRoot(import.meta.dir);\n436: const outputArg = Bun.argv[2];\n437: const outputDir = resolveOutputDirectory(repoRoot, outputArg);\n438: const outputDirRelative = outputDir.startsWith(repoRoot)\n439:   ? outputDir.slice(repoRoot.length + 1)\n440:   : outputDir;\n441: \n442: mkdirSync(outputDir, { recursive: true });\n443: clearExistingExtFiles(outputDir);\n444: \n445: const sitemapXml = await fetchText(SITEMAP_URL);\n446: const docsUrls = extractDocsUrls(sitemapXml);\n447: \n448: if (docsUrls.length === 0) {\n449:   throw new Error(\"No docs URLs found in moonrepo sitemap\");\n450: }\n451: \n452: const scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n453:   scrapeDocsPage(url, index + 1, docsUrls.length),\n454: );\n455: \n456: const usedNames = new Map<string, number>();\n457: const artifacts: PageArtifact[] = scrapeResults.map((result) => {\n458:   const stem = fileStemFromUrl(result.url);\n459:   const seen = usedNames.get(stem) ?? 0;\n460:   usedNames.set(stem, seen + 1);\n461: \n462:   const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n463:   const fileName = `${stem}${suffix}.ext.md`;\n464: \n465:   return {\n466:     ...result,\n467:     fileName,\n468:     sourcePath: sourcePathFromUrl(result.url),\n469:   };\n470: });\n471: \n472: const capturedAt = new Date().toISOString();\n473: \n474: for (const artifact of artifacts) {\n475:   const pagePath = resolve(outputDir, artifact.fileName);\n476:   const pageContent = buildPageMarkdown(artifact, capturedAt);\n477:   await Bun.write(pagePath, pageContent);\n478: }\n479: \n480: const indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\n481: await Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n482: \n483: const successCount = artifacts.filter((artifact) => artifact.ok).length;\n484: const failureCount = artifacts.length - successCount;\n485: \n486: console.log(\n487:   `Docs // Scrape // Wrote split external docs (pages=${artifacts.length},ok=${successCount},failed=${failureCount},dir=${outputDir})`,\n488: );\n489: \n\n(End of file - total 489 lines)\n</content>",
            "title": "scripts/scrape_moon_docs.sh.ts",
            "metadata": {
              "preview": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};",
              "truncated": false,
              "loaded": []
            },
            "time": {
              "start": 1771215024035,
              "end": 1771215024054
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_082e2ad3f2d886f201699298afd2088195bb38bdd543a09720"
            }
          },
          "id": "prt_c64a46ef7001Lt5lTZo7jiQHFh",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a45dcb001xV6ld55zbyNP6c"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "fc048a8afcda575cde9221fbaa918e5f21eda0a5",
          "cost": 0,
          "tokens": {
            "total": 22267,
            "input": 5318,
            "output": 53,
            "reasoning": 14,
            "cache": {
              "read": 16896,
              "write": 0
            }
          },
          "id": "prt_c64a46fff001R6MS56EtiPBvPy",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a45dcb001xV6ld55zbyNP6c"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215024192,
          "completed": 1771215103905
        },
        "parentID": "msg_c64a42a82001VxLufzWxER91hc",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 32342,
          "input": 4770,
          "output": 5428,
          "reasoning": 339,
          "cache": {
            "read": 22144,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a47040001VZWpaHT2z78mj6",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fc048a8afcda575cde9221fbaa918e5f21eda0a5",
          "id": "prt_c64a47738001aaniM0qGsc5IWs",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a47040001VZWpaHT2z78mj6"
        },
        {
          "type": "reasoning",
          "text": "**Planning resilient sitemap scraper**",
          "metadata": {
            "openai": {
              "itemId": "rs_0f3fbc8225b8ed4f01699298b3a4cc819598ed797c92172212",
              "reasoningEncryptedContent": "gAAAAABpkpi6ulAdnrklWWk_pTcpPKY0QiXjVb87TASyFi9XUIf4Qnk3ocpkmsafCQuNXw7zOwcFMwG7q99CgEdK4WMdHmPCVIFgX14mv9TwMBpYFooIQVsY92XqAwI5yod8RY1P-j0bBcxIxaB7Oe500Lg_J1P6JgDzMc7diw6PBSI-PHFcqZaWMKLPcPfOfkJDvjrK-c9w49L7bkI4-DzP6wm-qlqkQs3IOqoruAnOfzU3ghbCn5ICjJB__WHsS_AyIGhcAk2-fOFRauSayNaVsGMvXY9qxfmHx_PCSRUQMDbdGWsjJVeen0VJnaAOmInRMFIsHkj_l6O4XV_aT4f_lmP_rrA4uzipuiapvn_7R8yOELmNk0l1WKGeipSi00vOauACc2VX5tlx_Go6NxH52eGsNBMYur4wvM0nEKjx_DfAsfMyYRC1ExoCRmwNNhZHZTNKKwQi-CSdL-Tja6xVGDTL9uW-QJzOpWta7jafIV0EV2-glZri2yS_zY5xZTp_4elrWopid8ahIT8UksLGiQ-RIuxACJX1fwCeWPLp6EGIidGE4mDIUyONM84_zw8MWNAcZBJn0rxP9KyptZxedQVG23PB_mrEOOJLy1oIzQY16RIPHCEs4uz-6zDUYuFYwBjcfWV-vlMlVb_v63_sEkLl6iZXIL-VlRfUFtGYphdYxg1vtXGRGvrF1uOv83I3a2yNHz4A7dIMCtW3ct6XhJ6foLWKc7UH7txtz3FyHXeJRRF-GCy1aE-CoJoUhsT0jPgaA_i-igBki04nY9BBgCvpsJ-SMovCdp0X_SMiA4buzn7mCjoDuPyPZEYQ62GpXwKOtvsfB0UtmD8Cgkk_C7Xb-pNlBnKip8OzptbdaFTnG8NykGQNETFYH0LbbudWF13erVUguJi0pBq0WVDgFL6qfa24qpE2_YbJEWVVUVHTgEA5dpWjB6cd44T1_PrlmyXIN_vg8QZKvOEUvBU13mmHPxcOBuRfty1sLo6nzqViuEZ7Zic9C0nAUs6adH7b3FwunpsSnTGV_wPxQ7j0N9kQSLOQ8FNYXGAtc7LrO9_fs34X-2lkYksBB3x4Onp6x048Dk93uBelZRkiw3fL3bb8KbzWVTa3n0FpOnOlePY5HPn3Q02GEddbh1THpDfbCSJ_9m-ef7NsWF8pE3zw7soGrtRx10BBmFtdLm4Wjt45U6AKH7GzjOp0ThqyucXiPhMVRiXy8_yuzjQNCV3rhd1f4OOhh2BsRg7bErWnvwGGcJBnW6uDZo0vu8raRemSD1uRMqVju1_T4KqqNj2cKagGQ0lRPiVJ6_X70dfmajgh9MAypIB5o6RJesw3kFPqel8YRcZkZ3sHZJxmzYJsVs8MAr-OOrgsNL7AuSy_pYDYLMhgyyKwJiyltoVMWTy3eM5N-hxquufa_zdXHO6pPNKnVIClKTVYN43UNSXTE3yW3pWR9tL9eujQmyoNd_JvfsCDGvLf7SA7SODXU4Kmd9U2UBLWKk_CB5C4rMKOiJWZsASy3yyfOJ8E0DPpNhDeycSgDPr744VheC_cE6k8igVM_92n8hIJ3f_yEbg2_NDwNSdgUS1LsAyHw2LgUFRRGI5G6zUKIUCY9Og9_w3PQgEFM1sEayMBYR1pjHSxZeLQmRUTbqkDL4tnkTnctbGMiTmaw7ebVgLjQWaTI64bpQpymBXxHiZh0zr24PTNOLHoH0S5xoxUyMh0DNQO850ZRoR5gleZx44L_70m3ZZxoXCw05ZgftQ4-N2oE53dWDYQT4M69q2r4HAcfUwybAYKxxji2EGWFTtapHOC8GRsJrlWMUqZRTndae0Cav7FWWDrYdIVm08-NVICBZ13u9HAT4Y6-N8sEM2FR9OYMFQUvfG0MgW1q18uVx-2-_bUUAjWRhN34KiAsisvfr-pnvI9p_h1xQDH-C8Dt5OfaMitv4CCx3dR_NHyNBSWdj9UBn-7U51RCMOtiUgPHjaq7OC4X1Wg6frtB-oKTxOlUjwUi3a3zkPDIekLdaXxkvHjKIzAuteTsLpgI3ieTUVpLRenDSNPUy70wKetQY4ypYwhVLiuprkAawyofMtBMUUNegQxhxMA5xg02rymt0sOblNVci51-43_DgAywmKZaWd3PCBblfsg139C_1OSbr4NuHLGTKKvJmsHqMlmuAYpJXTu-ZGw9pTX8E3Y5e3mNgoCwWWVN_FycqN0WtR38Na6RWzzHIq4EvEe77bIFbjD-vv1vVbzCrTFTNEVQo7TtLhYO0S9iqNvTi5SMZdAX3zVTmsWs5xalRAo8NSjtNTLKhTLVfDnWHoOaFZSz-Pqs90FJ7D-dI8q6f1javieNf8_YpTKQyKKQnWti7O4yc2GGAsO6WQPVprQh71nN7-ssn-roYcrbjA1Y_wnwEAvRq4OEMQXczztjDo295gRwaTRyDi92RyFGv0HQIrg84YmdnB57XpTHRMwVF08oglEcOO61l6sFthdj4jSez1KTfFYWoQITz6OSwunc7q16ZGvlHh8Fd2XBGQzPLVFbAmEfF90TUv7v2DHNx-TVPwLJrzS_c4ZDUwB4UV4CP_1KP4QaVVYhRLhs7hHhGVghZjhwzBK4SfY9gL4lDej4-x2hUzfKQSApDipab4hOSb0VU8uSK_PZqjwdUNtd0bzY7rXlgNNp-4J4lEwVR72vAwjNPU7mouK5o_eEUj-MrNIxbr8Af7ROthl84HLaAwZLQ2U7I5o6Eckgr5ks7rXnGjSf0sp7SAK_tNSp23wjdowbn9Lc7AKTguyjEM0WMuKKCskaCjWNwmL4Wkax-m0CyEQdMt-OxE8kGn-ohl1CqzKOtVuzkowRoUSXn2sYm9gfbdvoJWI6Jevv8d_YtUqtncJ_HHRLQ0bccspW0KG32qre_qs5N6GT5ek_kqJcGzr97QxkStGN3l4ET78_3y8TQs8J0qX7sd7f05uMGVg9kTdJavK2FB_3-aGk5XXBgwLglW15LyrkBlEGzfzrXo5fm2GTtJXq2mJae3XVsq6YTshOef0XcnyJUYiWrO4QDET7g3B7x319O-G8w8fQsARExQ-MlU_qM4_zCa8Y_9i8liKTEPd1NR-ohUm423gIzOvuh013s1vYcCjuGVdAJ7Y3z_gd00seTl9axvAGGJyVPIOzqXHAn0M88b33trEkvdxNuHkiWQkj--i7PuJoORE15jpy3loy7j1m9Hdqd3s"
            }
          },
          "time": {
            "start": 1771215027843,
            "end": 1771215034231
          },
          "id": "prt_c64a47e830011XtstN2Y3kUb1w",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a47040001VZWpaHT2z78mj6"
        },
        {
          "type": "tool",
          "callID": "call_AQCGDQlg0RIXuMl3CRJxiNpU",
          "tool": "apply_patch",
          "state": {
            "status": "completed",
            "input": {
              "patchText": "*** Begin Patch\n*** Add File: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n+#!/usr/bin/env bun\n+\n+import { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\n+import { dirname, resolve } from \"node:path\";\n+import { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n+\n+type ScrapeMode = \"jina\" | \"html\";\n+\n+type ScrapeResult = {\n+  url: string;\n+  ok: boolean;\n+  markdown?: string;\n+  error?: string;\n+  mode?: ScrapeMode;\n+};\n+\n+type PageArtifact = ScrapeResult & {\n+  fileName: string;\n+  sourcePath: string;\n+};\n+\n+const SOURCE_KEY = \"opencode\";\n+const DOCS_ROOT = \"https://opencode.ai/docs\";\n+const SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\n+const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\n+const CONCURRENCY = 4;\n+const SUMMARY_MAX_CHARS = 240;\n+\n+function decodeEntities(value: string): string {\n+  return value\n+    .replaceAll(\"&amp;\", \"&\")\n+    .replaceAll(\"&quot;\", '\"')\n+    .replaceAll(\"&apos;\", \"'\")\n+    .replaceAll(\"&#x27;\", \"'\")\n+    .replaceAll(\"&#39;\", \"'\")\n+    .replaceAll(\"&nbsp;\", \" \")\n+    .replaceAll(\"&lt;\", \"<\")\n+    .replaceAll(\"&gt;\", \">\");\n+}\n+\n+function stripJinaEnvelope(markdown: string): string {\n+  return markdown\n+    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n+    .trim();\n+}\n+\n+function stripTags(value: string): string {\n+  return value.replace(/<[^>]+>/g, \"\");\n+}\n+\n+function plainTextFromHtml(value: string): string {\n+  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n+}\n+\n+function extractMainHtml(html: string): string {\n+  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n+  if (articleMatch?.[1]) {\n+    return articleMatch[1];\n+  }\n+\n+  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n+  if (mainMatch?.[1]) {\n+    return mainMatch[1];\n+  }\n+\n+  return html;\n+}\n+\n+function htmlToMarkdown(html: string): string {\n+  let content = extractMainHtml(html);\n+\n+  content = content\n+    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n+    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n+    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n+    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n+    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n+\n+  content = content.replace(\n+    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n+    (_match, code) => {\n+      const normalizedCode = decodeEntities(\n+        stripTags(code)\n+          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n+          .replace(/\\n{3,}/g, \"\\n\\n\")\n+          .trim(),\n+      );\n+\n+      if (!normalizedCode) {\n+        return \"\";\n+      }\n+\n+      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n+    },\n+  );\n+\n+  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n+    const normalizedCode = decodeEntities(stripTags(code)).trim();\n+    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n+  });\n+\n+  content = content.replace(\n+    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n+    (_match, href, label) => {\n+      const text = plainTextFromHtml(label);\n+      if (!text) {\n+        return \"\";\n+      }\n+\n+      return `[${text}](${decodeEntities(href)})`;\n+    },\n+  );\n+\n+  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n+    const heading = plainTextFromHtml(inner);\n+    if (!heading) {\n+      return \"\";\n+    }\n+\n+    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n+  });\n+\n+  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n+    const line = plainTextFromHtml(inner);\n+    return line ? `- ${line}\\n` : \"\";\n+  });\n+\n+  content = content\n+    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n+    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n+    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n+    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n+      const cell = plainTextFromHtml(inner);\n+      return cell ? `${cell} ` : \"\";\n+    });\n+\n+  content = decodeEntities(content)\n+    .replace(/<[^>]+>/g, \"\")\n+    .replace(/[ \\t]+\\n/g, \"\\n\")\n+    .replace(/\\n{3,}/g, \"\\n\\n\")\n+    .trim();\n+\n+  return content;\n+}\n+\n+function sanitizeSegment(value: string): string {\n+  const clean = decodeURIComponent(value)\n+    .toLowerCase()\n+    .replace(/[^a-z0-9]+/g, \"-\")\n+    .replace(/^-+|-+$/g, \"\");\n+\n+  return clean || \"page\";\n+}\n+\n+function sourcePathFromUrl(url: string): string {\n+  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n+  return pathname;\n+}\n+\n+function fileStemFromUrl(url: string): string {\n+  const sourcePath = sourcePathFromUrl(url);\n+\n+  if (sourcePath === \"/docs\") {\n+    return \"docs\";\n+  }\n+\n+  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n+  const segments = relative\n+    .split(\"/\")\n+    .filter(Boolean)\n+    .map(sanitizeSegment);\n+\n+  if (segments.length === 0) {\n+    return \"docs\";\n+  }\n+\n+  return [\"docs\", ...segments].join(\"__\");\n+}\n+\n+function extractSummary(markdown: string): string {\n+  const lines = markdown.split(\"\\n\");\n+  let inCodeBlock = false;\n+\n+  for (const rawLine of lines) {\n+    const line = rawLine.trim();\n+\n+    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n+      inCodeBlock = !inCodeBlock;\n+      continue;\n+    }\n+\n+    if (inCodeBlock) {\n+      continue;\n+    }\n+\n+    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n+      continue;\n+    }\n+\n+    if (line.length <= 25) {\n+      continue;\n+    }\n+\n+    if (line.length > SUMMARY_MAX_CHARS) {\n+      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n+    }\n+\n+    return line;\n+  }\n+\n+  return \"OpenCode documentation page snapshot.\";\n+}\n+\n+function keywordsForPath(sourcePath: string): string {\n+  const dynamic = sourcePath\n+    .split(\"/\")\n+    .filter(Boolean)\n+    .slice(1)\n+    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n+    .filter(Boolean)\n+    .join(\", \");\n+\n+  const base = \"opencode, docs, ai coding assistant, cli\";\n+  return dynamic ? `${base}, ${dynamic}` : base;\n+}\n+\n+function buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n+  const pageSummary = result.ok\n+    ? extractSummary(result.markdown ?? \"\")\n+    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n+\n+  const pageBody = result.ok\n+    ? result.markdown?.trim() ?? \"\"\n+    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n+\n+  return [\n+    \"----\",\n+    \"## External Docs Snapshot // opencode\",\n+    \"\",\n+    `- Captured: ${capturedAt}`,\n+    `- Source root: ${DOCS_ROOT}`,\n+    `- Source page: ${result.sourcePath}`,\n+    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n+    `- Summary: ${pageSummary}`,\n+    \"----\",\n+    \"\",\n+    `Source: ${result.url}`,\n+    \"\",\n+    pageBody,\n+    \"\",\n+    \"----\",\n+    \"## Notes / Comments / Lessons\",\n+    \"\",\n+    \"- Collection method: sitemap discovery + markdown conversion.\",\n+    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n+    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n+    \"----\",\n+    \"\",\n+  ].join(\"\\n\");\n+}\n+\n+function buildIndexMarkdown(\n+  artifacts: PageArtifact[],\n+  capturedAt: string,\n+  outputDirRelative: string,\n+): string {\n+  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n+  const failureCount = artifacts.length - successCount;\n+\n+  const pageList = artifacts\n+    .map((artifact) => {\n+      const status = artifact.ok ? \"ok\" : \"failed\";\n+      const mode = artifact.mode ?? \"unknown\";\n+      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n+    })\n+    .join(\"\\n\");\n+\n+  return [\n+    \"----\",\n+    \"## External Docs Index // opencode\",\n+    \"\",\n+    `- Captured: ${capturedAt}`,\n+    `- Source root: ${DOCS_ROOT}`,\n+    `- Output directory: ${outputDirRelative}`,\n+    `- Scope: ${artifacts.length} pages under /docs`,\n+    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n+    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n+    \"----\",\n+    \"\",\n+    \"## Pages\",\n+    \"\",\n+    pageList,\n+    \"\",\n+    \"----\",\n+    \"## Notes / Comments / Lessons\",\n+    \"\",\n+    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n+    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n+    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n+    \"----\",\n+    \"\",\n+  ].join(\"\\n\");\n+}\n+\n+async function fetchText(url: string): Promise<string> {\n+  const response = await fetch(url, {\n+    headers: {\n+      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n+    },\n+  });\n+\n+  if (!response.ok) {\n+    throw new Error(`Request failed (${response.status}) for ${url}`);\n+  }\n+\n+  return await response.text();\n+}\n+\n+function extractLocUrls(xml: string): string[] {\n+  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n+    decodeEntities(match[1]?.trim() ?? \"\"),\n+  ).filter(Boolean);\n+}\n+\n+async function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n+  const visited = new Set<string>();\n+  const pending: string[] = [sitemapUrl];\n+  const docsUrls = new Set<string>();\n+\n+  while (pending.length > 0) {\n+    const current = pending.pop();\n+    if (!current || visited.has(current)) {\n+      continue;\n+    }\n+\n+    visited.add(current);\n+\n+    let xml: string;\n+    try {\n+      xml = await fetchText(current);\n+    } catch {\n+      continue;\n+    }\n+\n+    const locUrls = extractLocUrls(xml);\n+    for (const locUrl of locUrls) {\n+      if (locUrl.endsWith(\".xml\")) {\n+        if (!visited.has(locUrl)) {\n+          pending.push(locUrl);\n+        }\n+        continue;\n+      }\n+\n+      if (!locUrl.startsWith(DOCS_ROOT)) {\n+        continue;\n+      }\n+\n+      if (locUrl.includes(\"#\")) {\n+        continue;\n+      }\n+\n+      docsUrls.add(locUrl);\n+    }\n+  }\n+\n+  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n+}\n+\n+async function mapConcurrent<T, R>(\n+  values: T[],\n+  limit: number,\n+  map: (value: T, index: number) => Promise<R>,\n+): Promise<R[]> {\n+  const results = new Array<R>(values.length);\n+  let index = 0;\n+\n+  async function worker(): Promise<void> {\n+    while (true) {\n+      const currentIndex = index;\n+      index += 1;\n+\n+      if (currentIndex >= values.length) {\n+        return;\n+      }\n+\n+      results[currentIndex] = await map(values[currentIndex], currentIndex);\n+    }\n+  }\n+\n+  const workerCount = Math.min(limit, values.length);\n+  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n+  return results;\n+}\n+\n+async function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n+  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n+\n+  try {\n+    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n+\n+    try {\n+      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n+      if (markdown) {\n+        return {\n+          url,\n+          ok: true,\n+          markdown,\n+          mode: \"jina\",\n+        };\n+      }\n+    } catch {\n+      // Fall through to direct HTML scrape.\n+    }\n+\n+    const html = await fetchText(url);\n+    const markdown = htmlToMarkdown(html);\n+\n+    if (!markdown) {\n+      return {\n+        url,\n+        ok: false,\n+        error: \"No markdown content returned from HTML fallback\",\n+      };\n+    }\n+\n+    return {\n+      url,\n+      ok: true,\n+      markdown,\n+      mode: \"html\",\n+    };\n+  } catch (error) {\n+    return {\n+      url,\n+      ok: false,\n+      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n+    };\n+  }\n+}\n+\n+function resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n+  if (!outputArg) {\n+    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n+  }\n+\n+  const resolved = resolve(repoRoot, outputArg);\n+  if (resolved.endsWith(\".md\")) {\n+    return dirname(resolved);\n+  }\n+\n+  return resolved;\n+}\n+\n+function clearExistingExtFiles(outputDir: string): void {\n+  if (!existsSync(outputDir)) {\n+    return;\n+  }\n+\n+  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n+    if (!entry.isFile()) {\n+      continue;\n+    }\n+\n+    if (!entry.name.endsWith(\".ext.md\")) {\n+      continue;\n+    }\n+\n+    rmSync(resolve(outputDir, entry.name));\n+  }\n+}\n+\n+const repoRoot = findRepoRoot(import.meta.dir);\n+const outputArg = Bun.argv[2];\n+const outputDir = resolveOutputDirectory(repoRoot, outputArg);\n+const outputDirRelative = outputDir.startsWith(repoRoot)\n+  ? outputDir.slice(repoRoot.length + 1)\n+  : outputDir;\n+\n+mkdirSync(outputDir, { recursive: true });\n+clearExistingExtFiles(outputDir);\n+\n+const docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+\n+if (docsUrls.length === 0) {\n+  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n+}\n+\n+const scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n+  scrapeDocsPage(url, index + 1, docsUrls.length),\n+);\n+\n+const usedNames = new Map<string, number>();\n+const artifacts: PageArtifact[] = scrapeResults.map((result) => {\n+  const stem = fileStemFromUrl(result.url);\n+  const seen = usedNames.get(stem) ?? 0;\n+  usedNames.set(stem, seen + 1);\n+\n+  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n+  const fileName = `${stem}${suffix}.ext.md`;\n+\n+  return {\n+    ...result,\n+    fileName,\n+    sourcePath: sourcePathFromUrl(result.url),\n+  };\n+});\n+\n+const capturedAt = new Date().toISOString();\n+\n+for (const artifact of artifacts) {\n+  const pagePath = resolve(outputDir, artifact.fileName);\n+  const pageContent = buildPageMarkdown(artifact, capturedAt);\n+  await Bun.write(pagePath, pageContent);\n+}\n+\n+const indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\n+await Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n+\n+const successCount = artifacts.filter((artifact) => artifact.ok).length;\n+const failureCount = artifacts.length - successCount;\n+const blockedPages = artifacts\n+  .filter((artifact) => !artifact.ok)\n+  .map((artifact) => artifact.sourcePath)\n+  .join(\",\");\n+\n+console.log(\n+  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n+);\n*** End Patch"
            },
            "output": "Success. Updated the following files:\nA scripts/scrape_opencode_docs.sh.ts",
            "title": "Success. Updated the following files:\nA scripts/scrape_opencode_docs.sh.ts",
            "metadata": {
              "diff": "Index: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n+++ /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n@@ -0,0 +1,528 @@\n+#!/usr/bin/env bun\n+\n+import { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\n+import { dirname, resolve } from \"node:path\";\n+import { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n+\n+type ScrapeMode = \"jina\" | \"html\";\n+\n+type ScrapeResult = {\n+  url: string;\n+  ok: boolean;\n+  markdown?: string;\n+  error?: string;\n+  mode?: ScrapeMode;\n+};\n+\n+type PageArtifact = ScrapeResult & {\n+  fileName: string;\n+  sourcePath: string;\n+};\n+\n+const SOURCE_KEY = \"opencode\";\n+const DOCS_ROOT = \"https://opencode.ai/docs\";\n+const SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\n+const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\n+const CONCURRENCY = 4;\n+const SUMMARY_MAX_CHARS = 240;\n+\n+function decodeEntities(value: string): string {\n+  return value\n+    .replaceAll(\"&amp;\", \"&\")\n+    .replaceAll(\"&quot;\", '\"')\n+    .replaceAll(\"&apos;\", \"'\")\n+    .replaceAll(\"&#x27;\", \"'\")\n+    .replaceAll(\"&#39;\", \"'\")\n+    .replaceAll(\"&nbsp;\", \" \")\n+    .replaceAll(\"&lt;\", \"<\")\n+    .replaceAll(\"&gt;\", \">\");\n+}\n+\n+function stripJinaEnvelope(markdown: string): string {\n+  return markdown\n+    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n+    .trim();\n+}\n+\n+function stripTags(value: string): string {\n+  return value.replace(/<[^>]+>/g, \"\");\n+}\n+\n+function plainTextFromHtml(value: string): string {\n+  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n+}\n+\n+function extractMainHtml(html: string): string {\n+  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n+  if (articleMatch?.[1]) {\n+    return articleMatch[1];\n+  }\n+\n+  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n+  if (mainMatch?.[1]) {\n+    return mainMatch[1];\n+  }\n+\n+  return html;\n+}\n+\n+function htmlToMarkdown(html: string): string {\n+  let content = extractMainHtml(html);\n+\n+  content = content\n+    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n+    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n+    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n+    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n+    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n+\n+  content = content.replace(\n+    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n+    (_match, code) => {\n+      const normalizedCode = decodeEntities(\n+        stripTags(code)\n+          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n+          .replace(/\\n{3,}/g, \"\\n\\n\")\n+          .trim(),\n+      );\n+\n+      if (!normalizedCode) {\n+        return \"\";\n+      }\n+\n+      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n+    },\n+  );\n+\n+  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n+    const normalizedCode = decodeEntities(stripTags(code)).trim();\n+    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n+  });\n+\n+  content = content.replace(\n+    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n+    (_match, href, label) => {\n+      const text = plainTextFromHtml(label);\n+      if (!text) {\n+        return \"\";\n+      }\n+\n+      return `[${text}](${decodeEntities(href)})`;\n+    },\n+  );\n+\n+  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n+    const heading = plainTextFromHtml(inner);\n+    if (!heading) {\n+      return \"\";\n+    }\n+\n+    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n+  });\n+\n+  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n+    const line = plainTextFromHtml(inner);\n+    return line ? `- ${line}\\n` : \"\";\n+  });\n+\n+  content = content\n+    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n+    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n+    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n+    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n+      const cell = plainTextFromHtml(inner);\n+      return cell ? `${cell} ` : \"\";\n+    });\n+\n+  content = decodeEntities(content)\n+    .replace(/<[^>]+>/g, \"\")\n+    .replace(/[ \\t]+\\n/g, \"\\n\")\n+    .replace(/\\n{3,}/g, \"\\n\\n\")\n+    .trim();\n+\n+  return content;\n+}\n+\n+function sanitizeSegment(value: string): string {\n+  const clean = decodeURIComponent(value)\n+    .toLowerCase()\n+    .replace(/[^a-z0-9]+/g, \"-\")\n+    .replace(/^-+|-+$/g, \"\");\n+\n+  return clean || \"page\";\n+}\n+\n+function sourcePathFromUrl(url: string): string {\n+  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n+  return pathname;\n+}\n+\n+function fileStemFromUrl(url: string): string {\n+  const sourcePath = sourcePathFromUrl(url);\n+\n+  if (sourcePath === \"/docs\") {\n+    return \"docs\";\n+  }\n+\n+  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n+  const segments = relative\n+    .split(\"/\")\n+    .filter(Boolean)\n+    .map(sanitizeSegment);\n+\n+  if (segments.length === 0) {\n+    return \"docs\";\n+  }\n+\n+  return [\"docs\", ...segments].join(\"__\");\n+}\n+\n+function extractSummary(markdown: string): string {\n+  const lines = markdown.split(\"\\n\");\n+  let inCodeBlock = false;\n+\n+  for (const rawLine of lines) {\n+    const line = rawLine.trim();\n+\n+    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n+      inCodeBlock = !inCodeBlock;\n+      continue;\n+    }\n+\n+    if (inCodeBlock) {\n+      continue;\n+    }\n+\n+    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n+      continue;\n+    }\n+\n+    if (line.length <= 25) {\n+      continue;\n+    }\n+\n+    if (line.length > SUMMARY_MAX_CHARS) {\n+      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n+    }\n+\n+    return line;\n+  }\n+\n+  return \"OpenCode documentation page snapshot.\";\n+}\n+\n+function keywordsForPath(sourcePath: string): string {\n+  const dynamic = sourcePath\n+    .split(\"/\")\n+    .filter(Boolean)\n+    .slice(1)\n+    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n+    .filter(Boolean)\n+    .join(\", \");\n+\n+  const base = \"opencode, docs, ai coding assistant, cli\";\n+  return dynamic ? `${base}, ${dynamic}` : base;\n+}\n+\n+function buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n+  const pageSummary = result.ok\n+    ? extractSummary(result.markdown ?? \"\")\n+    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n+\n+  const pageBody = result.ok\n+    ? result.markdown?.trim() ?? \"\"\n+    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n+\n+  return [\n+    \"----\",\n+    \"## External Docs Snapshot // opencode\",\n+    \"\",\n+    `- Captured: ${capturedAt}`,\n+    `- Source root: ${DOCS_ROOT}`,\n+    `- Source page: ${result.sourcePath}`,\n+    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n+    `- Summary: ${pageSummary}`,\n+    \"----\",\n+    \"\",\n+    `Source: ${result.url}`,\n+    \"\",\n+    pageBody,\n+    \"\",\n+    \"----\",\n+    \"## Notes / Comments / Lessons\",\n+    \"\",\n+    \"- Collection method: sitemap discovery + markdown conversion.\",\n+    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n+    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n+    \"----\",\n+    \"\",\n+  ].join(\"\\n\");\n+}\n+\n+function buildIndexMarkdown(\n+  artifacts: PageArtifact[],\n+  capturedAt: string,\n+  outputDirRelative: string,\n+): string {\n+  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n+  const failureCount = artifacts.length - successCount;\n+\n+  const pageList = artifacts\n+    .map((artifact) => {\n+      const status = artifact.ok ? \"ok\" : \"failed\";\n+      const mode = artifact.mode ?? \"unknown\";\n+      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n+    })\n+    .join(\"\\n\");\n+\n+  return [\n+    \"----\",\n+    \"## External Docs Index // opencode\",\n+    \"\",\n+    `- Captured: ${capturedAt}`,\n+    `- Source root: ${DOCS_ROOT}`,\n+    `- Output directory: ${outputDirRelative}`,\n+    `- Scope: ${artifacts.length} pages under /docs`,\n+    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n+    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n+    \"----\",\n+    \"\",\n+    \"## Pages\",\n+    \"\",\n+    pageList,\n+    \"\",\n+    \"----\",\n+    \"## Notes / Comments / Lessons\",\n+    \"\",\n+    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n+    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n+    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n+    \"----\",\n+    \"\",\n+  ].join(\"\\n\");\n+}\n+\n+async function fetchText(url: string): Promise<string> {\n+  const response = await fetch(url, {\n+    headers: {\n+      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n+    },\n+  });\n+\n+  if (!response.ok) {\n+    throw new Error(`Request failed (${response.status}) for ${url}`);\n+  }\n+\n+  return await response.text();\n+}\n+\n+function extractLocUrls(xml: string): string[] {\n+  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n+    decodeEntities(match[1]?.trim() ?? \"\"),\n+  ).filter(Boolean);\n+}\n+\n+async function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n+  const visited = new Set<string>();\n+  const pending: string[] = [sitemapUrl];\n+  const docsUrls = new Set<string>();\n+\n+  while (pending.length > 0) {\n+    const current = pending.pop();\n+    if (!current || visited.has(current)) {\n+      continue;\n+    }\n+\n+    visited.add(current);\n+\n+    let xml: string;\n+    try {\n+      xml = await fetchText(current);\n+    } catch {\n+      continue;\n+    }\n+\n+    const locUrls = extractLocUrls(xml);\n+    for (const locUrl of locUrls) {\n+      if (locUrl.endsWith(\".xml\")) {\n+        if (!visited.has(locUrl)) {\n+          pending.push(locUrl);\n+        }\n+        continue;\n+      }\n+\n+      if (!locUrl.startsWith(DOCS_ROOT)) {\n+        continue;\n+      }\n+\n+      if (locUrl.includes(\"#\")) {\n+        continue;\n+      }\n+\n+      docsUrls.add(locUrl);\n+    }\n+  }\n+\n+  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n+}\n+\n+async function mapConcurrent<T, R>(\n+  values: T[],\n+  limit: number,\n+  map: (value: T, index: number) => Promise<R>,\n+): Promise<R[]> {\n+  const results = new Array<R>(values.length);\n+  let index = 0;\n+\n+  async function worker(): Promise<void> {\n+    while (true) {\n+      const currentIndex = index;\n+      index += 1;\n+\n+      if (currentIndex >= values.length) {\n+        return;\n+      }\n+\n+      results[currentIndex] = await map(values[currentIndex], currentIndex);\n+    }\n+  }\n+\n+  const workerCount = Math.min(limit, values.length);\n+  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n+  return results;\n+}\n+\n+async function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n+  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n+\n+  try {\n+    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n+\n+    try {\n+      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n+      if (markdown) {\n+        return {\n+          url,\n+          ok: true,\n+          markdown,\n+          mode: \"jina\",\n+        };\n+      }\n+    } catch {\n+      // Fall through to direct HTML scrape.\n+    }\n+\n+    const html = await fetchText(url);\n+    const markdown = htmlToMarkdown(html);\n+\n+    if (!markdown) {\n+      return {\n+        url,\n+        ok: false,\n+        error: \"No markdown content returned from HTML fallback\",\n+      };\n+    }\n+\n+    return {\n+      url,\n+      ok: true,\n+      markdown,\n+      mode: \"html\",\n+    };\n+  } catch (error) {\n+    return {\n+      url,\n+      ok: false,\n+      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n+    };\n+  }\n+}\n+\n+function resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n+  if (!outputArg) {\n+    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n+  }\n+\n+  const resolved = resolve(repoRoot, outputArg);\n+  if (resolved.endsWith(\".md\")) {\n+    return dirname(resolved);\n+  }\n+\n+  return resolved;\n+}\n+\n+function clearExistingExtFiles(outputDir: string): void {\n+  if (!existsSync(outputDir)) {\n+    return;\n+  }\n+\n+  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n+    if (!entry.isFile()) {\n+      continue;\n+    }\n+\n+    if (!entry.name.endsWith(\".ext.md\")) {\n+      continue;\n+    }\n+\n+    rmSync(resolve(outputDir, entry.name));\n+  }\n+}\n+\n+const repoRoot = findRepoRoot(import.meta.dir);\n+const outputArg = Bun.argv[2];\n+const outputDir = resolveOutputDirectory(repoRoot, outputArg);\n+const outputDirRelative = outputDir.startsWith(repoRoot)\n+  ? outputDir.slice(repoRoot.length + 1)\n+  : outputDir;\n+\n+mkdirSync(outputDir, { recursive: true });\n+clearExistingExtFiles(outputDir);\n+\n+const docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+\n+if (docsUrls.length === 0) {\n+  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n+}\n+\n+const scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n+  scrapeDocsPage(url, index + 1, docsUrls.length),\n+);\n+\n+const usedNames = new Map<string, number>();\n+const artifacts: PageArtifact[] = scrapeResults.map((result) => {\n+  const stem = fileStemFromUrl(result.url);\n+  const seen = usedNames.get(stem) ?? 0;\n+  usedNames.set(stem, seen + 1);\n+\n+  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n+  const fileName = `${stem}${suffix}.ext.md`;\n+\n+  return {\n+    ...result,\n+    fileName,\n+    sourcePath: sourcePathFromUrl(result.url),\n+  };\n+});\n+\n+const capturedAt = new Date().toISOString();\n+\n+for (const artifact of artifacts) {\n+  const pagePath = resolve(outputDir, artifact.fileName);\n+  const pageContent = buildPageMarkdown(artifact, capturedAt);\n+  await Bun.write(pagePath, pageContent);\n+}\n+\n+const indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\n+await Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n+\n+const successCount = artifacts.filter((artifact) => artifact.ok).length;\n+const failureCount = artifacts.length - successCount;\n+const blockedPages = artifacts\n+  .filter((artifact) => !artifact.ok)\n+  .map((artifact) => artifact.sourcePath)\n+  .join(\",\");\n+\n+console.log(\n+  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n+);\n\n",
              "files": [
                {
                  "filePath": "/Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts",
                  "relativePath": "scripts/scrape_opencode_docs.sh.ts",
                  "type": "add",
                  "diff": "Index: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n+++ /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n@@ -0,0 +1,528 @@\n+#!/usr/bin/env bun\n+\n+import { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\n+import { dirname, resolve } from \"node:path\";\n+import { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n+\n+type ScrapeMode = \"jina\" | \"html\";\n+\n+type ScrapeResult = {\n+  url: string;\n+  ok: boolean;\n+  markdown?: string;\n+  error?: string;\n+  mode?: ScrapeMode;\n+};\n+\n+type PageArtifact = ScrapeResult & {\n+  fileName: string;\n+  sourcePath: string;\n+};\n+\n+const SOURCE_KEY = \"opencode\";\n+const DOCS_ROOT = \"https://opencode.ai/docs\";\n+const SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\n+const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\n+const CONCURRENCY = 4;\n+const SUMMARY_MAX_CHARS = 240;\n+\n+function decodeEntities(value: string): string {\n+  return value\n+    .replaceAll(\"&amp;\", \"&\")\n+    .replaceAll(\"&quot;\", '\"')\n+    .replaceAll(\"&apos;\", \"'\")\n+    .replaceAll(\"&#x27;\", \"'\")\n+    .replaceAll(\"&#39;\", \"'\")\n+    .replaceAll(\"&nbsp;\", \" \")\n+    .replaceAll(\"&lt;\", \"<\")\n+    .replaceAll(\"&gt;\", \">\");\n+}\n+\n+function stripJinaEnvelope(markdown: string): string {\n+  return markdown\n+    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n+    .trim();\n+}\n+\n+function stripTags(value: string): string {\n+  return value.replace(/<[^>]+>/g, \"\");\n+}\n+\n+function plainTextFromHtml(value: string): string {\n+  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n+}\n+\n+function extractMainHtml(html: string): string {\n+  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n+  if (articleMatch?.[1]) {\n+    return articleMatch[1];\n+  }\n+\n+  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n+  if (mainMatch?.[1]) {\n+    return mainMatch[1];\n+  }\n+\n+  return html;\n+}\n+\n+function htmlToMarkdown(html: string): string {\n+  let content = extractMainHtml(html);\n+\n+  content = content\n+    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n+    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n+    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n+    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n+    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n+\n+  content = content.replace(\n+    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n+    (_match, code) => {\n+      const normalizedCode = decodeEntities(\n+        stripTags(code)\n+          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n+          .replace(/\\n{3,}/g, \"\\n\\n\")\n+          .trim(),\n+      );\n+\n+      if (!normalizedCode) {\n+        return \"\";\n+      }\n+\n+      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n+    },\n+  );\n+\n+  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n+    const normalizedCode = decodeEntities(stripTags(code)).trim();\n+    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n+  });\n+\n+  content = content.replace(\n+    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n+    (_match, href, label) => {\n+      const text = plainTextFromHtml(label);\n+      if (!text) {\n+        return \"\";\n+      }\n+\n+      return `[${text}](${decodeEntities(href)})`;\n+    },\n+  );\n+\n+  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n+    const heading = plainTextFromHtml(inner);\n+    if (!heading) {\n+      return \"\";\n+    }\n+\n+    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n+  });\n+\n+  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n+    const line = plainTextFromHtml(inner);\n+    return line ? `- ${line}\\n` : \"\";\n+  });\n+\n+  content = content\n+    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n+    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n+    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n+    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n+      const cell = plainTextFromHtml(inner);\n+      return cell ? `${cell} ` : \"\";\n+    });\n+\n+  content = decodeEntities(content)\n+    .replace(/<[^>]+>/g, \"\")\n+    .replace(/[ \\t]+\\n/g, \"\\n\")\n+    .replace(/\\n{3,}/g, \"\\n\\n\")\n+    .trim();\n+\n+  return content;\n+}\n+\n+function sanitizeSegment(value: string): string {\n+  const clean = decodeURIComponent(value)\n+    .toLowerCase()\n+    .replace(/[^a-z0-9]+/g, \"-\")\n+    .replace(/^-+|-+$/g, \"\");\n+\n+  return clean || \"page\";\n+}\n+\n+function sourcePathFromUrl(url: string): string {\n+  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n+  return pathname;\n+}\n+\n+function fileStemFromUrl(url: string): string {\n+  const sourcePath = sourcePathFromUrl(url);\n+\n+  if (sourcePath === \"/docs\") {\n+    return \"docs\";\n+  }\n+\n+  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n+  const segments = relative\n+    .split(\"/\")\n+    .filter(Boolean)\n+    .map(sanitizeSegment);\n+\n+  if (segments.length === 0) {\n+    return \"docs\";\n+  }\n+\n+  return [\"docs\", ...segments].join(\"__\");\n+}\n+\n+function extractSummary(markdown: string): string {\n+  const lines = markdown.split(\"\\n\");\n+  let inCodeBlock = false;\n+\n+  for (const rawLine of lines) {\n+    const line = rawLine.trim();\n+\n+    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n+      inCodeBlock = !inCodeBlock;\n+      continue;\n+    }\n+\n+    if (inCodeBlock) {\n+      continue;\n+    }\n+\n+    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n+      continue;\n+    }\n+\n+    if (line.length <= 25) {\n+      continue;\n+    }\n+\n+    if (line.length > SUMMARY_MAX_CHARS) {\n+      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n+    }\n+\n+    return line;\n+  }\n+\n+  return \"OpenCode documentation page snapshot.\";\n+}\n+\n+function keywordsForPath(sourcePath: string): string {\n+  const dynamic = sourcePath\n+    .split(\"/\")\n+    .filter(Boolean)\n+    .slice(1)\n+    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n+    .filter(Boolean)\n+    .join(\", \");\n+\n+  const base = \"opencode, docs, ai coding assistant, cli\";\n+  return dynamic ? `${base}, ${dynamic}` : base;\n+}\n+\n+function buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n+  const pageSummary = result.ok\n+    ? extractSummary(result.markdown ?? \"\")\n+    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n+\n+  const pageBody = result.ok\n+    ? result.markdown?.trim() ?? \"\"\n+    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n+\n+  return [\n+    \"----\",\n+    \"## External Docs Snapshot // opencode\",\n+    \"\",\n+    `- Captured: ${capturedAt}`,\n+    `- Source root: ${DOCS_ROOT}`,\n+    `- Source page: ${result.sourcePath}`,\n+    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n+    `- Summary: ${pageSummary}`,\n+    \"----\",\n+    \"\",\n+    `Source: ${result.url}`,\n+    \"\",\n+    pageBody,\n+    \"\",\n+    \"----\",\n+    \"## Notes / Comments / Lessons\",\n+    \"\",\n+    \"- Collection method: sitemap discovery + markdown conversion.\",\n+    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n+    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n+    \"----\",\n+    \"\",\n+  ].join(\"\\n\");\n+}\n+\n+function buildIndexMarkdown(\n+  artifacts: PageArtifact[],\n+  capturedAt: string,\n+  outputDirRelative: string,\n+): string {\n+  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n+  const failureCount = artifacts.length - successCount;\n+\n+  const pageList = artifacts\n+    .map((artifact) => {\n+      const status = artifact.ok ? \"ok\" : \"failed\";\n+      const mode = artifact.mode ?? \"unknown\";\n+      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n+    })\n+    .join(\"\\n\");\n+\n+  return [\n+    \"----\",\n+    \"## External Docs Index // opencode\",\n+    \"\",\n+    `- Captured: ${capturedAt}`,\n+    `- Source root: ${DOCS_ROOT}`,\n+    `- Output directory: ${outputDirRelative}`,\n+    `- Scope: ${artifacts.length} pages under /docs`,\n+    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n+    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n+    \"----\",\n+    \"\",\n+    \"## Pages\",\n+    \"\",\n+    pageList,\n+    \"\",\n+    \"----\",\n+    \"## Notes / Comments / Lessons\",\n+    \"\",\n+    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n+    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n+    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n+    \"----\",\n+    \"\",\n+  ].join(\"\\n\");\n+}\n+\n+async function fetchText(url: string): Promise<string> {\n+  const response = await fetch(url, {\n+    headers: {\n+      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n+    },\n+  });\n+\n+  if (!response.ok) {\n+    throw new Error(`Request failed (${response.status}) for ${url}`);\n+  }\n+\n+  return await response.text();\n+}\n+\n+function extractLocUrls(xml: string): string[] {\n+  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n+    decodeEntities(match[1]?.trim() ?? \"\"),\n+  ).filter(Boolean);\n+}\n+\n+async function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n+  const visited = new Set<string>();\n+  const pending: string[] = [sitemapUrl];\n+  const docsUrls = new Set<string>();\n+\n+  while (pending.length > 0) {\n+    const current = pending.pop();\n+    if (!current || visited.has(current)) {\n+      continue;\n+    }\n+\n+    visited.add(current);\n+\n+    let xml: string;\n+    try {\n+      xml = await fetchText(current);\n+    } catch {\n+      continue;\n+    }\n+\n+    const locUrls = extractLocUrls(xml);\n+    for (const locUrl of locUrls) {\n+      if (locUrl.endsWith(\".xml\")) {\n+        if (!visited.has(locUrl)) {\n+          pending.push(locUrl);\n+        }\n+        continue;\n+      }\n+\n+      if (!locUrl.startsWith(DOCS_ROOT)) {\n+        continue;\n+      }\n+\n+      if (locUrl.includes(\"#\")) {\n+        continue;\n+      }\n+\n+      docsUrls.add(locUrl);\n+    }\n+  }\n+\n+  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n+}\n+\n+async function mapConcurrent<T, R>(\n+  values: T[],\n+  limit: number,\n+  map: (value: T, index: number) => Promise<R>,\n+): Promise<R[]> {\n+  const results = new Array<R>(values.length);\n+  let index = 0;\n+\n+  async function worker(): Promise<void> {\n+    while (true) {\n+      const currentIndex = index;\n+      index += 1;\n+\n+      if (currentIndex >= values.length) {\n+        return;\n+      }\n+\n+      results[currentIndex] = await map(values[currentIndex], currentIndex);\n+    }\n+  }\n+\n+  const workerCount = Math.min(limit, values.length);\n+  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n+  return results;\n+}\n+\n+async function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n+  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n+\n+  try {\n+    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n+\n+    try {\n+      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n+      if (markdown) {\n+        return {\n+          url,\n+          ok: true,\n+          markdown,\n+          mode: \"jina\",\n+        };\n+      }\n+    } catch {\n+      // Fall through to direct HTML scrape.\n+    }\n+\n+    const html = await fetchText(url);\n+    const markdown = htmlToMarkdown(html);\n+\n+    if (!markdown) {\n+      return {\n+        url,\n+        ok: false,\n+        error: \"No markdown content returned from HTML fallback\",\n+      };\n+    }\n+\n+    return {\n+      url,\n+      ok: true,\n+      markdown,\n+      mode: \"html\",\n+    };\n+  } catch (error) {\n+    return {\n+      url,\n+      ok: false,\n+      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n+    };\n+  }\n+}\n+\n+function resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n+  if (!outputArg) {\n+    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n+  }\n+\n+  const resolved = resolve(repoRoot, outputArg);\n+  if (resolved.endsWith(\".md\")) {\n+    return dirname(resolved);\n+  }\n+\n+  return resolved;\n+}\n+\n+function clearExistingExtFiles(outputDir: string): void {\n+  if (!existsSync(outputDir)) {\n+    return;\n+  }\n+\n+  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n+    if (!entry.isFile()) {\n+      continue;\n+    }\n+\n+    if (!entry.name.endsWith(\".ext.md\")) {\n+      continue;\n+    }\n+\n+    rmSync(resolve(outputDir, entry.name));\n+  }\n+}\n+\n+const repoRoot = findRepoRoot(import.meta.dir);\n+const outputArg = Bun.argv[2];\n+const outputDir = resolveOutputDirectory(repoRoot, outputArg);\n+const outputDirRelative = outputDir.startsWith(repoRoot)\n+  ? outputDir.slice(repoRoot.length + 1)\n+  : outputDir;\n+\n+mkdirSync(outputDir, { recursive: true });\n+clearExistingExtFiles(outputDir);\n+\n+const docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+\n+if (docsUrls.length === 0) {\n+  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n+}\n+\n+const scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n+  scrapeDocsPage(url, index + 1, docsUrls.length),\n+);\n+\n+const usedNames = new Map<string, number>();\n+const artifacts: PageArtifact[] = scrapeResults.map((result) => {\n+  const stem = fileStemFromUrl(result.url);\n+  const seen = usedNames.get(stem) ?? 0;\n+  usedNames.set(stem, seen + 1);\n+\n+  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n+  const fileName = `${stem}${suffix}.ext.md`;\n+\n+  return {\n+    ...result,\n+    fileName,\n+    sourcePath: sourcePathFromUrl(result.url),\n+  };\n+});\n+\n+const capturedAt = new Date().toISOString();\n+\n+for (const artifact of artifacts) {\n+  const pagePath = resolve(outputDir, artifact.fileName);\n+  const pageContent = buildPageMarkdown(artifact, capturedAt);\n+  await Bun.write(pagePath, pageContent);\n+}\n+\n+const indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\n+await Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n+\n+const successCount = artifacts.filter((artifact) => artifact.ok).length;\n+const failureCount = artifacts.length - successCount;\n+const blockedPages = artifacts\n+  .filter((artifact) => !artifact.ok)\n+  .map((artifact) => artifact.sourcePath)\n+  .join(\",\");\n+\n+console.log(\n+  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n+);\n",
                  "before": "",
                  "after": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};\n\nconst SOURCE_KEY = \"opencode\";\nconst DOCS_ROOT = \"https://opencode.ai/docs\";\nconst SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\nconst DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\nconst CONCURRENCY = 4;\nconst SUMMARY_MAX_CHARS = 240;\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replaceAll(\"&amp;\", \"&\")\n    .replaceAll(\"&quot;\", '\"')\n    .replaceAll(\"&apos;\", \"'\")\n    .replaceAll(\"&#x27;\", \"'\")\n    .replaceAll(\"&#39;\", \"'\")\n    .replaceAll(\"&nbsp;\", \" \")\n    .replaceAll(\"&lt;\", \"<\")\n    .replaceAll(\"&gt;\", \">\");\n}\n\nfunction stripJinaEnvelope(markdown: string): string {\n  return markdown\n    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n    .trim();\n}\n\nfunction stripTags(value: string): string {\n  return value.replace(/<[^>]+>/g, \"\");\n}\n\nfunction plainTextFromHtml(value: string): string {\n  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n}\n\nfunction extractMainHtml(html: string): string {\n  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n  if (articleMatch?.[1]) {\n    return articleMatch[1];\n  }\n\n  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n  if (mainMatch?.[1]) {\n    return mainMatch[1];\n  }\n\n  return html;\n}\n\nfunction htmlToMarkdown(html: string): string {\n  let content = extractMainHtml(html);\n\n  content = content\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n\n  content = content.replace(\n    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n    (_match, code) => {\n      const normalizedCode = decodeEntities(\n        stripTags(code)\n          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n          .replace(/\\n{3,}/g, \"\\n\\n\")\n          .trim(),\n      );\n\n      if (!normalizedCode) {\n        return \"\";\n      }\n\n      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n    },\n  );\n\n  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n    const normalizedCode = decodeEntities(stripTags(code)).trim();\n    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n  });\n\n  content = content.replace(\n    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n    (_match, href, label) => {\n      const text = plainTextFromHtml(label);\n      if (!text) {\n        return \"\";\n      }\n\n      return `[${text}](${decodeEntities(href)})`;\n    },\n  );\n\n  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n    const heading = plainTextFromHtml(inner);\n    if (!heading) {\n      return \"\";\n    }\n\n    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n  });\n\n  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n    const line = plainTextFromHtml(inner);\n    return line ? `- ${line}\\n` : \"\";\n  });\n\n  content = content\n    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n      const cell = plainTextFromHtml(inner);\n      return cell ? `${cell} ` : \"\";\n    });\n\n  content = decodeEntities(content)\n    .replace(/<[^>]+>/g, \"\")\n    .replace(/[ \\t]+\\n/g, \"\\n\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .trim();\n\n  return content;\n}\n\nfunction sanitizeSegment(value: string): string {\n  const clean = decodeURIComponent(value)\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return clean || \"page\";\n}\n\nfunction sourcePathFromUrl(url: string): string {\n  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n  return pathname;\n}\n\nfunction fileStemFromUrl(url: string): string {\n  const sourcePath = sourcePathFromUrl(url);\n\n  if (sourcePath === \"/docs\") {\n    return \"docs\";\n  }\n\n  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n  const segments = relative\n    .split(\"/\")\n    .filter(Boolean)\n    .map(sanitizeSegment);\n\n  if (segments.length === 0) {\n    return \"docs\";\n  }\n\n  return [\"docs\", ...segments].join(\"__\");\n}\n\nfunction extractSummary(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  let inCodeBlock = false;\n\n  for (const rawLine of lines) {\n    const line = rawLine.trim();\n\n    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n      inCodeBlock = !inCodeBlock;\n      continue;\n    }\n\n    if (inCodeBlock) {\n      continue;\n    }\n\n    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n      continue;\n    }\n\n    if (line.length <= 25) {\n      continue;\n    }\n\n    if (line.length > SUMMARY_MAX_CHARS) {\n      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n    }\n\n    return line;\n  }\n\n  return \"OpenCode documentation page snapshot.\";\n}\n\nfunction keywordsForPath(sourcePath: string): string {\n  const dynamic = sourcePath\n    .split(\"/\")\n    .filter(Boolean)\n    .slice(1)\n    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n    .filter(Boolean)\n    .join(\", \");\n\n  const base = \"opencode, docs, ai coding assistant, cli\";\n  return dynamic ? `${base}, ${dynamic}` : base;\n}\n\nfunction buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n  const pageSummary = result.ok\n    ? extractSummary(result.markdown ?? \"\")\n    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  const pageBody = result.ok\n    ? result.markdown?.trim() ?? \"\"\n    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  return [\n    \"----\",\n    \"## External Docs Snapshot // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Source page: ${result.sourcePath}`,\n    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n    `- Summary: ${pageSummary}`,\n    \"----\",\n    \"\",\n    `Source: ${result.url}`,\n    \"\",\n    pageBody,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Collection method: sitemap discovery + markdown conversion.\",\n    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nfunction buildIndexMarkdown(\n  artifacts: PageArtifact[],\n  capturedAt: string,\n  outputDirRelative: string,\n): string {\n  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n  const failureCount = artifacts.length - successCount;\n\n  const pageList = artifacts\n    .map((artifact) => {\n      const status = artifact.ok ? \"ok\" : \"failed\";\n      const mode = artifact.mode ?? \"unknown\";\n      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n    })\n    .join(\"\\n\");\n\n  return [\n    \"----\",\n    \"## External Docs Index // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Output directory: ${outputDirRelative}`,\n    `- Scope: ${artifacts.length} pages under /docs`,\n    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n    \"----\",\n    \"\",\n    \"## Pages\",\n    \"\",\n    pageList,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nasync function fetchText(url: string): Promise<string> {\n  const response = await fetch(url, {\n    headers: {\n      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Request failed (${response.status}) for ${url}`);\n  }\n\n  return await response.text();\n}\n\nfunction extractLocUrls(xml: string): string[] {\n  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n    decodeEntities(match[1]?.trim() ?? \"\"),\n  ).filter(Boolean);\n}\n\nasync function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n  const visited = new Set<string>();\n  const pending: string[] = [sitemapUrl];\n  const docsUrls = new Set<string>();\n\n  while (pending.length > 0) {\n    const current = pending.pop();\n    if (!current || visited.has(current)) {\n      continue;\n    }\n\n    visited.add(current);\n\n    let xml: string;\n    try {\n      xml = await fetchText(current);\n    } catch {\n      continue;\n    }\n\n    const locUrls = extractLocUrls(xml);\n    for (const locUrl of locUrls) {\n      if (locUrl.endsWith(\".xml\")) {\n        if (!visited.has(locUrl)) {\n          pending.push(locUrl);\n        }\n        continue;\n      }\n\n      if (!locUrl.startsWith(DOCS_ROOT)) {\n        continue;\n      }\n\n      if (locUrl.includes(\"#\")) {\n        continue;\n      }\n\n      docsUrls.add(locUrl);\n    }\n  }\n\n  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n}\n\nasync function mapConcurrent<T, R>(\n  values: T[],\n  limit: number,\n  map: (value: T, index: number) => Promise<R>,\n): Promise<R[]> {\n  const results = new Array<R>(values.length);\n  let index = 0;\n\n  async function worker(): Promise<void> {\n    while (true) {\n      const currentIndex = index;\n      index += 1;\n\n      if (currentIndex >= values.length) {\n        return;\n      }\n\n      results[currentIndex] = await map(values[currentIndex], currentIndex);\n    }\n  }\n\n  const workerCount = Math.min(limit, values.length);\n  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n  return results;\n}\n\nasync function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n\n  try {\n    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n\n    try {\n      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n      if (markdown) {\n        return {\n          url,\n          ok: true,\n          markdown,\n          mode: \"jina\",\n        };\n      }\n    } catch {\n      // Fall through to direct HTML scrape.\n    }\n\n    const html = await fetchText(url);\n    const markdown = htmlToMarkdown(html);\n\n    if (!markdown) {\n      return {\n        url,\n        ok: false,\n        error: \"No markdown content returned from HTML fallback\",\n      };\n    }\n\n    return {\n      url,\n      ok: true,\n      markdown,\n      mode: \"html\",\n    };\n  } catch (error) {\n    return {\n      url,\n      ok: false,\n      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n    };\n  }\n}\n\nfunction resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n  if (!outputArg) {\n    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n  }\n\n  const resolved = resolve(repoRoot, outputArg);\n  if (resolved.endsWith(\".md\")) {\n    return dirname(resolved);\n  }\n\n  return resolved;\n}\n\nfunction clearExistingExtFiles(outputDir: string): void {\n  if (!existsSync(outputDir)) {\n    return;\n  }\n\n  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n    if (!entry.isFile()) {\n      continue;\n    }\n\n    if (!entry.name.endsWith(\".ext.md\")) {\n      continue;\n    }\n\n    rmSync(resolve(outputDir, entry.name));\n  }\n}\n\nconst repoRoot = findRepoRoot(import.meta.dir);\nconst outputArg = Bun.argv[2];\nconst outputDir = resolveOutputDirectory(repoRoot, outputArg);\nconst outputDirRelative = outputDir.startsWith(repoRoot)\n  ? outputDir.slice(repoRoot.length + 1)\n  : outputDir;\n\nmkdirSync(outputDir, { recursive: true });\nclearExistingExtFiles(outputDir);\n\nconst docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n\nif (docsUrls.length === 0) {\n  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n}\n\nconst scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n  scrapeDocsPage(url, index + 1, docsUrls.length),\n);\n\nconst usedNames = new Map<string, number>();\nconst artifacts: PageArtifact[] = scrapeResults.map((result) => {\n  const stem = fileStemFromUrl(result.url);\n  const seen = usedNames.get(stem) ?? 0;\n  usedNames.set(stem, seen + 1);\n\n  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n  const fileName = `${stem}${suffix}.ext.md`;\n\n  return {\n    ...result,\n    fileName,\n    sourcePath: sourcePathFromUrl(result.url),\n  };\n});\n\nconst capturedAt = new Date().toISOString();\n\nfor (const artifact of artifacts) {\n  const pagePath = resolve(outputDir, artifact.fileName);\n  const pageContent = buildPageMarkdown(artifact, capturedAt);\n  await Bun.write(pagePath, pageContent);\n}\n\nconst indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\nawait Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n\nconst successCount = artifacts.filter((artifact) => artifact.ok).length;\nconst failureCount = artifacts.length - successCount;\nconst blockedPages = artifacts\n  .filter((artifact) => !artifact.ok)\n  .map((artifact) => artifact.sourcePath)\n  .join(\",\");\n\nconsole.log(\n  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n);\n",
                  "additions": 528,
                  "deletions": 0
                }
              ],
              "diagnostics": {},
              "truncated": false
            },
            "time": {
              "start": 1771215103820,
              "end": 1771215103836
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_0f3fbc8225b8ed4f01699298ba2f088195a54423e1fe538a60"
            }
          },
          "id": "prt_c64a49778001BLM5F5ODnw3JkB",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a47040001VZWpaHT2z78mj6"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "0e8c60b38e790b7092f92dd8c3ccd3f49b1c202e",
          "cost": 0,
          "tokens": {
            "total": 32342,
            "input": 4770,
            "output": 5428,
            "reasoning": 339,
            "cache": {
              "read": 22144,
              "write": 0
            }
          },
          "id": "prt_c64a5a7710015zh27uym9qgEJO",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a47040001VZWpaHT2z78mj6"
        },
        {
          "type": "patch",
          "hash": "fc048a8afcda575cde9221fbaa918e5f21eda0a5",
          "files": [
            "/Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts"
          ],
          "id": "prt_c64a5a79e001CP9vwrpXTKylyL",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a47040001VZWpaHT2z78mj6"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215103906,
          "completed": 1771215142172
        },
        "error": {
          "name": "MessageAbortedError",
          "data": {
            "message": "The operation was aborted."
          }
        },
        "parentID": "msg_c64a42a82001VxLufzWxER91hc",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "input": 0,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "variant": "low",
        "id": "msg_c64a5a7a2001yFtzaOjVOr3tf5",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "0e8c60b38e790b7092f92dd8c3ccd3f49b1c202e",
          "id": "prt_c64a5afd90012x7PE33nt1iH1f",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a5a7a2001yFtzaOjVOr3tf5"
        },
        {
          "type": "reasoning",
          "text": "**Preparing to run script with bash**",
          "metadata": {
            "openai": {
              "itemId": "rs_0c4358df051802ad01699299025e0481979ad7f011be2a725f",
              "reasoningEncryptedContent": "gAAAAABpkpkDtCswrpqtHjUd8yt1AC_G185Rn8jJmhNqfhwzTBQciDYBdOif5u4UjE7ddTMlwln7sV3nnQPIqGjaYiQ3t1hOLKWWpzaYr0Uexbegew2FbQ4wX9-XqELUY7MxWCcUyDAK7qu7LWQ7rd9wVCVuO1dUx40D9dq8fEMe7pcundaaE_biEZTp4-9wjJelwthygklQC49Fx2iZp7PVwiK3sx0RLQRTyvySat7yg6GED8_IK37paPhvQrwh9SlIkIq-N_qbcykytFfbyYmRPFwOjSaosFobrrK3hcGW37NS1HuZImtSGn4-qdbJlM4JIAqcLXi-FqEtNh-B5a8eC4LyNfZnU06Te3p8bT2ZFUAhq1Luc1O7RuubBAODscjhNwDZo5w7Rg3z4XF7T7IufuBW5XlOO19kuHEgNF2A6ca5p3kv6sE8IRYaH3LYsWJ86O_te0SZoSWixDtWRDVCKoQgdhwc6-9DQcbsimj06DqjULcR0DFxLw9UoElZvn6a8sRV4GCBqZCzJh0zsQVlNA2b5nLOi95k2j3cFY605ZvjStxKzpceMYKSM5ar7Q5GZBEYSR-mBET9o2vV3yBp5V57bRzZK_IR8QJ7hpWkGpAThUQPR7AXhU0nvuthznzsJJM-mHumagKjwp6s1Zg10yl-_lhloyVWPy0pi3quZ15gh4LAdrphZ2eaGWdOV6CfEUCr10ubW9_JuJ6MDBXHAC5Auvhb6Di8RYgMM4DTJmCgzWBTbbQCo_-FR1kYfy-3Eyud7wWiOz0MSRJNvMk7J1KliByc6io5j_ITXTaQzsyYzUqV-h6pOw2cd1i62g2ZKqFhjHvhLq7q1F-oWs6an3l1yxlEhEMN2Fev7ycwQvWXDFLnWwt30jfzGAgErxy2k6dvQNo03TG420mbmVqFPv2zOl54mAC6wubAUz8d2ThKAOkYunj144FwROYqiLZxtuNF6xDfEhDOVCIENbdRoKmCSpOJxTii3eg3BoN3XUXXOZNjGlJD-ckxeSrDkLGWPWa2JXWWBnsnbjQpmkElgChJC9rtg8e-oNW-uMrTLznC-xGOFko="
            }
          },
          "time": {
            "start": 1771215106435,
            "end": 1771215107317
          },
          "id": "prt_c64a5b1830015yfP2TulBItgXw",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a5a7a2001yFtzaOjVOr3tf5"
        },
        {
          "type": "tool",
          "callID": "call_IodQBiieK8y3fga6lwQWvfTZ",
          "tool": "bash",
          "state": {
            "status": "error",
            "input": {
              "command": "bun scripts/scrape_opencode_docs.sh.ts",
              "description": "Run OpenCode docs scraper script"
            },
            "error": "Tool execution aborted",
            "metadata": {
              "output": "Docs // Scrape // 1/578 https://opencode.ai/docs/\nDocs // Scrape // 2/578 https://opencode.ai/docs/acp\nDocs // Scrape // 3/578 https://opencode.ai/docs/agents\nDocs // Scrape // 4/578 https://opencode.ai/docs/ar/\nDocs // Scrape // 5/578 https://opencode.ai/docs/ar/acp\nDocs // Scrape // 6/578 https://opencode.ai/docs/ar/agents\nDocs // Scrape // 7/578 https://opencode.ai/docs/ar/cli\nDocs // Scrape // 8/578 https://opencode.ai/docs/ar/commands\nDocs // Scrape // 9/578 https://opencode.ai/docs/ar/config\nDocs // Scrape // 10/578 https://opencode.ai/docs/ar/custom-tools\nDocs // Scrape // 11/578 https://opencode.ai/docs/ar/ecosystem\nDocs // Scrape // 12/578 https://opencode.ai/docs/ar/enterprise\nDocs // Scrape // 13/578 https://opencode.ai/docs/ar/formatters\nDocs // Scrape // 14/578 https://opencode.ai/docs/ar/github\nDocs // Scrape // 15/578 https://opencode.ai/docs/ar/gitlab\nDocs // Scrape // 16/578 https://opencode.ai/docs/ar/ide\nDocs // Scrape // 17/578 https://opencode.ai/docs/ar/keybinds\nDocs // Scrape // 18/578 https://opencode.ai/docs/ar/lsp\nDocs // Scrape // 19/578 https://opencode.ai/docs/ar/mcp-servers\nDocs // Scrape // 20/578 https://opencode.ai/docs/ar/models\nDocs // Scrape // 21/578 https://opencode.ai/docs/ar/modes\nDocs // Scrape // 22/578 https://opencode.ai/docs/ar/network\nDocs // Scrape // 23/578 https://opencode.ai/docs/ar/permissions\nDocs // Scrape // 24/578 https://opencode.ai/docs/ar/plugins\nDocs // Scrape // 25/578 https://opencode.ai/docs/ar/providers\nDocs // Scrape // 26/578 https://opencode.ai/docs/ar/rules\nDocs // Scrape // 27/578 https://opencode.ai/docs/ar/sdk\nDocs // Scrape // 28/578 https://opencode.ai/docs/ar/server\nDocs // Scrape // 29/578 https://opencode.ai/docs/ar/share\nDocs // Scrape // 30/578 https://opencode.ai/docs/ar/skills\nDocs // Scrape // 31/578 https://opencode.ai/docs/ar/themes\nDocs // Scrape // 32/578 https://opencode.ai/docs/ar/tools\nDocs // Scrape // 33/578 https://opencode.ai/docs/ar/troubleshooting\nDocs // Scrape // 34/578 https://opencode.ai/docs/ar/tui\nDocs // Scrape // 35/578 https://opencode.ai/docs/ar/web\nDocs // Scrape // 36/578 https://opencode.ai/docs/ar/windows-wsl\nDocs // Scrape // 37/578 https://opencode.ai/docs/ar/zen\nDocs // Scrape // 38/578 https://opencode.ai/docs/cli\nDocs // Scrape // 39/578 https://opencode.ai/docs/commands\nDocs // Scrape // 40/578 https://opencode.ai/docs/config\nDocs // Scrape // 41/578 https://opencode.ai/docs/custom-tools\nDocs // Scrape // 42/578 https://opencode.ai/docs/da/\nDocs // Scrape // 43/578 https://opencode.ai/docs/da/acp\nDocs // Scrape // 44/578 https://opencode.ai/docs/da/agents\nDocs // Scrape // 45/578 https://opencode.ai/docs/da/cli\nDocs // Scrape // 46/578 https://opencode.ai/docs/da/commands\nDocs // Scrape // 47/578 https://opencode.ai/docs/da/config\nDocs // Scrape // 48/578 https://opencode.ai/docs/da/custom-tools\nDocs // Scrape // 49/578 https://opencode.ai/docs/da/ecosystem\nDocs // Scrape // 50/578 https://opencode.ai/docs/da/enterprise\nDocs // Scrape // 51/578 https://opencode.ai/docs/da/formatters\nDocs // Scrape // 52/578 https://opencode.ai/docs/da/github\nDocs // Scrape // 53/578 https://opencode.ai/docs/da/gitlab\nDocs // Scrape // 54/578 https://opencode.ai/docs/da/ide\nDocs // Scrape // 55/578 https://opencode.ai/docs/da/keybinds\nDocs // Scrape // 56/578 https://opencode.ai/docs/da/lsp\nDocs // Scrape // 57/578 https://opencode.ai/docs/da/mcp-servers\nDocs // Scrape // 58/578 https://opencode.ai/docs/da/models\nDocs // Scrape // 59/578 https://opencode.ai/docs/da/modes\nDocs // Scrape // 60/578 https://opencode.ai/docs/da/network\nDocs // Scrape // 61/578 https://opencode.ai/docs/da/permissions\nDocs // Scrape // 62/578 https://opencode.ai/docs/da/plugins\nDocs // Scrape // 63/578 https://opencode.ai/docs/da/providers\nDocs // Scrape // 64/578 https://opencode.ai/docs/da/rules\nDocs // Scrape // 65/578 https://opencode.ai/docs/da/sdk\nDocs // Scrape // 66/578 https://opencode.ai/docs/da/server\nDocs // Scrape // 67/578 https://opencode.ai/docs/da/share\nDocs // Scrape // 68/578 https://opencode.ai/docs/da/skills\nDocs // Scrape // 69/578 https://opencode.ai/docs/da/themes\nDocs // Scrape // 70/578 https://opencode.ai/docs/da/tools\nDocs // Scrape // 71/578 https://opencode.ai/docs/da/troubleshooting\nDocs // Scrape // 72/578 https://opencode.ai/docs/da/tui\nDocs // Scrape // 73/578 https://opencode.ai/docs/da/web\nDocs // Scrape // 74/578 https://opencode.ai/docs/da/windows-wsl\nDocs // Scrape // 75/578 https://opencode.ai/docs/da/zen\nDocs // Scrape // 76/578 https://opencode.ai/docs/de/\nDocs // Scrape // 77/578 https://opencode.ai/docs/de/acp\nDocs // Scrape // 78/578 https://opencode.ai/docs/de/agents\nDocs // Scrape // 79/578 https://opencode.ai/docs/de/cli\nDocs // Scrape // 80/578 https://opencode.ai/docs/de/commands\nDocs // Scrape // 81/578 https://opencode.ai/docs/de/config\nDocs // Scrape // 82/578 https://opencode.ai/docs/de/custom-tools\nDocs // Scrape // 83/578 https://opencode.ai/docs/de/ecosystem\nDocs // Scrape // 84/578 https://opencode.ai/docs/de/enterprise\nDocs // Scrape // 85/578 https://opencode.ai/docs/de/formatters\nDocs // Scrape // 86/578 https://opencode.ai/docs/de/github\nDocs // Scrape // 87/578 https://opencode.ai/docs/de/gitlab\nDocs // Scrape // 88/578 https://opencode.ai/docs/de/ide\nDocs // Scrape // 89/578 https://opencode.ai/docs/de/keybinds\nDocs // Scrape // 90/578 https://opencode.ai/docs/de/lsp\nDocs // Scrape // 91/578 https://opencode.ai/docs/de/mcp-servers\nDocs // Scrape // 92/578 https://opencode.ai/docs/de/models\nDocs // Scrape // 93/578 https://opencode.ai/docs/de/modes\nDocs // Scrape // 94/578 https://opencode.ai/docs/de/network\nDocs // Scrape // 95/578 https://opencode.ai/docs/de/permissions\nDocs // Scrape // 96/578 https://opencode.ai/docs/de/plugins\nDocs // Scrape // 97/578 https://opencode.ai/docs/de/providers\nDocs // Scrape // 98/578 https://opencode.ai/docs/de/rules\nDocs // Scrape // 99/578 https://opencode.ai/docs/de/sdk\nDocs // Scrape // 100/578 https://opencode.ai/docs/de/server\nDocs // Scrape // 101/578 https://opencode.ai/docs/de/share\nDocs // Scrape // 102/578 https://opencode.ai/docs/de/skills\nDocs // Scrape // 103/578 https://opencode.ai/docs/de/themes\nDocs // Scrape // 104/578 https://opencode.ai/docs/de/tools\nDocs // Scrape // 105/578 https://opencode.ai/docs/de/troubleshooting\nDocs // Scrape // 106/578 https://opencode.ai/docs/de/tui\nDocs // Scrape // 107/578 https://opencode.ai/docs/de/web\nDocs // Scrape // 108/578 https://opencode.ai/docs/de/windows-wsl\nDocs // Scrape // 109/578 https://opencode.ai/docs/de/zen\nDocs // Scrape // 110/578 https://opencode.ai/docs/ecosystem\nDocs // Scrape // 111/578 https://opencode.ai/docs/enterprise\nDocs // Scrape // 112/578 https://opencode.ai/docs/es/\nDocs // Scrape // 113/578 https://opencode.ai/docs/es/acp\nDocs // Scrape // 114/578 https://opencode.ai/docs/es/agents\nDocs // Scrape // 115/578 https://opencode.ai/docs/es/cli\nDocs // Scrape // 116/578 https://opencode.ai/docs/es/commands\nDocs // Scrape // 117/578 https://opencode.ai/docs/es/config\nDocs // Scrape // 118/578 https://opencode.ai/docs/es/custom-tools\nDocs // Scrape // 119/578 https://opencode.ai/docs/es/ecosystem\nDocs // Scrape // 120/578 https://opencode.ai/docs/es/enterprise\nDocs // Scrape // 121/578 https://opencode.ai/docs/es/formatters\nDocs // Scrape // 122/578 https://opencode.ai/docs/es/github\nDocs // Scrape // 123/578 https://opencode.ai/docs/es/gitlab\nDocs // Scrape // 124/578 https://opencode.ai/docs/es/ide\nDocs // Scrape // 125/578 https://opencode.ai/docs/es/keybinds\nDocs // Scrape // 126/578 https://opencode.ai/docs/es/lsp\nDocs // Scrape // 127/578 https://opencode.ai/docs/es/mcp-servers\nDocs // Scrape // 128/578 https://opencode.ai/docs/es/models\nDocs // Scrape // 129/578 https://opencode.ai/docs/es/modes\nDocs // Scrape // 130/578 https://opencode.ai/docs/es/network\nDocs // Scrape // 131/578 https://opencode.ai/docs/es/permissions\nDocs // Scrape // 132/578 https://opencode.ai/docs/es/plugins\nDocs // Scrape // 133/578 https://opencode.ai/docs/es/providers\nDocs // Scrape // 134/578 https://opencode.ai/docs/es/rules\nDocs // Scrape // 135/578 https://opencode.ai/docs/es/sdk\nDocs // Scrape // 136/578 https://opencode.ai/docs/es/server\nDocs // Scrape // 137/578 https://opencode.ai/docs/es/share\nDocs // Scrape // 138/578 https://opencode.ai/docs/es/skills\nDocs // Scrape // 139/578 https://opencode.ai/docs/es/themes\nDocs // Scrape // 140/578 https://opencode.ai/docs/es/tools\nDocs // Scrape // 141/578 https://opencode.ai/docs/es/troubleshooting\nDocs // Scrape // 142/578 https://opencode.ai/docs/es/tui\nDocs // Scrape // 143/578 https://opencode.ai/docs/es/web\nDocs // Scrape // 144/578 https://opencode.ai/docs/es/windows-wsl\nDocs // Scrape // 145/578 https://opencode.ai/docs/es/zen\nDocs // Scrape // 146/578 https://opencode.ai/docs/formatters\nDocs // Scrape // 147/578 https://opencode.ai/docs/fr/\nDocs // Scrape // 148/578 https://opencode.ai/docs/fr/acp\nDocs // Scrape // 149/578 https://opencode.ai/docs/fr/agents\nDocs // Scrape // 150/578 https://opencode.ai/docs/fr/cli\nDocs // Scrape // 151/578 https://opencode.ai/docs/fr/commands\nDocs // Scrape // 152/578 https://opencode.ai/docs/fr/config\nDocs // Scrape // 153/578 https://opencode.ai/docs/fr/custom-tools\nDocs // Scrape // 154/578 https://opencode.ai/docs/fr/ecosystem\nDocs // Scrape // 155/578 https://opencode.ai/docs/fr/enterprise\nDocs // Scrape // 156/578 https://opencode.ai/docs/fr/formatters\nDocs // Scrape // 157/578 https://opencode.ai/docs/fr/github\nDocs // Scrape // 158/578 https://opencode.ai/docs/fr/gitlab\nDocs // Scrape // 159/578 https://opencode.ai/docs/fr/ide\nDocs // Scrape // 160/578 https://opencode.ai/docs/fr/keybinds\nDocs // Scrape // 161/578 https://opencode.ai/docs/fr/lsp\nDocs // Scrape // 162/578 https://opencode.ai/docs/fr/mcp-servers\nDocs // Scrape // 163/578 https://opencode.ai/docs/fr/models\nDocs // Scrape // 164/578 https://opencode.ai/docs/fr/modes\nDocs // Scrape // 165/578 https://opencode.ai/docs/fr/network\nDocs // Scrape // 166/578 https://opencode.ai/docs/fr/permissions\nDocs // Scrape // 167/578 https://opencode.ai/docs/fr/plugins\nDocs // Scrape // 168/578 https://opencode.ai/docs/fr/providers\nDocs // Scrape // 169/578 https://opencode.ai/docs/fr/rules\nDocs // Scrape // 170/578 https://opencode.ai/docs/fr/sdk\nDocs // Scrape // 171/578 https://opencode.ai/docs/fr/server\nDocs // Scrape // 172/578 https://opencode.ai/docs/fr/share\nDocs // Scrape // 173/578 https://opencode.ai/docs/fr/skills\nDocs // Scrape // 174/578 https://opencode.ai/docs/fr/themes\nDocs // Scrape // 175/578 https://opencode.ai/docs/fr/tools\nDocs // Scrape // 176/578 https://opencode.ai/docs/fr/troubleshooting\nDocs // Scrape // 177/578 https://opencode.ai/docs/fr/tui\nDocs // Scrape // 178/578 https://opencode.ai/docs/fr/web\nDocs // Scrape // 179/578 https://opencode.ai/docs/fr/windows-wsl\nDocs // Scrape // 180/578 https://opencode.ai/docs/fr/zen\nDocs // Scrape // 181/578 https://opencode.ai/docs/github\nDocs // Scrape // 182/578 https://opencode.ai/docs/gitlab\nDocs // Scrape // 183/578 https://opencode.ai/docs/ide\nDocs // Scrape // 184/578 https://opencode.ai/docs/it/\nDocs // Scrape // 185/578 https://opencode.ai/docs/it/acp\nDocs // Scrape // 186/578 https://opencode.ai/docs/it/agents\nDocs // Scrape // 187/578 https://opencode.ai/docs/it/cli\nDocs // Scrape // 188/578 https://opencode.ai/docs/it/commands\nDocs // Scrape // 189/578 https://opencode.ai/docs/it/config\nDocs // Scrape // 190/578 https://opencode.ai/docs/it/custom-tools\nDocs // Scrape // 191/578 https://opencode.ai/docs/it/ecosystem\nDocs // Scrape // 192/578 https://opencode.ai/docs/it/enterprise\nDocs // Scrape // 193/578 https://opencode.ai/docs/it/formatters\nDocs // Scrape // 194/578 https://opencode.ai/docs/it/github\nDocs // Scrape // 195/578 https://opencode.ai/docs/it/gitlab\nDocs // Scrape // 196/578 https://opencode.ai/docs/it/ide\nDocs // Scrape // 197/578 https://opencode.ai/docs/it/keybinds\nDocs // Scrape // 198/578 https://opencode.ai/docs/it/lsp\nDocs // Scrape // 199/578 https://opencode.ai/docs/it/mcp-servers\nDocs // Scrape // 200/578 https://opencode.ai/docs/it/models\nDocs // Scrape // 201/578 https://opencode.ai/docs/it/modes\nDocs // Scrape // 202/578 https://opencode.ai/docs/it/network\nDocs // Scrape // 203/578 https://opencode.ai/docs/it/permissions\nDocs // Scrape // 204/578 https://opencode.ai/docs/it/plugins\nDocs // Scrape // 205/578 https://opencode.ai/docs/it/providers\nDocs // Scrape // 206/578 https://opencode.ai/docs/it/rules\nDocs // Scrape // 207/578 https://opencode.ai/docs/it/sdk\nDocs // Scrape // 208/578 https://opencode.ai/docs/it/server\nDocs // Scrape // 209/578 https://opencode.ai/docs/it/share\nDocs // Scrape // 210/578 https://opencode.ai/docs/it/skills\nDocs // Scrape // 211/578 https://opencode.ai/docs/it/themes\nDocs // Scrape // 212/578 https://opencode.ai/docs/it/tools\nDocs // Scrape // 213/578 https://opencode.ai/docs/it/troubleshooting\nDocs // Scrape // 214/578 https://opencode.ai/docs/it/tui\nDocs // Scrape // 215/578 https://opencode.ai/docs/it/web\nDocs // Scrape // 216/578 https://opencode.ai/docs/it/windows-wsl\nDocs // Scrape // 217/578 https://opencode.ai/docs/it/zen\nDocs // Scrape // 218/578 https://opencode.ai/docs/ja/\nDocs // Scrape // 219/578 https://opencode.ai/docs/ja/acp\nDocs // Scrape // 220/578 https://opencode.ai/docs/ja/agents\nDocs // Scrape // 221/578 https://opencode.ai/docs/ja/cli\nDocs // Scrape // 222/578 https://opencode.ai/docs/ja/commands\nDocs // Scrape // 223/578 https://opencode.ai/docs/ja/config\nDocs // Scrape // 224/578 https://opencode.ai/docs/ja/custom-tools\nDocs // Scrape // 225/578 https://opencode.ai/docs/ja/ecosystem\nDocs // Scrape // 226/578 https://opencode.ai/docs/ja/enterprise\nDocs // Scrape // 227/578 https://opencode.ai/docs/ja/formatters\nDocs // Scrape // 228/578 https://opencode.ai/docs/ja/github\nDocs // Scrape // 229/578 https://opencode.ai/docs/ja/gitlab\nDocs // Scrape // 230/578 https://opencode.ai/docs/ja/ide\nDocs // Scrape // 231/578 https://opencode.ai/docs/ja/keybinds\nDocs // Scrape // 232/578 https://opencode.ai/docs/ja/lsp\nDocs // Scrape // 233/578 https://opencode.ai/docs/ja/mcp-servers\nDocs // Scrape // 234/578 https://opencode.ai/docs/ja/models\nDocs // Scrape // 235/578 https://opencode.ai/docs/ja/modes\nDocs // Scrape // 236/578 https://opencode.ai/docs/ja/network\nDocs // Scrape // 237/578 https://opencode.ai/docs/ja/permissions\nDocs // Scrape // 238/578 https://opencode.ai/docs/ja/plugins\nDocs // Scrape // 239/578 https://opencode.ai/docs/ja/providers\nDocs // Scrape // 240/578 https://opencode.ai/docs/ja/rules\nDocs // Scrape // 241/578 https://opencode.ai/docs/ja/sdk\nDocs // Scrape // 242/578 https://opencode.ai/docs/ja/server\nDocs // Scrape // 243/578 https://opencode.ai/docs/ja/share\nDocs // Scrape // 244/578 https://opencode.ai/docs/ja/skills\nDocs // Scrape // 245/578 https://opencode.ai/docs/ja/themes\nDocs // Scrape // 246/578 https://opencode.ai/docs/ja/tools\nDocs // Scrape // 247/578 https://opencode.ai/docs/ja/troubleshooting\nDocs // Scrape // 248/578 https://opencode.ai/docs/ja/tui\nDocs // Scrape // 249/578 https://opencode.ai/docs/ja/web\nDocs // Scrape // 250/578 https://opencode.ai/docs/ja/windows-wsl\nDocs // Scrape // 251/578 https://opencode.ai/docs/ja/zen\nDocs // Scrape // 252/578 https://opencode.ai/docs/keybinds\nDocs // Scrape // 253/578 https://opencode.ai/docs/ko/\nDocs // Scrape // 254/578 https://opencode.ai/docs/ko/acp\nDocs // Scrape // 255/578 https://opencode.ai/docs/ko/agents\nDocs // Scrape // 256/578 https://opencode.ai/docs/ko/cli\nDocs // Scrape // 257/578 https://opencode.ai/docs/ko/commands\nDocs // Scrape // 258/578 https://opencode.ai/docs/ko/config\nDocs // Scrape // 259/578 https://opencode.ai/docs/ko/custom-tools\nDocs // Scrape // 260/578 https://opencode.ai/docs/ko/ecosystem\nDocs // Scrape // 261/578 https://opencode.ai/docs/ko/enterprise\nDocs // Scrape // 262/578 https://opencode.ai/docs/ko/formatters\nDocs // Scrape // 263/578 https://opencode.ai/docs/ko/github\nDocs // Scrape // 264/578 https://opencode.ai/docs/ko/gitlab\nDocs // Scrape // 265/578 https://opencode.ai/docs/ko/ide\nDocs // Scrape // 266/578 https://opencode.ai/docs/ko/keybinds\nDocs // Scrape // 267/578 https://opencode.ai/docs/ko/lsp\nDocs // Scrape // 268/578 https://opencode.ai/docs/ko/mcp-servers\nDocs // Scrape // 269/578 https://opencode.ai/docs/ko/models\nDocs // Scrape // 270/578 https://opencode.ai/docs/ko/modes\nDocs // Scrape // 271/578 https://opencode.ai/docs/ko/network\nDocs // Scrape // 272/578 https://opencode.ai/docs/ko/permissions\nDocs // Scrape // 273/578 https://opencode.ai/docs/ko/plugins\nDocs // Scrape // 274/578 https://opencode.ai/docs/ko/providers\nDocs // Scrape // 275/578 https://opencode.ai/docs/ko/rules\nDocs // Scrape // 276/578 https://opencode.ai/docs/ko/sdk\nDocs // Scrape // 277/578 https://opencode.ai/docs/ko/server\nDocs // Scrape // 278/578 https://opencode.ai/docs/ko/share\nDocs // Scrape // 279/578 https://opencode.ai/docs/ko/skills\nDocs // Scrape // 280/578 https://opencode.ai/docs/ko/themes\nDocs // Scrape // 281/578 https://opencode.ai/docs/ko/tools\nDocs // Scrape // 282/578 https://opencode.ai/docs/ko/troubleshooting\nDocs // Scrape // 283/578 https://opencode.ai/docs/ko/tui\nDocs // Scrape // 284/578 https://opencode.ai/docs/ko/web\nDocs // Scrape // 285/578 https://opencode.ai/docs/ko/windows-wsl\nDocs // Scrape // 286/578 https://opencode.ai/docs/ko/zen\nDocs // Scrape // 287/578 https://opencode.ai/docs/lsp\nDocs // Scrape // 288/578 https://opencode.ai/docs/mcp-servers\nDocs // Scrape // 289/578 https://opencode.ai/docs/models\nDocs // Scrape // 290/578 https://opencode.ai/docs/modes\nDocs // Scrape // 291/578 https://opencode.ai/docs/nb/\nDocs // Scrape // 292/578 https://opencode.ai/docs/nb/acp\nDocs // Scrape // 293/578 https://opencode.ai/docs/nb/agents\nDocs // Scrape // 294/578 https://opencode.ai/docs/nb/cli\nDocs // Scrape // 295/578 https://opencode.ai/docs/nb/commands\nDocs // Scrape // 296/578 https://opencode.ai/docs/nb/config\nDocs // Scrape // 297/578 https://opencode.ai/docs/nb/custom-tools\nDocs // Scrape // 298/578 https://opencode.ai/docs/nb/ecosystem\nDocs // Scrape // 299/578 https://opencode.ai/docs/nb/enterprise\nDocs // Scrape // 300/578 https://opencode.ai/docs/nb/formatters\nDocs // Scrape // 301/578 https://opencode.ai/docs/nb/github\nDocs // Scrape // 302/578 https://opencode.ai/docs/nb/gitlab\nDocs // Scrape // 303/578 https://opencode.ai/docs/nb/ide\nDocs // Scrape // 304/578 https://opencode.ai/docs/nb/keybinds\nDocs // Scrape // 305/578 https://opencode.ai/docs/nb/lsp\nDocs // Scrape // 306/578 https://opencode.ai/docs/nb/mcp-servers\nDocs // Scrape // 307/578 https://opencode.ai/docs/nb/models\nDocs // Scrape // 308/578 https://opencode.ai/docs/nb/modes\nDocs // Scrape // 309/578 https://opencode.ai/docs/nb/network\nDocs // Scrape // 310/578 https://opencode.ai/docs/nb/permissions\nDocs // Scrape // 311/578 https://opencode.ai/docs/nb/plugins\nDocs // Scrape // 312/578 https://opencode.ai/docs/nb/providers\nDocs // Scrape // 313/578 https://opencode.ai/docs/nb/rules\nDocs // Scrape // 314/578 https://opencode.ai/docs/nb/sdk\nDocs // Scrape // 315/578 https://opencode.ai/docs/nb/server\n",
              "description": "Run OpenCode docs scraper script"
            },
            "time": {
              "start": 1771215142171,
              "end": 1771215142171
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_0c4358df051802ad016992990346788197b2ef3b70b9256a5e"
            }
          },
          "id": "prt_c64a5b4f500152SzrNRr7LxN8T",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a5a7a2001yFtzaOjVOr3tf5"
        },
        {
          "type": "patch",
          "hash": "0e8c60b38e790b7092f92dd8c3ccd3f49b1c202e",
          "files": [
            "/Users/alex/repos/vfp/dark-factory/docs/designs/core_gen1.design.md",
            "/Users/alex/repos/vfp/dark-factory/schemas/core/v1/api/product_api.proto",
            "/Users/alex/repos/vfp/dark-factory/schemas/core/v1/types/actor.proto",
            "/Users/alex/repos/vfp/dark-factory/schemas/core/v1/types/common.proto",
            "/Users/alex/repos/vfp/dark-factory/schemas/core/v1/types/product.proto",
            "/Users/alex/repos/vfp/dark-factory/schemas/core/v1/types/variant.proto"
          ],
          "id": "prt_c64a63d18001Hp2GozH5UQa92U",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a5a7a2001yFtzaOjVOr3tf5"
        }
      ]
    },
    {
      "info": {
        "role": "user",
        "time": {
          "created": 1771215153126
        },
        "summary": {
          "title": "Language handling: English-only option?",
          "diffs": [
            {
              "file": "AGENTS.md",
              "before": "# Dark Factory - Agent Operating Guide\n\nThis file is for coding agents working in `dark-factory`.\nIt reflects only what is currently true in this repository.\n\n## 1) Current Repository Context\n\n- The repo is early-stage and mostly docs/config right now.\n- Tracked project files currently include:\n  - `README.md`\n  - `TODO.md`\n  - `AGENTS.md`\n  - `opencode.jsonc`\n  - `.opencode/agents/gitter.md`\n  - `.opencode/skills/gitter-commit/SKILL.md`\n- No application code tree is committed yet (`src/`, `apps/`, `crates/`, etc.).\n\n## 2) Build/Lint/Test Status (Current Truth)\n\n- There are no validated build, lint, typecheck, or test commands yet.\n- Do not invent or assume project commands in commits or PR notes.\n- If new tooling is added, document only commands that are verified in this repo.\n\n## 3) Cursor and Copilot Rules\n\n- Checked and currently absent:\n  - `.cursor/rules/`\n  - `.cursorrules`\n  - `.github/copilot-instructions.md`\n- If any of these files appear later, treat them as authoritative and update this guide.\n\n## 4) Coding Style (Minimal Baseline)\n\nUntil language/tool-specific configs exist, follow pragmatic defaults:\n\n- Favor readable, explicit code over clever shortcuts.\n- Keep functions focused and avoid hidden side effects.\n- Avoid dead code, unused imports, and speculative abstractions.\n- Keep naming consistent (`PascalCase` types, `camelCase` values/functions, `UPPER_SNAKE_CASE` constants).\n- Handle errors with context; do not swallow exceptions silently.\n- Never log secrets or credentials.\n- Log messages should follow: `System // Optional Sub system // Message (Metadata)`.\n  - Example: `Core // HTTP // Listening (env=development,host=127.0.0.1,port=4150)`.\n\n## 5) Git Workflow\n\n- Commit meaningful units of work; avoid giant mixed commits.\n- Do not push unless the user explicitly requests it.\n- Commit message format:\n  - `{Component/Meta} // {Optional Addition} // {Short Description} (Optional,Tags)`\n- Examples:\n  - `Docs // Added converted PDF docs`\n  - `Pipelines // ODM // Added initial ODM pipeline (WIP)`\n- In commit body, add a short rationale and signature when possible:\n  - `// Chappie/Model (your model if known)`\n\n## 6) OpenCode Integration\n\n- `.opencode/agents/gitter.md` is the git-focused subagent.\n- `.opencode/skills/gitter-commit/SKILL.md` documents when to route commit tasks to `@gitter`.\n- `.opencode/skills/proto-install/SKILL.md` documents standardized script-based `proto install` usage.\n- `.opencode/skills/protobuf-schema-authoring/SKILL.md` documents how to author proto2/proto3 schemas and provide Rust/TypeScript codegen workflows.\n- `.opencode/skills/script-authoring/SKILL.md` documents how to build reusable Bun scripts from prompt/example/bash/context.\n- `.opencode/skills/docs-scraping/SKILL.md` documents generic user-request driven external docs scraping workflows.\n- Use `@gitter` when the user asks for commit support or cleanup.\n\n## 7) Local Fork Workflow (`elysia-protobuf`)\n\n- `elysia-protobuf` is also cloned locally at `~/repos/vfp/elysia-protobuf`.\n- If Core hits a bug in that dependency, patch it in the local fork repo, push the fork, then update the pinned git ref in `core/package.json` and refresh `core/bun.lock`.\n- Core currently tracks `elysia-protobuf` from the fork `master` branch in `core/package.json`; after pushing fork changes, refresh `core/bun.lock` in this repo.\n\n## 8) Script Conventions\n\n- Project scripts use shebanged Bun TypeScript files (`#!/usr/bin/env bun`) under `scripts/`.\n- Script naming uses `*.sh.ts` to indicate executable shell-style Bun scripts.\n- Shared script helpers live under `scripts/helpers/`.\n- `scripts/install.sh.ts` runs a reusable ordered list of install steps.\n- `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n- `scripts/scrape_moon_docs.sh.ts` scrapes moonrepo docs into split per-page `docs/external/moonrepo/*.ext.md` files and writes `docs/external/moonrepo/index.ext.md`.\n- After a new command sequence succeeds in a conversation, suggest capturing it into a reusable script via `.opencode/commands/capture_script_from_context.md`.\n\n## 9) Keep This File Updated\n\n- Update this file when real code, tooling, or CI is added.\n- Keep instructions tied to verified repository behavior.\n- Prefer short, accurate guidance over aspirational process docs.\n",
              "after": "# Dark Factory - Agent Operating Guide\n\nThis file is for coding agents working in `dark-factory`.\nIt reflects only what is currently true in this repository.\n\n## 1) Current Repository Context\n\n- The repo is early-stage and mostly docs/config right now.\n- Tracked project files currently include:\n  - `README.md`\n  - `TODO.md`\n  - `AGENTS.md`\n  - `opencode.jsonc`\n  - `.opencode/agents/gitter.md`\n  - `.opencode/skills/gitter-commit/SKILL.md`\n- No application code tree is committed yet (`src/`, `apps/`, `crates/`, etc.).\n\n## 2) Build/Lint/Test Status (Current Truth)\n\n- There are no validated build, lint, typecheck, or test commands yet.\n- Do not invent or assume project commands in commits or PR notes.\n- If new tooling is added, document only commands that are verified in this repo.\n\n## 3) Cursor and Copilot Rules\n\n- Checked and currently absent:\n  - `.cursor/rules/`\n  - `.cursorrules`\n  - `.github/copilot-instructions.md`\n- If any of these files appear later, treat them as authoritative and update this guide.\n\n## 4) Coding Style (Minimal Baseline)\n\nUntil language/tool-specific configs exist, follow pragmatic defaults:\n\n- Favor readable, explicit code over clever shortcuts.\n- Keep functions focused and avoid hidden side effects.\n- Avoid dead code, unused imports, and speculative abstractions.\n- Keep naming consistent (`PascalCase` types, `camelCase` values/functions, `UPPER_SNAKE_CASE` constants).\n- Handle errors with context; do not swallow exceptions silently.\n- Never log secrets or credentials.\n- Log messages should follow: `System // Optional Sub system // Message (Metadata)`.\n  - Example: `Core // HTTP // Listening (env=development,host=127.0.0.1,port=4150)`.\n\n## 5) Git Workflow\n\n- Commit meaningful units of work; avoid giant mixed commits.\n- Do not push unless the user explicitly requests it.\n- Commit message format:\n  - `{Component/Meta} // {Optional Addition} // {Short Description} (Optional,Tags)`\n- Examples:\n  - `Docs // Added converted PDF docs`\n  - `Pipelines // ODM // Added initial ODM pipeline (WIP)`\n- In commit body, add a short rationale and signature when possible:\n  - `// Chappie/Model (your model if known)`\n\n## 6) OpenCode Integration\n\n- `.opencode/agents/gitter.md` is the git-focused subagent.\n- `.opencode/skills/gitter-commit/SKILL.md` documents when to route commit tasks to `@gitter`.\n- `.opencode/skills/proto-install/SKILL.md` documents standardized script-based `proto install` usage.\n- `.opencode/skills/protobuf-schema-authoring/SKILL.md` documents how to author proto2/proto3 schemas and provide Rust/TypeScript codegen workflows.\n- `.opencode/skills/script-authoring/SKILL.md` documents how to build reusable Bun scripts from prompt/example/bash/context.\n- `.opencode/skills/docs-scraping/SKILL.md` documents generic user-request driven external docs scraping workflows.\n- Use `@gitter` when the user asks for commit support or cleanup.\n\n## 7) Local Fork Workflow (`elysia-protobuf`)\n\n- `elysia-protobuf` is also cloned locally at `~/repos/vfp/elysia-protobuf`.\n- If Core hits a bug in that dependency, patch it in the local fork repo, push the fork, then update the pinned git ref in `core/package.json` and refresh `core/bun.lock`.\n- Core currently tracks `elysia-protobuf` from the fork `master` branch in `core/package.json`; after pushing fork changes, refresh `core/bun.lock` in this repo.\n\n## 8) Script Conventions\n\n- Project scripts use shebanged Bun TypeScript files (`#!/usr/bin/env bun`) under `scripts/`.\n- Script naming uses `*.sh.ts` to indicate executable shell-style Bun scripts.\n- Shared script helpers live under `scripts/helpers/`.\n- `scripts/install.sh.ts` runs a reusable ordered list of install steps.\n- `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n- `scripts/scrape_moon_docs.sh.ts` scrapes moonrepo docs into split per-page `docs/external/moonrepo/*.ext.md` files and writes `docs/external/moonrepo/index.ext.md`.\n- `scripts/scrape_opencode_docs.sh.ts` scrapes OpenCode docs into split per-page `docs/external/opencode/*.ext.md` files and writes `docs/external/opencode/index.ext.md`.\n  - Default language filter is English (`DOCS_LANGUAGE=en`) to avoid multi-language captures unless overridden.\n- After a new command sequence succeeds in a conversation, suggest capturing it into a reusable script via `.opencode/commands/capture_script_from_context.md`.\n\n## 9) Keep This File Updated\n\n- Update this file when real code, tooling, or CI is added.\n- Keep instructions tied to verified repository behavior.\n- Prefer short, accurate guidance over aspirational process docs.\n",
              "additions": 2,
              "deletions": 0,
              "status": "modified"
            },
            {
              "file": "README.md",
              "before": "# Dark Factory - Autonomous Agentic Development At Scale\n\n# Concept\n\n- A central `dark-factory` \"core\" is used to track `products`\n- A `product` is the canonical definition of a code product we want to work on\n  - In Stage 0 this is identified by a local path-based locator key\n  - Locators are path/url-like identifiers, currently using `@local://{abs_path}`\n  - `product` may optionally include a `display_name` for human-friendly rendering\n- A `variant` is a spawned instance of a `product` where work actually runs\n  - In Stage 0 a product immediately gets one default variant on creation\n  - Variant identity follows the same locator pattern with a fragment suffix:\n    - `@local://{abs_path}#default`\n  - Future variants can use other suffixes (example: `#wt-main`) when we support parallel instances\n- Stage 0 topology is intentionally strict and simple:\n  - One product locator\n  - One default variant locator\n  - One actor bound to that variant\n- `actor` is a spawned agent that operates on a variant\n  - Can be various agent backends (currently scoped in OpenCode, Codex and a custom agent), but first iteration is JUST OpenCode\n  - Future work will allow multiple variants per product and multiple actors where operations allow\n\n# Stack + Tools\n\n- Agentic Coding: `opencode`\n- Main languages: `rust` and `bun` / `typescript`\n- Scripting: shebanged Bun TypeScript scripts under `scripts/` (`*.sh.ts`)\n- Optional build system: `moon` / `proto`\n- Common Schema Definition: `prisma`\n  - [ ] TODO: Investigate use of protobuf\n\n# Scripts\n\n- Project shell-style scripts are Bun TypeScript files with shebangs: `#!/usr/bin/env bun`.\n- Shared helpers live in `scripts/helpers/`.\n- `scripts/install.sh.ts` runs an ordered array of install steps from repository root.\n- `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n- `scripts/scrape_moon_docs.sh.ts` captures moonrepo docs as split per-page `docs/external/moonrepo/*.ext.md` files plus `docs/external/moonrepo/index.ext.md`.\n- OpenCode skill reference: `.opencode/skills/proto-install/SKILL.md`.\n- OpenCode skill reference: `.opencode/skills/script-authoring/SKILL.md`.\n- OpenCode skill reference: `.opencode/skills/docs-scraping/SKILL.md`.\n\n# Components\n\n## Core\n\n- Central service that manages tracking of all products/variants/actors/settings, etc.\n  - TBD: will either be stateless w/ DB and route all commands just to the agents\n    - OR: a background API service (REST even) we can query from frontends\n- Currently looks like it will be Bun + Elysia JS\n\n## Frontends\n\n- Various frontends that invoke / connect to Core\n- Main way of iterating with the system\n- Uses the Core API to communicate (REST / WS or GRPC in the future)\n- Some Frontends:\n  - Rust TUI (Ratatui.rs) - First One\n  - Web Client (Bun + Vite + Shadcn + React)\n  - Pure CLI (Rust)\n\n## Agents\n\n- Abstracted communication with actual agents doing work\n- First is OpenCode\n",
              "after": "# Dark Factory - Autonomous Agentic Development At Scale\n\n# Concept\n\n- A central `dark-factory` \"core\" is used to track `products`\n- A `product` is the canonical definition of a code product we want to work on\n  - In Stage 0 this is identified by a local path-based locator key\n  - Locators are path/url-like identifiers, currently using `@local://{abs_path}`\n  - `product` may optionally include a `display_name` for human-friendly rendering\n- A `variant` is a spawned instance of a `product` where work actually runs\n  - In Stage 0 a product immediately gets one default variant on creation\n  - Variant identity follows the same locator pattern with a fragment suffix:\n    - `@local://{abs_path}#default`\n  - Future variants can use other suffixes (example: `#wt-main`) when we support parallel instances\n- Stage 0 topology is intentionally strict and simple:\n  - One product locator\n  - One default variant locator\n  - One actor bound to that variant\n- `actor` is a spawned agent that operates on a variant\n  - Can be various agent backends (currently scoped in OpenCode, Codex and a custom agent), but first iteration is JUST OpenCode\n  - Future work will allow multiple variants per product and multiple actors where operations allow\n\n# Stack + Tools\n\n- Agentic Coding: `opencode`\n- Main languages: `rust` and `bun` / `typescript`\n- Scripting: shebanged Bun TypeScript scripts under `scripts/` (`*.sh.ts`)\n- Optional build system: `moon` / `proto`\n- Common Schema Definition: `prisma`\n  - [ ] TODO: Investigate use of protobuf\n\n# Scripts\n\n- Project shell-style scripts are Bun TypeScript files with shebangs: `#!/usr/bin/env bun`.\n- Shared helpers live in `scripts/helpers/`.\n- `scripts/install.sh.ts` runs an ordered array of install steps from repository root.\n- `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n- `scripts/scrape_moon_docs.sh.ts` captures moonrepo docs as split per-page `docs/external/moonrepo/*.ext.md` files plus `docs/external/moonrepo/index.ext.md`.\n- `scripts/scrape_opencode_docs.sh.ts` captures OpenCode docs as split per-page `docs/external/opencode/*.ext.md` files plus `docs/external/opencode/index.ext.md`.\n  - Defaults to English docs only (`DOCS_LANGUAGE=en`), with optional override via `DOCS_LANGUAGE`.\n- OpenCode skill reference: `.opencode/skills/proto-install/SKILL.md`.\n- OpenCode skill reference: `.opencode/skills/script-authoring/SKILL.md`.\n- OpenCode skill reference: `.opencode/skills/docs-scraping/SKILL.md`.\n\n# Components\n\n## Core\n\n- Central service that manages tracking of all products/variants/actors/settings, etc.\n  - TBD: will either be stateless w/ DB and route all commands just to the agents\n    - OR: a background API service (REST even) we can query from frontends\n- Currently looks like it will be Bun + Elysia JS\n\n## Frontends\n\n- Various frontends that invoke / connect to Core\n- Main way of iterating with the system\n- Uses the Core API to communicate (REST / WS or GRPC in the future)\n- Some Frontends:\n  - Rust TUI (Ratatui.rs) - First One\n  - Web Client (Bun + Vite + Shadcn + React)\n  - Pure CLI (Rust)\n\n## Agents\n\n- Abstracted communication with actual agents doing work\n- First is OpenCode\n",
              "additions": 2,
              "deletions": 0,
              "status": "modified"
            },
            {
              "file": "docs/external/opencode/docs.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs\n- Keywords: opencode, docs, ai coding assistant, cli\n- Summary: Get started with OpenCode.\n----\n\nSource: https://opencode.ai/docs/\n\n# Intro\n\nGet started with OpenCode.\n\n[OpenCode](/) is an open source AI coding agent. Its available as a terminal-based interface, desktop app, or IDE extension.\n\nLets get started.\n\n#### [Prerequisites](#prerequisites)\n\nTo use OpenCode in your terminal, youll need:\n\n- A modern terminal emulator like: [WezTerm](https://wezterm.org), cross-platform\n\n- [Alacritty](https://alacritty.org), cross-platform\n\n- [Ghostty](https://ghostty.org), Linux and macOS\n\n- [Kitty](https://sw.kovidgoyal.net/kitty/), Linux and macOS\n\n- API keys for the LLM providers you want to use.\n\n## [Install](#install)\n\nThe easiest way to install OpenCode is through the install script.\n\n- Terminal window ``` curl -fsSL https://opencode.ai/install | bash ``` You can also install it with the following commands: Using Node.js [npm](#tab-panel-0)\n- [Bun](#tab-panel-1)\n- [pnpm](#tab-panel-2)\n- [Yarn](#tab-panel-3)\n\nTerminal window\n\n```\nnpm install -g opencode-ai\n```\n\nTerminal window\n\n```\nbun install -g opencode-ai\n```\n\nTerminal window\n\n```\npnpm install -g opencode-ai\n```\n\nTerminal window\n\n```\nyarn global add opencode-ai\n```\n\n- Using Homebrew on macOS and Linux Terminal window ``` brew install anomalyco/tap/opencode ``` We recommend using the OpenCode tap for the most up to date releases. The official `brew install opencode` formula is maintained by the Homebrew team and is updated less frequently.\n\n- Installing on Arch Linux Terminal window ``` sudo pacman -S opencode # Arch Linux (Stable)paru -S opencode-bin # Arch Linux (Latest from AUR) ```\n\n#### [Windows](#windows)\n\nRecommended: Use WSL\n\nFor the best experience on Windows, we recommend using [Windows Subsystem for Linux (WSL)](/docs/windows-wsl). It provides better performance and full compatibility with OpenCodes features.\n\n- Using Chocolatey Terminal window ``` choco install opencode ```\n\n- Using Scoop Terminal window ``` scoop install opencode ```\n\n- Using NPM Terminal window ``` npm install -g opencode-ai ```\n\n- Using Mise Terminal window ``` mise use -g github:anomalyco/opencode ```\n\n- Using Docker Terminal window ``` docker run -it --rm ghcr.io/anomalyco/opencode ```\n\nSupport for installing OpenCode on Windows using Bun is currently in progress.\n\nYou can also grab the binary from the [Releases](https://github.com/anomalyco/opencode/releases).\n\n## [Configure](#configure)\n\nWith OpenCode you can use any LLM provider by configuring their API keys.\n\nIf you are new to using LLM providers, we recommend using [OpenCode Zen](/docs/zen).\nIts a curated list of models that have been tested and verified by the OpenCode\nteam.\n\n- Run the `/connect` command in the TUI, select opencode, and head to [opencode.ai/auth](https://opencode.ai/auth). ``` /connect ```\n\n- Sign in, add your billing details, and copy your API key.\n\n- Paste your API key. ```  API key enter ```\n\nAlternatively, you can select one of the other providers. [Learn more](/docs/providers#directory).\n\n## [Initialize](#initialize)\n\nNow that youve configured a provider, you can navigate to a project that\nyou want to work on.\n\nTerminal window\n\n```\ncd /path/to/project\n```\n\nAnd run OpenCode.\n\nTerminal window\n\n```\nopencode\n```\n\nNext, initialize OpenCode for the project by running the following command.\n\n```\n/init\n```\n\nThis will get OpenCode to analyze your project and create an `AGENTS.md` file in\nthe project root.\n\nTip\n\nYou should commit your projects `AGENTS.md` file to Git.\n\nThis helps OpenCode understand the project structure and the coding patterns\nused.\n\n## [Usage](#usage)\n\nYou are now ready to use OpenCode to work on your project. Feel free to ask it\nanything!\n\nIf you are new to using an AI coding agent, here are some examples that might\nhelp.\n\n### [Ask questions](#ask-questions)\n\nYou can ask OpenCode to explain the codebase to you.\n\nTip\n\nUse the `@` key to fuzzy search for files in the project.\n\n```\nHow is authentication handled in @packages/functions/src/api/index.ts\n```\n\nThis is helpful if theres a part of the codebase that you didnt work on.\n\n### [Add features](#add-features)\n\nYou can ask OpenCode to add new features to your project. Though we first recommend asking it to create a plan.\n\n- Create a plan OpenCode has a Plan mode that disables its ability to make changes and instead suggest how itll implement the feature. Switch to it using the Tab key. Youll see an indicator for this in the lower right corner. ``` &#x3C;TAB> ``` Now lets describe what we want it to do. ``` When a user deletes a note, we'd like to flag it as deleted in the database.Then create a screen that shows all the recently deleted notes.From this screen, the user can undelete a note or permanently delete it. ``` You want to give OpenCode enough details to understand what you want. It helps to talk to it like you are talking to a junior developer on your team. TipGive OpenCode plenty of context and examples to help it understand what you want.\n\n- Iterate on the plan Once it gives you a plan, you can give it feedback or add more details. ``` We'd like to design this new screen using a design I've used before.[Image #1] Take a look at this image and use it as a reference. ``` TipDrag and drop images into the terminal to add them to the prompt. OpenCode can scan any images you give it and add them to the prompt. You can do this by dragging and dropping an image into the terminal.\n\n- Build the feature Once you feel comfortable with the plan, switch back to Build mode by hitting the Tab key again. ``` &#x3C;TAB> ``` And asking it to make the changes. ``` Sounds good! Go ahead and make the changes. ```\n\n### [Make changes](#make-changes)\n\nFor more straightforward changes, you can ask OpenCode to directly build it\nwithout having to review the plan first.\n\n```\nWe need to add authentication to the /settings route. Take a look at how this ishandled in the /notes route in @packages/functions/src/notes.ts and implementthe same logic in @packages/functions/src/settings.ts\n```\n\nYou want to make sure you provide a good amount of detail so OpenCode makes the right\nchanges.\n\n### [Undo changes](#undo-changes)\n\nLets say you ask OpenCode to make some changes.\n\n```\nCan you refactor the function in @packages/functions/src/api/index.ts?\n```\n\nBut you realize that it is not what you wanted. You can undo the changes\nusing the `/undo` command.\n\n```\n/undo\n```\n\nOpenCode will now revert the changes you made and show your original message\nagain.\n\n```\nCan you refactor the function in @packages/functions/src/api/index.ts?\n```\n\nFrom here you can tweak the prompt and ask OpenCode to try again.\n\nTip\n\nYou can run `/undo` multiple times to undo multiple changes.\n\nOr you can redo the changes using the `/redo` command.\n\n```\n/redo\n```\n\n## [Share](#share)\n\nThe conversations that you have with OpenCode can be [shared with your team](/docs/share).\n\n```\n/share\n```\n\nThis will create a link to the current conversation and copy it to your clipboard.\n\nNote\n\nConversations are not shared by default.\n\nHeres an [example conversation](https://opencode.ai/s/4XP1fce5) with OpenCode.\n\n## [Customize](#customize)\n\nAnd thats it! You are now a pro at using OpenCode.\n\nTo make it your own, we recommend [picking a theme](/docs/themes), [customizing the keybinds](/docs/keybinds), [configuring code formatters](/docs/formatters), [creating custom commands](/docs/commands), or playing around with the [OpenCode config](/docs/config).\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/index.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 255,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__acp.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/acp\n- Keywords: opencode, docs, ai coding assistant, cli, acp\n- Summary: Use OpenCode in any ACP-compatible editor.\n----\n\nSource: https://opencode.ai/docs/acp\n\n# ACP Support\n\nUse OpenCode in any ACP-compatible editor.\n\nOpenCode supports the [Agent Client Protocol](https://agentclientprotocol.com) or (ACP), allowing you to use it directly in compatible editors and IDEs.\n\nTip\n\nFor a list of editors and tools that support ACP, check out the [ACP progress report](https://zed.dev/blog/acp-progress-report#available-now).\n\nACP is an open protocol that standardizes communication between code editors and AI coding agents.\n\n## [Configure](#configure)\n\nTo use OpenCode via ACP, configure your editor to run the `opencode acp` command.\n\nThe command starts OpenCode as an ACP-compatible subprocess that communicates with your editor over JSON-RPC via stdio.\n\nBelow are examples for popular editors that support ACP.\n\n### [Zed](#zed)\n\nAdd to your [Zed](https://zed.dev) configuration (`~/.config/zed/settings.json`):\n\n- ~/.config/zed/settings.json ``` { \"agent_servers\": { \"OpenCode\": { \"command\": \"opencode\", \"args\": [\"acp\"] } }} ``` To open it, use the `agent: new thread` action in the Command Palette. You can also bind a keyboard shortcut by editing your `keymap.json`: keymap.json ``` [ { \"bindings\": { \"cmd-alt-o\": [ \"agent::NewExternalAgentThread\", { \"agent\": { \"custom\": { \"name\": \"OpenCode\", \"command\": { \"command\": \"opencode\", \"args\": [\"acp\"] } } } } ] } }] ``` ### [JetBrains IDEs](#jetbrains-ides) Add to your [JetBrains IDE](https://www.jetbrains.com/) acp.json according to the [documentation](https://www.jetbrains.com/help/ai-assistant/acp.html): acp.json ``` { \"agent_servers\": { \"OpenCode\": { \"command\": \"/absolute/path/bin/opencode\", \"args\": [\"acp\"] } }} ``` To open it, use the new OpenCode agent in the AI Chat agent selector. ### [Avante.nvim](#avantenvim) Add to your [Avante.nvim](https://github.com/yetone/avante.nvim) configuration: ``` { acp_providers = { [\"opencode\"] = { command = \"opencode\", args = { \"acp\" } } }} ``` If you need to pass environment variables: ``` { acp_providers = { [\"opencode\"] = { command = \"opencode\", args = { \"acp\" }, env = { OPENCODE_API_KEY = os.getenv(\"OPENCODE_API_KEY\") } } }} ``` ### [CodeCompanion.nvim](#codecompanionnvim) To use OpenCode as an ACP agent in [CodeCompanion.nvim](https://github.com/olimorris/codecompanion.nvim), add the following to your Neovim config: ``` require(\"codecompanion\").setup({ interactions = { chat = { adapter = { name = \"opencode\", model = \"claude-sonnet-4\", }, }, },}) ``` This config sets up CodeCompanion to use OpenCode as the ACP agent for chat. If you need to pass environment variables (like `OPENCODE_API_KEY`), refer to [Configuring Adapters: Environment Variables](https://codecompanion.olimorris.dev/getting-started#setting-an-api-key) in the CodeCompanion.nvim documentation for full details. ## [Support](#support) OpenCode works the same via ACP as it does in the terminal. All features are supported: NoteSome built-in slash commands like `/undo` and `/redo` are currently unsupported. Built-in tools (file operations, terminal commands, etc.)\n\n- Custom tools and slash commands\n\n- MCP servers configured in your OpenCode config\n\n- Project-specific rules from `AGENTS.md`\n\n- Custom formatters and linters\n\n- Agents and permissions system\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/acp.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 61,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__agents.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/agents\n- Keywords: opencode, docs, ai coding assistant, cli, agents\n- Summary: Configure and use specialized agents.\n----\n\nSource: https://opencode.ai/docs/agents\n\n# Agents\n\nConfigure and use specialized agents.\n\nAgents are specialized AI assistants that can be configured for specific tasks and workflows. They allow you to create focused tools with custom prompts, models, and tool access.\n\nTip\n\nUse the plan agent to analyze code and review suggestions without making any code changes.\n\nYou can switch between agents during a session or invoke them with the `@` mention.\n\n## [Types](#types)\n\nThere are two types of agents in OpenCode; primary agents and subagents.\n\n### [Primary agents](#primary-agents)\n\nPrimary agents are the main assistants you interact with directly. You can cycle through them using the Tab key, or your configured `switch_agent` keybind. These agents handle your main conversation. Tool access is configured via permissions  for example, Build has all tools enabled while Plan is restricted.\n\nTip\n\nYou can use the Tab key to switch between primary agents during a session.\n\nOpenCode comes with two built-in primary agents, Build and Plan. Well\nlook at these below.\n\n### [Subagents](#subagents)\n\nSubagents are specialized assistants that primary agents can invoke for specific tasks. You can also manually invoke them by @ mentioning them in your messages.\n\nOpenCode comes with two built-in subagents, General and Explore. Well look at this below.\n\n## [Built-in](#built-in)\n\nOpenCode comes with two built-in primary agents and two built-in subagents.\n\n### [Use build](#use-build)\n\nMode: `primary`\n\nBuild is the default primary agent with all tools enabled. This is the standard agent for development work where you need full access to file operations and system commands.\n\n### [Use plan](#use-plan)\n\nMode: `primary`\n\nA restricted agent designed for planning and analysis. We use a permission system to give you more control and prevent unintended changes.\nBy default, all of the following are set to `ask`:\n\n- `file edits`: All writes, patches, and edits\n\n- `bash`: All bash commands\n\nThis agent is useful when you want the LLM to analyze code, suggest changes, or create plans without making any actual modifications to your codebase.\n\n### [Use general](#use-general)\n\nMode: `subagent`\n\nA general-purpose agent for researching complex questions and executing multi-step tasks. Has full tool access (except todo), so it can make file changes when needed. Use this to run multiple units of work in parallel.\n\n### [Use explore](#use-explore)\n\nMode: `subagent`\n\nA fast, read-only agent for exploring codebases. Cannot modify files. Use this when you need to quickly find files by patterns, search code for keywords, or answer questions about the codebase.\n\n### [Use compaction](#use-compaction)\n\nMode: `primary`\n\nHidden system agent that compacts long context into a smaller summary. It runs automatically when needed and is not selectable in the UI.\n\n### [Use title](#use-title)\n\nMode: `primary`\n\nHidden system agent that generates short session titles. It runs automatically and is not selectable in the UI.\n\n### [Use summary](#use-summary)\n\nMode: `primary`\n\nHidden system agent that creates session summaries. It runs automatically and is not selectable in the UI.\n\n## [Usage](#usage)\n\n- For primary agents, use the Tab key to cycle through them during a session. You can also use your configured `switch_agent` keybind.\n\n- Subagents can be invoked: Automatically by primary agents for specialized tasks based on their descriptions.\n\n- Manually by @ mentioning a subagent in your message. For example. ``` @general help me search for this function ```\n\n- Navigation between sessions: When subagents create their own child sessions, you can navigate between the parent session and all child sessions using: &#x3C;Leader>+Right (or your configured `session_child_cycle` keybind) to cycle forward through parent  child1  child2    parent\n\n- &#x3C;Leader>+Left (or your configured `session_child_cycle_reverse` keybind) to cycle backward through parent  child1  child2    parent\n\nThis allows you to seamlessly switch between the main conversation and specialized subagent work.\n\n## [Configure](#configure)\n\nYou can customize the built-in agents or create your own through configuration. Agents can be configured in two ways:\n\n### [JSON](#json)\n\nConfigure agents in your `opencode.json` config file:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"agent\": {    \"build\": {      \"mode\": \"primary\",      \"model\": \"anthropic/claude-sonnet-4-20250514\",      \"prompt\": \"{file:./prompts/build.txt}\",      \"tools\": {        \"write\": true,        \"edit\": true,        \"bash\": true      }    },    \"plan\": {      \"mode\": \"primary\",      \"model\": \"anthropic/claude-haiku-4-20250514\",      \"tools\": {        \"write\": false,        \"edit\": false,        \"bash\": false      }    },    \"code-reviewer\": {      \"description\": \"Reviews code for best practices and potential issues\",      \"mode\": \"subagent\",      \"model\": \"anthropic/claude-sonnet-4-20250514\",      \"prompt\": \"You are a code reviewer. Focus on security, performance, and maintainability.\",      \"tools\": {        \"write\": false,        \"edit\": false      }    }  }}\n```\n\n### [Markdown](#markdown)\n\nYou can also define agents using markdown files. Place them in:\n\n- Global: `~/.config/opencode/agents/`\n\n- Per-project: `.opencode/agents/`\n\n~/.config/opencode/agents/review.md\n\n```\n---description: Reviews code for quality and best practicesmode: subagentmodel: anthropic/claude-sonnet-4-20250514temperature: 0.1tools:  write: false  edit: false  bash: false---\nYou are in code review mode. Focus on:\n- Code quality and best practices- Potential bugs and edge cases- Performance implications- Security considerations\nProvide constructive feedback without making direct changes.\n```\n\nThe markdown file name becomes the agent name. For example, `review.md` creates a `review` agent.\n\n## [Options](#options)\n\nLets look at these configuration options in detail.\n\n### [Description](#description)\n\nUse the `description` option to provide a brief description of what the agent does and when to use it.\n\nopencode.json\n\n```\n{  \"agent\": {    \"review\": {      \"description\": \"Reviews code for best practices and potential issues\"    }  }}\n```\n\nThis is a required config option.\n\n### [Temperature](#temperature)\n\nControl the randomness and creativity of the LLMs responses with the `temperature` config.\n\nLower values make responses more focused and deterministic, while higher values increase creativity and variability.\n\nopencode.json\n\n```\n{  \"agent\": {    \"plan\": {      \"temperature\": 0.1    },    \"creative\": {      \"temperature\": 0.8    }  }}\n```\n\nTemperature values typically range from 0.0 to 1.0:\n\n- 0.0-0.2: Very focused and deterministic responses, ideal for code analysis and planning\n\n- 0.3-0.5: Balanced responses with some creativity, good for general development tasks\n\n- 0.6-1.0: More creative and varied responses, useful for brainstorming and exploration\n\nopencode.json\n\n```\n{  \"agent\": {    \"analyze\": {      \"temperature\": 0.1,      \"prompt\": \"{file:./prompts/analysis.txt}\"    },    \"build\": {      \"temperature\": 0.3    },    \"brainstorm\": {      \"temperature\": 0.7,      \"prompt\": \"{file:./prompts/creative.txt}\"    }  }}\n```\n\nIf no temperature is specified, OpenCode uses model-specific defaults; typically 0 for most models, 0.55 for Qwen models.\n\n### [Max steps](#max-steps)\n\nControl the maximum number of agentic iterations an agent can perform before being forced to respond with text only. This allows users who wish to control costs to set a limit on agentic actions.\n\nIf this is not set, the agent will continue to iterate until the model chooses to stop or the user interrupts the session.\n\nopencode.json\n\n```\n{  \"agent\": {    \"quick-thinker\": {      \"description\": \"Fast reasoning with limited iterations\",      \"prompt\": \"You are a quick thinker. Solve problems with minimal steps.\",      \"steps\": 5    }  }}\n```\n\nWhen the limit is reached, the agent receives a special system prompt instructing it to respond with a summarization of its work and recommended remaining tasks.\n\nCaution\n\nThe legacy `maxSteps` field is deprecated. Use `steps` instead.\n\n### [Disable](#disable)\n\nSet to `true` to disable the agent.\n\nopencode.json\n\n```\n{  \"agent\": {    \"review\": {      \"disable\": true    }  }}\n```\n\n### [Prompt](#prompt)\n\nSpecify a custom system prompt file for this agent with the `prompt` config. The prompt file should contain instructions specific to the agents purpose.\n\nopencode.json\n\n```\n{  \"agent\": {    \"review\": {      \"prompt\": \"{file:./prompts/code-review.txt}\"    }  }}\n```\n\nThis path is relative to where the config file is located. So this works for both the global OpenCode config and the project specific config.\n\n### [Model](#model)\n\nUse the `model` config to override the model for this agent. Useful for using different models optimized for different tasks. For example, a faster model for planning, a more capable model for implementation.\n\nTip\n\nIf you dont specify a model, primary agents use the [model globally configured](/docs/config#models) while subagents will use the model of the primary agent that invoked the subagent.\n\nopencode.json\n\n```\n{  \"agent\": {    \"plan\": {      \"model\": \"anthropic/claude-haiku-4-20250514\"    }  }}\n```\n\nThe model ID in your OpenCode config uses the format `provider/model-id`. For example, if youre using [OpenCode Zen](/docs/zen), you would use `opencode/gpt-5.1-codex` for GPT 5.1 Codex.\n\n### [Tools](#tools)\n\nControl which tools are available in this agent with the `tools` config. You can enable or disable specific tools by setting them to `true` or `false`.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"tools\": {    \"write\": true,    \"bash\": true  },  \"agent\": {    \"plan\": {      \"tools\": {        \"write\": false,        \"bash\": false      }    }  }}\n```\n\nNote\n\nThe agent-specific config overrides the global config.\n\nYou can also use wildcards to control multiple tools at once. For example, to disable all tools from an MCP server:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"agent\": {    \"readonly\": {      \"tools\": {        \"mymcp_*\": false,        \"write\": false,        \"edit\": false      }    }  }}\n```\n\n[Learn more about tools](/docs/tools).\n\n### [Permissions](#permissions)\n\nYou can configure permissions to manage what actions an agent can take. Currently, the permissions for the `edit`, `bash`, and `webfetch` tools can be configured to:\n\n- `\"ask\"`  Prompt for approval before running the tool\n\n- `\"allow\"`  Allow all operations without approval\n\n- `\"deny\"`  Disable the tool\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"permission\": {    \"edit\": \"deny\"  }}\n```\n\nYou can override these permissions per agent.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"permission\": {    \"edit\": \"deny\"  },  \"agent\": {    \"build\": {      \"permission\": {        \"edit\": \"ask\"      }    }  }}\n```\n\nYou can also set permissions in Markdown agents.\n\n~/.config/opencode/agents/review.md\n\n```\n---description: Code review without editsmode: subagentpermission:  edit: deny  bash:    \"*\": ask    \"git diff\": allow    \"git log*\": allow    \"grep *\": allow  webfetch: deny---\nOnly analyze code and suggest changes.\n```\n\nYou can set permissions for specific bash commands.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"agent\": {    \"build\": {      \"permission\": {        \"bash\": {          \"git push\": \"ask\",          \"grep *\": \"allow\"        }      }    }  }}\n```\n\nThis can take a glob pattern.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"agent\": {    \"build\": {      \"permission\": {        \"bash\": {          \"git *\": \"ask\"        }      }    }  }}\n```\n\nAnd you can also use the `*` wildcard to manage permissions for all commands.\nSince the last matching rule takes precedence, put the `*` wildcard first and specific rules after.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"agent\": {    \"build\": {      \"permission\": {        \"bash\": {          \"*\": \"ask\",          \"git status *\": \"allow\"        }      }    }  }}\n```\n\n[Learn more about permissions](/docs/permissions).\n\n### [Mode](#mode)\n\nControl the agents mode with the `mode` config. The `mode` option is used to determine how the agent can be used.\n\nopencode.json\n\n```\n{  \"agent\": {    \"review\": {      \"mode\": \"subagent\"    }  }}\n```\n\nThe `mode` option can be set to `primary`, `subagent`, or `all`. If no `mode` is specified, it defaults to `all`.\n\n### [Hidden](#hidden)\n\nHide a subagent from the `@` autocomplete menu with `hidden: true`. Useful for internal subagents that should only be invoked programmatically by other agents via the Task tool.\n\nopencode.json\n\n```\n{  \"agent\": {    \"internal-helper\": {      \"mode\": \"subagent\",      \"hidden\": true    }  }}\n```\n\nThis only affects user visibility in the autocomplete menu. Hidden agents can still be invoked by the model via the Task tool if permissions allow.\n\nNote\n\nOnly applies to `mode: subagent` agents.\n\n### [Task permissions](#task-permissions)\n\nControl which subagents an agent can invoke via the Task tool with `permission.task`. Uses glob patterns for flexible matching.\n\nopencode.json\n\n```\n{  \"agent\": {    \"orchestrator\": {      \"mode\": \"primary\",      \"permission\": {        \"task\": {          \"*\": \"deny\",          \"orchestrator-*\": \"allow\",          \"code-reviewer\": \"ask\"        }      }    }  }}\n```\n\nWhen set to `deny`, the subagent is removed from the Task tool description entirely, so the model wont attempt to invoke it.\n\nTip\n\nRules are evaluated in order, and the last matching rule wins. In the example above, `orchestrator-planner` matches both `*` (deny) and `orchestrator-*` (allow), but since `orchestrator-*` comes after `*`, the result is `allow`.\n\nTip\n\nUsers can always invoke any subagent directly via the `@` autocomplete menu, even if the agents task permissions would deny it.\n\n### [Color](#color)\n\nCustomize the agents visual appearance in the UI with the `color` option. This affects how the agent appears in the interface.\n\nUse a valid hex color (e.g., `#FF5733`) or theme color: `primary`, `secondary`, `accent`, `success`, `warning`, `error`, `info`.\n\nopencode.json\n\n```\n{  \"agent\": {    \"creative\": {      \"color\": \"#ff6b6b\"    },    \"code-reviewer\": {      \"color\": \"accent\"    }  }}\n```\n\n### [Top P](#top-p)\n\nControl response diversity with the `top_p` option. Alternative to temperature for controlling randomness.\n\nopencode.json\n\n```\n{  \"agent\": {    \"brainstorm\": {      \"top_p\": 0.9    }  }}\n```\n\nValues range from 0.0 to 1.0. Lower values are more focused, higher values more diverse.\n\n### [Additional](#additional)\n\nAny other options you specify in your agent configuration will be passed through directly to the provider as model options. This allows you to use provider-specific features and parameters.\n\nFor example, with OpenAIs reasoning models, you can control the reasoning effort:\n\nopencode.json\n\n```\n{  \"agent\": {    \"deep-thinker\": {      \"description\": \"Agent that uses high reasoning effort for complex problems\",      \"model\": \"openai/gpt-5\",      \"reasoningEffort\": \"high\",      \"textVerbosity\": \"low\"    }  }}\n```\n\nThese additional options are model and provider-specific. Check your providers documentation for available parameters.\n\nTip\n\nRun `opencode models` to see a list of the available models.\n\n## [Create agents](#create-agents)\n\nYou can create new agents using the following command:\n\nTerminal window\n\n```\nopencode agent create\n```\n\nThis interactive command will:\n\n- Ask where to save the agent; global or project-specific.\n\n- Description of what the agent should do.\n\n- Generate an appropriate system prompt and identifier.\n\n- Let you select which tools the agent can access.\n\n- Finally, create a markdown file with the agent configuration.\n\n## [Use cases](#use-cases)\n\nHere are some common use cases for different agents.\n\n- Build agent: Full development work with all tools enabled\n\n- Plan agent: Analysis and planning without making changes\n\n- Review agent: Code review with read-only access plus documentation tools\n\n- Debug agent: Focused on investigation with bash and read tools enabled\n\n- Docs agent: Documentation writing with file operations but no system commands\n\n## [Examples](#examples)\n\nHere are some example agents you might find useful.\n\nTip\n\nDo you have an agent youd like to share? [Submit a PR](https://github.com/anomalyco/opencode).\n\n### [Documentation agent](#documentation-agent)\n\n~/.config/opencode/agents/docs-writer.md\n\n```\n---description: Writes and maintains project documentationmode: subagenttools:  bash: false---\nYou are a technical writer. Create clear, comprehensive documentation.\nFocus on:\n- Clear explanations- Proper structure- Code examples- User-friendly language\n```\n\n### [Security auditor](#security-auditor)\n\n~/.config/opencode/agents/security-auditor.md\n\n```\n---description: Performs security audits and identifies vulnerabilitiesmode: subagenttools:  write: false  edit: false---\nYou are a security expert. Focus on identifying potential security issues.\nLook for:\n- Input validation vulnerabilities- Authentication and authorization flaws- Data exposure risks- Dependency vulnerabilities- Configuration security issues\n```\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/agents.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 498,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__cli.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/cli\n- Keywords: opencode, docs, ai coding assistant, cli, cli\n- Summary: OpenCode CLI options and commands.\n----\n\nSource: https://opencode.ai/docs/cli\n\n# CLI\n\nOpenCode CLI options and commands.\n\nThe OpenCode CLI by default starts the [TUI](/docs/tui) when run without any arguments.\n\nTerminal window\n\n```\nopencode\n```\n\nBut it also accepts commands as documented on this page. This allows you to interact with OpenCode programmatically.\n\nTerminal window\n\n```\nopencode run \"Explain how closures work in JavaScript\"\n```\n\n### [tui](#tui)\n\nStart the OpenCode terminal user interface.\n\nTerminal window\n\n```\nopencode [project]\n```\n\n#### [Flags](#flags)\n\nFlag Short Description\n\n`--continue` `-c` Continue the last session\n\n`--session` `-s` Session ID to continue\n\n`--fork` Fork the session when continuing (use with `--continue` or `--session`)\n\n`--prompt` Prompt to use\n\n`--model` `-m` Model to use in the form of provider/model\n\n`--agent` Agent to use\n\n`--port` Port to listen on\n\n`--hostname` Hostname to listen on\n\n## [Commands](#commands)\n\nThe OpenCode CLI also has the following commands.\n\n### [agent](#agent)\n\nManage agents for OpenCode.\n\nTerminal window\n\n```\nopencode agent [command]\n```\n\n### [attach](#attach)\n\nAttach a terminal to an already running OpenCode backend server started via `serve` or `web` commands.\n\nTerminal window\n\n```\nopencode attach [url]\n```\n\nThis allows using the TUI with a remote OpenCode backend. For example:\n\nTerminal window\n\n```\n# Start the backend server for web/mobile accessopencode web --port 4096 --hostname 0.0.0.0\n# In another terminal, attach the TUI to the running backendopencode attach http://10.20.30.40:4096\n```\n\n#### [Flags](#flags-1)\n\nFlag Short Description\n\n`--dir` Working directory to start TUI in\n\n`--session` `-s` Session ID to continue\n\n#### [create](#create)\n\nCreate a new agent with custom configuration.\n\nTerminal window\n\n```\nopencode agent create\n```\n\nThis command will guide you through creating a new agent with a custom system prompt and tool configuration.\n\n#### [list](#list)\n\nList all available agents.\n\nTerminal window\n\n```\nopencode agent list\n```\n\n### [auth](#auth)\n\nCommand to manage credentials and login for providers.\n\nTerminal window\n\n```\nopencode auth [command]\n```\n\n#### [login](#login)\n\nOpenCode is powered by the provider list at [Models.dev](https://models.dev), so you can use `opencode auth login` to configure API keys for any provider youd like to use. This is stored in `~/.local/share/opencode/auth.json`.\n\nTerminal window\n\n```\nopencode auth login\n```\n\nWhen OpenCode starts up it loads the providers from the credentials file. And if there are any keys defined in your environments or a `.env` file in your project.\n\n#### [list](#list-1)\n\nLists all the authenticated providers as stored in the credentials file.\n\nTerminal window\n\n```\nopencode auth list\n```\n\nOr the short version.\n\nTerminal window\n\n```\nopencode auth ls\n```\n\n#### [logout](#logout)\n\nLogs you out of a provider by clearing it from the credentials file.\n\nTerminal window\n\n```\nopencode auth logout\n```\n\n### [github](#github)\n\nManage the GitHub agent for repository automation.\n\nTerminal window\n\n```\nopencode github [command]\n```\n\n#### [install](#install)\n\nInstall the GitHub agent in your repository.\n\nTerminal window\n\n```\nopencode github install\n```\n\nThis sets up the necessary GitHub Actions workflow and guides you through the configuration process. [Learn more](/docs/github).\n\n#### [run](#run)\n\nRun the GitHub agent. This is typically used in GitHub Actions.\n\nTerminal window\n\n```\nopencode github run\n```\n\n##### [Flags](#flags-2)\n\nFlag Description\n\n`--event` GitHub mock event to run the agent for\n\n`--token` GitHub personal access token\n\n### [mcp](#mcp)\n\nManage Model Context Protocol servers.\n\nTerminal window\n\n```\nopencode mcp [command]\n```\n\n#### [add](#add)\n\nAdd an MCP server to your configuration.\n\nTerminal window\n\n```\nopencode mcp add\n```\n\nThis command will guide you through adding either a local or remote MCP server.\n\n#### [list](#list-2)\n\nList all configured MCP servers and their connection status.\n\nTerminal window\n\n```\nopencode mcp list\n```\n\nOr use the short version.\n\nTerminal window\n\n```\nopencode mcp ls\n```\n\n#### [auth](#auth-1)\n\nAuthenticate with an OAuth-enabled MCP server.\n\nTerminal window\n\n```\nopencode mcp auth [name]\n```\n\nIf you dont provide a server name, youll be prompted to select from available OAuth-capable servers.\n\nYou can also list OAuth-capable servers and their authentication status.\n\nTerminal window\n\n```\nopencode mcp auth list\n```\n\nOr use the short version.\n\nTerminal window\n\n```\nopencode mcp auth ls\n```\n\n#### [logout](#logout-1)\n\nRemove OAuth credentials for an MCP server.\n\nTerminal window\n\n```\nopencode mcp logout [name]\n```\n\n#### [debug](#debug)\n\nDebug OAuth connection issues for an MCP server.\n\nTerminal window\n\n```\nopencode mcp debug &#x3C;name>\n```\n\n### [models](#models)\n\nList all available models from configured providers.\n\nTerminal window\n\n```\nopencode models [provider]\n```\n\nThis command displays all models available across your configured providers in the format `provider/model`.\n\nThis is useful for figuring out the exact model name to use in [your config](/docs/config/).\n\nYou can optionally pass a provider ID to filter models by that provider.\n\nTerminal window\n\n```\nopencode models anthropic\n```\n\n#### [Flags](#flags-3)\n\nFlag Description\n\n`--refresh` Refresh the models cache from models.dev\n\n`--verbose` Use more verbose model output (includes metadata like costs)\n\nUse the `--refresh` flag to update the cached model list. This is useful when new models have been added to a provider and you want to see them in OpenCode.\n\nTerminal window\n\n```\nopencode models --refresh\n```\n\n### [run](#run-1)\n\nRun opencode in non-interactive mode by passing a prompt directly.\n\nTerminal window\n\n```\nopencode run [message..]\n```\n\nThis is useful for scripting, automation, or when you want a quick answer without launching the full TUI. For example.\n\nTerminal window\n\n```\nopencode run Explain the use of context in Go\n```\n\nYou can also attach to a running `opencode serve` instance to avoid MCP server cold boot times on every run:\n\nTerminal window\n\n```\n# Start a headless server in one terminalopencode serve\n# In another terminal, run commands that attach to itopencode run --attach http://localhost:4096 \"Explain async/await in JavaScript\"\n```\n\n#### [Flags](#flags-4)\n\nFlag Short Description\n\n`--command` The command to run, use message for args\n\n`--continue` `-c` Continue the last session\n\n`--session` `-s` Session ID to continue\n\n`--fork` Fork the session when continuing (use with `--continue` or `--session`)\n\n`--share` Share the session\n\n`--model` `-m` Model to use in the form of provider/model\n\n`--agent` Agent to use\n\n`--file` `-f` File(s) to attach to message\n\n`--format` Format: default (formatted) or json (raw JSON events)\n\n`--title` Title for the session (uses truncated prompt if no value provided)\n\n`--attach` Attach to a running opencode server (e.g., [http://localhost:4096](http://localhost:4096))\n\n`--port` Port for the local server (defaults to random port)\n\n### [serve](#serve)\n\nStart a headless OpenCode server for API access. Check out the [server docs](/docs/server) for the full HTTP interface.\n\nTerminal window\n\n```\nopencode serve\n```\n\nThis starts an HTTP server that provides API access to opencode functionality without the TUI interface. Set `OPENCODE_SERVER_PASSWORD` to enable HTTP basic auth (username defaults to `opencode`).\n\n#### [Flags](#flags-5)\n\nFlag Description\n\n`--port` Port to listen on\n\n`--hostname` Hostname to listen on\n\n`--mdns` Enable mDNS discovery\n\n`--cors` Additional browser origin(s) to allow CORS\n\n### [session](#session)\n\nManage OpenCode sessions.\n\nTerminal window\n\n```\nopencode session [command]\n```\n\n#### [list](#list-3)\n\nList all OpenCode sessions.\n\nTerminal window\n\n```\nopencode session list\n```\n\n##### [Flags](#flags-6)\n\nFlag Short Description\n\n`--max-count` `-n` Limit to N most recent sessions\n\n`--format` Output format: table or json (table)\n\n### [stats](#stats)\n\nShow token usage and cost statistics for your OpenCode sessions.\n\nTerminal window\n\n```\nopencode stats\n```\n\n#### [Flags](#flags-7)\n\nFlag Description\n\n`--days` Show stats for the last N days (all time)\n\n`--tools` Number of tools to show (all)\n\n`--models` Show model usage breakdown (hidden by default). Pass a number to show top N\n\n`--project` Filter by project (all projects, empty string: current project)\n\n### [export](#export)\n\nExport session data as JSON.\n\nTerminal window\n\n```\nopencode export [sessionID]\n```\n\nIf you dont provide a session ID, youll be prompted to select from available sessions.\n\n### [import](#import)\n\nImport session data from a JSON file or OpenCode share URL.\n\nTerminal window\n\n```\nopencode import &#x3C;file>\n```\n\nYou can import from a local file or an OpenCode share URL.\n\nTerminal window\n\n```\nopencode import session.jsonopencode import https://opncd.ai/s/abc123\n```\n\n### [web](#web)\n\nStart a headless OpenCode server with a web interface.\n\nTerminal window\n\n```\nopencode web\n```\n\nThis starts an HTTP server and opens a web browser to access OpenCode through a web interface. Set `OPENCODE_SERVER_PASSWORD` to enable HTTP basic auth (username defaults to `opencode`).\n\n#### [Flags](#flags-8)\n\nFlag Description\n\n`--port` Port to listen on\n\n`--hostname` Hostname to listen on\n\n`--mdns` Enable mDNS discovery\n\n`--cors` Additional browser origin(s) to allow CORS\n\n### [acp](#acp)\n\nStart an ACP (Agent Client Protocol) server.\n\nTerminal window\n\n```\nopencode acp\n```\n\nThis command starts an ACP server that communicates via stdin/stdout using nd-JSON.\n\n#### [Flags](#flags-9)\n\nFlag Description\n\n`--cwd` Working directory\n\n`--port` Port to listen on\n\n`--hostname` Hostname to listen on\n\n### [uninstall](#uninstall)\n\nUninstall OpenCode and remove all related files.\n\nTerminal window\n\n```\nopencode uninstall\n```\n\n#### [Flags](#flags-10)\n\nFlag Short Description\n\n`--keep-config` `-c` Keep configuration files\n\n`--keep-data` `-d` Keep session data and snapshots\n\n`--dry-run` Show what would be removed without removing\n\n`--force` `-f` Skip confirmation prompts\n\n### [upgrade](#upgrade)\n\nUpdates opencode to the latest version or a specific version.\n\nTerminal window\n\n```\nopencode upgrade [target]\n```\n\nTo upgrade to the latest version.\n\nTerminal window\n\n```\nopencode upgrade\n```\n\nTo upgrade to a specific version.\n\nTerminal window\n\n```\nopencode upgrade v0.1.48\n```\n\n#### [Flags](#flags-11)\n\nFlag Short Description\n\n`--method` `-m` The installation method that was used; curl, npm, pnpm, bun, brew\n\n## [Global Flags](#global-flags)\n\nThe opencode CLI takes the following global flags.\n\nFlag Short Description\n\n`--help` `-h` Display help\n\n`--version` `-v` Print version number\n\n`--print-logs` Print logs to stderr\n\n`--log-level` Log level (DEBUG, INFO, WARN, ERROR)\n\n## [Environment variables](#environment-variables)\n\nOpenCode can be configured using environment variables.\n\nVariable Type Description\n\n`OPENCODE_AUTO_SHARE` boolean Automatically share sessions\n\n`OPENCODE_GIT_BASH_PATH` string Path to Git Bash executable on Windows\n\n`OPENCODE_CONFIG` string Path to config file\n\n`OPENCODE_CONFIG_DIR` string Path to config directory\n\n`OPENCODE_CONFIG_CONTENT` string Inline json config content\n\n`OPENCODE_DISABLE_AUTOUPDATE` boolean Disable automatic update checks\n\n`OPENCODE_DISABLE_PRUNE` boolean Disable pruning of old data\n\n`OPENCODE_DISABLE_TERMINAL_TITLE` boolean Disable automatic terminal title updates\n\n`OPENCODE_PERMISSION` string Inlined json permissions config\n\n`OPENCODE_DISABLE_DEFAULT_PLUGINS` boolean Disable default plugins\n\n`OPENCODE_DISABLE_LSP_DOWNLOAD` boolean Disable automatic LSP server downloads\n\n`OPENCODE_ENABLE_EXPERIMENTAL_MODELS` boolean Enable experimental models\n\n`OPENCODE_DISABLE_AUTOCOMPACT` boolean Disable automatic context compaction\n\n`OPENCODE_DISABLE_CLAUDE_CODE` boolean Disable reading from `.claude` (prompt + skills)\n\n`OPENCODE_DISABLE_CLAUDE_CODE_PROMPT` boolean Disable reading `~/.claude/CLAUDE.md`\n\n`OPENCODE_DISABLE_CLAUDE_CODE_SKILLS` boolean Disable loading `.claude/skills`\n\n`OPENCODE_DISABLE_MODELS_FETCH` boolean Disable fetching models from remote sources\n\n`OPENCODE_FAKE_VCS` string Fake VCS provider for testing purposes\n\n`OPENCODE_DISABLE_FILETIME_CHECK` boolean Disable file time checking for optimization\n\n`OPENCODE_CLIENT` string Client identifier (defaults to `cli`)\n\n`OPENCODE_ENABLE_EXA` boolean Enable Exa web search tools\n\n`OPENCODE_SERVER_PASSWORD` string Enable basic auth for `serve`/`web`\n\n`OPENCODE_SERVER_USERNAME` string Override basic auth username (default `opencode`)\n\n`OPENCODE_MODELS_URL` string Custom URL for fetching models configuration\n\n### [Experimental](#experimental)\n\nThese environment variables enable experimental features that may change or be removed.\n\nVariable Type Description\n\n`OPENCODE_EXPERIMENTAL` boolean Enable all experimental features\n\n`OPENCODE_EXPERIMENTAL_ICON_DISCOVERY` boolean Enable icon discovery\n\n`OPENCODE_EXPERIMENTAL_DISABLE_COPY_ON_SELECT` boolean Disable copy on select in TUI\n\n`OPENCODE_EXPERIMENTAL_BASH_DEFAULT_TIMEOUT_MS` number Default timeout for bash commands in ms\n\n`OPENCODE_EXPERIMENTAL_OUTPUT_TOKEN_MAX` number Max output tokens for LLM responses\n\n`OPENCODE_EXPERIMENTAL_FILEWATCHER` boolean Enable file watcher for entire dir\n\n`OPENCODE_EXPERIMENTAL_OXFMT` boolean Enable oxfmt formatter\n\n`OPENCODE_EXPERIMENTAL_LSP_TOOL` boolean Enable experimental LSP tool\n\n`OPENCODE_EXPERIMENTAL_DISABLE_FILEWATCHER` boolean Disable file watcher\n\n`OPENCODE_EXPERIMENTAL_EXA` boolean Enable experimental Exa features\n\n`OPENCODE_EXPERIMENTAL_LSP_TY` boolean Enable experimental LSP type checking\n\n`OPENCODE_EXPERIMENTAL_MARKDOWN` boolean Enable experimental markdown features\n\n`OPENCODE_EXPERIMENTAL_PLAN_MODE` boolean Enable plan mode\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/cli.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 713,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__commands.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/commands\n- Keywords: opencode, docs, ai coding assistant, cli, commands\n- Summary: Create custom commands for repetitive tasks.\n----\n\nSource: https://opencode.ai/docs/commands\n\n# Commands\n\nCreate custom commands for repetitive tasks.\n\nCustom commands let you specify a prompt you want to run when that command is executed in the TUI.\n\n- ``` /my-command ``` Custom commands are in addition to the built-in commands like `/init`, `/undo`, `/redo`, `/share`, `/help`. [Learn more](/docs/tui#commands). ## [Create command files](#create-command-files) Create markdown files in the `commands/` directory to define custom commands. Create `.opencode/commands/test.md`: .opencode/commands/test.md ``` ---description: Run tests with coverageagent: buildmodel: anthropic/claude-3-5-sonnet-20241022--- Run the full test suite with coverage report and show any failures.Focus on the failing tests and suggest fixes. ``` The frontmatter defines command properties. The content becomes the template. Use the command by typing `/` followed by the command name. ``` \"/test\" ``` ## [Configure](#configure) You can add custom commands through the OpenCode config or by creating markdown files in the `commands/` directory. ### [JSON](#json) Use the `command` option in your OpenCode [config](/docs/config): opencode.jsonc ``` { \"$schema\": \"https://opencode.ai/config.json\", \"command\": { // This becomes the name of the command \"test\": { // This is the prompt that will be sent to the LLM \"template\": \"Run the full test suite with coverage report and show any failures.\\nFocus on the failing tests and suggest fixes.\", // This is shown as the description in the TUI \"description\": \"Run tests with coverage\", \"agent\": \"build\", \"model\": \"anthropic/claude-3-5-sonnet-20241022\" } }} ``` Now you can run this command in the TUI: ``` /test ``` ### [Markdown](#markdown) You can also define commands using markdown files. Place them in: Global: `~/.config/opencode/commands/`\n\n- Per-project: `.opencode/commands/`\n\n~/.config/opencode/commands/test.md\n\n```\n---description: Run tests with coverageagent: buildmodel: anthropic/claude-3-5-sonnet-20241022---\nRun the full test suite with coverage report and show any failures.Focus on the failing tests and suggest fixes.\n```\n\nThe markdown file name becomes the command name. For example, `test.md` lets\nyou run:\n\n```\n/test\n```\n\n## [Prompt config](#prompt-config)\n\nThe prompts for the custom commands support several special placeholders and syntax.\n\n### [Arguments](#arguments)\n\nPass arguments to commands using the `$ARGUMENTS` placeholder.\n\n.opencode/commands/component.md\n\n```\n---description: Create a new component---\nCreate a new React component named $ARGUMENTS with TypeScript support.Include proper typing and basic structure.\n```\n\nRun the command with arguments:\n\n```\n/component Button\n```\n\nAnd `$ARGUMENTS` will be replaced with `Button`.\n\nYou can also access individual arguments using positional parameters:\n\n- `$1` - First argument\n\n- `$2` - Second argument\n\n- `$3` - Third argument\n\n- And so on\n\nFor example:\n\n.opencode/commands/create-file.md\n\n```\n---description: Create a new file with content---\nCreate a file named $1 in the directory $2with the following content: $3\n```\n\nRun the command:\n\n```\n/create-file config.json src \"{ \\\"key\\\": \\\"value\\\" }\"\n```\n\nThis replaces:\n\n- `$1` with `config.json`\n\n- `$2` with `src`\n\n- `$3` with `{ \"key\": \"value\" }`\n\n### [Shell output](#shell-output)\n\nUse !`command` to inject [bash command](/docs/tui#bash-commands) output into your prompt.\n\nFor example, to create a custom command that analyzes test coverage:\n\n.opencode/commands/analyze-coverage.md\n\n```\n---description: Analyze test coverage---\nHere are the current test results:!`npm test`\nBased on these results, suggest improvements to increase coverage.\n```\n\nOr to review recent changes:\n\n.opencode/commands/review-changes.md\n\n```\n---description: Review recent changes---\nRecent git commits:!`git log --oneline -10`\nReview these changes and suggest any improvements.\n```\n\nCommands run in your projects root directory and their output becomes part of the prompt.\n\n### [File references](#file-references)\n\nInclude files in your command using `@` followed by the filename.\n\n.opencode/commands/review-component.md\n\n```\n---description: Review component---\nReview the component in @src/components/Button.tsx.Check for performance issues and suggest improvements.\n```\n\nThe file content gets included in the prompt automatically.\n\n## [Options](#options)\n\nLets look at the configuration options in detail.\n\n### [Template](#template)\n\nThe `template` option defines the prompt that will be sent to the LLM when the command is executed.\n\nopencode.json\n\n```\n{  \"command\": {    \"test\": {      \"template\": \"Run the full test suite with coverage report and show any failures.\\nFocus on the failing tests and suggest fixes.\"    }  }}\n```\n\nThis is a required config option.\n\n### [Description](#description)\n\nUse the `description` option to provide a brief description of what the command does.\n\nopencode.json\n\n```\n{  \"command\": {    \"test\": {      \"description\": \"Run tests with coverage\"    }  }}\n```\n\nThis is shown as the description in the TUI when you type in the command.\n\n### [Agent](#agent)\n\nUse the `agent` config to optionally specify which [agent](/docs/agents) should execute this command.\nIf this is a [subagent](/docs/agents/#subagents) the command will trigger a subagent invocation by default.\nTo disable this behavior, set `subtask` to `false`.\n\nopencode.json\n\n```\n{  \"command\": {    \"review\": {      \"agent\": \"plan\"    }  }}\n```\n\nThis is an optional config option. If not specified, defaults to your current agent.\n\n### [Subtask](#subtask)\n\nUse the `subtask` boolean to force the command to trigger a [subagent](/docs/agents/#subagents) invocation.\nThis is useful if you want the command to not pollute your primary context and will force the agent to act as a subagent,\neven if `mode` is set to `primary` on the [agent](/docs/agents) configuration.\n\nopencode.json\n\n```\n{  \"command\": {    \"analyze\": {      \"subtask\": true    }  }}\n```\n\nThis is an optional config option.\n\n### [Model](#model)\n\nUse the `model` config to override the default model for this command.\n\nopencode.json\n\n```\n{  \"command\": {    \"analyze\": {      \"model\": \"anthropic/claude-3-5-sonnet-20241022\"    }  }}\n```\n\nThis is an optional config option.\n\n## [Built-in](#built-in)\n\nopencode includes several built-in commands like `/init`, `/undo`, `/redo`, `/share`, `/help`; [learn more](/docs/tui#commands).\n\nNote\n\nCustom commands can override built-in commands.\n\nIf you define a custom command with the same name, it will override the built-in command.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/commands.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 222,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__config.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/config\n- Keywords: opencode, docs, ai coding assistant, cli, config\n- Summary: Using the OpenCode JSON config.\n----\n\nSource: https://opencode.ai/docs/config\n\n# Config\n\nUsing the OpenCode JSON config.\n\nYou can configure OpenCode using a JSON config file.\n\n## [Format](#format)\n\nOpenCode supports both JSON and JSONC (JSON with Comments) formats.\n\n- opencode.jsonc ``` { \"$schema\": \"https://opencode.ai/config.json\", // Theme configuration \"theme\": \"opencode\", \"model\": \"anthropic/claude-sonnet-4-5\", \"autoupdate\": true,} ``` ## [Locations](#locations) You can place your config in a couple of different locations and they have a different order of precedence. NoteConfiguration files are merged together, not replaced. Configuration files are merged together, not replaced. Settings from the following config locations are combined. Later configs override earlier ones only for conflicting keys. Non-conflicting settings from all configs are preserved. For example, if your global config sets `theme: \"opencode\"` and `autoupdate: true`, and your project config sets `model: \"anthropic/claude-sonnet-4-5\"`, the final configuration will include all three settings. ### [Precedence order](#precedence-order) Config sources are loaded in this order (later sources override earlier ones): Remote config (from `.well-known/opencode`) - organizational defaults\n\n- Global config (`~/.config/opencode/opencode.json`) - user preferences\n\n- Custom config (`OPENCODE_CONFIG` env var) - custom overrides\n\n- Project config (`opencode.json` in project) - project-specific settings\n\n- `.opencode` directories - agents, commands, plugins\n\n- Inline config (`OPENCODE_CONFIG_CONTENT` env var) - runtime overrides\n\nThis means project configs can override global defaults, and global configs can override remote organizational defaults.\n\nNote\n\nThe `.opencode` and `~/.config/opencode` directories use plural names for subdirectories: `agents/`, `commands/`, `modes/`, `plugins/`, `skills/`, `tools/`, and `themes/`. Singular names (e.g., `agent/`) are also supported for backwards compatibility.\n\n### [Remote](#remote)\n\nOrganizations can provide default configuration via the `.well-known/opencode` endpoint. This is fetched automatically when you authenticate with a provider that supports it.\n\nRemote config is loaded first, serving as the base layer. All other config sources (global, project) can override these defaults.\n\nFor example, if your organization provides MCP servers that are disabled by default:\n\nRemote config from .well-known/opencode\n\n```\n{  \"mcp\": {    \"jira\": {      \"type\": \"remote\",      \"url\": \"https://jira.example.com/mcp\",      \"enabled\": false    }  }}\n```\n\nYou can enable specific servers in your local config:\n\nopencode.json\n\n```\n{  \"mcp\": {    \"jira\": {      \"type\": \"remote\",      \"url\": \"https://jira.example.com/mcp\",      \"enabled\": true    }  }}\n```\n\n### [Global](#global)\n\nPlace your global OpenCode config in `~/.config/opencode/opencode.json`. Use global config for user-wide preferences like themes, providers, or keybinds.\n\nGlobal config overrides remote organizational defaults.\n\n### [Per project](#per-project)\n\nAdd `opencode.json` in your project root. Project config has the highest precedence among standard config files - it overrides both global and remote configs.\n\nTip\n\nPlace project specific config in the root of your project.\n\nWhen OpenCode starts up, it looks for a config file in the current directory or traverse up to the nearest Git directory.\n\nThis is also safe to be checked into Git and uses the same schema as the global one.\n\n### [Custom path](#custom-path)\n\nSpecify a custom config file path using the `OPENCODE_CONFIG` environment variable.\n\nTerminal window\n\n```\nexport OPENCODE_CONFIG=/path/to/my/custom-config.jsonopencode run \"Hello world\"\n```\n\nCustom config is loaded between global and project configs in the precedence order.\n\n### [Custom directory](#custom-directory)\n\nSpecify a custom config directory using the `OPENCODE_CONFIG_DIR`\nenvironment variable. This directory will be searched for agents, commands,\nmodes, and plugins just like the standard `.opencode` directory, and should\nfollow the same structure.\n\nTerminal window\n\n```\nexport OPENCODE_CONFIG_DIR=/path/to/my/config-directoryopencode run \"Hello world\"\n```\n\nThe custom directory is loaded after the global config and `.opencode` directories, so it can override their settings.\n\n## [Schema](#schema)\n\nThe config file has a schema thats defined in [`opencode.ai/config.json`](https://opencode.ai/config.json).\n\nYour editor should be able to validate and autocomplete based on the schema.\n\n### [TUI](#tui)\n\nYou can configure TUI-specific settings through the `tui` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"tui\": {    \"scroll_speed\": 3,    \"scroll_acceleration\": {      \"enabled\": true    },    \"diff_style\": \"auto\"  }}\n```\n\nAvailable options:\n\n- `scroll_acceleration.enabled` - Enable macOS-style scroll acceleration. Takes precedence over `scroll_speed`.\n\n- `scroll_speed` - Custom scroll speed multiplier (default: `3`, minimum: `1`). Ignored if `scroll_acceleration.enabled` is `true`.\n\n- `diff_style` - Control diff rendering. `\"auto\"` adapts to terminal width, `\"stacked\"` always shows single column.\n\n[Learn more about using the TUI here](/docs/tui).\n\n### [Server](#server)\n\nYou can configure server settings for the `opencode serve` and `opencode web` commands through the `server` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"server\": {    \"port\": 4096,    \"hostname\": \"0.0.0.0\",    \"mdns\": true,    \"mdnsDomain\": \"myproject.local\",    \"cors\": [\"http://localhost:5173\"]  }}\n```\n\nAvailable options:\n\n- `port` - Port to listen on.\n\n- `hostname` - Hostname to listen on. When `mdns` is enabled and no hostname is set, defaults to `0.0.0.0`.\n\n- `mdns` - Enable mDNS service discovery. This allows other devices on the network to discover your OpenCode server.\n\n- `mdnsDomain` - Custom domain name for mDNS service. Defaults to `opencode.local`. Useful for running multiple instances on the same network.\n\n- `cors` - Additional origins to allow for CORS when using the HTTP server from a browser-based client. Values must be full origins (scheme + host + optional port), eg `https://app.example.com`.\n\n[Learn more about the server here](/docs/server).\n\n### [Tools](#tools)\n\nYou can manage the tools an LLM can use through the `tools` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"tools\": {    \"write\": false,    \"bash\": false  }}\n```\n\n[Learn more about tools here](/docs/tools).\n\n### [Models](#models)\n\nYou can configure the providers and models you want to use in your OpenCode config through the `provider`, `model` and `small_model` options.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {},  \"model\": \"anthropic/claude-sonnet-4-5\",  \"small_model\": \"anthropic/claude-haiku-4-5\"}\n```\n\nThe `small_model` option configures a separate model for lightweight tasks like title generation. By default, OpenCode tries to use a cheaper model if one is available from your provider, otherwise it falls back to your main model.\n\nProvider options can include `timeout` and `setCacheKey`:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"anthropic\": {      \"options\": {        \"timeout\": 600000,        \"setCacheKey\": true      }    }  }}\n```\n\n- `timeout` - Request timeout in milliseconds (default: 300000). Set to `false` to disable.\n\n- `setCacheKey` - Ensure a cache key is always set for designated provider.\n\nYou can also configure [local models](/docs/models#local). [Learn more](/docs/models).\n\n#### [Provider-Specific Options](#provider-specific-options)\n\nSome providers support additional configuration options beyond the generic `timeout` and `apiKey` settings.\n\n##### [Amazon Bedrock](#amazon-bedrock)\n\nAmazon Bedrock supports AWS-specific configuration:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"amazon-bedrock\": {      \"options\": {        \"region\": \"us-east-1\",        \"profile\": \"my-aws-profile\",        \"endpoint\": \"https://bedrock-runtime.us-east-1.vpce-xxxxx.amazonaws.com\"      }    }  }}\n```\n\n- `region` - AWS region for Bedrock (defaults to `AWS_REGION` env var or `us-east-1`)\n\n- `profile` - AWS named profile from `~/.aws/credentials` (defaults to `AWS_PROFILE` env var)\n\n- `endpoint` - Custom endpoint URL for VPC endpoints. This is an alias for the generic `baseURL` option using AWS-specific terminology. If both are specified, `endpoint` takes precedence.\n\nNote\n\nBearer tokens (`AWS_BEARER_TOKEN_BEDROCK` or `/connect`) take precedence over profile-based authentication. See [authentication precedence](/docs/providers#authentication-precedence) for details.\n\n[Learn more about Amazon Bedrock configuration](/docs/providers#amazon-bedrock).\n\n### [Themes](#themes)\n\nYou can configure the theme you want to use in your OpenCode config through the `theme` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"theme\": \"\"}\n```\n\n[Learn more here](/docs/themes).\n\n### [Agents](#agents)\n\nYou can configure specialized agents for specific tasks through the `agent` option.\n\nopencode.jsonc\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"agent\": {    \"code-reviewer\": {      \"description\": \"Reviews code for best practices and potential issues\",      \"model\": \"anthropic/claude-sonnet-4-5\",      \"prompt\": \"You are a code reviewer. Focus on security, performance, and maintainability.\",      \"tools\": {        // Disable file modification tools for review-only agent        \"write\": false,        \"edit\": false,      },    },  },}\n```\n\nYou can also define agents using markdown files in `~/.config/opencode/agents/` or `.opencode/agents/`. [Learn more here](/docs/agents).\n\n### [Default agent](#default-agent)\n\nYou can set the default agent using the `default_agent` option. This determines which agent is used when none is explicitly specified.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"default_agent\": \"plan\"}\n```\n\nThe default agent must be a primary agent (not a subagent). This can be a built-in agent like `\"build\"` or `\"plan\"`, or a [custom agent](/docs/agents) youve defined. If the specified agent doesnt exist or is a subagent, OpenCode will fall back to `\"build\"` with a warning.\n\nThis setting applies across all interfaces: TUI, CLI (`opencode run`), desktop app, and GitHub Action.\n\n### [Sharing](#sharing)\n\nYou can configure the [share](/docs/share) feature through the `share` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"share\": \"manual\"}\n```\n\nThis takes:\n\n- `\"manual\"` - Allow manual sharing via commands (default)\n\n- `\"auto\"` - Automatically share new conversations\n\n- `\"disabled\"` - Disable sharing entirely\n\nBy default, sharing is set to manual mode where you need to explicitly share conversations using the `/share` command.\n\n### [Commands](#commands)\n\nYou can configure custom commands for repetitive tasks through the `command` option.\n\nopencode.jsonc\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"command\": {    \"test\": {      \"template\": \"Run the full test suite with coverage report and show any failures.\\nFocus on the failing tests and suggest fixes.\",      \"description\": \"Run tests with coverage\",      \"agent\": \"build\",      \"model\": \"anthropic/claude-haiku-4-5\",    },    \"component\": {      \"template\": \"Create a new React component named $ARGUMENTS with TypeScript support.\\nInclude proper typing and basic structure.\",      \"description\": \"Create a new component\",    },  },}\n```\n\nYou can also define commands using markdown files in `~/.config/opencode/commands/` or `.opencode/commands/`. [Learn more here](/docs/commands).\n\n### [Keybinds](#keybinds)\n\nYou can customize your keybinds through the `keybinds` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"keybinds\": {}}\n```\n\n[Learn more here](/docs/keybinds).\n\n### [Autoupdate](#autoupdate)\n\nOpenCode will automatically download any new updates when it starts up. You can disable this with the `autoupdate` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"autoupdate\": false}\n```\n\nIf you dont want updates but want to be notified when a new version is available, set `autoupdate` to `\"notify\"`.\nNotice that this only works if it was not installed using a package manager such as Homebrew.\n\n### [Formatters](#formatters)\n\nYou can configure code formatters through the `formatter` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"formatter\": {    \"prettier\": {      \"disabled\": true    },    \"custom-prettier\": {      \"command\": [\"npx\", \"prettier\", \"--write\", \"$FILE\"],      \"environment\": {        \"NODE_ENV\": \"development\"      },      \"extensions\": [\".js\", \".ts\", \".jsx\", \".tsx\"]    }  }}\n```\n\n[Learn more about formatters here](/docs/formatters).\n\n### [Permissions](#permissions)\n\nBy default, opencode allows all operations without requiring explicit approval. You can change this using the `permission` option.\n\nFor example, to ensure that the `edit` and `bash` tools require user approval:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"permission\": {    \"edit\": \"ask\",    \"bash\": \"ask\"  }}\n```\n\n[Learn more about permissions here](/docs/permissions).\n\n### [Compaction](#compaction)\n\nYou can control context compaction behavior through the `compaction` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"compaction\": {    \"auto\": true,    \"prune\": true,    \"reserved\": 10000  }}\n```\n\n- `auto` - Automatically compact the session when context is full (default: `true`).\n\n- `prune` - Remove old tool outputs to save tokens (default: `true`).\n\n- `reserved` - Token buffer for compaction. Leaves enough window to avoid overflow during compaction\n\n### [Watcher](#watcher)\n\nYou can configure file watcher ignore patterns through the `watcher` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"watcher\": {    \"ignore\": [\"node_modules/**\", \"dist/**\", \".git/**\"]  }}\n```\n\nPatterns follow glob syntax. Use this to exclude noisy directories from file watching.\n\n### [MCP servers](#mcp-servers)\n\nYou can configure MCP servers you want to use through the `mcp` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {}}\n```\n\n[Learn more here](/docs/mcp-servers).\n\n### [Plugins](#plugins)\n\n[Plugins](/docs/plugins) extend OpenCode with custom tools, hooks, and integrations.\n\nPlace plugin files in `.opencode/plugins/` or `~/.config/opencode/plugins/`. You can also load plugins from npm through the `plugin` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"plugin\": [\"opencode-helicone-session\", \"@my-org/custom-plugin\"]}\n```\n\n[Learn more here](/docs/plugins).\n\n### [Instructions](#instructions)\n\nYou can configure the instructions for the model youre using through the `instructions` option.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"instructions\": [\"CONTRIBUTING.md\", \"docs/guidelines.md\", \".cursor/rules/*.md\"]}\n```\n\nThis takes an array of paths and glob patterns to instruction files. [Learn more about rules here](/docs/rules).\n\n### [Disabled providers](#disabled-providers)\n\nYou can disable providers that are loaded automatically through the `disabled_providers` option. This is useful when you want to prevent certain providers from being loaded even if their credentials are available.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"disabled_providers\": [\"openai\", \"gemini\"]}\n```\n\nNote\n\nThe `disabled_providers` takes priority over `enabled_providers`.\n\nThe `disabled_providers` option accepts an array of provider IDs. When a provider is disabled:\n\n- It wont be loaded even if environment variables are set.\n\n- It wont be loaded even if API keys are configured through the `/connect` command.\n\n- The providers models wont appear in the model selection list.\n\n### [Enabled providers](#enabled-providers)\n\nYou can specify an allowlist of providers through the `enabled_providers` option. When set, only the specified providers will be enabled and all others will be ignored.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"enabled_providers\": [\"anthropic\", \"openai\"]}\n```\n\nThis is useful when you want to restrict OpenCode to only use specific providers rather than disabling them one by one.\n\nNote\n\nThe `disabled_providers` takes priority over `enabled_providers`.\n\nIf a provider appears in both `enabled_providers` and `disabled_providers`, the `disabled_providers` takes priority for backwards compatibility.\n\n### [Experimental](#experimental)\n\nThe `experimental` key contains options that are under active development.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"experimental\": {}}\n```\n\nCaution\n\nExperimental options are not stable. They may change or be removed without notice.\n\n## [Variables](#variables)\n\nYou can use variable substitution in your config files to reference environment variables and file contents.\n\n### [Env vars](#env-vars)\n\nUse `{env:VARIABLE_NAME}` to substitute environment variables:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"model\": \"{env:OPENCODE_MODEL}\",  \"provider\": {    \"anthropic\": {      \"models\": {},      \"options\": {        \"apiKey\": \"{env:ANTHROPIC_API_KEY}\"      }    }  }}\n```\n\nIf the environment variable is not set, it will be replaced with an empty string.\n\n### [Files](#files)\n\nUse `{file:path/to/file}` to substitute the contents of a file:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"instructions\": [\"./custom-instructions.md\"],  \"provider\": {    \"openai\": {      \"options\": {        \"apiKey\": \"{file:~/.secrets/openai-key}\"      }    }  }}\n```\n\nFile paths can be:\n\n- Relative to the config file directory\n\n- Or absolute paths starting with `/` or `~`\n\nThese are useful for:\n\n- Keeping sensitive data like API keys in separate files.\n\n- Including large instruction files without cluttering your config.\n\n- Sharing common configuration snippets across multiple config files.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/config.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 515,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__custom-tools.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/custom-tools\n- Keywords: opencode, docs, ai coding assistant, cli, custom tools\n- Summary: Create tools the LLM can call in opencode.\n----\n\nSource: https://opencode.ai/docs/custom-tools\n\n# Custom Tools\n\nCreate tools the LLM can call in opencode.\n\nCustom tools are functions you create that the LLM can call during conversations. They work alongside opencodes [built-in tools](/docs/tools) like `read`, `write`, and `bash`.\n\n## [Creating a tool](#creating-a-tool)\n\nTools are defined as TypeScript or JavaScript files. However, the tool definition can invoke scripts written in any language  TypeScript or JavaScript is only used for the tool definition itself.\n\n### [Location](#location)\n\nThey can be defined:\n\n- Locally by placing them in the `.opencode/tools/` directory of your project.\n\n- Or globally, by placing them in `~/.config/opencode/tools/`.\n\n### [Structure](#structure)\n\nThe easiest way to create tools is using the `tool()` helper which provides type-safety and validation.\n\n.opencode/tools/database.ts\n\n```\nimport { tool } from \"@opencode-ai/plugin\"\nexport default tool({  description: \"Query the project database\",  args: {    query: tool.schema.string().describe(\"SQL query to execute\"),  },  async execute(args) {    // Your database logic here    return `Executed query: ${args.query}`  },})\n```\n\nThe filename becomes the tool name. The above creates a `database` tool.\n\n#### [Multiple tools per file](#multiple-tools-per-file)\n\nYou can also export multiple tools from a single file. Each export becomes a separate tool with the name `&#x3C;filename>_&#x3C;exportname>`:\n\n.opencode/tools/math.ts\n\n```\nimport { tool } from \"@opencode-ai/plugin\"\nexport const add = tool({  description: \"Add two numbers\",  args: {    a: tool.schema.number().describe(\"First number\"),    b: tool.schema.number().describe(\"Second number\"),  },  async execute(args) {    return args.a + args.b  },})\nexport const multiply = tool({  description: \"Multiply two numbers\",  args: {    a: tool.schema.number().describe(\"First number\"),    b: tool.schema.number().describe(\"Second number\"),  },  async execute(args) {    return args.a * args.b  },})\n```\n\nThis creates two tools: `math_add` and `math_multiply`.\n\n### [Arguments](#arguments)\n\nYou can use `tool.schema`, which is just [Zod](https://zod.dev), to define argument types.\n\n```\nargs: {  query: tool.schema.string().describe(\"SQL query to execute\")}\n```\n\nYou can also import [Zod](https://zod.dev) directly and return a plain object:\n\n```\nimport { z } from \"zod\"\nexport default {  description: \"Tool description\",  args: {    param: z.string().describe(\"Parameter description\"),  },  async execute(args, context) {    // Tool implementation    return \"result\"  },}\n```\n\n### [Context](#context)\n\nTools receive context about the current session:\n\n.opencode/tools/project.ts\n\n```\nimport { tool } from \"@opencode-ai/plugin\"\nexport default tool({  description: \"Get project information\",  args: {},  async execute(args, context) {    // Access context information    const { agent, sessionID, messageID, directory, worktree } = context    return `Agent: ${agent}, Session: ${sessionID}, Message: ${messageID}, Directory: ${directory}, Worktree: ${worktree}`  },})\n```\n\nUse `context.directory` for the session working directory.\nUse `context.worktree` for the git worktree root.\n\n## [Examples](#examples)\n\n### [Write a tool in Python](#write-a-tool-in-python)\n\nYou can write your tools in any language you want. Heres an example that adds two numbers using Python.\n\nFirst, create the tool as a Python script:\n\n.opencode/tools/add.py\n\n```\nimport sys\na = int(sys.argv[1])b = int(sys.argv[2])print(a + b)\n```\n\nThen create the tool definition that invokes it:\n\n.opencode/tools/python-add.ts\n\n```\nimport { tool } from \"@opencode-ai/plugin\"import path from \"path\"\nexport default tool({  description: \"Add two numbers using Python\",  args: {    a: tool.schema.number().describe(\"First number\"),    b: tool.schema.number().describe(\"Second number\"),  },  async execute(args, context) {    const script = path.join(context.worktree, \".opencode/tools/add.py\")    const result = await Bun.$`python3 ${script} ${args.a} ${args.b}`.text()    return result.trim()  },})\n```\n\nHere we are using the [`Bun.$`](https://bun.com/docs/runtime/shell) utility to run the Python script.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/custom-tools.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 125,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__ecosystem.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/ecosystem\n- Keywords: opencode, docs, ai coding assistant, cli, ecosystem\n- Summary: Projects and integrations built with OpenCode.\n----\n\nSource: https://opencode.ai/docs/ecosystem\n\n# Ecosystem\n\nProjects and integrations built with OpenCode.\n\nA collection of community projects built on OpenCode.\n\nNote\n\nWant to add your OpenCode related project to this list? Submit a PR.\n\nYou can also check out [awesome-opencode](https://github.com/awesome-opencode/awesome-opencode) and [opencode.cafe](https://opencode.cafe), a community that aggregates the ecosystem and community.\n\n## [Plugins](#plugins)\n\nName Description\n\n[opencode-daytona](https://github.com/jamesmurdza/daytona/blob/main/guides/typescript/opencode/README.md) Automatically run OpenCode sessions in isolated Daytona sandboxes with git sync and live previews\n\n[opencode-helicone-session](https://github.com/H2Shami/opencode-helicone-session) Automatically inject Helicone session headers for request grouping\n\n[opencode-type-inject](https://github.com/nick-vi/opencode-type-inject) Auto-inject TypeScript/Svelte types into file reads with lookup tools\n\n[opencode-openai-codex-auth](https://github.com/numman-ali/opencode-openai-codex-auth) Use your ChatGPT Plus/Pro subscription instead of API credits\n\n[opencode-gemini-auth](https://github.com/jenslys/opencode-gemini-auth) Use your existing Gemini plan instead of API billing\n\n[opencode-antigravity-auth](https://github.com/NoeFabris/opencode-antigravity-auth) Use Antigravitys free models instead of API billing\n\n[opencode-devcontainers](https://github.com/athal7/opencode-devcontainers) Multi-branch devcontainer isolation with shallow clones and auto-assigned ports\n\n[opencode-google-antigravity-auth](https://github.com/shekohex/opencode-google-antigravity-auth) Google Antigravity OAuth Plugin, with support for Google Search, and more robust API handling\n\n[opencode-dynamic-context-pruning](https://github.com/Tarquinen/opencode-dynamic-context-pruning) Optimize token usage by pruning obsolete tool outputs\n\n[opencode-websearch-cited](https://github.com/ghoulr/opencode-websearch-cited.git) Add native websearch support for supported providers with Google grounded style\n\n[opencode-pty](https://github.com/shekohex/opencode-pty.git) Enables AI agents to run background processes in a PTY, send interactive input to them.\n\n[opencode-shell-strategy](https://github.com/JRedeker/opencode-shell-strategy) Instructions for non-interactive shell commands - prevents hangs from TTY-dependent operations\n\n[opencode-wakatime](https://github.com/angristan/opencode-wakatime) Track OpenCode usage with Wakatime\n\n[opencode-md-table-formatter](https://github.com/franlol/opencode-md-table-formatter/tree/main) Clean up markdown tables produced by LLMs\n\n[opencode-morph-fast-apply](https://github.com/JRedeker/opencode-morph-fast-apply) 10x faster code editing with Morph Fast Apply API and lazy edit markers\n\n[oh-my-opencode](https://github.com/code-yeongyu/oh-my-opencode) Background agents, pre-built LSP/AST/MCP tools, curated agents, Claude Code compatible\n\n[opencode-notificator](https://github.com/panta82/opencode-notificator) Desktop notifications and sound alerts for OpenCode sessions\n\n[opencode-notifier](https://github.com/mohak34/opencode-notifier) Desktop notifications and sound alerts for permission, completion, and error events\n\n[opencode-zellij-namer](https://github.com/24601/opencode-zellij-namer) AI-powered automatic Zellij session naming based on OpenCode context\n\n[opencode-skillful](https://github.com/zenobi-us/opencode-skillful) Allow OpenCode agents to lazy load prompts on demand with skill discovery and injection\n\n[opencode-supermemory](https://github.com/supermemoryai/opencode-supermemory) Persistent memory across sessions using Supermemory\n\n[@plannotator/opencode](https://github.com/backnotprop/plannotator/tree/main/apps/opencode-plugin) Interactive plan review with visual annotation and private/offline sharing\n\n[@openspoon/subtask2](https://github.com/spoons-and-mirrors/subtask2) Extend opencode /commands into a powerful orchestration system with granular flow control\n\n[opencode-scheduler](https://github.com/different-ai/opencode-scheduler) Schedule recurring jobs using launchd (Mac) or systemd (Linux) with cron syntax\n\n[micode](https://github.com/vtemian/micode) Structured Brainstorm  Plan  Implement workflow with session continuity\n\n[octto](https://github.com/vtemian/octto) Interactive browser UI for AI brainstorming with multi-question forms\n\n[opencode-background-agents](https://github.com/kdcokenny/opencode-background-agents) Claude Code-style background agents with async delegation and context persistence\n\n[opencode-notify](https://github.com/kdcokenny/opencode-notify) Native OS notifications for OpenCode  know when tasks complete\n\n[opencode-workspace](https://github.com/kdcokenny/opencode-workspace) Bundled multi-agent orchestration harness  16 components, one install\n\n[opencode-worktree](https://github.com/kdcokenny/opencode-worktree) Zero-friction git worktrees for OpenCode\n\n## [Projects](#projects)\n\nName Description\n\n[kimaki](https://github.com/remorses/kimaki) Discord bot to control OpenCode sessions, built on the SDK\n\n[opencode.nvim](https://github.com/NickvanDyke/opencode.nvim) Neovim plugin for editor-aware prompts, built on the API\n\n[portal](https://github.com/hosenur/portal) Mobile-first web UI for OpenCode over Tailscale/VPN\n\n[opencode plugin template](https://github.com/zenobi-us/opencode-plugin-template/) Template for building OpenCode plugins\n\n[opencode.nvim](https://github.com/sudo-tee/opencode.nvim) Neovim frontend for opencode - a terminal-based AI coding agent\n\n[ai-sdk-provider-opencode-sdk](https://github.com/ben-vargas/ai-sdk-provider-opencode-sdk) Vercel AI SDK provider for using OpenCode via @opencode-ai/sdk\n\n[OpenChamber](https://github.com/btriapitsyn/openchamber) Web / Desktop App and VS Code Extension for OpenCode\n\n[OpenCode-Obsidian](https://github.com/mtymek/opencode-obsidian) Obsidian plugin that embeds OpenCode in Obsidians UI\n\n[OpenWork](https://github.com/different-ai/openwork) An open-source alternative to Claude Cowork, powered by OpenCode\n\n[ocx](https://github.com/kdcokenny/ocx) OpenCode extension manager with portable, isolated profiles.\n\n[CodeNomad](https://github.com/NeuralNomadsAI/CodeNomad) Desktop, Web, Mobile and Remote Client App for OpenCode\n\n## [Agents](#agents)\n\nName Description\n\n[Agentic](https://github.com/Cluster444/agentic) Modular AI agents and commands for structured development\n\n[opencode-agents](https://github.com/darrenhinde/opencode-agents) Configs, prompts, agents, and plugins for enhanced workflows\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/ecosystem.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 135,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__enterprise.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/enterprise\n- Keywords: opencode, docs, ai coding assistant, cli, enterprise\n- Summary: Using OpenCode securely in your organization.\n----\n\nSource: https://opencode.ai/docs/enterprise\n\n# Enterprise\n\nUsing OpenCode securely in your organization.\n\nOpenCode Enterprise is for organizations that want to ensure that their code and data never leaves their infrastructure. It can do this by using a centralized config that integrates with your SSO and internal AI gateway.\n\nNote\n\nOpenCode does not store any of your code or context data.\n\nTo get started with OpenCode Enterprise:\n\n- Do a trial internally with your team.\n\n- [Contact us](mailto:contact@anoma.ly) to discuss pricing and implementation options.\n\n## [Trial](#trial)\n\nOpenCode is open source and does not store any of your code or context data, so your developers can simply [get started](/docs/) and carry out a trial.\n\n### [Data handling](#data-handling)\n\nOpenCode does not store your code or context data. All processing happens locally or through direct API calls to your AI provider.\n\nThis means that as long as you are using a provider you trust, or an internal\nAI gateway, you can use OpenCode securely.\n\nThe only caveat here is the optional `/share` feature.\n\n#### [Sharing conversations](#sharing-conversations)\n\nIf a user enables the `/share` feature, the conversation and the data associated with it are sent to the service we use to host these share pages at opencode.ai.\n\nThe data is currently served through our CDNs edge network, and is cached on the edge near your users.\n\nWe recommend you disable this for your trial.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"share\": \"disabled\"}\n```\n\n[Learn more about sharing](/docs/share).\n\n### [Code ownership](#code-ownership)\n\nYou own all code produced by OpenCode. There are no licensing restrictions or ownership claims.\n\n## [Pricing](#pricing)\n\nWe use a per-seat model for OpenCode Enterprise. If you have your own LLM gateway, we do not charge for tokens used. For further details about pricing and implementation options, [contact us](mailto:contact@anoma.ly).\n\n## [Deployment](#deployment)\n\nOnce you have completed your trial and you are ready to use OpenCode at\nyour organization, you can [contact us](mailto:contact@anoma.ly) to discuss\npricing and implementation options.\n\n### [Central Config](#central-config)\n\nWe can set up OpenCode to use a single central config for your entire organization.\n\nThis centralized config can integrate with your SSO provider and ensures all users access only your internal AI gateway.\n\n### [SSO integration](#sso-integration)\n\nThrough the central config, OpenCode can integrate with your organizations SSO provider for authentication.\n\nThis allows OpenCode to obtain credentials for your internal AI gateway through your existing identity management system.\n\n### [Internal AI gateway](#internal-ai-gateway)\n\nWith the central config, OpenCode can also be configured to use only your internal AI gateway.\n\nYou can also disable all other AI providers, ensuring all requests go through your organizations approved infrastructure.\n\n### [Self-hosting](#self-hosting)\n\nWhile we recommend disabling the share pages to ensure your data never leaves\nyour organization, we can also help you self-host them on your infrastructure.\n\nThis is currently on our roadmap. If youre interested, [let us know](mailto:contact@anoma.ly).\n\n## [FAQ](#faq)\n\nWhat is OpenCode Enterprise?\nOpenCode Enterprise is for organizations that want to ensure that their code and data never leaves their infrastructure. It can do this by using a centralized config that integrates with your SSO and internal AI gateway.\n\nHow do I get started with OpenCode Enterprise?\nSimply start with an internal trial with your team. OpenCode by default does not store your code or context data, making it easy to get started.\n\nThen [contact us](mailto:contact@anoma.ly) to discuss pricing and implementation options.\n\nHow does enterprise pricing work?\nWe offer per-seat enterprise pricing. If you have your own LLM gateway, we do not charge for tokens used. For further details, [contact us](mailto:contact@anoma.ly) for a custom quote based on your organizations needs.\n\nIs my data secure with OpenCode Enterprise?\nYes. OpenCode does not store your code or context data. All processing happens locally or through direct API calls to your AI provider. With central config and SSO integration, your data remains secure within your organizations infrastructure.\n\nCan we use our own private NPM registry?\nOpenCode supports private npm registries through Buns native `.npmrc` file support. If your organization uses a private registry, such as JFrog Artifactory, Nexus, or similar, ensure developers are authenticated before running OpenCode.\n\nTo set up authentication with your private registry:\n\nTerminal window\n\n```\nnpm login --registry=https://your-company.jfrog.io/api/npm/npm-virtual/\n```\n\nThis creates `~/.npmrc` with authentication details. OpenCode will automatically\npick this up.\n\nCaution\n\nYou must be logged into the private registry before running OpenCode.\n\nAlternatively, you can manually configure a `.npmrc` file:\n\n~/.npmrc\n\n```\nregistry=https://your-company.jfrog.io/api/npm/npm-virtual///your-company.jfrog.io/api/npm/npm-virtual/:_authToken=${NPM_AUTH_TOKEN}\n```\n\nDevelopers must be logged into the private registry before running OpenCode to ensure packages can be installed from your enterprise registry.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/enterprise.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 153,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__formatters.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/formatters\n- Keywords: opencode, docs, ai coding assistant, cli, formatters\n- Summary: OpenCode uses language specific formatters.\n----\n\nSource: https://opencode.ai/docs/formatters\n\n# Formatters\n\nOpenCode uses language specific formatters.\n\nOpenCode automatically formats files after they are written or edited using language-specific formatters. This ensures that the code that is generated follows the code styles of your project.\n\n## [Built-in](#built-in)\n\nOpenCode comes with several built-in formatters for popular languages and frameworks. Below is a list of the formatters, supported file extensions, and commands or config options it needs.\n\nFormatter Extensions Requirements\n\nair .R `air` command available\n\nbiome .js, .jsx, .ts, .tsx, .html, .css, .md, .json, .yaml, and [more](https://biomejs.dev/) `biome.json(c)` config file\n\ncargofmt .rs `cargo fmt` command available\n\nclang-format .c, .cpp, .h, .hpp, .ino, and [more](https://clang.llvm.org/docs/ClangFormat.html) `.clang-format` config file\n\ncljfmt .clj, .cljs, .cljc, .edn `cljfmt` command available\n\ndart .dart `dart` command available\n\ngleam .gleam `gleam` command available\n\ngofmt .go `gofmt` command available\n\nhtmlbeautifier .erb, .html.erb `htmlbeautifier` command available\n\nktlint .kt, .kts `ktlint` command available\n\nmix .ex, .exs, .eex, .heex, .leex, .neex, .sface `mix` command available\n\nnixfmt .nix `nixfmt` command available\n\nocamlformat .ml, .mli `ocamlformat` command available and `.ocamlformat` config file\n\normolu .hs `ormolu` command available\n\noxfmt (Experimental) .js, .jsx, .ts, .tsx `oxfmt` dependency in `package.json` and an [experimental env variable flag](/docs/cli/#experimental)\n\npint .php `laravel/pint` dependency in `composer.json`\n\nprettier .js, .jsx, .ts, .tsx, .html, .css, .md, .json, .yaml, and [more](https://prettier.io/docs/en/index.html) `prettier` dependency in `package.json`\n\nrubocop .rb, .rake, .gemspec, .ru `rubocop` command available\n\nruff .py, .pyi `ruff` command available with config\n\nrustfmt .rs `rustfmt` command available\n\nshfmt .sh, .bash `shfmt` command available\n\nstandardrb .rb, .rake, .gemspec, .ru `standardrb` command available\n\nterraform .tf, .tfvars `terraform` command available\n\nuv .py, .pyi `uv` command available\n\nzig .zig, .zon `zig` command available\n\nSo if your project has `prettier` in your `package.json`, OpenCode will automatically use it.\n\n## [How it works](#how-it-works)\n\nWhen OpenCode writes or edits a file, it:\n\n- Checks the file extension against all enabled formatters.\n\n- Runs the appropriate formatter command on the file.\n\n- Applies the formatting changes automatically.\n\nThis process happens in the background, ensuring your code styles are maintained without any manual steps.\n\n## [Configure](#configure)\n\nYou can customize formatters through the `formatter` section in your OpenCode config.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"formatter\": {}}\n```\n\nEach formatter configuration supports the following:\n\nProperty Type Description\n\n`disabled` boolean Set this to `true` to disable the formatter\n\n`command` string[] The command to run for formatting\n\n`environment` object Environment variables to set when running the formatter\n\n`extensions` string[] File extensions this formatter should handle\n\nLets look at some examples.\n\n### [Disabling formatters](#disabling-formatters)\n\nTo disable all formatters globally, set `formatter` to `false`:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"formatter\": false}\n```\n\nTo disable a specific formatter, set `disabled` to `true`:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"formatter\": {    \"prettier\": {      \"disabled\": true    }  }}\n```\n\n### [Custom formatters](#custom-formatters)\n\nYou can override the built-in formatters or add new ones by specifying the command, environment variables, and file extensions:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"formatter\": {    \"prettier\": {      \"command\": [\"npx\", \"prettier\", \"--write\", \"$FILE\"],      \"environment\": {        \"NODE_ENV\": \"development\"      },      \"extensions\": [\".js\", \".ts\", \".jsx\", \".tsx\"]    },    \"custom-markdown-formatter\": {      \"command\": [\"deno\", \"fmt\", \"$FILE\"],      \"extensions\": [\".md\"]    }  }}\n```\n\nThe `$FILE` placeholder in the command will be replaced with the path to the file being formatted.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/formatters.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 155,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__github.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/github\n- Keywords: opencode, docs, ai coding assistant, cli, github\n- Summary: Use OpenCode in GitHub issues and pull-requests.\n----\n\nSource: https://opencode.ai/docs/github\n\n# GitHub\n\nUse OpenCode in GitHub issues and pull-requests.\n\nOpenCode integrates with your GitHub workflow. Mention `/opencode` or `/oc` in your comment, and OpenCode will execute tasks within your GitHub Actions runner.\n\n## [Features](#features)\n\n- Triage issues: Ask OpenCode to look into an issue and explain it to you.\n\n- Fix and implement: Ask OpenCode to fix an issue or implement a feature. And it will work in a new branch and submits a PR with all the changes.\n\n- Secure: OpenCode runs inside your GitHubs runners.\n\n## [Installation](#installation)\n\nRun the following command in a project that is in a GitHub repo:\n\n- Terminal window ``` opencode github install ``` This will walk you through installing the GitHub app, creating the workflow, and setting up secrets. ### [Manual Setup](#manual-setup) Or you can set it up manually. Install the GitHub app Head over to [github.com/apps/opencode-agent](https://github.com/apps/opencode-agent). Make sure its installed on the target repository.\n\n- Add the workflow Add the following workflow file to `.github/workflows/opencode.yml` in your repo. Make sure to set the appropriate `model` and required API keys in `env`. .github/workflows/opencode.yml ``` name: opencode on: issue_comment: types: [created] pull_request_review_comment: types: [created] jobs: opencode: if: | contains(github.event.comment.body, '/oc') || contains(github.event.comment.body, '/opencode') runs-on: ubuntu-latest permissions: id-token: write steps: - name: Checkout repository uses: actions/checkout@v6 with: fetch-depth: 1 persist-credentials: false - name: Run OpenCode uses: anomalyco/opencode/github@latest env: ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }} with: model: anthropic/claude-sonnet-4-20250514 # share: true # github_token: xxxx ```\n\n- Store the API keys in secrets In your organization or project settings, expand Secrets and variables on the left and select Actions. And add the required API keys.\n\n## [Configuration](#configuration)\n\n- `model`: The model to use with OpenCode. Takes the format of `provider/model`. This is required.\n\n- `agent`: The agent to use. Must be a primary agent. Falls back to `default_agent` from config or `\"build\"` if not found.\n\n- `share`: Whether to share the OpenCode session. Defaults to true for public repositories.\n\n- `prompt`: Optional custom prompt to override the default behavior. Use this to customize how OpenCode processes requests.\n\n- `token`: Optional GitHub access token for performing operations such as creating comments, committing changes, and opening pull requests. By default, OpenCode uses the installation access token from the OpenCode GitHub App, so commits, comments, and pull requests appear as coming from the app. Alternatively, you can use the GitHub Action runners [built-in `GITHUB_TOKEN`](https://docs.github.com/en/actions/tutorials/authenticate-with-github_token) without installing the OpenCode GitHub App. Just make sure to grant the required permissions in your workflow: ``` permissions: id-token: write contents: write pull-requests: write issues: write ``` You can also use a [personal access tokens](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens)(PAT) if preferred.\n\n## [Supported Events](#supported-events)\n\nOpenCode can be triggered by the following GitHub events:\n\nEvent Type Triggered By Details\n\n`issue_comment` Comment on an issue or PR Mention `/opencode` or `/oc` in your comment. OpenCode reads context and can create branches, open PRs, or reply.\n\n`pull_request_review_comment` Comment on specific code lines in a PR Mention `/opencode` or `/oc` while reviewing code. OpenCode receives file path, line numbers, and diff context.\n\n`issues` Issue opened or edited Automatically trigger OpenCode when issues are created or modified. Requires `prompt` input.\n\n`pull_request` PR opened or updated Automatically trigger OpenCode when PRs are opened, synchronized, or reopened. Useful for automated reviews.\n\n`schedule` Cron-based schedule Run OpenCode on a schedule. Requires `prompt` input. Output goes to logs and PRs (no issue to comment on).\n\n`workflow_dispatch` Manual trigger from GitHub UI Trigger OpenCode on demand via Actions tab. Requires `prompt` input. Output goes to logs and PRs.\n\n### [Schedule Example](#schedule-example)\n\nRun OpenCode on a schedule to perform automated tasks:\n\n.github/workflows/opencode-scheduled.yml\n\n```\nname: Scheduled OpenCode Task\non:  schedule:    - cron: \"0 9 * * 1\" # Every Monday at 9am UTC\njobs:  opencode:    runs-on: ubuntu-latest    permissions:      id-token: write      contents: write      pull-requests: write      issues: write    steps:      - name: Checkout repository        uses: actions/checkout@v6        with:          persist-credentials: false\n      - name: Run OpenCode        uses: anomalyco/opencode/github@latest        env:          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}        with:          model: anthropic/claude-sonnet-4-20250514          prompt: |            Review the codebase for any TODO comments and create a summary.            If you find issues worth addressing, open an issue to track them.\n```\n\nFor scheduled events, the `prompt` input is required since theres no comment to extract instructions from. Scheduled workflows run without a user context to permission-check, so the workflow must grant `contents: write` and `pull-requests: write` if you expect OpenCode to create branches or PRs.\n\n### [Pull Request Example](#pull-request-example)\n\nAutomatically review PRs when they are opened or updated:\n\n.github/workflows/opencode-review.yml\n\n```\nname: opencode-review\non:  pull_request:    types: [opened, synchronize, reopened, ready_for_review]\njobs:  review:    runs-on: ubuntu-latest    permissions:      id-token: write      contents: read      pull-requests: read      issues: read    steps:      - uses: actions/checkout@v6        with:          persist-credentials: false      - uses: anomalyco/opencode/github@latest        env:          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}        with:          model: anthropic/claude-sonnet-4-20250514          use_github_token: true          prompt: |            Review this pull request:            - Check for code quality issues            - Look for potential bugs            - Suggest improvements\n```\n\nFor `pull_request` events, if no `prompt` is provided, OpenCode defaults to reviewing the pull request.\n\n### [Issues Triage Example](#issues-triage-example)\n\nAutomatically triage new issues. This example filters to accounts older than 30 days to reduce spam:\n\n.github/workflows/opencode-triage.yml\n\n```\nname: Issue Triage\non:  issues:    types: [opened]\njobs:  triage:    runs-on: ubuntu-latest    permissions:      id-token: write      contents: write      pull-requests: write      issues: write    steps:      - name: Check account age        id: check        uses: actions/github-script@v7        with:          script: |            const user = await github.rest.users.getByUsername({              username: context.payload.issue.user.login            });            const created = new Date(user.data.created_at);            const days = (Date.now() - created) / (1000 * 60 * 60 * 24);            return days >= 30;          result-encoding: string\n      - uses: actions/checkout@v6        if: steps.check.outputs.result == 'true'        with:          persist-credentials: false\n      - uses: anomalyco/opencode/github@latest        if: steps.check.outputs.result == 'true'        env:          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}        with:          model: anthropic/claude-sonnet-4-20250514          prompt: |            Review this issue. If there's a clear fix or relevant docs:            - Provide documentation links            - Add error handling guidance for code examples            Otherwise, do not comment.\n```\n\nFor `issues` events, the `prompt` input is required since theres no comment to extract instructions from.\n\n## [Custom prompts](#custom-prompts)\n\nOverride the default prompt to customize OpenCodes behavior for your workflow.\n\n.github/workflows/opencode.yml\n\n```\n- uses: anomalyco/opencode/github@latest  with:    model: anthropic/claude-sonnet-4-5    prompt: |      Review this pull request:      - Check for code quality issues      - Look for potential bugs      - Suggest improvements\n```\n\nThis is useful for enforcing specific review criteria, coding standards, or focus areas relevant to your project.\n\n## [Examples](#examples)\n\nHere are some examples of how you can use OpenCode in GitHub.\n\n- Explain an issue Add this comment in a GitHub issue. ``` /opencode explain this issue ``` OpenCode will read the entire thread, including all comments, and reply with a clear explanation.\n\n- Fix an issue In a GitHub issue, say: ``` /opencode fix this ``` And OpenCode will create a new branch, implement the changes, and open a PR with the changes.\n\n- Review PRs and make changes Leave the following comment on a GitHub PR. ``` Delete the attachment from S3 when the note is removed /oc ``` OpenCode will implement the requested change and commit it to the same PR.\n\n- Review specific code lines Leave a comment directly on code lines in the PRs Files tab. OpenCode automatically detects the file, line numbers, and diff context to provide precise responses. ``` [Comment on specific lines in Files tab]/oc add error handling here ``` When commenting on specific lines, OpenCode receives: The exact file being reviewed\n\n- The specific lines of code\n\n- The surrounding diff context\n\n- Line number information\n\nThis allows for more targeted requests without needing to specify file paths or line numbers manually.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/github.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 156,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__gitlab.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/gitlab\n- Keywords: opencode, docs, ai coding assistant, cli, gitlab\n- Summary: Use OpenCode in GitLab issues and merge requests.\n----\n\nSource: https://opencode.ai/docs/gitlab\n\n# GitLab\n\nUse OpenCode in GitLab issues and merge requests.\n\nOpenCode integrates with your GitLab workflow through your GitLab CI/CD pipeline or with GitLab Duo.\n\nIn both cases, OpenCode will run on your GitLab runners.\n\n## [GitLab CI](#gitlab-ci)\n\nOpenCode works in a regular GitLab pipeline. You can build it into a pipeline as a [CI component](https://docs.gitlab.com/ee/ci/components/)\n\nHere we are using a community-created CI/CD component for OpenCode  [nagyv/gitlab-opencode](https://gitlab.com/nagyv/gitlab-opencode).\n\n### [Features](#features)\n\n- Use custom configuration per job: Configure OpenCode with a custom configuration directory, for example `./config/#custom-directory` to enable or disable functionality per OpenCode invocation.\n\n- Minimal setup: The CI component sets up OpenCode in the background, you only need to create the OpenCode configuration and the initial prompt.\n\n- Flexible: The CI component supports several inputs for customizing its behavior\n\n### [Setup](#setup)\n\n- Store your OpenCode authentication JSON as a File type CI environment variables under Settings > CI/CD > Variables. Make sure to mark them as Masked and hidden.\n\n- Add the following to your `.gitlab-ci.yml` file. .gitlab-ci.yml ``` include: - component: $CI_SERVER_FQDN/nagyv/gitlab-opencode/opencode@2 inputs: config_dir: ${CI_PROJECT_DIR}/opencode-config auth_json: $OPENCODE_AUTH_JSON # The variable name for your OpenCode authentication JSON command: optional-custom-command message: \"Your prompt here\" ```\n\nFor more inputs and use cases [check out the docs](https://gitlab.com/explore/catalog/nagyv/gitlab-opencode) for this component.\n\n## [GitLab Duo](#gitlab-duo)\n\nOpenCode integrates with your GitLab workflow.\nMention `@opencode` in a comment, and OpenCode will execute tasks within your GitLab CI pipeline.\n\n### [Features](#features-1)\n\n- Triage issues: Ask OpenCode to look into an issue and explain it to you.\n\n- Fix and implement: Ask OpenCode to fix an issue or implement a feature. It will create a new branch and raise a merge request with the changes.\n\n- Secure: OpenCode runs on your GitLab runners.\n\n### [Setup](#setup-1)\n\nOpenCode runs in your GitLab CI/CD pipeline, heres what youll need to set it up:\n\nTip\n\nCheck out the [GitLab docs](https://docs.gitlab.com/user/duo_agent_platform/agent_assistant/) for up to date instructions.\n\n- Configure your GitLab environment\n\n- Set up CI/CD\n\n- Get an AI model provider API key\n\n- Create a service account\n\n- Configure CI/CD variables\n\n- Create a flow config file, heres an example: Flow configuration ``` image: node:22-slimcommands: - echo \"Installing opencode\" - npm install --global opencode-ai - echo \"Installing glab\" - export GITLAB_TOKEN=$GITLAB_TOKEN_OPENCODE - apt-get update --quiet &#x26;&#x26; apt-get install --yes curl wget gpg git &#x26;&#x26; rm --recursive --force /var/lib/apt/lists/* - curl --silent --show-error --location \"https://raw.githubusercontent.com/upciti/wakemeops/main/assets/install_repository\" | bash - apt-get install --yes glab - echo \"Configuring glab\" - echo $GITLAB_HOST - echo \"Creating OpenCode auth configuration\" - mkdir --parents ~/.local/share/opencode - | cat > ~/.local/share/opencode/auth.json &#x3C;&#x3C; EOF { \"anthropic\": { \"type\": \"api\", \"key\": \"$ANTHROPIC_API_KEY\" } } EOF - echo \"Configuring git\" - git config --global user.email \"opencode@gitlab.com\" - git config --global user.name \"OpenCode\" - echo \"Testing glab\" - glab issue list - echo \"Running OpenCode\" - | opencode run \" You are an AI assistant helping with GitLab operations. Context: $AI_FLOW_CONTEXT Task: $AI_FLOW_INPUT Event: $AI_FLOW_EVENT Please execute the requested task using the available GitLab tools. Be thorough in your analysis and provide clear explanations. &#x3C;important> Please use the glab CLI to access data from GitLab. The glab CLI has already been authenticated. You can run the corresponding commands. If you are asked to summarize an MR or issue or asked to provide more information then please post back a note to the MR/Issue so that the user can see it. You don't need to commit or push up changes, those will be done automatically based on the file changes you make. &#x3C;/important> \" - git checkout --branch $CI_WORKLOAD_REF origin/$CI_WORKLOAD_REF - echo \"Checking for git changes and pushing if any exist\" - | if ! git diff --quiet || ! git diff --cached --quiet || [ --not --zero \"$(git ls-files --others --exclude-standard)\" ]; then echo \"Git changes detected, adding and pushing...\" git add . if git diff --cached --quiet; then echo \"No staged changes to commit\" else echo \"Committing changes to branch: $CI_WORKLOAD_REF\" git commit --message \"Codex changes\" echo \"Pushing changes up to $CI_WORKLOAD_REF\" git push https://gitlab-ci-token:$GITLAB_TOKEN@$GITLAB_HOST/gl-demo-ultimate-dev-ai-epic-17570/test-java-project.git $CI_WORKLOAD_REF echo \"Changes successfully pushed\" fi else echo \"No git changes detected, skipping push\" fivariables: - ANTHROPIC_API_KEY - GITLAB_TOKEN_OPENCODE - GITLAB_HOST ```\n\nYou can refer to the [GitLab CLI agents docs](https://docs.gitlab.com/user/duo_agent_platform/agent_assistant/) for detailed instructions.\n\n### [Examples](#examples)\n\nHere are some examples of how you can use OpenCode in GitLab.\n\nTip\n\nYou can configure to use a different trigger phrase than `@opencode`.\n\n- Explain an issue Add this comment in a GitLab issue. ``` @opencode explain this issue ``` OpenCode will read the issue and reply with a clear explanation.\n\n- Fix an issue In a GitLab issue, say: ``` @opencode fix this ``` OpenCode will create a new branch, implement the changes, and open a merge request with the changes.\n\n- Review merge requests Leave the following comment on a GitLab merge request. ``` @opencode review this merge request ``` OpenCode will review the merge request and provide feedback.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/gitlab.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 104,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__ide.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/ide\n- Keywords: opencode, docs, ai coding assistant, cli, ide\n- Summary: The OpenCode extension for VS Code, Cursor, and other IDEs\n----\n\nSource: https://opencode.ai/docs/ide\n\n# IDE\n\nThe OpenCode extension for VS Code, Cursor, and other IDEs\n\nOpenCode integrates with VS Code, Cursor, or any IDE that supports a terminal. Just run `opencode` in the terminal to get started.\n\n## [Usage](#usage)\n\n- Quick Launch: Use `Cmd+Esc` (Mac) or `Ctrl+Esc` (Windows/Linux) to open OpenCode in a split terminal view, or focus an existing terminal session if one is already running.\n\n- New Session: Use `Cmd+Shift+Esc` (Mac) or `Ctrl+Shift+Esc` (Windows/Linux) to start a new OpenCode terminal session, even if one is already open. You can also click the OpenCode button in the UI.\n\n- Context Awareness: Automatically share your current selection or tab with OpenCode.\n\n- File Reference Shortcuts: Use `Cmd+Option+K` (Mac) or `Alt+Ctrl+K` (Linux/Windows) to insert file references. For example, `@File#L37-42`.\n\n## [Installation](#installation)\n\nTo install OpenCode on VS Code and popular forks like Cursor, Windsurf, VSCodium:\n\n- Open VS Code\n\n- Open the integrated terminal\n\n- Run `opencode` - the extension installs automatically\n\nIf on the other hand you want to use your own IDE when you run `/editor` or `/export` from the TUI, youll need to set `export EDITOR=\"code --wait\"`. [Learn more](/docs/tui/#editor-setup).\n\n### [Manual Install](#manual-install)\n\nSearch for OpenCode in the Extension Marketplace and click Install.\n\n### [Troubleshooting](#troubleshooting)\n\nIf the extension fails to install automatically:\n\n- Ensure youre running `opencode` in the integrated terminal.\n\n- Confirm the CLI for your IDE is installed: For VS Code: `code` command\n\n- For Cursor: `cursor` command\n\n- For Windsurf: `windsurf` command\n\n- For VSCodium: `codium` command\n\n- If not, run `Cmd+Shift+P` (Mac) or `Ctrl+Shift+P` (Windows/Linux) and search for Shell Command: Install code command in PATH (or the equivalent for your IDE)\n\n- Ensure VS Code has permission to install extensions\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/ide.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 75,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__keybinds.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/keybinds\n- Keywords: opencode, docs, ai coding assistant, cli, keybinds\n- Summary: OpenCode has a list of keybinds that you can customize through the OpenCode config.\n----\n\nSource: https://opencode.ai/docs/keybinds\n\n# Keybinds\n\nCustomize your keybinds.\n\nOpenCode has a list of keybinds that you can customize through the OpenCode config.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"keybinds\": {    \"leader\": \"ctrl+x\",    \"app_exit\": \"ctrl+c,ctrl+d,&#x3C;leader>q\",    \"editor_open\": \"&#x3C;leader>e\",    \"theme_list\": \"&#x3C;leader>t\",    \"sidebar_toggle\": \"&#x3C;leader>b\",    \"scrollbar_toggle\": \"none\",    \"username_toggle\": \"none\",    \"status_view\": \"&#x3C;leader>s\",    \"tool_details\": \"none\",    \"session_export\": \"&#x3C;leader>x\",    \"session_new\": \"&#x3C;leader>n\",    \"session_list\": \"&#x3C;leader>l\",    \"session_timeline\": \"&#x3C;leader>g\",    \"session_fork\": \"none\",    \"session_rename\": \"none\",    \"session_share\": \"none\",    \"session_unshare\": \"none\",    \"session_interrupt\": \"escape\",    \"session_compact\": \"&#x3C;leader>c\",    \"session_child_cycle\": \"&#x3C;leader>right\",    \"session_child_cycle_reverse\": \"&#x3C;leader>left\",    \"session_parent\": \"&#x3C;leader>up\",    \"messages_page_up\": \"pageup,ctrl+alt+b\",    \"messages_page_down\": \"pagedown,ctrl+alt+f\",    \"messages_line_up\": \"ctrl+alt+y\",    \"messages_line_down\": \"ctrl+alt+e\",    \"messages_half_page_up\": \"ctrl+alt+u\",    \"messages_half_page_down\": \"ctrl+alt+d\",    \"messages_first\": \"ctrl+g,home\",    \"messages_last\": \"ctrl+alt+g,end\",    \"messages_next\": \"none\",    \"messages_previous\": \"none\",    \"messages_copy\": \"&#x3C;leader>y\",    \"messages_undo\": \"&#x3C;leader>u\",    \"messages_redo\": \"&#x3C;leader>r\",    \"messages_last_user\": \"none\",    \"messages_toggle_conceal\": \"&#x3C;leader>h\",    \"model_list\": \"&#x3C;leader>m\",    \"model_cycle_recent\": \"f2\",    \"model_cycle_recent_reverse\": \"shift+f2\",    \"model_cycle_favorite\": \"none\",    \"model_cycle_favorite_reverse\": \"none\",    \"variant_cycle\": \"ctrl+t\",    \"command_list\": \"ctrl+p\",    \"agent_list\": \"&#x3C;leader>a\",    \"agent_cycle\": \"tab\",    \"agent_cycle_reverse\": \"shift+tab\",    \"input_clear\": \"ctrl+c\",    \"input_paste\": \"ctrl+v\",    \"input_submit\": \"return\",    \"input_newline\": \"shift+return,ctrl+return,alt+return,ctrl+j\",    \"input_move_left\": \"left,ctrl+b\",    \"input_move_right\": \"right,ctrl+f\",    \"input_move_up\": \"up\",    \"input_move_down\": \"down\",    \"input_select_left\": \"shift+left\",    \"input_select_right\": \"shift+right\",    \"input_select_up\": \"shift+up\",    \"input_select_down\": \"shift+down\",    \"input_line_home\": \"ctrl+a\",    \"input_line_end\": \"ctrl+e\",    \"input_select_line_home\": \"ctrl+shift+a\",    \"input_select_line_end\": \"ctrl+shift+e\",    \"input_visual_line_home\": \"alt+a\",    \"input_visual_line_end\": \"alt+e\",    \"input_select_visual_line_home\": \"alt+shift+a\",    \"input_select_visual_line_end\": \"alt+shift+e\",    \"input_buffer_home\": \"home\",    \"input_buffer_end\": \"end\",    \"input_select_buffer_home\": \"shift+home\",    \"input_select_buffer_end\": \"shift+end\",    \"input_delete_line\": \"ctrl+shift+d\",    \"input_delete_to_line_end\": \"ctrl+k\",    \"input_delete_to_line_start\": \"ctrl+u\",    \"input_backspace\": \"backspace,shift+backspace\",    \"input_delete\": \"ctrl+d,delete,shift+delete\",    \"input_undo\": \"ctrl+-,super+z\",    \"input_redo\": \"ctrl+.,super+shift+z\",    \"input_word_forward\": \"alt+f,alt+right,ctrl+right\",    \"input_word_backward\": \"alt+b,alt+left,ctrl+left\",    \"input_select_word_forward\": \"alt+shift+f,alt+shift+right\",    \"input_select_word_backward\": \"alt+shift+b,alt+shift+left\",    \"input_delete_word_forward\": \"alt+d,alt+delete,ctrl+delete\",    \"input_delete_word_backward\": \"ctrl+w,ctrl+backspace,alt+backspace\",    \"history_previous\": \"up\",    \"history_next\": \"down\",    \"terminal_suspend\": \"ctrl+z\",    \"terminal_title_toggle\": \"none\",    \"tips_toggle\": \"&#x3C;leader>h\",    \"display_thinking\": \"none\"  }}\n```\n\n## [Leader key](#leader-key)\n\nOpenCode uses a `leader` key for most keybinds. This avoids conflicts in your terminal.\n\nBy default, `ctrl+x` is the leader key and most actions require you to first press the leader key and then the shortcut. For example, to start a new session you first press `ctrl+x` and then press `n`.\n\nYou dont need to use a leader key for your keybinds but we recommend doing so.\n\n## [Disable keybind](#disable-keybind)\n\nYou can disable a keybind by adding the key to your config with a value of none.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"keybinds\": {    \"session_compact\": \"none\"  }}\n```\n\n## [Desktop prompt shortcuts](#desktop-prompt-shortcuts)\n\nThe OpenCode desktop app prompt input supports common Readline/Emacs-style shortcuts for editing text. These are built-in and currently not configurable via `opencode.json`.\n\nShortcut Action\n\n`ctrl+a` Move to start of current line\n\n`ctrl+e` Move to end of current line\n\n`ctrl+b` Move cursor back one character\n\n`ctrl+f` Move cursor forward one character\n\n`alt+b` Move cursor back one word\n\n`alt+f` Move cursor forward one word\n\n`ctrl+d` Delete character under cursor\n\n`ctrl+k` Kill to end of line\n\n`ctrl+u` Kill to start of line\n\n`ctrl+w` Kill previous word\n\n`alt+d` Kill next word\n\n`ctrl+t` Transpose characters\n\n`ctrl+g` Cancel popovers / abort running response\n\n## [Shift+Enter](#shiftenter)\n\nSome terminals dont send modifier keys with Enter by default. You may need to configure your terminal to send `Shift+Enter` as an escape sequence.\n\n### [Windows Terminal](#windows-terminal)\n\nOpen your `settings.json` at:\n\n```\n%LOCALAPPDATA%\\Packages\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\LocalState\\settings.json\n```\n\nAdd this to the root-level `actions` array:\n\n```\n\"actions\": [  {    \"command\": {      \"action\": \"sendInput\",      \"input\": \"\\u001b[13;2u\"    },    \"id\": \"User.sendInput.ShiftEnterCustom\"  }]\n```\n\nAdd this to the root-level `keybindings` array:\n\n```\n\"keybindings\": [  {    \"keys\": \"shift+enter\",    \"id\": \"User.sendInput.ShiftEnterCustom\"  }]\n```\n\nSave the file and restart Windows Terminal or open a new tab.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/keybinds.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 113,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__lsp.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/lsp\n- Keywords: opencode, docs, ai coding assistant, cli, lsp\n- Summary: OpenCode integrates with your LSP servers.\n----\n\nSource: https://opencode.ai/docs/lsp\n\n# LSP Servers\n\nOpenCode integrates with your LSP servers.\n\nOpenCode integrates with your Language Server Protocol (LSP) to help the LLM interact with your codebase. It uses diagnostics to provide feedback to the LLM.\n\n## [Built-in](#built-in)\n\nOpenCode comes with several built-in LSP servers for popular languages:\n\nLSP Server Extensions Requirements\n\nastro .astro Auto-installs for Astro projects\n\nbash .sh, .bash, .zsh, .ksh Auto-installs bash-language-server\n\nclangd .c, .cpp, .cc, .cxx, .c++, .h, .hpp, .hh, .hxx, .h++ Auto-installs for C/C++ projects\n\ncsharp .cs `.NET SDK` installed\n\nclojure-lsp .clj, .cljs, .cljc, .edn `clojure-lsp` command available\n\ndart .dart `dart` command available\n\ndeno .ts, .tsx, .js, .jsx, .mjs `deno` command available (auto-detects deno.json/deno.jsonc)\n\nelixir-ls .ex, .exs `elixir` command available\n\neslint .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts, .vue `eslint` dependency in project\n\nfsharp .fs, .fsi, .fsx, .fsscript `.NET SDK` installed\n\ngleam .gleam `gleam` command available\n\ngopls .go `go` command available\n\nhls .hs, .lhs `haskell-language-server-wrapper` command available\n\njdtls .java `Java SDK (version 21+)` installed\n\nkotlin-ls .kt, .kts Auto-installs for Kotlin projects\n\nlua-ls .lua Auto-installs for Lua projects\n\nnixd .nix `nixd` command available\n\nocaml-lsp .ml, .mli `ocamllsp` command available\n\noxlint .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts, .vue, .astro, .svelte `oxlint` dependency in project\n\nphp intelephense .php Auto-installs for PHP projects\n\nprisma .prisma `prisma` command available\n\npyright .py, .pyi `pyright` dependency installed\n\nruby-lsp (rubocop) .rb, .rake, .gemspec, .ru `ruby` and `gem` commands available\n\nrust .rs `rust-analyzer` command available\n\nsourcekit-lsp .swift, .objc, .objcpp `swift` installed (`xcode` on macOS)\n\nsvelte .svelte Auto-installs for Svelte projects\n\nterraform .tf, .tfvars Auto-installs from GitHub releases\n\ntinymist .typ, .typc Auto-installs from GitHub releases\n\ntypescript .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts `typescript` dependency in project\n\nvue .vue Auto-installs for Vue projects\n\nyaml-ls .yaml, .yml Auto-installs Red Hat yaml-language-server\n\nzls .zig, .zon `zig` command available\n\nLSP servers are automatically enabled when one of the above file extensions are detected and the requirements are met.\n\nNote\n\nYou can disable automatic LSP server downloads by setting the `OPENCODE_DISABLE_LSP_DOWNLOAD` environment variable to `true`.\n\n## [How It Works](#how-it-works)\n\nWhen opencode opens a file, it:\n\n- Checks the file extension against all enabled LSP servers.\n\n- Starts the appropriate LSP server if not already running.\n\n## [Configure](#configure)\n\nYou can customize LSP servers through the `lsp` section in your opencode config.\n\n- opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"lsp\": {}} ``` Each LSP server supports the following: PropertyTypeDescription`disabled`booleanSet this to `true` to disable the LSP server`command`string[]The command to start the LSP server`extensions`string[]File extensions this LSP server should handle`env`objectEnvironment variables to set when starting server`initialization`objectInitialization options to send to the LSP server Lets look at some examples. ### [Environment variables](#environment-variables) Use the `env` property to set environment variables when starting the LSP server: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"lsp\": { \"rust\": { \"env\": { \"RUST_LOG\": \"debug\" } } }} ``` ### [Initialization options](#initialization-options) Use the `initialization` property to pass initialization options to the LSP server. These are server-specific settings sent during the LSP `initialize` request: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"lsp\": { \"typescript\": { \"initialization\": { \"preferences\": { \"importModuleSpecifierPreference\": \"relative\" } } } }} ``` NoteInitialization options vary by LSP server. Check your LSP servers documentation for available options. ### [Disabling LSP servers](#disabling-lsp-servers) To disable all LSP servers globally, set `lsp` to `false`: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"lsp\": false} ``` To disable a specific LSP server, set `disabled` to `true`: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"lsp\": { \"typescript\": { \"disabled\": true } }} ``` ### [Custom LSP servers](#custom-lsp-servers) You can add custom LSP servers by specifying the command and file extensions: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"lsp\": { \"custom-lsp\": { \"command\": [\"custom-lsp-server\", \"--stdio\"], \"extensions\": [\".custom\"] } }} ``` ## [Additional Information](#additional-information) ### [PHP Intelephense](#php-intelephense) PHP Intelephense offers premium features through a license key. You can provide a license key by placing (only) the key in a text file at: On macOS/Linux: `$HOME/intelephense/license.txt`\n\n- On Windows: `%USERPROFILE%/intelephense/license.txt`\n\nThe file should contain only the license key with no additional content.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/lsp.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 125,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__mcp-servers.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/mcp-servers\n- Keywords: opencode, docs, ai coding assistant, cli, mcp servers\n- Summary: Add local and remote MCP tools.\n----\n\nSource: https://opencode.ai/docs/mcp-servers\n\n# MCP servers\n\nAdd local and remote MCP tools.\n\nYou can add external tools to OpenCode using the Model Context Protocol, or MCP. OpenCode supports both local and remote servers.\n\nOnce added, MCP tools are automatically available to the LLM alongside built-in tools.\n\n#### [Caveats](#caveats)\n\nWhen you use an MCP server, it adds to the context. This can quickly add up if you have a lot of tools. So we recommend being careful with which MCP servers you use.\n\nTip\n\nMCP servers add to your context, so you want to be careful with which ones you enable.\n\nCertain MCP servers, like the GitHub MCP server, tend to add a lot of tokens and can easily exceed the context limit.\n\n## [Enable](#enable)\n\nYou can define MCP servers in your [OpenCode Config](https://opencode.ai/docs/config/) under `mcp`. Add each MCP with a unique name. You can refer to that MCP by name when prompting the LLM.\n\n- opencode.jsonc ``` { \"$schema\": \"https://opencode.ai/config.json\", \"mcp\": { \"name-of-mcp-server\": { // ... \"enabled\": true, }, \"name-of-other-mcp-server\": { // ... }, },} ``` You can also disable a server by setting `enabled` to `false`. This is useful if you want to temporarily disable a server without removing it from your config. ### [Overriding remote defaults](#overriding-remote-defaults) Organizations can provide default MCP servers via their `.well-known/opencode` endpoint. These servers may be disabled by default, allowing users to opt-in to the ones they need. To enable a specific server from your organizations remote config, add it to your local config with `enabled: true`: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"mcp\": { \"jira\": { \"type\": \"remote\", \"url\": \"https://jira.example.com/mcp\", \"enabled\": true } }} ``` Your local config values override the remote defaults. See [config precedence](/docs/config#precedence-order) for more details. ## [Local](#local) Add local MCP servers using `type` to `\"local\"` within the MCP object. opencode.jsonc ``` { \"$schema\": \"https://opencode.ai/config.json\", \"mcp\": { \"my-local-mcp-server\": { \"type\": \"local\", // Or [\"bun\", \"x\", \"my-mcp-command\"] \"command\": [\"npx\", \"-y\", \"my-mcp-command\"], \"enabled\": true, \"environment\": { \"MY_ENV_VAR\": \"my_env_var_value\", }, }, },} ``` The command is how the local MCP server is started. You can also pass in a list of environment variables as well. For example, heres how you can add the test [`@modelcontextprotocol/server-everything`](https://www.npmjs.com/package/@modelcontextprotocol/server-everything) MCP server. opencode.jsonc ``` { \"$schema\": \"https://opencode.ai/config.json\", \"mcp\": { \"mcp_everything\": { \"type\": \"local\", \"command\": [\"npx\", \"-y\", \"@modelcontextprotocol/server-everything\"], }, },} ``` And to use it I can add `use the mcp_everything tool` to my prompts. ``` use the mcp_everything tool to add the number 3 and 4 ``` #### [Options](#options) Here are all the options for configuring a local MCP server. OptionTypeRequiredDescription`type`StringYType of MCP server connection, must be `\"local\"`.`command`ArrayYCommand and arguments to run the MCP server.`environment`ObjectEnvironment variables to set when running the server.`enabled`BooleanEnable or disable the MCP server on startup.`timeout`NumberTimeout in ms for fetching tools from the MCP server. Defaults to 5000 (5 seconds). ## [Remote](#remote) Add remote MCP servers by setting `type` to `\"remote\"`. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"mcp\": { \"my-remote-mcp\": { \"type\": \"remote\", \"url\": \"https://my-mcp-server.com\", \"enabled\": true, \"headers\": { \"Authorization\": \"Bearer MY_API_KEY\" } } }} ``` The `url` is the URL of the remote MCP server and with the `headers` option you can pass in a list of headers. #### [Options](#options-1) OptionTypeRequiredDescription`type`StringYType of MCP server connection, must be `\"remote\"`.`url`StringYURL of the remote MCP server.`enabled`BooleanEnable or disable the MCP server on startup.`headers`ObjectHeaders to send with the request.`oauth`ObjectOAuth authentication configuration. See [OAuth](#oauth) section below.`timeout`NumberTimeout in ms for fetching tools from the MCP server. Defaults to 5000 (5 seconds). ## [OAuth](#oauth) OpenCode automatically handles OAuth authentication for remote MCP servers. When a server requires authentication, OpenCode will: Detect the 401 response and initiate the OAuth flow\n\n- Use Dynamic Client Registration (RFC 7591) if supported by the server\n\n- Store tokens securely for future requests\n\n### [Automatic](#automatic)\n\nFor most OAuth-enabled MCP servers, no special configuration is needed. Just configure the remote server:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"my-oauth-server\": {      \"type\": \"remote\",      \"url\": \"https://mcp.example.com/mcp\"    }  }}\n```\n\nIf the server requires authentication, OpenCode will prompt you to authenticate when you first try to use it. If not, you can [manually trigger the flow](#authenticating) with `opencode mcp auth &#x3C;server-name>`.\n\n### [Pre-registered](#pre-registered)\n\nIf you have client credentials from the MCP server provider, you can configure them:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"my-oauth-server\": {      \"type\": \"remote\",      \"url\": \"https://mcp.example.com/mcp\",      \"oauth\": {        \"clientId\": \"{env:MY_MCP_CLIENT_ID}\",        \"clientSecret\": \"{env:MY_MCP_CLIENT_SECRET}\",        \"scope\": \"tools:read tools:execute\"      }    }  }}\n```\n\n### [Authenticating](#authenticating)\n\nYou can manually trigger authentication or manage credentials.\n\nAuthenticate with a specific MCP server:\n\nTerminal window\n\n```\nopencode mcp auth my-oauth-server\n```\n\nList all MCP servers and their auth status:\n\nTerminal window\n\n```\nopencode mcp list\n```\n\nRemove stored credentials:\n\nTerminal window\n\n```\nopencode mcp logout my-oauth-server\n```\n\nThe `mcp auth` command will open your browser for authorization. After you authorize, OpenCode will store the tokens securely in `~/.local/share/opencode/mcp-auth.json`.\n\n#### [Disabling OAuth](#disabling-oauth)\n\nIf you want to disable automatic OAuth for a server (e.g., for servers that use API keys instead), set `oauth` to `false`:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"my-api-key-server\": {      \"type\": \"remote\",      \"url\": \"https://mcp.example.com/mcp\",      \"oauth\": false,      \"headers\": {        \"Authorization\": \"Bearer {env:MY_API_KEY}\"      }    }  }}\n```\n\n#### [OAuth Options](#oauth-options)\n\nOption Type Description\n\n`oauth` Object | false OAuth config object, or `false` to disable OAuth auto-detection.\n\n`clientId` String OAuth client ID. If not provided, dynamic client registration will be attempted.\n\n`clientSecret` String OAuth client secret, if required by the authorization server.\n\n`scope` String OAuth scopes to request during authorization.\n\n#### [Debugging](#debugging)\n\nIf a remote MCP server is failing to authenticate, you can diagnose issues with:\n\nTerminal window\n\n```\n# View auth status for all OAuth-capable serversopencode mcp auth list\n# Debug connection and OAuth flow for a specific serveropencode mcp debug my-oauth-server\n```\n\nThe `mcp debug` command shows the current auth status, tests HTTP connectivity, and attempts the OAuth discovery flow.\n\n## [Manage](#manage)\n\nYour MCPs are available as tools in OpenCode, alongside built-in tools. So you can manage them through the OpenCode config like any other tool.\n\n### [Global](#global)\n\nThis means that you can enable or disable them globally.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"my-mcp-foo\": {      \"type\": \"local\",      \"command\": [\"bun\", \"x\", \"my-mcp-command-foo\"]    },    \"my-mcp-bar\": {      \"type\": \"local\",      \"command\": [\"bun\", \"x\", \"my-mcp-command-bar\"]    }  },  \"tools\": {    \"my-mcp-foo\": false  }}\n```\n\nWe can also use a glob pattern to disable all matching MCPs.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"my-mcp-foo\": {      \"type\": \"local\",      \"command\": [\"bun\", \"x\", \"my-mcp-command-foo\"]    },    \"my-mcp-bar\": {      \"type\": \"local\",      \"command\": [\"bun\", \"x\", \"my-mcp-command-bar\"]    }  },  \"tools\": {    \"my-mcp*\": false  }}\n```\n\nHere we are using the glob pattern `my-mcp*` to disable all MCPs.\n\n### [Per agent](#per-agent)\n\nIf you have a large number of MCP servers you may want to only enable them per agent and disable them globally. To do this:\n\n- Disable it as a tool globally.\n\n- In your [agent config](/docs/agents#tools), enable the MCP server as a tool.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"my-mcp\": {      \"type\": \"local\",      \"command\": [\"bun\", \"x\", \"my-mcp-command\"],      \"enabled\": true    }  },  \"tools\": {    \"my-mcp*\": false  },  \"agent\": {    \"my-agent\": {      \"tools\": {        \"my-mcp*\": true      }    }  }}\n```\n\n#### [Glob patterns](#glob-patterns)\n\nThe glob pattern uses simple regex globbing patterns:\n\n- `*` matches zero or more of any character (e.g., `\"my-mcp*\"` matches `my-mcp_search`, `my-mcp_list`, etc.)\n\n- `?` matches exactly one character\n\n- All other characters match literally\n\nNote\n\nMCP server tools are registered with server name as prefix, so to disable all tools for a server simply use:\n\n```\n\"mymcpservername_*\": false\n```\n\n## [Examples](#examples)\n\nBelow are examples of some common MCP servers. You can submit a PR if you want to document other servers.\n\n### [Sentry](#sentry)\n\nAdd the [Sentry MCP server](https://mcp.sentry.dev) to interact with your Sentry projects and issues.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"sentry\": {      \"type\": \"remote\",      \"url\": \"https://mcp.sentry.dev/mcp\",      \"oauth\": {}    }  }}\n```\n\nAfter adding the configuration, authenticate with Sentry:\n\nTerminal window\n\n```\nopencode mcp auth sentry\n```\n\nThis will open a browser window to complete the OAuth flow and connect OpenCode to your Sentry account.\n\nOnce authenticated, you can use Sentry tools in your prompts to query issues, projects, and error data.\n\n```\nShow me the latest unresolved issues in my project. use sentry\n```\n\n### [Context7](#context7)\n\nAdd the [Context7 MCP server](https://github.com/upstash/context7) to search through docs.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"context7\": {      \"type\": \"remote\",      \"url\": \"https://mcp.context7.com/mcp\"    }  }}\n```\n\nIf you have signed up for a free account, you can use your API key and get higher rate-limits.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"context7\": {      \"type\": \"remote\",      \"url\": \"https://mcp.context7.com/mcp\",      \"headers\": {        \"CONTEXT7_API_KEY\": \"{env:CONTEXT7_API_KEY}\"      }    }  }}\n```\n\nHere we are assuming that you have the `CONTEXT7_API_KEY` environment variable set.\n\nAdd `use context7` to your prompts to use Context7 MCP server.\n\n```\nConfigure a Cloudflare Worker script to cache JSON API responses for five minutes. use context7\n```\n\nAlternatively, you can add something like this to your [AGENTS.md](/docs/rules/).\n\nAGENTS.md\n\n```\nWhen you need to search docs, use `context7` tools.\n```\n\n### [Grep by Vercel](#grep-by-vercel)\n\nAdd the [Grep by Vercel](https://grep.app) MCP server to search through code snippets on GitHub.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mcp\": {    \"gh_grep\": {      \"type\": \"remote\",      \"url\": \"https://mcp.grep.app\"    }  }}\n```\n\nSince we named our MCP server `gh_grep`, you can add `use the gh_grep tool` to your prompts to get the agent to use it.\n\n```\nWhat's the right way to set a custom domain in an SST Astro component? use the gh_grep tool\n```\n\nAlternatively, you can add something like this to your [AGENTS.md](/docs/rules/).\n\nAGENTS.md\n\n```\nIf you are unsure how to do something, use `gh_grep` to search code examples from GitHub.\n```\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/mcp-servers.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 284,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__models.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/models\n- Keywords: opencode, docs, ai coding assistant, cli, models\n- Summary: Configuring an LLM provider and model.\n----\n\nSource: https://opencode.ai/docs/models\n\n# Models\n\nConfiguring an LLM provider and model.\n\nOpenCode uses the [AI SDK](https://ai-sdk.dev/) and [Models.dev](https://models.dev) to support 75+ LLM providers and it supports running local models.\n\n## [Providers](#providers)\n\nMost popular providers are preloaded by default. If youve added the credentials for a provider through the `/connect` command, theyll be available when you start OpenCode.\n\nLearn more about [providers](/docs/providers).\n\n## [Select a model](#select-a-model)\n\nOnce youve configured your provider you can select the model you want by typing in:\n\n- ``` /models ``` ## [Recommended models](#recommended-models) There are a lot of models out there, with new models coming out every week. TipConsider using one of the models we recommend. However, there are only a few of them that are good at both generating code and tool calling. Here are several models that work well with OpenCode, in no particular order. (This is not an exhaustive list nor is it necessarily up to date): GPT 5.2\n\n- GPT 5.1 Codex\n\n- Claude Opus 4.5\n\n- Claude Sonnet 4.5\n\n- Minimax M2.1\n\n- Gemini 3 Pro\n\n## [Set a default](#set-a-default)\n\nTo set one of these as the default model, you can set the `model` key in your\nOpenCode config.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"model\": \"lmstudio/google/gemma-3n-e4b\"}\n```\n\nHere the full ID is `provider_id/model_id`. For example, if youre using [OpenCode Zen](/docs/zen), you would use `opencode/gpt-5.1-codex` for GPT 5.1 Codex.\n\nIf youve configured a [custom provider](/docs/providers#custom), the `provider_id` is key from the `provider` part of your config, and the `model_id` is the key from `provider.models`.\n\n## [Configure models](#configure-models)\n\nYou can globally configure a models options through the config.\n\nopencode.jsonc\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"openai\": {      \"models\": {        \"gpt-5\": {          \"options\": {            \"reasoningEffort\": \"high\",            \"textVerbosity\": \"low\",            \"reasoningSummary\": \"auto\",            \"include\": [\"reasoning.encrypted_content\"],          },        },      },    },    \"anthropic\": {      \"models\": {        \"claude-sonnet-4-5-20250929\": {          \"options\": {            \"thinking\": {              \"type\": \"enabled\",              \"budgetTokens\": 16000,            },          },        },      },    },  },}\n```\n\nHere were configuring global settings for two built-in models: `gpt-5` when accessed via the `openai` provider, and `claude-sonnet-4-20250514` when accessed via the `anthropic` provider.\nThe built-in provider and model names can be found on [Models.dev](https://models.dev).\n\nYou can also configure these options for any agents that you are using. The agent config overrides any global options here. [Learn more](/docs/agents/#additional).\n\nYou can also define custom variants that extend built-in ones. Variants let you configure different settings for the same model without creating duplicate entries:\n\nopencode.jsonc\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"opencode\": {      \"models\": {        \"gpt-5\": {          \"variants\": {            \"high\": {              \"reasoningEffort\": \"high\",              \"textVerbosity\": \"low\",              \"reasoningSummary\": \"auto\",            },            \"low\": {              \"reasoningEffort\": \"low\",              \"textVerbosity\": \"low\",              \"reasoningSummary\": \"auto\",            },          },        },      },    },  },}\n```\n\n## [Variants](#variants)\n\nMany models support multiple variants with different configurations. OpenCode ships with built-in default variants for popular providers.\n\n### [Built-in variants](#built-in-variants)\n\nOpenCode ships with default variants for many providers:\n\nAnthropic:\n\n- `high` - High thinking budget (default)\n\n- `max` - Maximum thinking budget\n\nOpenAI:\n\nVaries by model but roughly:\n\n- `none` - No reasoning\n\n- `minimal` - Minimal reasoning effort\n\n- `low` - Low reasoning effort\n\n- `medium` - Medium reasoning effort\n\n- `high` - High reasoning effort\n\n- `xhigh` - Extra high reasoning effort\n\nGoogle:\n\n- `low` - Lower effort/token budget\n\n- `high` - Higher effort/token budget\n\nTip\n\nThis list is not comprehensive. Many other providers have built-in defaults too.\n\n### [Custom variants](#custom-variants)\n\nYou can override existing variants or add your own:\n\nopencode.jsonc\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"openai\": {      \"models\": {        \"gpt-5\": {          \"variants\": {            \"thinking\": {              \"reasoningEffort\": \"high\",              \"textVerbosity\": \"low\",            },            \"fast\": {              \"disabled\": true,            },          },        },      },    },  },}\n```\n\n### [Cycle variants](#cycle-variants)\n\nUse the keybind `variant_cycle` to quickly switch between variants. [Learn more](/docs/keybinds).\n\n## [Loading models](#loading-models)\n\nWhen OpenCode starts up, it checks for models in the following priority order:\n\n- The `--model` or `-m` command line flag. The format is the same as in the config file: `provider_id/model_id`.\n\n- The model list in the OpenCode config. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"model\": \"anthropic/claude-sonnet-4-20250514\"} ``` The format here is `provider/model`.\n\n- The last used model.\n\n- The first model using an internal priority.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/models.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 157,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__modes.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/modes\n- Keywords: opencode, docs, ai coding assistant, cli, modes\n- Summary: Different modes for different use cases.\n----\n\nSource: https://opencode.ai/docs/modes\n\n# Modes\n\nDifferent modes for different use cases.\n\nCaution\n\nModes are now configured through the `agent` option in the opencode config. The\n`mode` option is now deprecated. [Learn more](/docs/agents).\n\nModes in opencode allow you to customize the behavior, tools, and prompts for different use cases.\n\nIt comes with two built-in modes: build and plan. You can customize\nthese or configure your own through the opencode config.\n\nYou can switch between modes during a session or configure them in your config file.\n\n## [Built-in](#built-in)\n\nopencode comes with two built-in modes.\n\n### [Build](#build)\n\nBuild is the default mode with all tools enabled. This is the standard mode for development work where you need full access to file operations and system commands.\n\n### [Plan](#plan)\n\nA restricted mode designed for planning and analysis. In plan mode, the following tools are disabled by default:\n\n- `write` - Cannot create new files\n\n- `edit` - Cannot modify existing files, except for files located at `.opencode/plans/*.md` to detail the plan itself\n\n- `patch` - Cannot apply patches\n\n- `bash` - Cannot execute shell commands\n\nThis mode is useful when you want the AI to analyze code, suggest changes, or create plans without making any actual modifications to your codebase.\n\n## [Switching](#switching)\n\nYou can switch between modes during a session using the Tab key. Or your configured `switch_mode` keybind.\n\nSee also: [Formatters](/docs/formatters) for information about code formatting configuration.\n\n## [Configure](#configure)\n\nYou can customize the built-in modes or create your own through configuration. Modes can be configured in two ways:\n\n### [JSON Configuration](#json-configuration)\n\nConfigure modes in your `opencode.json` config file:\n\n- opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"mode\": { \"build\": { \"model\": \"anthropic/claude-sonnet-4-20250514\", \"prompt\": \"{file:./prompts/build.txt}\", \"tools\": { \"write\": true, \"edit\": true, \"bash\": true } }, \"plan\": { \"model\": \"anthropic/claude-haiku-4-20250514\", \"tools\": { \"write\": false, \"edit\": false, \"bash\": false } } }} ``` ### [Markdown Configuration](#markdown-configuration) You can also define modes using markdown files. Place them in: Global: `~/.config/opencode/modes/`\n\n- Project: `.opencode/modes/`\n\n~/.config/opencode/modes/review.md\n\n```\n---model: anthropic/claude-sonnet-4-20250514temperature: 0.1tools:  write: false  edit: false  bash: false---\nYou are in code review mode. Focus on:\n- Code quality and best practices- Potential bugs and edge cases- Performance implications- Security considerations\nProvide constructive feedback without making direct changes.\n```\n\nThe markdown file name becomes the mode name (e.g., `review.md` creates a `review` mode).\n\nLets look at these configuration options in detail.\n\n### [Model](#model)\n\nUse the `model` config to override the default model for this mode. Useful for using different models optimized for different tasks. For example, a faster model for planning, a more capable model for implementation.\n\nopencode.json\n\n```\n{  \"mode\": {    \"plan\": {      \"model\": \"anthropic/claude-haiku-4-20250514\"    }  }}\n```\n\n### [Temperature](#temperature)\n\nControl the randomness and creativity of the AIs responses with the `temperature` config. Lower values make responses more focused and deterministic, while higher values increase creativity and variability.\n\nopencode.json\n\n```\n{  \"mode\": {    \"plan\": {      \"temperature\": 0.1    },    \"creative\": {      \"temperature\": 0.8    }  }}\n```\n\nTemperature values typically range from 0.0 to 1.0:\n\n- 0.0-0.2: Very focused and deterministic responses, ideal for code analysis and planning\n\n- 0.3-0.5: Balanced responses with some creativity, good for general development tasks\n\n- 0.6-1.0: More creative and varied responses, useful for brainstorming and exploration\n\nopencode.json\n\n```\n{  \"mode\": {    \"analyze\": {      \"temperature\": 0.1,      \"prompt\": \"{file:./prompts/analysis.txt}\"    },    \"build\": {      \"temperature\": 0.3    },    \"brainstorm\": {      \"temperature\": 0.7,      \"prompt\": \"{file:./prompts/creative.txt}\"    }  }}\n```\n\nIf no temperature is specified, opencode uses model-specific defaults (typically 0 for most models, 0.55 for Qwen models).\n\n### [Prompt](#prompt)\n\nSpecify a custom system prompt file for this mode with the `prompt` config. The prompt file should contain instructions specific to the modes purpose.\n\nopencode.json\n\n```\n{  \"mode\": {    \"review\": {      \"prompt\": \"{file:./prompts/code-review.txt}\"    }  }}\n```\n\nThis path is relative to where the config file is located. So this works for\nboth the global opencode config and the project specific config.\n\n### [Tools](#tools)\n\nControl which tools are available in this mode with the `tools` config. You can enable or disable specific tools by setting them to `true` or `false`.\n\n```\n{  \"mode\": {    \"readonly\": {      \"tools\": {        \"write\": false,        \"edit\": false,        \"bash\": false,        \"read\": true,        \"grep\": true,        \"glob\": true      }    }  }}\n```\n\nIf no tools are specified, all tools are enabled by default.\n\n#### [Available tools](#available-tools)\n\nHere are all the tools can be controlled through the mode config.\n\nTool Description\n\n`bash` Execute shell commands\n\n`edit` Modify existing files\n\n`write` Create new files\n\n`read` Read file contents\n\n`grep` Search file contents\n\n`glob` Find files by pattern\n\n`list` List directory contents\n\n`patch` Apply patches to files\n\n`todowrite` Manage todo lists\n\n`todoread` Read todo lists\n\n`webfetch` Fetch web content\n\n## [Custom modes](#custom-modes)\n\nYou can create your own custom modes by adding them to the configuration. Here are examples using both approaches:\n\n### [Using JSON configuration](#using-json-configuration)\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"mode\": {    \"docs\": {      \"prompt\": \"{file:./prompts/documentation.txt}\",      \"tools\": {        \"write\": true,        \"edit\": true,        \"bash\": false,        \"read\": true,        \"grep\": true,        \"glob\": true      }    }  }}\n```\n\n### [Using markdown files](#using-markdown-files)\n\nCreate mode files in `.opencode/modes/` for project-specific modes or `~/.config/opencode/modes/` for global modes:\n\n.opencode/modes/debug.md\n\n```\n---temperature: 0.1tools:  bash: true  read: true  grep: true  write: false  edit: false---\nYou are in debug mode. Your primary goal is to help investigate and diagnose issues.\nFocus on:\n- Understanding the problem through careful analysis- Using bash commands to inspect system state- Reading relevant files and logs- Searching for patterns and anomalies- Providing clear explanations of findings\nDo not make any changes to files. Only investigate and report.\n```\n\n~/.config/opencode/modes/refactor.md\n\n```\n---model: anthropic/claude-sonnet-4-20250514temperature: 0.2tools:  edit: true  read: true  grep: true  glob: true---\nYou are in refactoring mode. Focus on improving code quality without changing functionality.\nPriorities:\n- Improve code readability and maintainability- Apply consistent naming conventions- Reduce code duplication- Optimize performance where appropriate- Ensure all tests continue to pass\n```\n\n### [Use cases](#use-cases)\n\nHere are some common use cases for different modes.\n\n- Build mode: Full development work with all tools enabled\n\n- Plan mode: Analysis and planning without making changes\n\n- Review mode: Code review with read-only access plus documentation tools\n\n- Debug mode: Focused on investigation with bash and read tools enabled\n\n- Docs mode: Documentation writing with file operations but no system commands\n\nYou might also find different models are good for different use cases.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/modes.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 232,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__network.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/network\n- Keywords: opencode, docs, ai coding assistant, cli, network\n- Summary: Configure proxies and custom certificates.\n----\n\nSource: https://opencode.ai/docs/network\n\n# Network\n\nConfigure proxies and custom certificates.\n\nOpenCode supports standard proxy environment variables and custom certificates for enterprise network environments.\n\n## [Proxy](#proxy)\n\nOpenCode respects standard proxy environment variables.\n\nTerminal window\n\n```\n# HTTPS proxy (recommended)export HTTPS_PROXY=https://proxy.example.com:8080\n# HTTP proxy (if HTTPS not available)export HTTP_PROXY=http://proxy.example.com:8080\n# Bypass proxy for local server (required)export NO_PROXY=localhost,127.0.0.1\n```\n\nCaution\n\nThe TUI communicates with a local HTTP server. You must bypass the proxy for this connection to prevent routing loops.\n\nYou can configure the servers port and hostname using [CLI flags](/docs/cli#run).\n\n### [Authenticate](#authenticate)\n\nIf your proxy requires basic authentication, include credentials in the URL.\n\nTerminal window\n\n```\nexport HTTPS_PROXY=http://username:password@proxy.example.com:8080\n```\n\nCaution\n\nAvoid hardcoding passwords. Use environment variables or secure credential storage.\n\nFor proxies requiring advanced authentication like NTLM or Kerberos, consider using an LLM Gateway that supports your authentication method.\n\n## [Custom certificates](#custom-certificates)\n\nIf your enterprise uses custom CAs for HTTPS connections, configure OpenCode to trust them.\n\nTerminal window\n\n```\nexport NODE_EXTRA_CA_CERTS=/path/to/ca-cert.pem\n```\n\nThis works for both proxy connections and direct API access.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/network.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 77,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__permissions.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/permissions\n- Keywords: opencode, docs, ai coding assistant, cli, permissions\n- Summary: Control which actions require approval to run.\n----\n\nSource: https://opencode.ai/docs/permissions\n\n# Permissions\n\nControl which actions require approval to run.\n\nOpenCode uses the `permission` config to decide whether a given action should run automatically, prompt you, or be blocked.\n\nAs of `v1.1.1`, the legacy `tools` boolean config is deprecated and has been merged into `permission`. The old `tools` config is still supported for backwards compatibility.\n\n## [Actions](#actions)\n\nEach permission rule resolves to one of:\n\n- `\"allow\"`  run without approval\n\n- `\"ask\"`  prompt for approval\n\n- `\"deny\"`  block the action\n\n## [Configuration](#configuration)\n\nYou can set permissions globally (with `*`), and override specific tools.\n\n- opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"*\": \"ask\", \"bash\": \"allow\", \"edit\": \"deny\" }} ``` You can also set all permissions at once: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": \"allow\"} ``` ## [Granular Rules (Object Syntax)](#granular-rules-object-syntax) For most permissions, you can use an object to apply different actions based on the tool input. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"bash\": { \"*\": \"ask\", \"git *\": \"allow\", \"npm *\": \"allow\", \"rm *\": \"deny\", \"grep *\": \"allow\" }, \"edit\": { \"*\": \"deny\", \"packages/web/src/content/docs/*.mdx\": \"allow\" } }} ``` Rules are evaluated by pattern match, with the last matching rule winning. A common pattern is to put the catch-all `\"*\"` rule first, and more specific rules after it. ### [Wildcards](#wildcards) Permission patterns use simple wildcard matching: `*` matches zero or more of any character\n\n- `?` matches exactly one character\n\n- All other characters match literally\n\n### [Home Directory Expansion](#home-directory-expansion)\n\nYou can use `~` or `$HOME` at the start of a pattern to reference your home directory. This is particularly useful for [`external_directory`](#external-directories) rules.\n\n- `~/projects/*` -> `/Users/username/projects/*`\n\n- `$HOME/projects/*` -> `/Users/username/projects/*`\n\n- `~` -> `/Users/username`\n\n### [External Directories](#external-directories)\n\nUse `external_directory` to allow tool calls that touch paths outside the working directory where OpenCode was started. This applies to any tool that takes a path as input (for example `read`, `edit`, `list`, `glob`, `grep`, and many `bash` commands).\n\nHome expansion (like `~/...`) only affects how a pattern is written. It does not make an external path part of the current workspace, so paths outside the working directory must still be allowed via `external_directory`.\n\nFor example, this allows access to everything under `~/projects/personal/`:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"permission\": {    \"external_directory\": {      \"~/projects/personal/**\": \"allow\"    }  }}\n```\n\nAny directory allowed here inherits the same defaults as the current workspace. Since [`read` defaults to `allow`](#defaults), reads are also allowed for entries under `external_directory` unless overridden. Add explicit rules when a tool should be restricted in these paths, such as blocking edits while keeping reads:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"permission\": {    \"external_directory\": {      \"~/projects/personal/**\": \"allow\"    },    \"edit\": {      \"~/projects/personal/**\": \"deny\"    }  }}\n```\n\nKeep the list focused on trusted paths, and layer extra allow or deny rules as needed for other tools (for example `bash`).\n\n## [Available Permissions](#available-permissions)\n\nOpenCode permissions are keyed by tool name, plus a couple of safety guards:\n\n- `read`  reading a file (matches the file path)\n\n- `edit`  all file modifications (covers `edit`, `write`, `patch`, `multiedit`)\n\n- `glob`  file globbing (matches the glob pattern)\n\n- `grep`  content search (matches the regex pattern)\n\n- `list`  listing files in a directory (matches the directory path)\n\n- `bash`  running shell commands (matches parsed commands like `git status --porcelain`)\n\n- `task`  launching subagents (matches the subagent type)\n\n- `skill`  loading a skill (matches the skill name)\n\n- `lsp`  running LSP queries (currently non-granular)\n\n- `todoread`, `todowrite`  reading/updating the todo list\n\n- `webfetch`  fetching a URL (matches the URL)\n\n- `websearch`, `codesearch`  web/code search (matches the query)\n\n- `external_directory`  triggered when a tool touches paths outside the project working directory\n\n- `doom_loop`  triggered when the same tool call repeats 3 times with identical input\n\n## [Defaults](#defaults)\n\nIf you dont specify anything, OpenCode starts from permissive defaults:\n\n- Most permissions default to `\"allow\"`.\n\n- `doom_loop` and `external_directory` default to `\"ask\"`.\n\n- `read` is `\"allow\"`, but `.env` files are denied by default:\n\nopencode.json\n\n```\n{  \"permission\": {    \"read\": {      \"*\": \"allow\",      \"*.env\": \"deny\",      \"*.env.*\": \"deny\",      \"*.env.example\": \"allow\"    }  }}\n```\n\n## [What Ask Does](#what-ask-does)\n\nWhen OpenCode prompts for approval, the UI offers three outcomes:\n\n- `once`  approve just this request\n\n- `always`  approve future requests matching the suggested patterns (for the rest of the current OpenCode session)\n\n- `reject`  deny the request\n\nThe set of patterns that `always` would approve is provided by the tool (for example, bash approvals typically whitelist a safe command prefix like `git status*`).\n\n## [Agents](#agents)\n\nYou can override permissions per agent. Agent permissions are merged with the global config, and agent rules take precedence. [Learn more](/docs/agents#permissions) about agent permissions.\n\nNote\n\nRefer to the [Granular Rules (Object Syntax)](#granular-rules-object-syntax) section above for more detailed pattern matching examples.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"permission\": {    \"bash\": {      \"*\": \"ask\",      \"git *\": \"allow\",      \"git commit *\": \"deny\",      \"git push *\": \"deny\",      \"grep *\": \"allow\"    }  },  \"agent\": {    \"build\": {      \"permission\": {        \"bash\": {          \"*\": \"ask\",          \"git *\": \"allow\",          \"git commit *\": \"ask\",          \"git push *\": \"deny\",          \"grep *\": \"allow\"        }      }    }  }}\n```\n\nYou can also configure agent permissions in Markdown:\n\n~/.config/opencode/agents/review.md\n\n```\n---description: Code review without editsmode: subagentpermission:  edit: deny  bash: ask  webfetch: deny---\nOnly analyze code and suggest changes.\n```\n\nTip\n\nUse pattern matching for commands with arguments. `\"grep *\"` allows `grep pattern file.txt`, while `\"grep\"` alone would block it. Commands like `git status` work for default behavior but require explicit permission (like `\"git status *\"`) when arguments are passed.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/permissions.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 174,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__plugins.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/plugins\n- Keywords: opencode, docs, ai coding assistant, cli, plugins\n- Summary: Write your own plugins to extend OpenCode.\n----\n\nSource: https://opencode.ai/docs/plugins\n\n# Plugins\n\nWrite your own plugins to extend OpenCode.\n\nPlugins allow you to extend OpenCode by hooking into various events and customizing behavior. You can create plugins to add new features, integrate with external services, or modify OpenCodes default behavior.\n\nFor examples, check out the [plugins](/docs/ecosystem#plugins) created by the community.\n\n## [Use a plugin](#use-a-plugin)\n\nThere are two ways to load plugins.\n\n### [From local files](#from-local-files)\n\nPlace JavaScript or TypeScript files in the plugin directory.\n\n- `.opencode/plugins/` - Project-level plugins\n\n- `~/.config/opencode/plugins/` - Global plugins\n\nFiles in these directories are automatically loaded at startup.\n\n### [From npm](#from-npm)\n\nSpecify npm packages in your config file.\n\n- opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"plugin\": [\"opencode-helicone-session\", \"opencode-wakatime\", \"@my-org/custom-plugin\"]} ``` Both regular and scoped npm packages are supported. Browse available plugins in the [ecosystem](/docs/ecosystem#plugins). ### [How plugins are installed](#how-plugins-are-installed) npm plugins are installed automatically using Bun at startup. Packages and their dependencies are cached in `~/.cache/opencode/node_modules/`. Local plugins are loaded directly from the plugin directory. To use external packages, you must create a `package.json` within your config directory (see [Dependencies](#dependencies)), or publish the plugin to npm and [add it to your config](/docs/config#plugins). ### [Load order](#load-order) Plugins are loaded from all sources and all hooks run in sequence. The load order is: Global config (`~/.config/opencode/opencode.json`)\n\n- Project config (`opencode.json`)\n\n- Global plugin directory (`~/.config/opencode/plugins/`)\n\n- Project plugin directory (`.opencode/plugins/`)\n\nDuplicate npm packages with the same name and version are loaded once. However, a local plugin and an npm plugin with similar names are both loaded separately.\n\n## [Create a plugin](#create-a-plugin)\n\nA plugin is a JavaScript/TypeScript module that exports one or more plugin\nfunctions. Each function receives a context object and returns a hooks object.\n\n### [Dependencies](#dependencies)\n\nLocal plugins and custom tools can use external npm packages. Add a `package.json` to your config directory with the dependencies you need.\n\n.opencode/package.json\n\n```\n{  \"dependencies\": {    \"shescape\": \"^2.1.0\"  }}\n```\n\nOpenCode runs `bun install` at startup to install these. Your plugins and tools can then import them.\n\n.opencode/plugins/my-plugin.ts\n\n```\nimport { escape } from \"shescape\"\nexport const MyPlugin = async (ctx) => {  return {    \"tool.execute.before\": async (input, output) => {      if (input.tool === \"bash\") {        output.args.command = escape(output.args.command)      }    },  }}\n```\n\n### [Basic structure](#basic-structure)\n\n.opencode/plugins/example.js\n\n```\nexport const MyPlugin = async ({ project, client, $, directory, worktree }) => {  console.log(\"Plugin initialized!\")\n  return {    // Hook implementations go here  }}\n```\n\nThe plugin function receives:\n\n- `project`: The current project information.\n\n- `directory`: The current working directory.\n\n- `worktree`: The git worktree path.\n\n- `client`: An opencode SDK client for interacting with the AI.\n\n- `$`: Buns [shell API](https://bun.com/docs/runtime/shell) for executing commands.\n\n### [TypeScript support](#typescript-support)\n\nFor TypeScript plugins, you can import types from the plugin package:\n\nmy-plugin.ts\n\n```\nimport type { Plugin } from \"@opencode-ai/plugin\"\nexport const MyPlugin: Plugin = async ({ project, client, $, directory, worktree }) => {  return {    // Type-safe hook implementations  }}\n```\n\n### [Events](#events)\n\nPlugins can subscribe to events as seen below in the Examples section. Here is a list of the different events available.\n\n#### [Command Events](#command-events)\n\n- `command.executed`\n\n#### [File Events](#file-events)\n\n- `file.edited`\n\n- `file.watcher.updated`\n\n#### [Installation Events](#installation-events)\n\n- `installation.updated`\n\n#### [LSP Events](#lsp-events)\n\n- `lsp.client.diagnostics`\n\n- `lsp.updated`\n\n#### [Message Events](#message-events)\n\n- `message.part.removed`\n\n- `message.part.updated`\n\n- `message.removed`\n\n- `message.updated`\n\n#### [Permission Events](#permission-events)\n\n- `permission.asked`\n\n- `permission.replied`\n\n#### [Server Events](#server-events)\n\n- `server.connected`\n\n#### [Session Events](#session-events)\n\n- `session.created`\n\n- `session.compacted`\n\n- `session.deleted`\n\n- `session.diff`\n\n- `session.error`\n\n- `session.idle`\n\n- `session.status`\n\n- `session.updated`\n\n#### [Todo Events](#todo-events)\n\n- `todo.updated`\n\n#### [Shell Events](#shell-events)\n\n- `shell.env`\n\n#### [Tool Events](#tool-events)\n\n- `tool.execute.after`\n\n- `tool.execute.before`\n\n#### [TUI Events](#tui-events)\n\n- `tui.prompt.append`\n\n- `tui.command.execute`\n\n- `tui.toast.show`\n\n## [Examples](#examples)\n\nHere are some examples of plugins you can use to extend opencode.\n\n### [Send notifications](#send-notifications)\n\nSend notifications when certain events occur:\n\n.opencode/plugins/notification.js\n\n```\nexport const NotificationPlugin = async ({ project, client, $, directory, worktree }) => {  return {    event: async ({ event }) => {      // Send notification on session completion      if (event.type === \"session.idle\") {        await $`osascript -e 'display notification \"Session completed!\" with title \"opencode\"'`      }    },  }}\n```\n\nWe are using `osascript` to run AppleScript on macOS. Here we are using it to send notifications.\n\nNote\n\nIf youre using the OpenCode desktop app, it can send system notifications automatically when a response is ready or when a session errors.\n\n### [.env protection](#env-protection)\n\nPrevent opencode from reading `.env` files:\n\n.opencode/plugins/env-protection.js\n\n```\nexport const EnvProtection = async ({ project, client, $, directory, worktree }) => {  return {    \"tool.execute.before\": async (input, output) => {      if (input.tool === \"read\" &#x26;&#x26; output.args.filePath.includes(\".env\")) {        throw new Error(\"Do not read .env files\")      }    },  }}\n```\n\n### [Inject environment variables](#inject-environment-variables)\n\nInject environment variables into all shell execution (AI tools and user terminals):\n\n.opencode/plugins/inject-env.js\n\n```\nexport const InjectEnvPlugin = async () => {  return {    \"shell.env\": async (input, output) => {      output.env.MY_API_KEY = \"secret\"      output.env.PROJECT_ROOT = input.cwd    },  }}\n```\n\n### [Custom tools](#custom-tools)\n\nPlugins can also add custom tools to opencode:\n\n.opencode/plugins/custom-tools.ts\n\n```\nimport { type Plugin, tool } from \"@opencode-ai/plugin\"\nexport const CustomToolsPlugin: Plugin = async (ctx) => {  return {    tool: {      mytool: tool({        description: \"This is a custom tool\",        args: {          foo: tool.schema.string(),        },        async execute(args, context) {          const { directory, worktree } = context          return `Hello ${args.foo} from ${directory} (worktree: ${worktree})`        },      }),    },  }}\n```\n\nThe `tool` helper creates a custom tool that opencode can call. It takes a Zod schema function and returns a tool definition with:\n\n- `description`: What the tool does\n\n- `args`: Zod schema for the tools arguments\n\n- `execute`: Function that runs when the tool is called\n\nYour custom tools will be available to opencode alongside built-in tools.\n\n### [Logging](#logging)\n\nUse `client.app.log()` instead of `console.log` for structured logging:\n\n.opencode/plugins/my-plugin.ts\n\n```\nexport const MyPlugin = async ({ client }) => {  await client.app.log({    body: {      service: \"my-plugin\",      level: \"info\",      message: \"Plugin initialized\",      extra: { foo: \"bar\" },    },  })}\n```\n\nLevels: `debug`, `info`, `warn`, `error`. See [SDK documentation](https://opencode.ai/docs/sdk) for details.\n\n### [Compaction hooks](#compaction-hooks)\n\nCustomize the context included when a session is compacted:\n\n.opencode/plugins/compaction.ts\n\n```\nimport type { Plugin } from \"@opencode-ai/plugin\"\nexport const CompactionPlugin: Plugin = async (ctx) => {  return {    \"experimental.session.compacting\": async (input, output) => {      // Inject additional context into the compaction prompt      output.context.push(`## Custom Context\nInclude any state that should persist across compaction:- Current task status- Important decisions made- Files being actively worked on`)    },  }}\n```\n\nThe `experimental.session.compacting` hook fires before the LLM generates a continuation summary. Use it to inject domain-specific context that the default compaction prompt would miss.\n\nYou can also replace the compaction prompt entirely by setting `output.prompt`:\n\n.opencode/plugins/custom-compaction.ts\n\n```\nimport type { Plugin } from \"@opencode-ai/plugin\"\nexport const CustomCompactionPlugin: Plugin = async (ctx) => {  return {    \"experimental.session.compacting\": async (input, output) => {      // Replace the entire compaction prompt      output.prompt = `You are generating a continuation prompt for a multi-agent swarm session.\nSummarize:1. The current task and its status2. Which files are being modified and by whom3. Any blockers or dependencies between agents4. The next steps to complete the work\nFormat as a structured prompt that a new agent can use to resume work.`    },  }}\n```\n\nWhen `output.prompt` is set, it completely replaces the default compaction prompt. The `output.context` array is ignored in this case.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/plugins.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 301,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__providers.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/providers\n- Keywords: opencode, docs, ai coding assistant, cli, providers\n- Summary: Using any LLM provider in OpenCode.\n----\n\nSource: https://opencode.ai/docs/providers\n\n# Providers\n\nUsing any LLM provider in OpenCode.\n\nOpenCode uses the [AI SDK](https://ai-sdk.dev/) and [Models.dev](https://models.dev) to support 75+ LLM providers and it supports running local models.\n\nTo add a provider you need to:\n\n- Add the API keys for the provider using the `/connect` command.\n\n- Configure the provider in your OpenCode config.\n\n### [Credentials](#credentials)\n\nWhen you add a providers API keys with the `/connect` command, they are stored\nin `~/.local/share/opencode/auth.json`.\n\n### [Config](#config)\n\nYou can customize the providers through the `provider` section in your OpenCode\nconfig.\n\n#### [Base URL](#base-url)\n\nYou can customize the base URL for any provider by setting the `baseURL` option. This is useful when using proxy services or custom endpoints.\n\n- opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"provider\": { \"anthropic\": { \"options\": { \"baseURL\": \"https://api.anthropic.com/v1\" } } }} ``` ## [OpenCode Zen](#opencode-zen) OpenCode Zen is a list of models provided by the OpenCode team that have been tested and verified to work well with OpenCode. [Learn more](/docs/zen). TipIf you are new, we recommend starting with OpenCode Zen. Run the `/connect` command in the TUI, select opencode, and head to [opencode.ai/auth](https://opencode.ai/auth). ``` /connect ```\n\n- Sign in, add your billing details, and copy your API key.\n\n- Paste your API key. ```  API key enter ```\n\n- Run `/models` in the TUI to see the list of models we recommend. ``` /models ```\n\nIt works like any other provider in OpenCode and is completely optional to use.\n\n## [Directory](#directory)\n\nLets look at some of the providers in detail. If youd like to add a provider to the\nlist, feel free to open a PR.\n\nNote\n\nDont see a provider here? Submit a PR.\n\n### [302.AI](#302ai)\n\n- Head over to the [302.AI console](https://302.ai/), create an account, and generate an API key.\n\n- Run the `/connect` command and search for 302.AI. ``` /connect ```\n\n- Enter your 302.AI API key. ```  API key enter ```\n\n- Run the `/models` command to select a model. ``` /models ```\n\n### [Amazon Bedrock](#amazon-bedrock)\n\nTo use Amazon Bedrock with OpenCode:\n\n- Head over to the Model catalog in the Amazon Bedrock console and request access to the models you want. TipYou need to have access to the model you want in Amazon Bedrock.\n\n- Configure authentication using one of the following methods: #### [Environment Variables (Quick Start)](#environment-variables-quick-start) Set one of these environment variables while running opencode: Terminal window ``` # Option 1: Using AWS access keysAWS_ACCESS_KEY_ID=XXX AWS_SECRET_ACCESS_KEY=YYY opencode # Option 2: Using named AWS profileAWS_PROFILE=my-profile opencode # Option 3: Using Bedrock bearer tokenAWS_BEARER_TOKEN_BEDROCK=XXX opencode ``` Or add them to your bash profile: ~/.bash_profile ``` export AWS_PROFILE=my-dev-profileexport AWS_REGION=us-east-1 ``` #### [Configuration File (Recommended)](#configuration-file-recommended) For project-specific or persistent configuration, use `opencode.json`: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"provider\": { \"amazon-bedrock\": { \"options\": { \"region\": \"us-east-1\", \"profile\": \"my-aws-profile\" } } }} ``` Available options: `region` - AWS region (e.g., `us-east-1`, `eu-west-1`)\n\n- `profile` - AWS named profile from `~/.aws/credentials`\n\n- `endpoint` - Custom endpoint URL for VPC endpoints (alias for generic `baseURL` option)\n\nTip\n\nConfiguration file options take precedence over environment variables.\n\n#### [Advanced: VPC Endpoints](#advanced-vpc-endpoints)\n\nIf youre using VPC endpoints for Bedrock:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"amazon-bedrock\": {      \"options\": {        \"region\": \"us-east-1\",        \"profile\": \"production\",        \"endpoint\": \"https://bedrock-runtime.us-east-1.vpce-xxxxx.amazonaws.com\"      }    }  }}\n```\n\nNote\n\nThe `endpoint` option is an alias for the generic `baseURL` option, using AWS-specific terminology. If both `endpoint` and `baseURL` are specified, `endpoint` takes precedence.\n\n#### [Authentication Methods](#authentication-methods)\n\n- `AWS_ACCESS_KEY_ID` / `AWS_SECRET_ACCESS_KEY`: Create an IAM user and generate access keys in the AWS Console\n\n- `AWS_PROFILE`: Use named profiles from `~/.aws/credentials`. First configure with `aws configure --profile my-profile` or `aws sso login`\n\n- `AWS_BEARER_TOKEN_BEDROCK`: Generate long-term API keys from the Amazon Bedrock console\n\n- `AWS_WEB_IDENTITY_TOKEN_FILE` / `AWS_ROLE_ARN`: For EKS IRSA (IAM Roles for Service Accounts) or other Kubernetes environments with OIDC federation. These environment variables are automatically injected by Kubernetes when using service account annotations.\n\n#### [Authentication Precedence](#authentication-precedence)\n\nAmazon Bedrock uses the following authentication priority:\n\n- Bearer Token - `AWS_BEARER_TOKEN_BEDROCK` environment variable or token from `/connect` command\n\n- AWS Credential Chain - Profile, access keys, shared credentials, IAM roles, Web Identity Tokens (EKS IRSA), instance metadata\n\nNote\n\nWhen a bearer token is set (via `/connect` or `AWS_BEARER_TOKEN_BEDROCK`), it takes precedence over all AWS credential methods including configured profiles.\n\n- Run the `/models` command to select the model you want. ``` /models ```\n\nNote\n\nFor custom inference profiles, use the model and provider name in the key and set the `id` property to the arn. This ensures correct caching:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"amazon-bedrock\": {      // ...      \"models\": {        \"anthropic-claude-sonnet-4.5\": {          \"id\": \"arn:aws:bedrock:us-east-1:xxx:application-inference-profile/yyy\"        }      }    }  }}\n```\n\n### [Anthropic](#anthropic)\n\n- Once youve signed up, run the `/connect` command and select Anthropic. ``` /connect ```\n\n- Here you can select the Claude Pro/Max option and itll open your browser and ask you to authenticate. ```  Select auth method Claude Pro/Max Create an API Key Manually enter API Key ```\n\n- Now all the Anthropic models should be available when you use the `/models` command. ``` /models ```\n\nUsing your Claude Pro/Max subscription in OpenCode is not officially supported by [Anthropic](https://anthropic.com).\n\n##### [Using API keys](#using-api-keys)\n\nYou can also select Create an API Key if you dont have a Pro/Max subscription. Itll also open your browser and ask you to login to Anthropic and give you a code you can paste in your terminal.\n\nOr if you already have an API key, you can select Manually enter API Key and paste it in your terminal.\n\n### [Azure OpenAI](#azure-openai)\n\nNote\n\nIf you encounter Im sorry, but I cannot assist with that request errors, try changing the content filter from DefaultV2 to Default in your Azure resource.\n\n- Head over to the [Azure portal](https://portal.azure.com/) and create an Azure OpenAI resource. Youll need: Resource name: This becomes part of your API endpoint (`https://RESOURCE_NAME.openai.azure.com/`)\n\n- API key: Either `KEY 1` or `KEY 2` from your resource\n\n- Go to [Azure AI Foundry](https://ai.azure.com/) and deploy a model. NoteThe deployment name must match the model name for opencode to work properly.\n\n- Run the `/connect` command and search for Azure. ``` /connect ```\n\n- Enter your API key. ```  API key enter ```\n\n- Set your resource name as an environment variable: Terminal window ``` AZURE_RESOURCE_NAME=XXX opencode ``` Or add it to your bash profile: ~/.bash_profile ``` export AZURE_RESOURCE_NAME=XXX ```\n\n- Run the `/models` command to select your deployed model. ``` /models ```\n\n### [Azure Cognitive Services](#azure-cognitive-services)\n\n- Head over to the [Azure portal](https://portal.azure.com/) and create an Azure OpenAI resource. Youll need: Resource name: This becomes part of your API endpoint (`https://AZURE_COGNITIVE_SERVICES_RESOURCE_NAME.cognitiveservices.azure.com/`)\n\n- API key: Either `KEY 1` or `KEY 2` from your resource\n\n- Go to [Azure AI Foundry](https://ai.azure.com/) and deploy a model. NoteThe deployment name must match the model name for opencode to work properly.\n\n- Run the `/connect` command and search for Azure Cognitive Services. ``` /connect ```\n\n- Enter your API key. ```  API key enter ```\n\n- Set your resource name as an environment variable: Terminal window ``` AZURE_COGNITIVE_SERVICES_RESOURCE_NAME=XXX opencode ``` Or add it to your bash profile: ~/.bash_profile ``` export AZURE_COGNITIVE_SERVICES_RESOURCE_NAME=XXX ```\n\n- Run the `/models` command to select your deployed model. ``` /models ```\n\n### [Baseten](#baseten)\n\n- Head over to the [Baseten](https://app.baseten.co/), create an account, and generate an API key.\n\n- Run the `/connect` command and search for Baseten. ``` /connect ```\n\n- Enter your Baseten API key. ```  API key enter ```\n\n- Run the `/models` command to select a model. ``` /models ```\n\n### [Cerebras](#cerebras)\n\n- Head over to the [Cerebras console](https://inference.cerebras.ai/), create an account, and generate an API key.\n\n- Run the `/connect` command and search for Cerebras. ``` /connect ```\n\n- Enter your Cerebras API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like Qwen 3 Coder 480B. ``` /models ```\n\n### [Cloudflare AI Gateway](#cloudflare-ai-gateway)\n\nCloudflare AI Gateway lets you access models from OpenAI, Anthropic, Workers AI, and more through a unified endpoint. With [Unified Billing](https://developers.cloudflare.com/ai-gateway/features/unified-billing/) you dont need separate API keys for each provider.\n\n- Head over to the [Cloudflare dashboard](https://dash.cloudflare.com/), navigate to AI > AI Gateway, and create a new gateway.\n\n- Set your Account ID and Gateway ID as environment variables. ~/.bash_profile ``` export CLOUDFLARE_ACCOUNT_ID=your-32-character-account-idexport CLOUDFLARE_GATEWAY_ID=your-gateway-id ```\n\n- Run the `/connect` command and search for Cloudflare AI Gateway. ``` /connect ```\n\n- Enter your Cloudflare API token. ```  API key enter ``` Or set it as an environment variable. ~/.bash_profile ``` export CLOUDFLARE_API_TOKEN=your-api-token ```\n\n- Run the `/models` command to select a model. ``` /models ``` You can also add models through your opencode config. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"provider\": { \"cloudflare-ai-gateway\": { \"models\": { \"openai/gpt-4o\": {}, \"anthropic/claude-sonnet-4\": {} } } }} ```\n\n### [Cortecs](#cortecs)\n\n- Head over to the [Cortecs console](https://cortecs.ai/), create an account, and generate an API key.\n\n- Run the `/connect` command and search for Cortecs. ``` /connect ```\n\n- Enter your Cortecs API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like Kimi K2 Instruct. ``` /models ```\n\n### [DeepSeek](#deepseek)\n\n- Head over to the [DeepSeek console](https://platform.deepseek.com/), create an account, and click Create new API key.\n\n- Run the `/connect` command and search for DeepSeek. ``` /connect ```\n\n- Enter your DeepSeek API key. ```  API key enter ```\n\n- Run the `/models` command to select a DeepSeek model like DeepSeek Reasoner. ``` /models ```\n\n### [Deep Infra](#deep-infra)\n\n- Head over to the [Deep Infra dashboard](https://deepinfra.com/dash), create an account, and generate an API key.\n\n- Run the `/connect` command and search for Deep Infra. ``` /connect ```\n\n- Enter your Deep Infra API key. ```  API key enter ```\n\n- Run the `/models` command to select a model. ``` /models ```\n\n### [Firmware](#firmware)\n\n- Head over to the [Firmware dashboard](https://app.firmware.ai/signup), create an account, and generate an API key.\n\n- Run the `/connect` command and search for Firmware. ``` /connect ```\n\n- Enter your Firmware API key. ```  API key enter ```\n\n- Run the `/models` command to select a model. ``` /models ```\n\n### [Fireworks AI](#fireworks-ai)\n\n- Head over to the [Fireworks AI console](https://app.fireworks.ai/), create an account, and click Create API Key.\n\n- Run the `/connect` command and search for Fireworks AI. ``` /connect ```\n\n- Enter your Fireworks AI API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like Kimi K2 Instruct. ``` /models ```\n\n### [GitLab Duo](#gitlab-duo)\n\nGitLab Duo provides AI-powered agentic chat with native tool calling capabilities through GitLabs Anthropic proxy.\n\n- Run the `/connect` command and select GitLab. ``` /connect ```\n\n- Choose your authentication method: ```  Select auth method OAuth (Recommended) Personal Access Token ``` #### [Using OAuth (Recommended)](#using-oauth-recommended) Select OAuth and your browser will open for authorization. #### [Using Personal Access Token](#using-personal-access-token) Go to [GitLab User Settings > Access Tokens](https://gitlab.com/-/user_settings/personal_access_tokens)\n\n- Click Add new token\n\n- Name: `OpenCode`, Scopes: `api`\n\n- Copy the token (starts with `glpat-`)\n\n- Enter it in the terminal\n\n- Run the `/models` command to see available models. ``` /models ``` Three Claude-based models are available: duo-chat-haiku-4-5 (Default) - Fast responses for quick tasks\n\n- duo-chat-sonnet-4-5 - Balanced performance for most workflows\n\n- duo-chat-opus-4-5 - Most capable for complex analysis\n\nNote\n\nYou can also specify GITLAB_TOKEN environment variable if you dont want\nto store token in opencode auth storage.\n\n##### [Self-Hosted GitLab](#self-hosted-gitlab)\n\ncompliance note\n\nOpenCode uses a small model for some AI tasks like generating the session title.\nIt is configured to use gpt-5-nano by default, hosted by Zen. To lock OpenCode\nto only use your own GitLab-hosted instance, add the following to your\n`opencode.json` file. It is also recommended to disable session sharing.\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"small_model\": \"gitlab/duo-chat-haiku-4-5\",  \"share\": \"disabled\"}\n```\n\nFor self-hosted GitLab instances:\n\nTerminal window\n\n```\nexport GITLAB_INSTANCE_URL=https://gitlab.company.comexport GITLAB_TOKEN=glpat-...\n```\n\nIf your instance runs a custom AI Gateway:\n\nTerminal window\n\n```\nGITLAB_AI_GATEWAY_URL=https://ai-gateway.company.com\n```\n\nOr add to your bash profile:\n\n~/.bash_profile\n\n```\nexport GITLAB_INSTANCE_URL=https://gitlab.company.comexport GITLAB_AI_GATEWAY_URL=https://ai-gateway.company.comexport GITLAB_TOKEN=glpat-...\n```\n\nNote\n\nYour GitLab administrator must enable the following:\n\n- [Duo Agent Platform](https://docs.gitlab.com/user/gitlab_duo/turn_on_off/) for the user, group, or instance\n\n- Feature flags (via Rails console): `agent_platform_claude_code`\n\n- `third_party_agents_enabled`\n\n##### [OAuth for Self-Hosted instances](#oauth-for-self-hosted-instances)\n\nIn order to make Oauth working for your self-hosted instance, you need to create\na new application (Settings  Applications) with the\ncallback URL `http://127.0.0.1:8080/callback` and following scopes:\n\n- api (Access the API on your behalf)\n\n- read_user (Read your personal information)\n\n- read_repository (Allows read-only access to the repository)\n\nThen expose application ID as environment variable:\n\nTerminal window\n\n```\nexport GITLAB_OAUTH_CLIENT_ID=your_application_id_here\n```\n\nMore documentation on [opencode-gitlab-auth](https://www.npmjs.com/package/@gitlab/opencode-gitlab-auth) homepage.\n\n##### [Configuration](#configuration)\n\nCustomize through `opencode.json`:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"gitlab\": {      \"options\": {        \"instanceUrl\": \"https://gitlab.com\",        \"featureFlags\": {          \"duo_agent_platform_agentic_chat\": true,          \"duo_agent_platform\": true        }      }    }  }}\n```\n\n##### [GitLab API Tools (Optional, but highly recommended)](#gitlab-api-tools-optional-but-highly-recommended)\n\nTo access GitLab tools (merge requests, issues, pipelines, CI/CD, etc.):\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"plugin\": [\"@gitlab/opencode-gitlab-plugin\"]}\n```\n\nThis plugin provides comprehensive GitLab repository management capabilities including MR reviews, issue tracking, pipeline monitoring, and more.\n\n### [GitHub Copilot](#github-copilot)\n\nTo use your GitHub Copilot subscription with opencode:\n\nNote\n\nSome models might need a [Pro+ subscription](https://github.com/features/copilot/plans) to use.\n\n- Run the `/connect` command and search for GitHub Copilot. ``` /connect ```\n\n- Navigate to [github.com/login/device](https://github.com/login/device) and enter the code. ```  Login with GitHub Copilot https://github.com/login/device Enter code: 8F43-6FCF Waiting for authorization... ```\n\n- Now run the `/models` command to select the model you want. ``` /models ```\n\n### [Google Vertex AI](#google-vertex-ai)\n\nTo use Google Vertex AI with OpenCode:\n\n- Head over to the Model Garden in the Google Cloud Console and check the models available in your region. NoteYou need to have a Google Cloud project with Vertex AI API enabled.\n\n- Set the required environment variables: `GOOGLE_CLOUD_PROJECT`: Your Google Cloud project ID\n\n- `VERTEX_LOCATION` (optional): The region for Vertex AI (defaults to `global`)\n\n- Authentication (choose one): `GOOGLE_APPLICATION_CREDENTIALS`: Path to your service account JSON key file\n\n- Authenticate using gcloud CLI: `gcloud auth application-default login`\n\nSet them while running opencode.\n\nTerminal window\n\n```\nGOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json GOOGLE_CLOUD_PROJECT=your-project-id opencode\n```\n\nOr add them to your bash profile.\n\n~/.bash_profile\n\n```\nexport GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.jsonexport GOOGLE_CLOUD_PROJECT=your-project-idexport VERTEX_LOCATION=global\n```\n\nTip\n\nThe `global` region improves availability and reduces errors at no extra cost. Use regional endpoints (e.g., `us-central1`) for data residency requirements. [Learn more](https://cloud.google.com/vertex-ai/generative-ai/docs/partner-models/use-partner-models#regional_and_global_endpoints)\n\n- Run the `/models` command to select the model you want. ``` /models ```\n\n### [Groq](#groq)\n\n- Head over to the [Groq console](https://console.groq.com/), click Create API Key, and copy the key.\n\n- Run the `/connect` command and search for Groq. ``` /connect ```\n\n- Enter the API key for the provider. ```  API key enter ```\n\n- Run the `/models` command to select the one you want. ``` /models ```\n\n### [Hugging Face](#hugging-face)\n\n[Hugging Face Inference Providers](https://huggingface.co/docs/inference-providers) provides access to open models supported by 17+ providers.\n\n- Head over to [Hugging Face settings](https://huggingface.co/settings/tokens/new?ownUserPermissions=inference.serverless.write&#x26;tokenType=fineGrained) to create a token with permission to make calls to Inference Providers.\n\n- Run the `/connect` command and search for Hugging Face. ``` /connect ```\n\n- Enter your Hugging Face token. ```  API key enter ```\n\n- Run the `/models` command to select a model like Kimi-K2-Instruct or GLM-4.6. ``` /models ```\n\n### [Helicone](#helicone)\n\n[Helicone](https://helicone.ai) is an LLM observability platform that provides logging, monitoring, and analytics for your AI applications. The Helicone AI Gateway routes your requests to the appropriate provider automatically based on the model.\n\n- Head over to [Helicone](https://helicone.ai), create an account, and generate an API key from your dashboard.\n\n- Run the `/connect` command and search for Helicone. ``` /connect ```\n\n- Enter your Helicone API key. ```  API key enter ```\n\n- Run the `/models` command to select a model. ``` /models ```\n\nFor more providers and advanced features like caching and rate limiting, check the [Helicone documentation](https://docs.helicone.ai).\n\n#### [Optional Configs](#optional-configs)\n\nIn the event you see a feature or model from Helicone that isnt configured automatically through opencode, you can always configure it yourself.\n\nHeres [Helicones Model Directory](https://helicone.ai/models), youll need this to grab the IDs of the models you want to add.\n\n~/.config/opencode/opencode.jsonc\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"helicone\": {      \"npm\": \"@ai-sdk/openai-compatible\",      \"name\": \"Helicone\",      \"options\": {        \"baseURL\": \"https://ai-gateway.helicone.ai\",      },      \"models\": {        \"gpt-4o\": {          // Model ID (from Helicone's model directory page)          \"name\": \"GPT-4o\", // Your own custom name for the model        },        \"claude-sonnet-4-20250514\": {          \"name\": \"Claude Sonnet 4\",        },      },    },  },}\n```\n\n#### [Custom Headers](#custom-headers)\n\nHelicone supports custom headers for features like caching, user tracking, and session management. Add them to your provider config using `options.headers`:\n\n~/.config/opencode/opencode.jsonc\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"helicone\": {      \"npm\": \"@ai-sdk/openai-compatible\",      \"name\": \"Helicone\",      \"options\": {        \"baseURL\": \"https://ai-gateway.helicone.ai\",        \"headers\": {          \"Helicone-Cache-Enabled\": \"true\",          \"Helicone-User-Id\": \"opencode\",        },      },    },  },}\n```\n\n##### [Session tracking](#session-tracking)\n\nHelicones [Sessions](https://docs.helicone.ai/features/sessions) feature lets you group related LLM requests together. Use the [opencode-helicone-session](https://github.com/H2Shami/opencode-helicone-session) plugin to automatically log each OpenCode conversation as a session in Helicone.\n\nTerminal window\n\n```\nnpm install -g opencode-helicone-session\n```\n\nAdd it to your config.\n\nopencode.json\n\n```\n{  \"plugin\": [\"opencode-helicone-session\"]}\n```\n\nThe plugin injects `Helicone-Session-Id` and `Helicone-Session-Name` headers into your requests. In Helicones Sessions page, youll see each OpenCode conversation listed as a separate session.\n\n##### [Common Helicone headers](#common-helicone-headers)\n\nHeader Description\n\n`Helicone-Cache-Enabled` Enable response caching (`true`/`false`)\n\n`Helicone-User-Id` Track metrics by user\n\n`Helicone-Property-[Name]` Add custom properties (e.g., `Helicone-Property-Environment`)\n\n`Helicone-Prompt-Id` Associate requests with prompt versions\n\nSee the [Helicone Header Directory](https://docs.helicone.ai/helicone-headers/header-directory) for all available headers.\n\n### [llama.cpp](#llamacpp)\n\nYou can configure opencode to use local models through [llama.cpps](https://github.com/ggml-org/llama.cpp) llama-server utility\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"llama.cpp\": {      \"npm\": \"@ai-sdk/openai-compatible\",      \"name\": \"llama-server (local)\",      \"options\": {        \"baseURL\": \"http://127.0.0.1:8080/v1\"      },      \"models\": {        \"qwen3-coder:a3b\": {          \"name\": \"Qwen3-Coder: a3b-30b (local)\",          \"limit\": {            \"context\": 128000,            \"output\": 65536          }        }      }    }  }}\n```\n\nIn this example:\n\n- `llama.cpp` is the custom provider ID. This can be any string you want.\n\n- `npm` specifies the package to use for this provider. Here, `@ai-sdk/openai-compatible` is used for any OpenAI-compatible API.\n\n- `name` is the display name for the provider in the UI.\n\n- `options.baseURL` is the endpoint for the local server.\n\n- `models` is a map of model IDs to their configurations. The model name will be displayed in the model selection list.\n\n### [IO.NET](#ionet)\n\nIO.NET offers 17 models optimized for various use cases:\n\n- Head over to the [IO.NET console](https://ai.io.net/), create an account, and generate an API key.\n\n- Run the `/connect` command and search for IO.NET. ``` /connect ```\n\n- Enter your IO.NET API key. ```  API key enter ```\n\n- Run the `/models` command to select a model. ``` /models ```\n\n### [LM Studio](#lm-studio)\n\nYou can configure opencode to use local models through LM Studio.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"lmstudio\": {      \"npm\": \"@ai-sdk/openai-compatible\",      \"name\": \"LM Studio (local)\",      \"options\": {        \"baseURL\": \"http://127.0.0.1:1234/v1\"      },      \"models\": {        \"google/gemma-3n-e4b\": {          \"name\": \"Gemma 3n-e4b (local)\"        }      }    }  }}\n```\n\nIn this example:\n\n- `lmstudio` is the custom provider ID. This can be any string you want.\n\n- `npm` specifies the package to use for this provider. Here, `@ai-sdk/openai-compatible` is used for any OpenAI-compatible API.\n\n- `name` is the display name for the provider in the UI.\n\n- `options.baseURL` is the endpoint for the local server.\n\n- `models` is a map of model IDs to their configurations. The model name will be displayed in the model selection list.\n\n### [Moonshot AI](#moonshot-ai)\n\nTo use Kimi K2 from Moonshot AI:\n\n- Head over to the [Moonshot AI console](https://platform.moonshot.ai/console), create an account, and click Create API key.\n\n- Run the `/connect` command and search for Moonshot AI. ``` /connect ```\n\n- Enter your Moonshot API key. ```  API key enter ```\n\n- Run the `/models` command to select Kimi K2. ``` /models ```\n\n### [MiniMax](#minimax)\n\n- Head over to the [MiniMax API Console](https://platform.minimax.io/login), create an account, and generate an API key.\n\n- Run the `/connect` command and search for MiniMax. ``` /connect ```\n\n- Enter your MiniMax API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like M2.1. ``` /models ```\n\n### [Nebius Token Factory](#nebius-token-factory)\n\n- Head over to the [Nebius Token Factory console](https://tokenfactory.nebius.com/), create an account, and click Add Key.\n\n- Run the `/connect` command and search for Nebius Token Factory. ``` /connect ```\n\n- Enter your Nebius Token Factory API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like Kimi K2 Instruct. ``` /models ```\n\n### [Ollama](#ollama)\n\nYou can configure opencode to use local models through Ollama.\n\nTip\n\nOllama can automatically configure itself for OpenCode. See the [Ollama integration docs](https://docs.ollama.com/integrations/opencode) for details.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"ollama\": {      \"npm\": \"@ai-sdk/openai-compatible\",      \"name\": \"Ollama (local)\",      \"options\": {        \"baseURL\": \"http://localhost:11434/v1\"      },      \"models\": {        \"llama2\": {          \"name\": \"Llama 2\"        }      }    }  }}\n```\n\nIn this example:\n\n- `ollama` is the custom provider ID. This can be any string you want.\n\n- `npm` specifies the package to use for this provider. Here, `@ai-sdk/openai-compatible` is used for any OpenAI-compatible API.\n\n- `name` is the display name for the provider in the UI.\n\n- `options.baseURL` is the endpoint for the local server.\n\n- `models` is a map of model IDs to their configurations. The model name will be displayed in the model selection list.\n\nTip\n\nIf tool calls arent working, try increasing `num_ctx` in Ollama. Start around 16k - 32k.\n\n### [Ollama Cloud](#ollama-cloud)\n\nTo use Ollama Cloud with OpenCode:\n\n- Head over to [https://ollama.com/](https://ollama.com/) and sign in or create an account.\n\n- Navigate to Settings > Keys and click Add API Key to generate a new API key.\n\n- Copy the API key for use in OpenCode.\n\n- Run the `/connect` command and search for Ollama Cloud. ``` /connect ```\n\n- Enter your Ollama Cloud API key. ```  API key enter ```\n\n- Important: Before using cloud models in OpenCode, you must pull the model information locally: Terminal window ``` ollama pull gpt-oss:20b-cloud ```\n\n- Run the `/models` command to select your Ollama Cloud model. ``` /models ```\n\n### [OpenAI](#openai)\n\nWe recommend signing up for [ChatGPT Plus or Pro](https://chatgpt.com/pricing).\n\n- Once youve signed up, run the `/connect` command and select OpenAI. ``` /connect ```\n\n- Here you can select the ChatGPT Plus/Pro option and itll open your browser and ask you to authenticate. ```  Select auth method ChatGPT Plus/Pro Manually enter API Key ```\n\n- Now all the OpenAI models should be available when you use the `/models` command. ``` /models ```\n\n##### [Using API keys](#using-api-keys-1)\n\nIf you already have an API key, you can select Manually enter API Key and paste it in your terminal.\n\n### [OpenCode Zen](#opencode-zen-1)\n\nOpenCode Zen is a list of tested and verified models provided by the OpenCode team. [Learn more](/docs/zen).\n\n- Sign in to [OpenCode Zen](https://opencode.ai/auth) and click Create API Key.\n\n- Run the `/connect` command and search for OpenCode Zen. ``` /connect ```\n\n- Enter your OpenCode API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like Qwen 3 Coder 480B. ``` /models ```\n\n### [OpenRouter](#openrouter)\n\n- Head over to the [OpenRouter dashboard](https://openrouter.ai/settings/keys), click Create API Key, and copy the key.\n\n- Run the `/connect` command and search for OpenRouter. ``` /connect ```\n\n- Enter the API key for the provider. ```  API key enter ```\n\n- Many OpenRouter models are preloaded by default, run the `/models` command to select the one you want. ``` /models ``` You can also add additional models through your opencode config. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"provider\": { \"openrouter\": { \"models\": { \"somecoolnewmodel\": {} } } }} ```\n\n- You can also customize them through your opencode config. Heres an example of specifying a provider opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"provider\": { \"openrouter\": { \"models\": { \"moonshotai/kimi-k2\": { \"options\": { \"provider\": { \"order\": [\"baseten\"], \"allow_fallbacks\": false } } } } } }} ```\n\n### [SAP AI Core](#sap-ai-core)\n\nSAP AI Core provides access to 40+ models from OpenAI, Anthropic, Google, Amazon, Meta, Mistral, and AI21 through a unified platform.\n\n- Go to your [SAP BTP Cockpit](https://account.hana.ondemand.com/), navigate to your SAP AI Core service instance, and create a service key. TipThe service key is a JSON object containing `clientid`, `clientsecret`, `url`, and `serviceurls.AI_API_URL`. You can find your AI Core instance under Services > Instances and Subscriptions in the BTP Cockpit.\n\n- Run the `/connect` command and search for SAP AI Core. ``` /connect ```\n\n- Enter your service key JSON. ```  Service key enter ``` Or set the `AICORE_SERVICE_KEY` environment variable: Terminal window ``` AICORE_SERVICE_KEY='{\"clientid\":\"...\",\"clientsecret\":\"...\",\"url\":\"...\",\"serviceurls\":{\"AI_API_URL\":\"...\"}}' opencode ``` Or add it to your bash profile: ~/.bash_profile ``` export AICORE_SERVICE_KEY='{\"clientid\":\"...\",\"clientsecret\":\"...\",\"url\":\"...\",\"serviceurls\":{\"AI_API_URL\":\"...\"}}' ```\n\n- Optionally set deployment ID and resource group: Terminal window ``` AICORE_DEPLOYMENT_ID=your-deployment-id AICORE_RESOURCE_GROUP=your-resource-group opencode ``` NoteThese settings are optional and should be configured according to your SAP AI Core setup.\n\n- Run the `/models` command to select from 40+ available models. ``` /models ```\n\n### [STACKIT](#stackit)\n\nSTACKIT AI Model Serving provides fully managed soverign hosting environment for AI models, focusing on LLMs like Llama, Mistral, and Qwen, with maximum data sovereignty on European infrastructure.\n\n- Head over to [STACKIT Portal](https://portal.stackit.cloud), navigate to AI Model Serving, and create an auth token for your project. TipYou need a STACKIT customer account, user account, and project before creating auth tokens.\n\n- Run the `/connect` command and search for STACKIT. ``` /connect ```\n\n- Enter your STACKIT AI Model Serving auth token. ```  API key enter ```\n\n- Run the `/models` command to select from available models like Qwen3-VL 235B or Llama 3.3 70B. ``` /models ```\n\n### [OVHcloud AI Endpoints](#ovhcloud-ai-endpoints)\n\n- Head over to the [OVHcloud panel](https://ovh.com/manager). Navigate to the `Public Cloud` section, `AI &#x26; Machine Learning` > `AI Endpoints` and in `API Keys` tab, click Create a new API key.\n\n- Run the `/connect` command and search for OVHcloud AI Endpoints. ``` /connect ```\n\n- Enter your OVHcloud AI Endpoints API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like gpt-oss-120b. ``` /models ```\n\n### [Scaleway](#scaleway)\n\nTo use [Scaleway Generative APIs](https://www.scaleway.com/en/docs/generative-apis/) with Opencode:\n\n- Head over to the [Scaleway Console IAM settings](https://console.scaleway.com/iam/api-keys) to generate a new API key.\n\n- Run the `/connect` command and search for Scaleway. ``` /connect ```\n\n- Enter your Scaleway API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like devstral-2-123b-instruct-2512 or gpt-oss-120b. ``` /models ```\n\n### [Together AI](#together-ai)\n\n- Head over to the [Together AI console](https://api.together.ai), create an account, and click Add Key.\n\n- Run the `/connect` command and search for Together AI. ``` /connect ```\n\n- Enter your Together AI API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like Kimi K2 Instruct. ``` /models ```\n\n### [Venice AI](#venice-ai)\n\n- Head over to the [Venice AI console](https://venice.ai), create an account, and generate an API key.\n\n- Run the `/connect` command and search for Venice AI. ``` /connect ```\n\n- Enter your Venice AI API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like Llama 3.3 70B. ``` /models ```\n\n### [Vercel AI Gateway](#vercel-ai-gateway)\n\nVercel AI Gateway lets you access models from OpenAI, Anthropic, Google, xAI, and more through a unified endpoint. Models are offered at list price with no markup.\n\n- Head over to the [Vercel dashboard](https://vercel.com/), navigate to the AI Gateway tab, and click API keys to create a new API key.\n\n- Run the `/connect` command and search for Vercel AI Gateway. ``` /connect ```\n\n- Enter your Vercel AI Gateway API key. ```  API key enter ```\n\n- Run the `/models` command to select a model. ``` /models ```\n\nYou can also customize models through your opencode config. Heres an example of specifying provider routing order.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"vercel\": {      \"models\": {        \"anthropic/claude-sonnet-4\": {          \"options\": {            \"order\": [\"anthropic\", \"vertex\"]          }        }      }    }  }}\n```\n\nSome useful routing options:\n\nOption Description\n\n`order` Provider sequence to try\n\n`only` Restrict to specific providers\n\n`zeroDataRetention` Only use providers with zero data retention policies\n\n### [xAI](#xai)\n\n- Head over to the [xAI console](https://console.x.ai/), create an account, and generate an API key.\n\n- Run the `/connect` command and search for xAI. ``` /connect ```\n\n- Enter your xAI API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like Grok Beta. ``` /models ```\n\n### [Z.AI](#zai)\n\n- Head over to the [Z.AI API console](https://z.ai/manage-apikey/apikey-list), create an account, and click Create a new API key.\n\n- Run the `/connect` command and search for Z.AI. ``` /connect ``` If you are subscribed to the GLM Coding Plan, select Z.AI Coding Plan.\n\n- Enter your Z.AI API key. ```  API key enter ```\n\n- Run the `/models` command to select a model like GLM-4.7. ``` /models ```\n\n### [ZenMux](#zenmux)\n\n- Head over to the [ZenMux dashboard](https://zenmux.ai/settings/keys), click Create API Key, and copy the key.\n\n- Run the `/connect` command and search for ZenMux. ``` /connect ```\n\n- Enter the API key for the provider. ```  API key enter ```\n\n- Many ZenMux models are preloaded by default, run the `/models` command to select the one you want. ``` /models ``` You can also add additional models through your opencode config. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"provider\": { \"zenmux\": { \"models\": { \"somecoolnewmodel\": {} } } }} ```\n\n## [Custom provider](#custom-provider)\n\nTo add any OpenAI-compatible provider thats not listed in the `/connect` command:\n\nTip\n\nYou can use any OpenAI-compatible provider with opencode. Most modern AI providers offer OpenAI-compatible APIs.\n\n- Run the `/connect` command and scroll down to Other. Terminal window ``` $ /connect  Add credential Select provider ...  Other ```\n\n- Enter a unique ID for the provider. Terminal window ``` $ /connect  Add credential Enter provider id myprovider ``` NoteChoose a memorable ID, youll use this in your config file.\n\n- Enter your API key for the provider. Terminal window ``` $ /connect  Add credential This only stores a credential for myprovider - you will need to configure it in opencode.json, check the docs for examples. Enter your API key sk-... ```\n\n- Create or update your `opencode.json` file in your project directory: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"provider\": { \"myprovider\": { \"npm\": \"@ai-sdk/openai-compatible\", \"name\": \"My AI ProviderDisplay Name\", \"options\": { \"baseURL\": \"https://api.myprovider.com/v1\" }, \"models\": { \"my-model-name\": { \"name\": \"My Model Display Name\" } } } }} ``` Here are the configuration options: npm: AI SDK package to use, `@ai-sdk/openai-compatible` for OpenAI-compatible providers\n\n- name: Display name in UI.\n\n- models: Available models.\n\n- options.baseURL: API endpoint URL.\n\n- options.apiKey: Optionally set the API key, if not using auth.\n\n- options.headers: Optionally set custom headers.\n\nMore on the advanced options in the example below.\n\n- Run the `/models` command and your custom provider and models will appear in the selection list.\n\n##### [Example](#example)\n\nHeres an example setting the `apiKey`, `headers`, and model `limit` options.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"provider\": {    \"myprovider\": {      \"npm\": \"@ai-sdk/openai-compatible\",      \"name\": \"My AI ProviderDisplay Name\",      \"options\": {        \"baseURL\": \"https://api.myprovider.com/v1\",        \"apiKey\": \"{env:ANTHROPIC_API_KEY}\",        \"headers\": {          \"Authorization\": \"Bearer custom-token\"        }      },      \"models\": {        \"my-model-name\": {          \"name\": \"My Model Display Name\",          \"limit\": {            \"context\": 200000,            \"output\": 65536          }        }      }    }  }}\n```\n\nConfiguration details:\n\n- apiKey: Set using `env` variable syntax, [learn more](/docs/config#env-vars).\n\n- headers: Custom headers sent with each request.\n\n- limit.context: Maximum input tokens the model accepts.\n\n- limit.output: Maximum tokens the model can generate.\n\nThe `limit` fields allow OpenCode to understand how much context you have left. Standard providers pull these from models.dev automatically.\n\n## [Troubleshooting](#troubleshooting)\n\nIf you are having trouble with configuring a provider, check the following:\n\n- Check the auth setup: Run `opencode auth list` to see if the credentials for the provider are added to your config. This doesnt apply to providers like Amazon Bedrock, that rely on environment variables for their auth.\n\n- For custom providers, check the opencode config and: Make sure the provider ID used in the `/connect` command matches the ID in your opencode config.\n\n- The right npm package is used for the provider. For example, use `@ai-sdk/cerebras` for Cerebras. And for all other OpenAI-compatible providers, use `@ai-sdk/openai-compatible`.\n\n- Check correct API endpoint is used in the `options.baseURL` field.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/providers.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 906,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__rules.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/rules\n- Keywords: opencode, docs, ai coding assistant, cli, rules\n- Summary: Set custom instructions for opencode.\n----\n\nSource: https://opencode.ai/docs/rules\n\n# Rules\n\nSet custom instructions for opencode.\n\nYou can provide custom instructions to opencode by creating an `AGENTS.md` file. This is similar to Cursors rules. It contains instructions that will be included in the LLMs context to customize its behavior for your specific project.\n\n## [Initialize](#initialize)\n\nTo create a new `AGENTS.md` file, you can run the `/init` command in opencode.\n\nTip\n\nYou should commit your projects `AGENTS.md` file to Git.\n\nThis will scan your project and all its contents to understand what the project is about and generate an `AGENTS.md` file with it. This helps opencode to navigate the project better.\n\nIf you have an existing `AGENTS.md` file, this will try to add to it.\n\n## [Example](#example)\n\nYou can also just create this file manually. Heres an example of some things you can put into an `AGENTS.md` file.\n\n- AGENTS.md ``` # SST v3 Monorepo Project This is an SST v3 monorepo with TypeScript. The project uses bun workspaces for package management. ## Project Structure - `packages/` - Contains all workspace packages (functions, core, web, etc.)- `infra/` - Infrastructure definitions split by service (storage.ts, api.ts, web.ts)- `sst.config.ts` - Main SST configuration with dynamic imports ## Code Standards - Use TypeScript with strict mode enabled- Shared code goes in `packages/core/` with proper exports configuration- Functions go in `packages/functions/`- Infrastructure should be split into logical files in `infra/` ## Monorepo Conventions - Import shared modules using workspace names: `@my-app/core/example` ``` We are adding project-specific instructions here and this will be shared across your team. ## [Types](#types) opencode also supports reading the `AGENTS.md` file from multiple locations. And this serves different purposes. ### [Project](#project) Place an `AGENTS.md` in your project root for project-specific rules. These only apply when you are working in this directory or its sub-directories. ### [Global](#global) You can also have global rules in a `~/.config/opencode/AGENTS.md` file. This gets applied across all opencode sessions. Since this isnt committed to Git or shared with your team, we recommend using this to specify any personal rules that the LLM should follow. ### [Claude Code Compatibility](#claude-code-compatibility) For users migrating from Claude Code, OpenCode supports Claude Codes file conventions as fallbacks: Project rules: `CLAUDE.md` in your project directory (used if no `AGENTS.md` exists)\n\n- Global rules: `~/.claude/CLAUDE.md` (used if no `~/.config/opencode/AGENTS.md` exists)\n\n- Skills: `~/.claude/skills/`  see [Agent Skills](/docs/skills/) for details\n\nTo disable Claude Code compatibility, set one of these environment variables:\n\nTerminal window\n\n```\nexport OPENCODE_DISABLE_CLAUDE_CODE=1        # Disable all .claude supportexport OPENCODE_DISABLE_CLAUDE_CODE_PROMPT=1 # Disable only ~/.claude/CLAUDE.mdexport OPENCODE_DISABLE_CLAUDE_CODE_SKILLS=1 # Disable only .claude/skills\n```\n\n## [Precedence](#precedence)\n\nWhen opencode starts, it looks for rule files in this order:\n\n- Local files by traversing up from the current directory (`AGENTS.md`, `CLAUDE.md`)\n\n- Global file at `~/.config/opencode/AGENTS.md`\n\n- Claude Code file at `~/.claude/CLAUDE.md` (unless disabled)\n\nThe first matching file wins in each category. For example, if you have both `AGENTS.md` and `CLAUDE.md`, only `AGENTS.md` is used. Similarly, `~/.config/opencode/AGENTS.md` takes precedence over `~/.claude/CLAUDE.md`.\n\n## [Custom Instructions](#custom-instructions)\n\nYou can specify custom instruction files in your `opencode.json` or the global `~/.config/opencode/opencode.json`. This allows you and your team to reuse existing rules rather than having to duplicate them to AGENTS.md.\n\nExample:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"instructions\": [\"CONTRIBUTING.md\", \"docs/guidelines.md\", \".cursor/rules/*.md\"]}\n```\n\nYou can also use remote URLs to load instructions from the web.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"instructions\": [\"https://raw.githubusercontent.com/my-org/shared-rules/main/style.md\"]}\n```\n\nRemote instructions are fetched with a 5 second timeout.\n\nAll instruction files are combined with your `AGENTS.md` files.\n\n## [Referencing External Files](#referencing-external-files)\n\nWhile opencode doesnt automatically parse file references in `AGENTS.md`, you can achieve similar functionality in two ways:\n\n### [Using opencode.json](#using-opencodejson)\n\nThe recommended approach is to use the `instructions` field in `opencode.json`:\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"instructions\": [\"docs/development-standards.md\", \"test/testing-guidelines.md\", \"packages/*/AGENTS.md\"]}\n```\n\n### [Manual Instructions in AGENTS.md](#manual-instructions-in-agentsmd)\n\nYou can teach opencode to read external files by providing explicit instructions in your `AGENTS.md`. Heres a practical example:\n\nAGENTS.md\n\n```\n# TypeScript Project Rules\n## External File Loading\nCRITICAL: When you encounter a file reference (e.g., @rules/general.md), use your Read tool to load it on a need-to-know basis. They're relevant to the SPECIFIC task at hand.\nInstructions:\n- Do NOT preemptively load all references - use lazy loading based on actual need- When loaded, treat content as mandatory instructions that override defaults- Follow references recursively when needed\n## Development Guidelines\nFor TypeScript code style and best practices: @docs/typescript-guidelines.mdFor React component architecture and hooks patterns: @docs/react-patterns.mdFor REST API design and error handling: @docs/api-standards.mdFor testing strategies and coverage requirements: @test/testing-guidelines.md\n## General Guidelines\nRead the following file immediately as it's relevant to all workflows: @rules/general-guidelines.md.\n```\n\nThis approach allows you to:\n\n- Create modular, reusable rule files\n\n- Share rules across projects via symlinks or git submodules\n\n- Keep AGENTS.md concise while referencing detailed guidelines\n\n- Ensure opencode loads files only when needed for the specific task\n\nTip\n\nFor monorepos or projects with shared standards, using `opencode.json` with glob patterns (like `packages/*/AGENTS.md`) is more maintainable than manual instructions.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/rules.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 143,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__sdk.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/sdk\n- Keywords: opencode, docs, ai coding assistant, cli, sdk\n- Summary: Type-safe JS client for opencode server.\n----\n\nSource: https://opencode.ai/docs/sdk\n\n# SDK\n\nType-safe JS client for opencode server.\n\nThe opencode JS/TS SDK provides a type-safe client for interacting with the server.\nUse it to build integrations and control opencode programmatically.\n\n[Learn more](/docs/server) about how the server works. For examples, check out the [projects](/docs/ecosystem#projects) built by the community.\n\n## [Install](#install)\n\nInstall the SDK from npm:\n\n- Terminal window ``` npm install @opencode-ai/sdk ``` ## [Create client](#create-client) Create an instance of opencode: ``` import { createOpencode } from \"@opencode-ai/sdk\" const { client } = await createOpencode() ``` This starts both a server and a client #### [Options](#options) OptionTypeDescriptionDefault`hostname``string`Server hostname`127.0.0.1``port``number`Server port`4096``signal``AbortSignal`Abort signal for cancellation`undefined``timeout``number`Timeout in ms for server start`5000``config``Config`Configuration object`{}` ## [Config](#config) You can pass a configuration object to customize behavior. The instance still picks up your `opencode.json`, but you can override or add configuration inline: ``` import { createOpencode } from \"@opencode-ai/sdk\" const opencode = await createOpencode({ hostname: \"127.0.0.1\", port: 4096, config: { model: \"anthropic/claude-3-5-sonnet-20241022\", },}) console.log(`Server running at ${opencode.server.url}`) opencode.server.close() ``` ## [Client only](#client-only) If you already have a running instance of opencode, you can create a client instance to connect to it: ``` import { createOpencodeClient } from \"@opencode-ai/sdk\" const client = createOpencodeClient({ baseUrl: \"http://localhost:4096\",}) ``` #### [Options](#options-1) OptionTypeDescriptionDefault`baseUrl``string`URL of the server`http://localhost:4096``fetch``function`Custom fetch implementation`globalThis.fetch``parseAs``string`Response parsing method`auto``responseStyle``string`Return style: `data` or `fields``fields``throwOnError``boolean`Throw errors instead of return`false` ## [Types](#types) The SDK includes TypeScript definitions for all API types. Import them directly: ``` import type { Session, Message, Part } from \"@opencode-ai/sdk\" ``` All types are generated from the servers OpenAPI specification and available in the [types file](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts). ## [Errors](#errors) The SDK can throw errors that you can catch and handle: ``` try { await client.session.get({ path: { id: \"invalid-id\" } })} catch (error) { console.error(\"Failed to get session:\", (error as Error).message)} ``` ## [Structured Output](#structured-output) You can request structured JSON output from the model by specifying an `format` with a JSON schema. The model will use a `StructuredOutput` tool to return validated JSON matching your schema. ### [Basic Usage](#basic-usage) ``` const result = await client.session.prompt({ path: { id: sessionId }, body: { parts: [{ type: \"text\", text: \"Research Anthropic and provide company info\" }], format: { type: \"json_schema\", schema: { type: \"object\", properties: { company: { type: \"string\", description: \"Company name\" }, founded: { type: \"number\", description: \"Year founded\" }, products: { type: \"array\", items: { type: \"string\" }, description: \"Main products\", }, }, required: [\"company\", \"founded\"], }, }, },}) // Access the structured outputconsole.log(result.data.info.structured_output)// { company: \"Anthropic\", founded: 2021, products: [\"Claude\", \"Claude API\"] } ``` ### [Output Format Types](#output-format-types) TypeDescription`text`Default. Standard text response (no structured output)`json_schema`Returns validated JSON matching the provided schema ### [JSON Schema Format](#json-schema-format) When using `type: 'json_schema'`, provide: FieldTypeDescription`type``'json_schema'`Required. Specifies JSON schema mode`schema``object`Required. JSON Schema object defining the output structure`retryCount``number`Optional. Number of validation retries (default: 2) ### [Error Handling](#error-handling) If the model fails to produce valid structured output after all retries, the response will include a `StructuredOutputError`: ``` if (result.data.info.error?.name === \"StructuredOutputError\") { console.error(\"Failed to produce structured output:\", result.data.info.error.message) console.error(\"Attempts:\", result.data.info.error.retries)} ``` ### [Best Practices](#best-practices) Provide clear descriptions in your schema properties to help the model understand what data to extract\n\n- Use `required` to specify which fields must be present\n\n- Keep schemas focused - complex nested schemas may be harder for the model to fill correctly\n\n- Set appropriate `retryCount` - increase for complex schemas, decrease for simple ones\n\n## [APIs](#apis)\n\nThe SDK exposes all server APIs through a type-safe client.\n\n### [Global](#global)\n\nMethod Description Response\n\n`global.health()` Check server health and version `{ healthy: true, version: string }`\n\n#### [Examples](#examples)\n\n```\nconst health = await client.global.health()console.log(health.data.version)\n```\n\n### [App](#app)\n\nMethod Description Response\n\n`app.log()` Write a log entry `boolean`\n\n`app.agents()` List all available agents [`Agent[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n#### [Examples](#examples-1)\n\n```\n// Write a log entryawait client.app.log({  body: {    service: \"my-app\",    level: \"info\",    message: \"Operation completed\",  },})\n// List available agentsconst agents = await client.app.agents()\n```\n\n### [Project](#project)\n\nMethod Description Response\n\n`project.list()` List all projects [`Project[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`project.current()` Get current project [`Project`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n#### [Examples](#examples-2)\n\n```\n// List all projectsconst projects = await client.project.list()\n// Get current projectconst currentProject = await client.project.current()\n```\n\n### [Path](#path)\n\nMethod Description Response\n\n`path.get()` Get current path [`Path`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n#### [Examples](#examples-3)\n\n```\n// Get current path informationconst pathInfo = await client.path.get()\n```\n\n### [Config](#config-1)\n\nMethod Description Response\n\n`config.get()` Get config info [`Config`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`config.providers()` List providers and default models `{ providers:`[`Provider[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, default: { [key: string]: string } }`\n\n#### [Examples](#examples-4)\n\n```\nconst config = await client.config.get()\nconst { providers, default: defaults } = await client.config.providers()\n```\n\n### [Sessions](#sessions)\n\nMethod Description Notes\n\n`session.list()` List sessions Returns [`Session[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.get({ path })` Get session Returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.children({ path })` List child sessions Returns [`Session[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.create({ body })` Create session Returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.delete({ path })` Delete session Returns `boolean`\n\n`session.update({ path, body })` Update session properties Returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.init({ path, body })` Analyze app and create `AGENTS.md` Returns `boolean`\n\n`session.abort({ path })` Abort a running session Returns `boolean`\n\n`session.share({ path })` Share session Returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.unshare({ path })` Unshare session Returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.summarize({ path, body })` Summarize session Returns `boolean`\n\n`session.messages({ path })` List messages in a session Returns `{ info:`[`Message`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, parts:`[`Part[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}[]`\n\n`session.message({ path })` Get message details Returns `{ info:`[`Message`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, parts:`[`Part[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}`\n\n`session.prompt({ path, body })` Send prompt message `body.noReply: true` returns UserMessage (context only). Default returns [`AssistantMessage`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts) with AI response. Supports `body.outputFormat` for [structured output](#structured-output)\n\n`session.command({ path, body })` Send command to session Returns `{ info:`[`AssistantMessage`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, parts:`[`Part[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}`\n\n`session.shell({ path, body })` Run a shell command Returns [`AssistantMessage`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.revert({ path, body })` Revert a message Returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`session.unrevert({ path })` Restore reverted messages Returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`postSessionByIdPermissionsByPermissionId({ path, body })` Respond to a permission request Returns `boolean`\n\n#### [Examples](#examples-5)\n\n```\n// Create and manage sessionsconst session = await client.session.create({  body: { title: \"My session\" },})\nconst sessions = await client.session.list()\n// Send a prompt messageconst result = await client.session.prompt({  path: { id: session.id },  body: {    model: { providerID: \"anthropic\", modelID: \"claude-3-5-sonnet-20241022\" },    parts: [{ type: \"text\", text: \"Hello!\" }],  },})\n// Inject context without triggering AI response (useful for plugins)await client.session.prompt({  path: { id: session.id },  body: {    noReply: true,    parts: [{ type: \"text\", text: \"You are a helpful assistant.\" }],  },})\n```\n\n### [Files](#files)\n\nMethod Description Response\n\n`find.text({ query })` Search for text in files Array of match objects with `path`, `lines`, `line_number`, `absolute_offset`, `submatches`\n\n`find.files({ query })` Find files and directories by name `string[]` (paths)\n\n`find.symbols({ query })` Find workspace symbols [`Symbol[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`file.read({ query })` Read a file `{ type: \"raw\" | \"patch\", content: string }`\n\n`file.status({ query? })` Get status for tracked files [`File[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`find.files` supports a few optional query fields:\n\n- `type`: `\"file\"` or `\"directory\"`\n\n- `directory`: override the project root for the search\n\n- `limit`: max results (1200)\n\n#### [Examples](#examples-6)\n\n```\n// Search and read filesconst textResults = await client.find.text({  query: { pattern: \"function.*opencode\" },})\nconst files = await client.find.files({  query: { query: \"*.ts\", type: \"file\" },})\nconst directories = await client.find.files({  query: { query: \"packages\", type: \"directory\", limit: 20 },})\nconst content = await client.file.read({  query: { path: \"src/index.ts\" },})\n```\n\n### [TUI](#tui)\n\nMethod Description Response\n\n`tui.appendPrompt({ body })` Append text to the prompt `boolean`\n\n`tui.openHelp()` Open the help dialog `boolean`\n\n`tui.openSessions()` Open the session selector `boolean`\n\n`tui.openThemes()` Open the theme selector `boolean`\n\n`tui.openModels()` Open the model selector `boolean`\n\n`tui.submitPrompt()` Submit the current prompt `boolean`\n\n`tui.clearPrompt()` Clear the prompt `boolean`\n\n`tui.executeCommand({ body })` Execute a command `boolean`\n\n`tui.showToast({ body })` Show toast notification `boolean`\n\n#### [Examples](#examples-7)\n\n```\n// Control TUI interfaceawait client.tui.appendPrompt({  body: { text: \"Add this to prompt\" },})\nawait client.tui.showToast({  body: { message: \"Task completed\", variant: \"success\" },})\n```\n\n### [Auth](#auth)\n\nMethod Description Response\n\n`auth.set({ ... })` Set authentication credentials `boolean`\n\n#### [Examples](#examples-8)\n\n```\nawait client.auth.set({  path: { id: \"anthropic\" },  body: { type: \"api\", key: \"your-api-key\" },})\n```\n\n### [Events](#events)\n\nMethod Description Response\n\n`event.subscribe()` Server-sent events stream Server-sent events stream\n\n#### [Examples](#examples-9)\n\n```\n// Listen to real-time eventsconst events = await client.event.subscribe()for await (const event of events.stream) {  console.log(\"Event:\", event.type, event.properties)}\n```\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/sdk.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 254,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__server.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/server\n- Keywords: opencode, docs, ai coding assistant, cli, server\n- Summary: Interact with opencode server over HTTP.\n----\n\nSource: https://opencode.ai/docs/server\n\n# Server\n\nInteract with opencode server over HTTP.\n\nThe `opencode serve` command runs a headless HTTP server that exposes an OpenAPI endpoint that an opencode client can use.\n\n### [Usage](#usage)\n\n- Terminal window ``` opencode serve [--port &#x3C;number>] [--hostname &#x3C;string>] [--cors &#x3C;origin>] ``` #### [Options](#options) FlagDescriptionDefault`--port`Port to listen on`4096``--hostname`Hostname to listen on`127.0.0.1``--mdns`Enable mDNS discovery`false``--mdns-domain`Custom domain name for mDNS service`opencode.local``--cors`Additional browser origins to allow`[]` `--cors` can be passed multiple times: Terminal window ``` opencode serve --cors http://localhost:5173 --cors https://app.example.com ``` ### [Authentication](#authentication) Set `OPENCODE_SERVER_PASSWORD` to protect the server with HTTP basic auth. The username defaults to `opencode`, or set `OPENCODE_SERVER_USERNAME` to override it. This applies to both `opencode serve` and `opencode web`. Terminal window ``` OPENCODE_SERVER_PASSWORD=your-password opencode serve ``` ### [How it works](#how-it-works) When you run `opencode` it starts a TUI and a server. Where the TUI is the client that talks to the server. The server exposes an OpenAPI 3.1 spec endpoint. This endpoint is also used to generate an [SDK](/docs/sdk). TipUse the opencode server to interact with opencode programmatically. This architecture lets opencode support multiple clients and allows you to interact with opencode programmatically. You can run `opencode serve` to start a standalone server. If you have the opencode TUI running, `opencode serve` will start a new server. #### [Connect to an existing server](#connect-to-an-existing-server) When you start the TUI it randomly assigns a port and hostname. You can instead pass in the `--hostname` and `--port` [flags](/docs/cli). Then use this to connect to its server. The [`/tui`](#tui) endpoint can be used to drive the TUI through the server. For example, you can prefill or run a prompt. This setup is used by the OpenCode [IDE](/docs/ide) plugins. ## [Spec](#spec) The server publishes an OpenAPI 3.1 spec that can be viewed at: ``` http://&#x3C;hostname>:&#x3C;port>/doc ``` For example, `http://localhost:4096/doc`. Use the spec to generate clients or inspect request and response types. Or view it in a Swagger explorer. ## [APIs](#apis) The opencode server exposes the following APIs. ### [Global](#global) MethodPathDescriptionResponse`GET``/global/health`Get server health and version`{ healthy: true, version: string }``GET``/global/event`Get global events (SSE stream)Event stream ### [Project](#project) MethodPathDescriptionResponse`GET``/project`List all projects[`Project[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/project/current`Get the current project[`Project`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts) ### [Path &#x26; VCS](#path--vcs) MethodPathDescriptionResponse`GET``/path`Get the current path[`Path`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/vcs`Get VCS info for the current project[`VcsInfo`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts) ### [Instance](#instance) MethodPathDescriptionResponse`POST``/instance/dispose`Dispose the current instance`boolean` ### [Config](#config) MethodPathDescriptionResponse`GET``/config`Get config info[`Config`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`PATCH``/config`Update config[`Config`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/config/providers`List providers and default models`{ providers:`[Provider[]](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, default: { [key: string]: string } }` ### [Provider](#provider) MethodPathDescriptionResponse`GET``/provider`List all providers`{ all:`[Provider[]](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, default: {...}, connected: string[] }``GET``/provider/auth`Get provider authentication methods`{ [providerID: string]:`[ProviderAuthMethod[]](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}``POST``/provider/{id}/oauth/authorize`Authorize a provider using OAuth[`ProviderAuthAuthorization`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`POST``/provider/{id}/oauth/callback`Handle OAuth callback for a provider`boolean` ### [Sessions](#sessions) MethodPathDescriptionNotes`GET``/session`List all sessionsReturns [`Session[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`POST``/session`Create a new sessionbody: `{ parentID?, title? }`, returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/session/status`Get session status for all sessionsReturns `{ [sessionID: string]:`[SessionStatus](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}``GET``/session/:id`Get session detailsReturns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`DELETE``/session/:id`Delete a session and all its dataReturns `boolean``PATCH``/session/:id`Update session propertiesbody: `{ title? }`, returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/session/:id/children`Get a sessions child sessionsReturns [`Session[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/session/:id/todo`Get the todo list for a sessionReturns [`Todo[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`POST``/session/:id/init`Analyze app and create `AGENTS.md`body: `{ messageID, providerID, modelID }`, returns `boolean``POST``/session/:id/fork`Fork an existing session at a messagebody: `{ messageID? }`, returns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`POST``/session/:id/abort`Abort a running sessionReturns `boolean``POST``/session/:id/share`Share a sessionReturns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`DELETE``/session/:id/share`Unshare a sessionReturns [`Session`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/session/:id/diff`Get the diff for this sessionquery: `messageID?`, returns [`FileDiff[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`POST``/session/:id/summarize`Summarize the sessionbody: `{ providerID, modelID }`, returns `boolean``POST``/session/:id/revert`Revert a messagebody: `{ messageID, partID? }`, returns `boolean``POST``/session/:id/unrevert`Restore all reverted messagesReturns `boolean``POST``/session/:id/permissions/:permissionID`Respond to a permission requestbody: `{ response, remember? }`, returns `boolean` ### [Messages](#messages) MethodPathDescriptionNotes`GET``/session/:id/message`List messages in a sessionquery: `limit?`, returns `{ info:`[Message](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, parts:`[Part[]](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}[]``POST``/session/:id/message`Send a message and wait for responsebody: `{ messageID?, model?, agent?, noReply?, system?, tools?, parts }`, returns `{ info:`[Message](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, parts:`[Part[]](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}``GET``/session/:id/message/:messageID`Get message detailsReturns `{ info:`[Message](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, parts:`[Part[]](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}``POST``/session/:id/prompt_async`Send a message asynchronously (no wait)body: same as `/session/:id/message`, returns `204 No Content``POST``/session/:id/command`Execute a slash commandbody: `{ messageID?, agent?, model?, command, arguments }`, returns `{ info:`[Message](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, parts:`[Part[]](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}``POST``/session/:id/shell`Run a shell commandbody: `{ agent, model?, command }`, returns `{ info:`[Message](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`, parts:`[Part[]](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}` ### [Commands](#commands) MethodPathDescriptionResponse`GET``/command`List all commands[`Command[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts) ### [Files](#files) MethodPathDescriptionResponse`GET``/find?pattern=`Search for text in filesArray of match objects with `path`, `lines`, `line_number`, `absolute_offset`, `submatches``GET``/find/file?query=`Find files and directories by name`string[]` (paths)`GET``/find/symbol?query=`Find workspace symbols[`Symbol[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/file?path=`List files and directories[`FileNode[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/file/content?path=`Read a file[`FileContent`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`GET``/file/status`Get status for tracked files[`File[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts) #### [`/find/file` query parameters](#findfile-query-parameters) `query` (required)  search string (fuzzy match)\n\n- `type` (optional)  limit results to `\"file\"` or `\"directory\"`\n\n- `directory` (optional)  override the project root for the search\n\n- `limit` (optional)  max results (1200)\n\n- `dirs` (optional)  legacy flag (`\"false\"` returns only files)\n\n### [Tools (Experimental)](#tools-experimental)\n\nMethod Path Description Response\n\n`GET` `/experimental/tool/ids` List all tool IDs [`ToolIDs`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`GET` `/experimental/tool?provider= &model=` List tools with JSON schemas for a model [`ToolList`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n### [LSP, Formatters &#x26; MCP](#lsp-formatters--mcp)\n\nMethod Path Description Response\n\n`GET` `/lsp` Get LSP server status [`LSPStatus[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`GET` `/formatter` Get formatter status [`FormatterStatus[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n`GET` `/mcp` Get MCP server status `{ [name: string]:`[MCPStatus](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)`}`\n\n`POST` `/mcp` Add MCP server dynamically body: `{ name, config }`, returns MCP status object\n\n### [Agents](#agents)\n\nMethod Path Description Response\n\n`GET` `/agent` List all available agents [`Agent[]`](https://github.com/anomalyco/opencode/blob/dev/packages/sdk/js/src/gen/types.gen.ts)\n\n### [Logging](#logging)\n\nMethod Path Description Response\n\n`POST` `/log` Write log entry. Body: `{ service, level, message, extra? }` `boolean`\n\n### [TUI](#tui)\n\nMethod Path Description Response\n\n`POST` `/tui/append-prompt` Append text to the prompt `boolean`\n\n`POST` `/tui/open-help` Open the help dialog `boolean`\n\n`POST` `/tui/open-sessions` Open the session selector `boolean`\n\n`POST` `/tui/open-themes` Open the theme selector `boolean`\n\n`POST` `/tui/open-models` Open the model selector `boolean`\n\n`POST` `/tui/submit-prompt` Submit the current prompt `boolean`\n\n`POST` `/tui/clear-prompt` Clear the prompt `boolean`\n\n`POST` `/tui/execute-command` Execute a command (`{ command }`) `boolean`\n\n`POST` `/tui/show-toast` Show toast (`{ title?, message, variant }`) `boolean`\n\n`GET` `/tui/control/next` Wait for the next control request Control request object\n\n`POST` `/tui/control/response` Respond to a control request (`{ body }`) `boolean`\n\n### [Auth](#auth)\n\nMethod Path Description Response\n\n`PUT` `/auth/:id` Set authentication credentials. Body must match provider schema `boolean`\n\n### [Events](#events)\n\nMethod Path Description Response\n\n`GET` `/event` Server-sent events stream. First event is `server.connected`, then bus events Server-sent events stream\n\n### [Docs](#docs)\n\nMethod Path Description Response\n\n`GET` `/doc` OpenAPI 3.1 specification HTML page with OpenAPI spec\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/server.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 119,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__share.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/share\n- Keywords: opencode, docs, ai coding assistant, cli, share\n- Summary: Share your OpenCode conversations.\n----\n\nSource: https://opencode.ai/docs/share\n\n# Share\n\nShare your OpenCode conversations.\n\nOpenCodes share feature allows you to create public links to your OpenCode conversations, so you can collaborate with teammates or get help from others.\n\nNote\n\nShared conversations are publicly accessible to anyone with the link.\n\n## [How it works](#how-it-works)\n\nWhen you share a conversation, OpenCode:\n\n- Creates a unique public URL for your session\n\n- Syncs your conversation history to our servers\n\n- Makes the conversation accessible via the shareable link  `opncd.ai/s/&#x3C;share-id>`\n\n## [Sharing](#sharing)\n\nOpenCode supports three sharing modes that control how conversations are shared:\n\n### [Manual (default)](#manual-default)\n\nBy default, OpenCode uses manual sharing mode. Sessions are not shared automatically, but you can manually share them using the `/share` command:\n\n- ``` /share ``` This will generate a unique URL thatll be copied to your clipboard. To explicitly set manual mode in your [config file](/docs/config): opencode.json ``` { \"$schema\": \"https://opncd.ai/config.json\", \"share\": \"manual\"} ``` ### [Auto-share](#auto-share) You can enable automatic sharing for all new conversations by setting the `share` option to `\"auto\"` in your [config file](/docs/config): opencode.json ``` { \"$schema\": \"https://opncd.ai/config.json\", \"share\": \"auto\"} ``` With auto-share enabled, every new conversation will automatically be shared and a link will be generated. ### [Disabled](#disabled) You can disable sharing entirely by setting the `share` option to `\"disabled\"` in your [config file](/docs/config): opencode.json ``` { \"$schema\": \"https://opncd.ai/config.json\", \"share\": \"disabled\"} ``` To enforce this across your team for a given project, add it to the `opencode.json` in your project and check into Git. ## [Un-sharing](#un-sharing) To stop sharing a conversation and remove it from public access: ``` /unshare ``` This will remove the share link and delete the data related to the conversation. ## [Privacy](#privacy) There are a few things to keep in mind when sharing a conversation. ### [Data retention](#data-retention) Shared conversations remain accessible until you explicitly unshare them. This includes: Full conversation history\n\n- All messages and responses\n\n- Session metadata\n\n### [Recommendations](#recommendations)\n\n- Only share conversations that dont contain sensitive information.\n\n- Review conversation content before sharing.\n\n- Unshare conversations when collaboration is complete.\n\n- Avoid sharing conversations with proprietary code or confidential data.\n\n- For sensitive projects, disable sharing entirely.\n\n## [For enterprises](#for-enterprises)\n\nFor enterprise deployments, the share feature can be:\n\n- Disabled entirely for security compliance\n\n- Restricted to users authenticated through SSO only\n\n- Self-hosted on your own infrastructure\n\n[Learn more](/docs/enterprise) about using opencode in your organization.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/share.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 83,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__skills.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/skills\n- Keywords: opencode, docs, ai coding assistant, cli, skills\n- Summary: Define reusable behavior via SKILL.md definitions\n----\n\nSource: https://opencode.ai/docs/skills\n\n# Agent Skills\n\nDefine reusable behavior via SKILL.md definitions\n\nAgent skills let OpenCode discover reusable instructions from your repo or home directory.\nSkills are loaded on-demand via the native `skill` toolagents see available skills and can load the full content when needed.\n\n## [Place files](#place-files)\n\nCreate one folder per skill name and put a `SKILL.md` inside it.\nOpenCode searches these locations:\n\n- Project config: `.opencode/skills/&#x3C;name>/SKILL.md`\n\n- Global config: `~/.config/opencode/skills/&#x3C;name>/SKILL.md`\n\n- Project Claude-compatible: `.claude/skills/&#x3C;name>/SKILL.md`\n\n- Global Claude-compatible: `~/.claude/skills/&#x3C;name>/SKILL.md`\n\n- Project agent-compatible: `.agents/skills/&#x3C;name>/SKILL.md`\n\n- Global agent-compatible: `~/.agents/skills/&#x3C;name>/SKILL.md`\n\n## [Understand discovery](#understand-discovery)\n\nFor project-local paths, OpenCode walks up from your current working directory until it reaches the git worktree.\nIt loads any matching `skills/*/SKILL.md` in `.opencode/` and any matching `.claude/skills/*/SKILL.md` or `.agents/skills/*/SKILL.md` along the way.\n\nGlobal definitions are also loaded from `~/.config/opencode/skills/*/SKILL.md`, `~/.claude/skills/*/SKILL.md`, and `~/.agents/skills/*/SKILL.md`.\n\n## [Write frontmatter](#write-frontmatter)\n\nEach `SKILL.md` must start with YAML frontmatter.\nOnly these fields are recognized:\n\n- `name` (required)\n\n- `description` (required)\n\n- `license` (optional)\n\n- `compatibility` (optional)\n\n- `metadata` (optional, string-to-string map)\n\nUnknown frontmatter fields are ignored.\n\n## [Validate names](#validate-names)\n\n`name` must:\n\n- Be 164 characters\n\n- Be lowercase alphanumeric with single hyphen separators\n\n- Not start or end with `-`\n\n- Not contain consecutive `--`\n\n- Match the directory name that contains `SKILL.md`\n\nEquivalent regex:\n\n- ``` ^[a-z0-9]+(-[a-z0-9]+)*$ ``` ## [Follow length rules](#follow-length-rules) `description` must be 1-1024 characters. Keep it specific enough for the agent to choose correctly. ## [Use an example](#use-an-example) Create `.opencode/skills/git-release/SKILL.md` like this: ``` ---name: git-releasedescription: Create consistent releases and changelogslicense: MITcompatibility: opencodemetadata: audience: maintainers workflow: github--- ## What I do - Draft release notes from merged PRs- Propose a version bump- Provide a copy-pasteable `gh release create` command ## When to use me Use this when you are preparing a tagged release.Ask clarifying questions if the target versioning scheme is unclear. ``` ## [Recognize tool description](#recognize-tool-description) OpenCode lists available skills in the `skill` tool description. Each entry includes the skill name and description: ``` &#x3C;available_skills> &#x3C;skill> &#x3C;name>git-release&#x3C;/name> &#x3C;description>Create consistent releases and changelogs&#x3C;/description> &#x3C;/skill>&#x3C;/available_skills> ``` The agent loads a skill by calling the tool: ``` skill({ name: \"git-release\" }) ``` ## [Configure permissions](#configure-permissions) Control which skills agents can access using pattern-based permissions in `opencode.json`: ``` { \"permission\": { \"skill\": { \"*\": \"allow\", \"pr-review\": \"allow\", \"internal-*\": \"deny\", \"experimental-*\": \"ask\" } }} ``` PermissionBehavior`allow`Skill loads immediately`deny`Skill hidden from agent, access rejected`ask`User prompted for approval before loading Patterns support wildcards: `internal-*` matches `internal-docs`, `internal-tools`, etc. ## [Override per agent](#override-per-agent) Give specific agents different permissions than the global defaults. For custom agents (in agent frontmatter): ``` ---permission: skill: \"documents-*\": \"allow\"--- ``` For built-in agents (in `opencode.json`): ``` { \"agent\": { \"plan\": { \"permission\": { \"skill\": { \"internal-*\": \"allow\" } } } }} ``` ## [Disable the skill tool](#disable-the-skill-tool) Completely disable skills for agents that shouldnt use them: For custom agents: ``` ---tools: skill: false--- ``` For built-in agents: ``` { \"agent\": { \"plan\": { \"tools\": { \"skill\": false } } }} ``` When disabled, the `&#x3C;available_skills>` section is omitted entirely. ## [Troubleshoot loading](#troubleshoot-loading) If a skill does not show up: Verify `SKILL.md` is spelled in all caps\n\n- Check that frontmatter includes `name` and `description`\n\n- Ensure skill names are unique across all locations\n\n- Check permissionsskills with `deny` are hidden from agents\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/skills.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 97,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__themes.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/themes\n- Keywords: opencode, docs, ai coding assistant, cli, themes\n- Summary: Select a built-in theme or define your own.\n----\n\nSource: https://opencode.ai/docs/themes\n\n# Themes\n\nSelect a built-in theme or define your own.\n\nWith OpenCode you can select from one of several built-in themes, use a theme that adapts to your terminal theme, or define your own custom theme.\n\nBy default, OpenCode uses our own `opencode` theme.\n\n## [Terminal requirements](#terminal-requirements)\n\nFor themes to display correctly with their full color palette, your terminal must support truecolor (24-bit color). Most modern terminals support this by default, but you may need to enable it:\n\n- Check support: Run `echo $COLORTERM` - it should output `truecolor` or `24bit`\n\n- Enable truecolor: Set the environment variable `COLORTERM=truecolor` in your shell profile\n\n- Terminal compatibility: Ensure your terminal emulator supports 24-bit color (most modern terminals like iTerm2, Alacritty, Kitty, Windows Terminal, and recent versions of GNOME Terminal do)\n\nWithout truecolor support, themes may appear with reduced color accuracy or fall back to the nearest 256-color approximation.\n\n## [Built-in themes](#built-in-themes)\n\nOpenCode comes with several built-in themes.\n\nName Description\n\n`system` Adapts to your terminals background color\n\n`tokyonight` Based on the [Tokyonight](https://github.com/folke/tokyonight.nvim) theme\n\n`everforest` Based on the [Everforest](https://github.com/sainnhe/everforest) theme\n\n`ayu` Based on the [Ayu](https://github.com/ayu-theme) dark theme\n\n`catppuccin` Based on the [Catppuccin](https://github.com/catppuccin) theme\n\n`catppuccin-macchiato` Based on the [Catppuccin](https://github.com/catppuccin) theme\n\n`gruvbox` Based on the [Gruvbox](https://github.com/morhetz/gruvbox) theme\n\n`kanagawa` Based on the [Kanagawa](https://github.com/rebelot/kanagawa.nvim) theme\n\n`nord` Based on the [Nord](https://github.com/nordtheme/nord) theme\n\n`matrix` Hacker-style green on black theme\n\n`one-dark` Based on the [Atom One](https://github.com/Th3Whit3Wolf/one-nvim) Dark theme\n\nAnd more, we are constantly adding new themes.\n\n## [System theme](#system-theme)\n\nThe `system` theme is designed to automatically adapt to your terminals color scheme. Unlike traditional themes that use fixed colors, the system theme:\n\n- Generates gray scale: Creates a custom gray scale based on your terminals background color, ensuring optimal contrast.\n\n- Uses ANSI colors: Leverages standard ANSI colors (0-15) for syntax highlighting and UI elements, which respect your terminals color palette.\n\n- Preserves terminal defaults: Uses `none` for text and background colors to maintain your terminals native appearance.\n\nThe system theme is for users who:\n\n- Want OpenCode to match their terminals appearance\n\n- Use custom terminal color schemes\n\n- Prefer a consistent look across all terminal applications\n\n## [Using a theme](#using-a-theme)\n\nYou can select a theme by bringing up the theme select with the `/theme` command. Or you can specify it in your [config](/docs/config).\n\n- opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"theme\": \"tokyonight\"} ``` ## [Custom themes](#custom-themes) OpenCode supports a flexible JSON-based theme system that allows users to create and customize themes easily. ### [Hierarchy](#hierarchy) Themes are loaded from multiple directories in the following order where later directories override earlier ones: Built-in themes - These are embedded in the binary\n\n- User config directory - Defined in `~/.config/opencode/themes/*.json` or `$XDG_CONFIG_HOME/opencode/themes/*.json`\n\n- Project root directory - Defined in the `&#x3C;project-root>/.opencode/themes/*.json`\n\n- Current working directory - Defined in `./.opencode/themes/*.json`\n\nIf multiple directories contain a theme with the same name, the theme from the directory with higher priority will be used.\n\n### [Creating a theme](#creating-a-theme)\n\nTo create a custom theme, create a JSON file in one of the theme directories.\n\nFor user-wide themes:\n\nTerminal window\n\n```\nmkdir -p ~/.config/opencode/themesvim ~/.config/opencode/themes/my-theme.json\n```\n\nAnd for project-specific themes.\n\nTerminal window\n\n```\nmkdir -p .opencode/themesvim .opencode/themes/my-theme.json\n```\n\n### [JSON format](#json-format)\n\nThemes use a flexible JSON format with support for:\n\n- Hex colors: `\"#ffffff\"`\n\n- ANSI colors: `3` (0-255)\n\n- Color references: `\"primary\"` or custom definitions\n\n- Dark/light variants: `{\"dark\": \"#000\", \"light\": \"#fff\"}`\n\n- No color: `\"none\"` - Uses the terminals default color or transparent\n\n### [Color definitions](#color-definitions)\n\nThe `defs` section is optional and it allows you to define reusable colors that can be referenced in the theme.\n\n### [Terminal defaults](#terminal-defaults)\n\nThe special value `\"none\"` can be used for any color to inherit the terminals default color. This is particularly useful for creating themes that blend seamlessly with your terminals color scheme:\n\n- `\"text\": \"none\"` - Uses terminals default foreground color\n\n- `\"background\": \"none\"` - Uses terminals default background color\n\n### [Example](#example)\n\nHeres an example of a custom theme:\n\nmy-theme.json\n\n```\n{  \"$schema\": \"https://opencode.ai/theme.json\",  \"defs\": {    \"nord0\": \"#2E3440\",    \"nord1\": \"#3B4252\",    \"nord2\": \"#434C5E\",    \"nord3\": \"#4C566A\",    \"nord4\": \"#D8DEE9\",    \"nord5\": \"#E5E9F0\",    \"nord6\": \"#ECEFF4\",    \"nord7\": \"#8FBCBB\",    \"nord8\": \"#88C0D0\",    \"nord9\": \"#81A1C1\",    \"nord10\": \"#5E81AC\",    \"nord11\": \"#BF616A\",    \"nord12\": \"#D08770\",    \"nord13\": \"#EBCB8B\",    \"nord14\": \"#A3BE8C\",    \"nord15\": \"#B48EAD\"  },  \"theme\": {    \"primary\": {      \"dark\": \"nord8\",      \"light\": \"nord10\"    },    \"secondary\": {      \"dark\": \"nord9\",      \"light\": \"nord9\"    },    \"accent\": {      \"dark\": \"nord7\",      \"light\": \"nord7\"    },    \"error\": {      \"dark\": \"nord11\",      \"light\": \"nord11\"    },    \"warning\": {      \"dark\": \"nord12\",      \"light\": \"nord12\"    },    \"success\": {      \"dark\": \"nord14\",      \"light\": \"nord14\"    },    \"info\": {      \"dark\": \"nord8\",      \"light\": \"nord10\"    },    \"text\": {      \"dark\": \"nord4\",      \"light\": \"nord0\"    },    \"textMuted\": {      \"dark\": \"nord3\",      \"light\": \"nord1\"    },    \"background\": {      \"dark\": \"nord0\",      \"light\": \"nord6\"    },    \"backgroundPanel\": {      \"dark\": \"nord1\",      \"light\": \"nord5\"    },    \"backgroundElement\": {      \"dark\": \"nord1\",      \"light\": \"nord4\"    },    \"border\": {      \"dark\": \"nord2\",      \"light\": \"nord3\"    },    \"borderActive\": {      \"dark\": \"nord3\",      \"light\": \"nord2\"    },    \"borderSubtle\": {      \"dark\": \"nord2\",      \"light\": \"nord3\"    },    \"diffAdded\": {      \"dark\": \"nord14\",      \"light\": \"nord14\"    },    \"diffRemoved\": {      \"dark\": \"nord11\",      \"light\": \"nord11\"    },    \"diffContext\": {      \"dark\": \"nord3\",      \"light\": \"nord3\"    },    \"diffHunkHeader\": {      \"dark\": \"nord3\",      \"light\": \"nord3\"    },    \"diffHighlightAdded\": {      \"dark\": \"nord14\",      \"light\": \"nord14\"    },    \"diffHighlightRemoved\": {      \"dark\": \"nord11\",      \"light\": \"nord11\"    },    \"diffAddedBg\": {      \"dark\": \"#3B4252\",      \"light\": \"#E5E9F0\"    },    \"diffRemovedBg\": {      \"dark\": \"#3B4252\",      \"light\": \"#E5E9F0\"    },    \"diffContextBg\": {      \"dark\": \"nord1\",      \"light\": \"nord5\"    },    \"diffLineNumber\": {      \"dark\": \"nord2\",      \"light\": \"nord4\"    },    \"diffAddedLineNumberBg\": {      \"dark\": \"#3B4252\",      \"light\": \"#E5E9F0\"    },    \"diffRemovedLineNumberBg\": {      \"dark\": \"#3B4252\",      \"light\": \"#E5E9F0\"    },    \"markdownText\": {      \"dark\": \"nord4\",      \"light\": \"nord0\"    },    \"markdownHeading\": {      \"dark\": \"nord8\",      \"light\": \"nord10\"    },    \"markdownLink\": {      \"dark\": \"nord9\",      \"light\": \"nord9\"    },    \"markdownLinkText\": {      \"dark\": \"nord7\",      \"light\": \"nord7\"    },    \"markdownCode\": {      \"dark\": \"nord14\",      \"light\": \"nord14\"    },    \"markdownBlockQuote\": {      \"dark\": \"nord3\",      \"light\": \"nord3\"    },    \"markdownEmph\": {      \"dark\": \"nord12\",      \"light\": \"nord12\"    },    \"markdownStrong\": {      \"dark\": \"nord13\",      \"light\": \"nord13\"    },    \"markdownHorizontalRule\": {      \"dark\": \"nord3\",      \"light\": \"nord3\"    },    \"markdownListItem\": {      \"dark\": \"nord8\",      \"light\": \"nord10\"    },    \"markdownListEnumeration\": {      \"dark\": \"nord7\",      \"light\": \"nord7\"    },    \"markdownImage\": {      \"dark\": \"nord9\",      \"light\": \"nord9\"    },    \"markdownImageText\": {      \"dark\": \"nord7\",      \"light\": \"nord7\"    },    \"markdownCodeBlock\": {      \"dark\": \"nord4\",      \"light\": \"nord0\"    },    \"syntaxComment\": {      \"dark\": \"nord3\",      \"light\": \"nord3\"    },    \"syntaxKeyword\": {      \"dark\": \"nord9\",      \"light\": \"nord9\"    },    \"syntaxFunction\": {      \"dark\": \"nord8\",      \"light\": \"nord8\"    },    \"syntaxVariable\": {      \"dark\": \"nord7\",      \"light\": \"nord7\"    },    \"syntaxString\": {      \"dark\": \"nord14\",      \"light\": \"nord14\"    },    \"syntaxNumber\": {      \"dark\": \"nord15\",      \"light\": \"nord15\"    },    \"syntaxType\": {      \"dark\": \"nord7\",      \"light\": \"nord7\"    },    \"syntaxOperator\": {      \"dark\": \"nord9\",      \"light\": \"nord9\"    },    \"syntaxPunctuation\": {      \"dark\": \"nord4\",      \"light\": \"nord0\"    }  }}\n```\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/themes.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 163,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__tools.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/tools\n- Keywords: opencode, docs, ai coding assistant, cli, tools\n- Summary: Manage the tools an LLM can use.\n----\n\nSource: https://opencode.ai/docs/tools\n\n# Tools\n\nManage the tools an LLM can use.\n\nTools allow the LLM to perform actions in your codebase. OpenCode comes with a set of built-in tools, but you can extend it with [custom tools](/docs/custom-tools) or [MCP servers](/docs/mcp-servers).\n\nBy default, all tools are enabled and dont need permission to run. You can control tool behavior through [permissions](/docs/permissions).\n\n## [Configure](#configure)\n\nUse the `permission` field to control tool behavior. You can allow, deny, or require approval for each tool.\n\n- opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"edit\": \"deny\", \"bash\": \"ask\", \"webfetch\": \"allow\" }} ``` You can also use wildcards to control multiple tools at once. For example, to require approval for all tools from an MCP server: opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"mymcp_*\": \"ask\" }} ``` [Learn more](/docs/permissions) about configuring permissions. ## [Built-in](#built-in) Here are all the built-in tools available in OpenCode. ### [bash](#bash) Execute shell commands in your project environment. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"bash\": \"allow\" }} ``` This tool allows the LLM to run terminal commands like `npm install`, `git status`, or any other shell command. ### [edit](#edit) Modify existing files using exact string replacements. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"edit\": \"allow\" }} ``` This tool performs precise edits to files by replacing exact text matches. Its the primary way the LLM modifies code. ### [write](#write) Create new files or overwrite existing ones. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"edit\": \"allow\" }} ``` Use this to allow the LLM to create new files. It will overwrite existing files if they already exist. NoteThe `write` tool is controlled by the `edit` permission, which covers all file modifications (`edit`, `write`, `patch`, `multiedit`). ### [read](#read) Read file contents from your codebase. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"read\": \"allow\" }} ``` This tool reads files and returns their contents. It supports reading specific line ranges for large files. ### [grep](#grep) Search file contents using regular expressions. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"grep\": \"allow\" }} ``` Fast content search across your codebase. Supports full regex syntax and file pattern filtering. ### [glob](#glob) Find files by pattern matching. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"glob\": \"allow\" }} ``` Search for files using glob patterns like `**/*.js` or `src/**/*.ts`. Returns matching file paths sorted by modification time. ### [list](#list) List files and directories in a given path. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"list\": \"allow\" }} ``` This tool lists directory contents. It accepts glob patterns to filter results. ### [lsp (experimental)](#lsp-experimental) Interact with your configured LSP servers to get code intelligence features like definitions, references, hover info, and call hierarchy. NoteThis tool is only available when `OPENCODE_EXPERIMENTAL_LSP_TOOL=true` (or `OPENCODE_EXPERIMENTAL=true`). opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"lsp\": \"allow\" }} ``` Supported operations include `goToDefinition`, `findReferences`, `hover`, `documentSymbol`, `workspaceSymbol`, `goToImplementation`, `prepareCallHierarchy`, `incomingCalls`, and `outgoingCalls`. To configure which LSP servers are available for your project, see [LSP Servers](/docs/lsp). ### [patch](#patch) Apply patches to files. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"edit\": \"allow\" }} ``` This tool applies patch files to your codebase. Useful for applying diffs and patches from various sources. NoteThe `patch` tool is controlled by the `edit` permission, which covers all file modifications (`edit`, `write`, `patch`, `multiedit`). ### [skill](#skill) Load a [skill](/docs/skills) (a `SKILL.md` file) and return its content in the conversation. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"skill\": \"allow\" }} ``` ### [todowrite](#todowrite) Manage todo lists during coding sessions. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"todowrite\": \"allow\" }} ``` Creates and updates task lists to track progress during complex operations. The LLM uses this to organize multi-step tasks. NoteThis tool is disabled for subagents by default, but you can enable it manually. [Learn more](/docs/agents/#permissions) ### [todoread](#todoread) Read existing todo lists. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"todoread\": \"allow\" }} ``` Reads the current todo list state. Used by the LLM to track what tasks are pending or completed. NoteThis tool is disabled for subagents by default, but you can enable it manually. [Learn more](/docs/agents/#permissions) ### [webfetch](#webfetch) Fetch web content. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"webfetch\": \"allow\" }} ``` Allows the LLM to fetch and read web pages. Useful for looking up documentation or researching online resources. ### [websearch](#websearch) Search the web for information. NoteThis tool is only available when using the OpenCode provider or when the `OPENCODE_ENABLE_EXA` environment variable is set to any truthy value (e.g., `true` or `1`).To enable when launching OpenCode:Terminal window ``` OPENCODE_ENABLE_EXA=1 opencode ``` opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"websearch\": \"allow\" }} ``` Performs web searches using Exa AI to find relevant information online. Useful for researching topics, finding current events, or gathering information beyond the training data cutoff. No API key is required  the tool connects directly to Exa AIs hosted MCP service without authentication. TipUse `websearch` when you need to find information (discovery), and `webfetch` when you need to retrieve content from a specific URL (retrieval). ### [question](#question) Ask the user questions during execution. opencode.json ``` { \"$schema\": \"https://opencode.ai/config.json\", \"permission\": { \"question\": \"allow\" }} ``` This tool allows the LLM to ask the user questions during a task. Its useful for: Gathering user preferences or requirements\n\n- Clarifying ambiguous instructions\n\n- Getting decisions on implementation choices\n\n- Offering choices about what direction to take\n\nEach question includes a header, the question text, and a list of options. Users can select from the provided options or type a custom answer. When there are multiple questions, users can navigate between them before submitting all answers.\n\n## [Custom tools](#custom-tools)\n\nCustom tools let you define your own functions that the LLM can call. These are defined in your config file and can execute arbitrary code.\n\n[Learn more](/docs/custom-tools) about creating custom tools.\n\n## [MCP servers](#mcp-servers)\n\nMCP (Model Context Protocol) servers allow you to integrate external tools and services. This includes database access, API integrations, and third-party services.\n\n[Learn more](/docs/mcp-servers) about configuring MCP servers.\n\n## [Internals](#internals)\n\nInternally, tools like `grep`, `glob`, and `list` use [ripgrep](https://github.com/BurntSushi/ripgrep) under the hood. By default, ripgrep respects `.gitignore` patterns, which means files and directories listed in your `.gitignore` will be excluded from searches and listings.\n\n### [Ignore patterns](#ignore-patterns)\n\nTo include files that would normally be ignored, create a `.ignore` file in your project root. This file can explicitly allow certain paths.\n\n.ignore\n\n```\n!node_modules/!dist/!build/\n```\n\nFor example, this `.ignore` file allows ripgrep to search within `node_modules/`, `dist/`, and `build/` directories even if theyre listed in `.gitignore`.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/tools.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 75,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__troubleshooting.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/troubleshooting\n- Keywords: opencode, docs, ai coding assistant, cli, troubleshooting\n- Summary: Common issues and how to resolve them.\n----\n\nSource: https://opencode.ai/docs/troubleshooting\n\n# Troubleshooting\n\nCommon issues and how to resolve them.\n\nTo debug issues with OpenCode, start by checking the logs and local data it stores on disk.\n\n## [Logs](#logs)\n\nLog files are written to:\n\n- macOS/Linux: `~/.local/share/opencode/log/`\n\n- Windows: Press `WIN+R` and paste `%USERPROFILE%\\.local\\share\\opencode\\log`\n\nLog files are named with timestamps (e.g., `2025-01-09T123456.log`) and the most recent 10 log files are kept.\n\nYou can set the log level with the `--log-level` command-line option to get more detailed debug information. For example, `opencode --log-level DEBUG`.\n\n## [Storage](#storage)\n\nopencode stores session data and other application data on disk at:\n\n- macOS/Linux: `~/.local/share/opencode/`\n\n- Windows: Press `WIN+R` and paste `%USERPROFILE%\\.local\\share\\opencode`\n\nThis directory contains:\n\n- `auth.json` - Authentication data like API keys, OAuth tokens\n\n- `log/` - Application logs\n\n- `project/` - Project-specific data like session and message data If the project is within a Git repo, it is stored in `./&#x3C;project-slug>/storage/`\n\n- If it is not a Git repo, it is stored in `./global/storage/`\n\n## [Desktop app](#desktop-app)\n\nOpenCode Desktop runs a local OpenCode server (the `opencode-cli` sidecar) in the background. Most issues are caused by a misbehaving plugin, a corrupted cache, or a bad server setting.\n\n### [Quick checks](#quick-checks)\n\n- Fully quit and relaunch the app.\n\n- If the app shows an error screen, click Restart and copy the error details.\n\n- macOS only: `OpenCode` menu -> Reload Webview (helps if the UI is blank/frozen).\n\n### [Disable plugins](#disable-plugins)\n\nIf the desktop app is crashing on launch, hanging, or behaving strangely, start by disabling plugins.\n\n#### [Check the global config](#check-the-global-config)\n\nOpen your global config file and look for a `plugin` key.\n\n- macOS/Linux: `~/.config/opencode/opencode.jsonc` (or `~/.config/opencode/opencode.json`)\n\n- macOS/Linux (older installs): `~/.local/share/opencode/opencode.jsonc`\n\n- Windows: Press `WIN+R` and paste `%USERPROFILE%\\.config\\opencode\\opencode.jsonc`\n\nIf you have plugins configured, temporarily disable them by removing the key or setting it to an empty array:\n\n- ``` { \"$schema\": \"https://opencode.ai/config.json\", \"plugin\": [],} ``` #### [Check plugin directories](#check-plugin-directories) OpenCode can also load local plugins from disk. Temporarily move these out of the way (or rename the folder) and restart the desktop app: Global plugins macOS/Linux: `~/.config/opencode/plugins/`\n\n- Windows: Press `WIN+R` and paste `%USERPROFILE%\\.config\\opencode\\plugins`\n\n- Project plugins (only if you use per-project config) `&#x3C;your-project>/.opencode/plugins/`\n\nIf the app starts working again, re-enable plugins one at a time to find which one is causing the issue.\n\n### [Clear the cache](#clear-the-cache)\n\nIf disabling plugins doesnt help (or a plugin install is stuck), clear the cache so OpenCode can rebuild it.\n\n- Quit OpenCode Desktop completely.\n\n- Delete the cache directory:\n\n- macOS: Finder -> `Cmd+Shift+G` -> paste `~/.cache/opencode`\n\n- Linux: delete `~/.cache/opencode` (or run `rm -rf ~/.cache/opencode`)\n\n- Windows: Press `WIN+R` and paste `%USERPROFILE%\\.cache\\opencode`\n\n- Restart OpenCode Desktop.\n\n### [Fix server connection issues](#fix-server-connection-issues)\n\nOpenCode Desktop can either start its own local server (default) or connect to a server URL you configured.\n\nIf you see a Connection Failed dialog (or the app never gets past the splash screen), check for a custom server URL.\n\n#### [Clear the desktop default server URL](#clear-the-desktop-default-server-url)\n\nFrom the Home screen, click the server name (with the status dot) to open the Server picker. In the Default server section, click Clear.\n\n#### [Remove `server.port` / `server.hostname` from your config](#remove-serverport--serverhostname-from-your-config)\n\nIf your `opencode.json(c)` contains a `server` section, temporarily remove it and restart the desktop app.\n\n#### [Check environment variables](#check-environment-variables)\n\nIf you have `OPENCODE_PORT` set in your environment, the desktop app will try to use that port for the local server.\n\n- Unset `OPENCODE_PORT` (or pick a free port) and restart.\n\n### [Linux: Wayland / X11 issues](#linux-wayland--x11-issues)\n\nOn Linux, some Wayland setups can cause blank windows or compositor errors.\n\n- If youre on Wayland and the app is blank/crashing, try launching with `OC_ALLOW_WAYLAND=1`.\n\n- If that makes things worse, remove it and try launching under an X11 session instead.\n\n### [Windows: WebView2 runtime](#windows-webview2-runtime)\n\nOn Windows, OpenCode Desktop requires the Microsoft Edge WebView2 Runtime. If the app opens to a blank window or wont start, install/update WebView2 and try again.\n\n### [Windows: General performance issues](#windows-general-performance-issues)\n\nIf youre experiencing slow performance, file access issues, or terminal problems on Windows, try using [WSL (Windows Subsystem for Linux)](/docs/windows-wsl). WSL provides a Linux environment that works more seamlessly with OpenCodes features.\n\n### [Notifications not showing](#notifications-not-showing)\n\nOpenCode Desktop only shows system notifications when:\n\n- notifications are enabled for OpenCode in your OS settings, and\n\n- the app window is not focused.\n\n### [Reset desktop app storage (last resort)](#reset-desktop-app-storage-last-resort)\n\nIf the app wont start and you cant clear settings from inside the UI, reset the desktop apps saved state.\n\n- Quit OpenCode Desktop.\n\n- Find and delete these files (they live in the OpenCode Desktop app data directory):\n\n- `opencode.settings.dat` (desktop default server URL)\n\n- `opencode.global.dat` and `opencode.workspace.*.dat` (UI state like recent servers/projects)\n\nTo find the directory quickly:\n\n- macOS: Finder -> `Cmd+Shift+G` -> `~/Library/Application Support` (then search for the filenames above)\n\n- Linux: search under `~/.local/share` for the filenames above\n\n- Windows: Press `WIN+R` -> `%APPDATA%` (then search for the filenames above)\n\n## [Getting help](#getting-help)\n\nIf youre experiencing issues with OpenCode:\n\n- Report issues on GitHub The best way to report bugs or request features is through our GitHub repository: [github.com/anomalyco/opencode/issues](https://github.com/anomalyco/opencode/issues) Before creating a new issue, search existing issues to see if your problem has already been reported.\n\n- Join our Discord For real-time help and community discussion, join our Discord server: [opencode.ai/discord](https://opencode.ai/discord)\n\n## [Common issues](#common-issues)\n\nHere are some common issues and how to resolve them.\n\n### [OpenCode wont start](#opencode-wont-start)\n\n- Check the logs for error messages\n\n- Try running with `--print-logs` to see output in the terminal\n\n- Ensure you have the latest version with `opencode upgrade`\n\n### [Authentication issues](#authentication-issues)\n\n- Try re-authenticating with the `/connect` command in the TUI\n\n- Check that your API keys are valid\n\n- Ensure your network allows connections to the providers API\n\n### [Model not available](#model-not-available)\n\n- Check that youve authenticated with the provider\n\n- Verify the model name in your config is correct\n\n- Some models may require specific access or subscriptions\n\nIf you encounter `ProviderModelNotFoundError` you are most likely incorrectly\nreferencing a model somewhere.\nModels should be referenced like so: `&#x3C;providerId>/&#x3C;modelId>`\n\nExamples:\n\n- `openai/gpt-4.1`\n\n- `openrouter/google/gemini-2.5-flash`\n\n- `opencode/kimi-k2`\n\nTo figure out what models you have access to, run `opencode models`\n\n### [ProviderInitError](#provideriniterror)\n\nIf you encounter a ProviderInitError, you likely have an invalid or corrupted configuration.\n\nTo resolve this:\n\n- First, verify your provider is set up correctly by following the [providers guide](/docs/providers)\n\n- If the issue persists, try clearing your stored configuration: Terminal window ``` rm -rf ~/.local/share/opencode ``` On Windows, press `WIN+R` and delete: `%USERPROFILE%\\.local\\share\\opencode`\n\n- Re-authenticate with your provider using the `/connect` command in the TUI.\n\n### [AI_APICallError and provider package issues](#ai_apicallerror-and-provider-package-issues)\n\nIf you encounter API call errors, this may be due to outdated provider packages. opencode dynamically installs provider packages (OpenAI, Anthropic, Google, etc.) as needed and caches them locally.\n\nTo resolve provider package issues:\n\n- Clear the provider package cache: Terminal window ``` rm -rf ~/.cache/opencode ``` On Windows, press `WIN+R` and delete: `%USERPROFILE%\\.cache\\opencode`\n\n- Restart opencode to reinstall the latest provider packages\n\nThis will force opencode to download the most recent versions of provider packages, which often resolves compatibility issues with model parameters and API changes.\n\n### [Copy/paste not working on Linux](#copypaste-not-working-on-linux)\n\nLinux users need to have one of the following clipboard utilities installed for copy/paste functionality to work:\n\nFor X11 systems:\n\nTerminal window\n\n```\napt install -y xclip# orapt install -y xsel\n```\n\nFor Wayland systems:\n\nTerminal window\n\n```\napt install -y wl-clipboard\n```\n\nFor headless environments:\n\nTerminal window\n\n```\napt install -y xvfb# and run:Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&#x26;1 &#x26;export DISPLAY=:99.0\n```\n\nopencode will detect if youre using Wayland and prefer `wl-clipboard`, otherwise it will try to find clipboard tools in order of: `xclip` and `xsel`.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/troubleshooting.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 281,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__tui.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/tui\n- Keywords: opencode, docs, ai coding assistant, cli, tui\n- Summary: Using the OpenCode terminal user interface.\n----\n\nSource: https://opencode.ai/docs/tui\n\n# TUI\n\nUsing the OpenCode terminal user interface.\n\nOpenCode provides an interactive terminal interface or TUI for working on your projects with an LLM.\n\nRunning OpenCode starts the TUI for the current directory.\n\n- Terminal window ``` opencode ``` Or you can start it for a specific working directory. Terminal window ``` opencode /path/to/project ``` Once youre in the TUI, you can prompt it with a message. ``` Give me a quick summary of the codebase. ``` ## [File references](#file-references) You can reference files in your messages using `@`. This does a fuzzy file search in the current working directory. TipYou can also use `@` to reference files in your messages. ``` How is auth handled in @packages/functions/src/api/index.ts? ``` The content of the file is added to the conversation automatically. ## [Bash commands](#bash-commands) Start a message with `!` to run a shell command. ``` !ls -la ``` The output of the command is added to the conversation as a tool result. ## [Commands](#commands) When using the OpenCode TUI, you can type `/` followed by a command name to quickly execute actions. For example: ``` /help ``` Most commands also have keybind using `ctrl+x` as the leader key, where `ctrl+x` is the default leader key. [Learn more](/docs/keybinds). Here are all available slash commands: ### [connect](#connect) Add a provider to OpenCode. Allows you to select from available providers and add their API keys. ``` /connect ``` ### [compact](#compact) Compact the current session. Alias: `/summarize` ``` /compact ``` Keybind: `ctrl+x c` ### [details](#details) Toggle tool execution details. ``` /details ``` Keybind: `ctrl+x d` ### [editor](#editor) Open external editor for composing messages. Uses the editor set in your `EDITOR` environment variable. [Learn more](#editor-setup). ``` /editor ``` Keybind: `ctrl+x e` ### [exit](#exit) Exit OpenCode. Aliases: `/quit`, `/q` ``` /exit ``` Keybind: `ctrl+x q` ### [export](#export) Export current conversation to Markdown and open in your default editor. Uses the editor set in your `EDITOR` environment variable. [Learn more](#editor-setup). ``` /export ``` Keybind: `ctrl+x x` ### [help](#help) Show the help dialog. ``` /help ``` Keybind: `ctrl+x h` ### [init](#init) Create or update `AGENTS.md` file. [Learn more](/docs/rules). ``` /init ``` Keybind: `ctrl+x i` ### [models](#models) List available models. ``` /models ``` Keybind: `ctrl+x m` ### [new](#new) Start a new session. Alias: `/clear` ``` /new ``` Keybind: `ctrl+x n` ### [redo](#redo) Redo a previously undone message. Only available after using `/undo`. TipAny file changes will also be restored. Internally, this uses Git to manage the file changes. So your project needs to be a Git repository. ``` /redo ``` Keybind: `ctrl+x r` ### [sessions](#sessions) List and switch between sessions. Aliases: `/resume`, `/continue` ``` /sessions ``` Keybind: `ctrl+x l` ### [share](#share) Share current session. [Learn more](/docs/share). ``` /share ``` Keybind: `ctrl+x s` ### [themes](#themes) List available themes. ``` /theme ``` Keybind: `ctrl+x t` ### [thinking](#thinking) Toggle the visibility of thinking/reasoning blocks in the conversation. When enabled, you can see the models reasoning process for models that support extended thinking. NoteThis command only controls whether thinking blocks are displayed - it does not enable or disable the models reasoning capabilities. To toggle actual reasoning capabilities, use `ctrl+t` to cycle through model variants. ``` /thinking ``` ### [undo](#undo) Undo last message in the conversation. Removes the most recent user message, all subsequent responses, and any file changes. TipAny file changes made will also be reverted. Internally, this uses Git to manage the file changes. So your project needs to be a Git repository. ``` /undo ``` Keybind: `ctrl+x u` ### [unshare](#unshare) Unshare current session. [Learn more](/docs/share#un-sharing). ``` /unshare ``` ## [Editor setup](#editor-setup) Both the `/editor` and `/export` commands use the editor specified in your `EDITOR` environment variable. [Linux/macOS](#tab-panel-4)\n- [Windows (CMD)](#tab-panel-5)\n- [Windows (PowerShell)](#tab-panel-6)\n\nTerminal window\n\n```\n# Example for nano or vimexport EDITOR=nanoexport EDITOR=vim\n# For GUI editors, VS Code, Cursor, VSCodium, Windsurf, Zed, etc.# include --waitexport EDITOR=\"code --wait\"\n```\n\nTo make it permanent, add this to your shell profile;\n`~/.bashrc`, `~/.zshrc`, etc.\n\nTerminal window\n\n```\nset EDITOR=notepad\n# For GUI editors, VS Code, Cursor, VSCodium, Windsurf, Zed, etc.# include --waitset EDITOR=code --wait\n```\n\nTo make it permanent, use System Properties > Environment\nVariables.\n\nTerminal window\n\n```\n$env:EDITOR = \"notepad\"\n# For GUI editors, VS Code, Cursor, VSCodium, Windsurf, Zed, etc.# include --wait$env:EDITOR = \"code --wait\"\n```\n\nTo make it permanent, add this to your PowerShell profile.\n\nPopular editor options include:\n\n- `code` - Visual Studio Code\n\n- `cursor` - Cursor\n\n- `windsurf` - Windsurf\n\n- `nvim` - Neovim editor\n\n- `vim` - Vim editor\n\n- `nano` - Nano editor\n\n- `notepad` - Windows Notepad\n\n- `subl` - Sublime Text\n\nNote\n\nSome editors like VS Code need to be started with the `--wait` flag.\n\nSome editors need command-line arguments to run in blocking mode. The `--wait` flag makes the editor process block until closed.\n\n## [Configure](#configure)\n\nYou can customize TUI behavior through your OpenCode config file.\n\nopencode.json\n\n```\n{  \"$schema\": \"https://opencode.ai/config.json\",  \"tui\": {    \"scroll_speed\": 3,    \"scroll_acceleration\": {      \"enabled\": true    }  }}\n```\n\n### [Options](#options)\n\n- `scroll_acceleration` - Enable macOS-style scroll acceleration for smooth, natural scrolling. When enabled, scroll speed increases with rapid scrolling gestures and stays precise for slower movements. This setting takes precedence over `scroll_speed` and overrides it when enabled.\n\n- `scroll_speed` - Controls how fast the TUI scrolls when using scroll commands (minimum: `1`). Defaults to `3`. Note: This is ignored if `scroll_acceleration.enabled` is set to `true`.\n\n## [Customization](#customization)\n\nYou can customize various aspects of the TUI view using the command palette (`ctrl+x h` or `/help`). These settings persist across restarts.\n\n#### [Username display](#username-display)\n\nToggle whether your username appears in chat messages. Access this through:\n\n- Command palette: Search for username or hide username\n\n- The setting persists automatically and will be remembered across TUI sessions\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/tui.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 118,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__web.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/web\n- Keywords: opencode, docs, ai coding assistant, cli, web\n- Summary: Using OpenCode in your browser.\n----\n\nSource: https://opencode.ai/docs/web\n\n# Web\n\nUsing OpenCode in your browser.\n\nOpenCode can run as a web application in your browser, providing the same powerful AI coding experience without needing a terminal.\n\n## [Getting Started](#getting-started)\n\nStart the web interface by running:\n\nTerminal window\n\n```\nopencode web\n```\n\nThis starts a local server on `127.0.0.1` with a random available port and automatically opens OpenCode in your default browser.\n\nCaution\n\nIf `OPENCODE_SERVER_PASSWORD` is not set, the server will be unsecured. This is fine for local use but should be set for network access.\n\nWindows Users\n\nFor the best experience, run `opencode web` from [WSL](/docs/windows-wsl) rather than PowerShell. This ensures proper file system access and terminal integration.\n\n## [Configuration](#configuration)\n\nYou can configure the web server using command line flags or in your [config file](/docs/config).\n\n### [Port](#port)\n\nBy default, OpenCode picks an available port. You can specify a port:\n\nTerminal window\n\n```\nopencode web --port 4096\n```\n\n### [Hostname](#hostname)\n\nBy default, the server binds to `127.0.0.1` (localhost only). To make OpenCode accessible on your network:\n\nTerminal window\n\n```\nopencode web --hostname 0.0.0.0\n```\n\nWhen using `0.0.0.0`, OpenCode will display both local and network addresses:\n\n```\nLocal access:       http://localhost:4096  Network access:     http://192.168.1.100:4096\n```\n\n### [mDNS Discovery](#mdns-discovery)\n\nEnable mDNS to make your server discoverable on the local network:\n\nTerminal window\n\n```\nopencode web --mdns\n```\n\nThis automatically sets the hostname to `0.0.0.0` and advertises the server as `opencode.local`.\n\nYou can customize the mDNS domain name to run multiple instances on the same network:\n\nTerminal window\n\n```\nopencode web --mdns --mdns-domain myproject.local\n```\n\n### [CORS](#cors)\n\nTo allow additional domains for CORS (useful for custom frontends):\n\nTerminal window\n\n```\nopencode web --cors https://example.com\n```\n\n### [Authentication](#authentication)\n\nTo protect access, set a password using the `OPENCODE_SERVER_PASSWORD` environment variable:\n\nTerminal window\n\n```\nOPENCODE_SERVER_PASSWORD=secret opencode web\n```\n\nThe username defaults to `opencode` but can be changed with `OPENCODE_SERVER_USERNAME`.\n\n## [Using the Web Interface](#using-the-web-interface)\n\nOnce started, the web interface provides access to your OpenCode sessions.\n\n### [Sessions](#sessions)\n\nView and manage your sessions from the homepage. You can see active sessions and start new ones.\n\n### [Server Status](#server-status)\n\nClick See Servers to view connected servers and their status.\n\n## [Attaching a Terminal](#attaching-a-terminal)\n\nYou can attach a terminal TUI to a running web server:\n\nTerminal window\n\n```\n# Start the web serveropencode web --port 4096\n# In another terminal, attach the TUIopencode attach http://localhost:4096\n```\n\nThis allows you to use both the web interface and terminal simultaneously, sharing the same sessions and state.\n\n## [Config File](#config-file)\n\nYou can also configure server settings in your `opencode.json` config file:\n\n```\n{  \"server\": {    \"port\": 4096,    \"hostname\": \"0.0.0.0\",    \"mdns\": true,    \"cors\": [\"https://example.com\"]  }}\n```\n\nCommand line flags take precedence over config file settings.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/web.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 158,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__windows-wsl.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/windows-wsl\n- Keywords: opencode, docs, ai coding assistant, cli, windows wsl\n- Summary: Run OpenCode on Windows using WSL for the best experience.\n----\n\nSource: https://opencode.ai/docs/windows-wsl\n\n# Windows (WSL)\n\nRun OpenCode on Windows using WSL for the best experience.\n\nWhile OpenCode can run directly on Windows, we recommend using [Windows Subsystem for Linux (WSL)](https://learn.microsoft.com/en-us/windows/wsl/install) for the best experience. WSL provides a Linux environment that works seamlessly with OpenCodes features.\n\nWhy WSL?\n\nWSL offers better file system performance, full terminal support, and compatibility with development tools that OpenCode relies on.\n\n## [Setup](#setup)\n\n- Install WSL If you havent already, [install WSL](https://learn.microsoft.com/en-us/windows/wsl/install) using the official Microsoft guide.\n\n- Install OpenCode in WSL Once WSL is set up, open your WSL terminal and install OpenCode using one of the [installation methods](/docs/). Terminal window ``` curl -fsSL https://opencode.ai/install | bash ```\n\n- Use OpenCode from WSL Navigate to your project directory (access Windows files via `/mnt/c/`, `/mnt/d/`, etc.) and run OpenCode. Terminal window ``` cd /mnt/c/Users/YourName/projectopencode ```\n\n## [Desktop App + WSL Server](#desktop-app--wsl-server)\n\nIf you prefer using the OpenCode Desktop app but want to run the server in WSL:\n\n- Start the server in WSL with `--hostname 0.0.0.0` to allow external connections: Terminal window ``` opencode serve --hostname 0.0.0.0 --port 4096 ```\n\n- Connect the Desktop app to `http://localhost:4096`\n\nNote\n\nIf `localhost` does not work in your setup, connect using the WSL IP address instead (from WSL: `hostname -I`) and use `http://&#x3C;wsl-ip>:4096`.\n\nCaution\n\nWhen using `--hostname 0.0.0.0`, set `OPENCODE_SERVER_PASSWORD` to secure the server.\n\nTerminal window\n\n```\nOPENCODE_SERVER_PASSWORD=your-password opencode serve --hostname 0.0.0.0\n```\n\n## [Web Client + WSL](#web-client--wsl)\n\nFor the best web experience on Windows:\n\n- Run `opencode web` in the WSL terminal rather than PowerShell: Terminal window ``` opencode web --hostname 0.0.0.0 ```\n\n- Access from your Windows browser at `http://localhost:&#x3C;port>` (OpenCode prints the URL)\n\nRunning `opencode web` from WSL ensures proper file system access and terminal integration while still being accessible from your Windows browser.\n\n## [Accessing Windows Files](#accessing-windows-files)\n\nWSL can access all your Windows files through the `/mnt/` directory:\n\n- `C:` drive  `/mnt/c/`\n\n- `D:` drive  `/mnt/d/`\n\n- And so on\n\nExample:\n\nTerminal window\n\n```\ncd /mnt/c/Users/YourName/Documents/projectopencode\n```\n\nTip\n\nFor the smoothest experience, consider cloning/copying your repo into the WSL filesystem (for example under `~/code/`) and running OpenCode there.\n\n## [Tips](#tips)\n\n- Keep OpenCode running in WSL for projects stored on Windows drives - file access is seamless\n\n- Use VS Codes [WSL extension](https://code.visualstudio.com/docs/remote/wsl) alongside OpenCode for an integrated development workflow\n\n- Your OpenCode config and sessions are stored within the WSL environment at `~/.local/share/opencode/`\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/windows-wsl.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 105,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/docs__zen.ext.md",
              "before": "",
              "after": "----\n## External Docs Snapshot // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Source page: /docs/zen\n- Keywords: opencode, docs, ai coding assistant, cli, zen\n- Summary: Curated list of models provided by OpenCode.\n----\n\nSource: https://opencode.ai/docs/zen\n\n# Zen\n\nCurated list of models provided by OpenCode.\n\nOpenCode Zen is a list of tested and verified models provided by the OpenCode team.\n\nNote\n\nOpenCode Zen is currently in beta.\n\nZen works like any other provider in OpenCode. You login to OpenCode Zen and get\nyour API key. Its completely optional and you dont need to use it to use\nOpenCode.\n\n## [Background](#background)\n\nThere are a large number of models out there but only a few of\nthese models work well as coding agents. Additionally, most providers are\nconfigured very differently; so you get very different performance and quality.\n\nTip\n\nWe tested a select group of models and providers that work well with OpenCode.\n\nSo if you are using a model through something like OpenRouter, you can never be\nsure if you are getting the best version of the model you want.\n\nTo fix this, we did a couple of things:\n\n- We tested a select group of models and talked to their teams about how to best run them.\n\n- We then worked with a few providers to make sure these were being served correctly.\n\n- Finally, we benchmarked the combination of the model/provider and came up with a list that we feel good recommending.\n\nOpenCode Zen is an AI gateway that gives you access to these models.\n\n## [How it works](#how-it-works)\n\nOpenCode Zen works like any other provider in OpenCode.\n\n- You sign in to [OpenCode Zen](https://opencode.ai/auth), add your billing details, and copy your API key.\n\n- You run the `/connect` command in the TUI, select OpenCode Zen, and paste your API key.\n\n- Run `/models` in the TUI to see the list of models we recommend.\n\nYou are charged per request and you can add credits to your account.\n\n## [Endpoints](#endpoints)\n\nYou can also access our models through the following API endpoints.\n\nModel Model ID Endpoint AI SDK Package\n\nGPT 5.2 gpt-5.2 `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nGPT 5.2 Codex gpt-5.2-codex `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nGPT 5.1 gpt-5.1 `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nGPT 5.1 Codex gpt-5.1-codex `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nGPT 5.1 Codex Max gpt-5.1-codex-max `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nGPT 5.1 Codex Mini gpt-5.1-codex-mini `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nGPT 5 gpt-5 `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nGPT 5 Codex gpt-5-codex `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nGPT 5 Nano gpt-5-nano `https://opencode.ai/zen/v1/responses` `@ai-sdk/openai`\n\nClaude Sonnet 4.5 claude-sonnet-4-5 `https://opencode.ai/zen/v1/messages` `@ai-sdk/anthropic`\n\nClaude Sonnet 4 claude-sonnet-4 `https://opencode.ai/zen/v1/messages` `@ai-sdk/anthropic`\n\nClaude Haiku 4.5 claude-haiku-4-5 `https://opencode.ai/zen/v1/messages` `@ai-sdk/anthropic`\n\nClaude Haiku 3.5 claude-3-5-haiku `https://opencode.ai/zen/v1/messages` `@ai-sdk/anthropic`\n\nClaude Opus 4.6 claude-opus-4-6 `https://opencode.ai/zen/v1/messages` `@ai-sdk/anthropic`\n\nClaude Opus 4.5 claude-opus-4-5 `https://opencode.ai/zen/v1/messages` `@ai-sdk/anthropic`\n\nClaude Opus 4.1 claude-opus-4-1 `https://opencode.ai/zen/v1/messages` `@ai-sdk/anthropic`\n\nGemini 3 Pro gemini-3-pro `https://opencode.ai/zen/v1/models/gemini-3-pro` `@ai-sdk/google`\n\nGemini 3 Flash gemini-3-flash `https://opencode.ai/zen/v1/models/gemini-3-flash` `@ai-sdk/google`\n\nMiniMax M2.5 minimax-m2.5 `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nMiniMax M2.5 Free minimax-m2.5-free `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nMiniMax M2.1 minimax-m2.1 `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nGLM 5 glm-5 `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nGLM 4.7 glm-4.7 `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nGLM 4.6 glm-4.6 `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nKimi K2.5 kimi-k2.5 `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nKimi K2.5 Free kimi-k2.5-free `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nKimi K2 Thinking kimi-k2-thinking `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nKimi K2 kimi-k2 `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nQwen3 Coder 480B qwen3-coder `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nBig Pickle big-pickle `https://opencode.ai/zen/v1/chat/completions` `@ai-sdk/openai-compatible`\n\nThe [model id](/docs/config/#models) in your OpenCode config\nuses the format `opencode/&#x3C;model-id>`. For example, for GPT 5.2 Codex, you would\nuse `opencode/gpt-5.2-codex` in your config.\n\n### [Models](#models)\n\nYou can fetch the full list of available models and their metadata from:\n\n- ``` https://opencode.ai/zen/v1/models ``` ## [Pricing](#pricing) We support a pay-as-you-go model. Below are the prices per 1M tokens. ModelInputOutputCached ReadCached WriteBig PickleFreeFreeFree-MiniMax M2.5 FreeFreeFreeFree-MiniMax M2.5$0.30$1.20$0.06-MiniMax M2.1$0.30$1.20$0.10-GLM 5$1.00$3.20$0.20-GLM 4.7$0.60$2.20$0.10-GLM 4.6$0.60$2.20$0.10-Kimi K2.5 FreeFreeFreeFree-Kimi K2.5$0.60$3.00$0.08-Kimi K2 Thinking$0.40$2.50--Kimi K2$0.40$2.50--Qwen3 Coder 480B$0.45$1.50--Claude Sonnet 4.5 ( 200K tokens)$3.00$15.00$0.30$3.75Claude Sonnet 4.5 (> 200K tokens)$6.00$22.50$0.60$7.50Claude Sonnet 4 ( 200K tokens)$3.00$15.00$0.30$3.75Claude Sonnet 4 (> 200K tokens)$6.00$22.50$0.60$7.50Claude Haiku 4.5$1.00$5.00$0.10$1.25Claude Haiku 3.5$0.80$4.00$0.08$1.00Claude Opus 4.6 ( 200K tokens)$5.00$25.00$0.50$6.25Claude Opus 4.6 (> 200K tokens)$10.00$37.50$1.00$12.50Claude Opus 4.5$5.00$25.00$0.50$6.25Claude Opus 4.1$15.00$75.00$1.50$18.75Gemini 3 Pro ( 200K tokens)$2.00$12.00$0.20-Gemini 3 Pro (> 200K tokens)$4.00$18.00$0.40-Gemini 3 Flash$0.50$3.00$0.05-GPT 5.2$1.75$14.00$0.175-GPT 5.2 Codex$1.75$14.00$0.175-GPT 5.1$1.07$8.50$0.107-GPT 5.1 Codex$1.07$8.50$0.107-GPT 5.1 Codex Max$1.25$10.00$0.125-GPT 5.1 Codex Mini$0.25$2.00$0.025-GPT 5$1.07$8.50$0.107-GPT 5 Codex$1.07$8.50$0.107-GPT 5 NanoFreeFreeFree- You might notice Claude Haiku 3.5 in your usage history. This is a [low cost model](/docs/config/#models) thats used to generate the titles of your sessions. NoteCredit card fees are passed along at cost (4.4% + $0.30 per transaction); we dont charge anything beyond that. The free models: Kimi K2.5 Free is available on OpenCode for a limited time. The team is using this time to collect feedback and improve the model.\n\n- MiniMax M2.5 Free is available on OpenCode for a limited time. The team is using this time to collect feedback and improve the model.\n\n- Big Pickle is a stealth model thats free on OpenCode for a limited time. The team is using this time to collect feedback and improve the model.\n\n[Contact us](mailto:contact@anoma.ly) if you have any questions.\n\n### [Auto-reload](#auto-reload)\n\nIf your balance goes below $5, Zen will automatically reload $20.\n\nYou can change the auto-reload amount. You can also disable auto-reload entirely.\n\n### [Monthly limits](#monthly-limits)\n\nYou can also set a monthly usage limit for the entire workspace and for each\nmember of your team.\n\nFor example, lets say you set a monthly usage limit to $20, Zen will not use\nmore than $20 in a month. But if you have auto-reload enabled, Zen might end up\ncharging you more than $20 if your balance goes below $5.\n\n## [Privacy](#privacy)\n\nAll our models are hosted in the US. Our providers follow a zero-retention policy and do not use your data for model training, with the following exceptions:\n\n- Big Pickle: During its free period, collected data may be used to improve the model.\n\n- Kimi K2.5 Free: During its free period, collected data may be used to improve the model.\n\n- MiniMax M2.5 Free: During its free period, collected data may be used to improve the model.\n\n- OpenAI APIs: Requests are retained for 30 days in accordance with [OpenAIs Data Policies](https://platform.openai.com/docs/guides/your-data).\n\n- Anthropic APIs: Requests are retained for 30 days in accordance with [Anthropics Data Policies](https://docs.anthropic.com/en/docs/claude-code/data-usage).\n\n## [For Teams](#for-teams)\n\nZen also works great for teams. You can invite teammates, assign roles, curate\nthe models your team uses, and more.\n\nNote\n\nWorkspaces are currently free for teams as a part of the beta.\n\nManaging your workspace is currently free for teams as a part of the beta. Well be\nsharing more details on the pricing soon.\n\n### [Roles](#roles)\n\nYou can invite teammates to your workspace and assign roles:\n\n- Admin: Manage models, members, API keys, and billing\n\n- Member: Manage only their own API keys\n\nAdmins can also set monthly spending limits for each member to keep costs under control.\n\n### [Model access](#model-access)\n\nAdmins can enable or disable specific models for the workspace. Requests made to a disabled model will return an error.\n\nThis is useful for cases where you want to disable the use of a model that\ncollects data.\n\n### [Bring your own key](#bring-your-own-key)\n\nYou can use your own OpenAI or Anthropic API keys while still accessing other models in Zen.\n\nWhen you use your own keys, tokens are billed directly by the provider, not by Zen.\n\nFor example, your organization might already have a key for OpenAI or Anthropic\nand you want to use that instead of the one that Zen provides.\n\n## [Goals](#goals)\n\nWe created OpenCode Zen to:\n\n- Benchmark the best models/providers for coding agents.\n\n- Have access to the highest quality options and not downgrade performance or route to cheaper providers.\n\n- Pass along any price drops by selling at cost; so the only markup is to cover our processing fees.\n\n- Have no lock-in by allowing you to use it with any other coding agent. And always let you use any other provider with OpenCode as well.\n\n[Edit page](https://github.com/anomalyco/opencode/edit/dev/packages/web/src/content/docs/zen.mdx)[Found a bug? Open an issue](https://github.com/anomalyco/opencode/issues/new)[Join our Discord community](https://opencode.ai/discord) Select language   EnglishBosanskiDanskDeutschEspaolFranaisItalianoNorsk BokmlPolskiPortugus (Brasil)Trke\n\n&copy; [Anomaly](https://anoma.ly)\n\nLast updated: Feb 15, 2026\n\n----\n## Notes / Comments / Lessons\n\n- Collection method: sitemap discovery + markdown conversion.\n- Conversion path: direct HTML fallback parser.\n- This file is one page-level external snapshot in markdown `.ext.md` format.\n----\n",
              "additions": 235,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "docs/external/opencode/index.ext.md",
              "before": "",
              "after": "----\n## External Docs Index // opencode\n\n- Captured: 2026-02-16T04:13:51.889Z\n- Source root: https://opencode.ai/docs\n- Output directory: docs/external/opencode\n- Scope: 34 pages under /docs\n- Keywords: opencode, docs index, ai coding assistant, cli\n- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\n----\n\n## Pages\n\n- [docs.ext.md](./docs.ext.md) - /docs (ok,mode=html)\n- [docs__acp.ext.md](./docs__acp.ext.md) - /docs/acp (ok,mode=html)\n- [docs__agents.ext.md](./docs__agents.ext.md) - /docs/agents (ok,mode=html)\n- [docs__cli.ext.md](./docs__cli.ext.md) - /docs/cli (ok,mode=html)\n- [docs__commands.ext.md](./docs__commands.ext.md) - /docs/commands (ok,mode=html)\n- [docs__config.ext.md](./docs__config.ext.md) - /docs/config (ok,mode=html)\n- [docs__custom-tools.ext.md](./docs__custom-tools.ext.md) - /docs/custom-tools (ok,mode=html)\n- [docs__ecosystem.ext.md](./docs__ecosystem.ext.md) - /docs/ecosystem (ok,mode=html)\n- [docs__enterprise.ext.md](./docs__enterprise.ext.md) - /docs/enterprise (ok,mode=html)\n- [docs__formatters.ext.md](./docs__formatters.ext.md) - /docs/formatters (ok,mode=html)\n- [docs__github.ext.md](./docs__github.ext.md) - /docs/github (ok,mode=html)\n- [docs__gitlab.ext.md](./docs__gitlab.ext.md) - /docs/gitlab (ok,mode=html)\n- [docs__ide.ext.md](./docs__ide.ext.md) - /docs/ide (ok,mode=html)\n- [docs__keybinds.ext.md](./docs__keybinds.ext.md) - /docs/keybinds (ok,mode=html)\n- [docs__lsp.ext.md](./docs__lsp.ext.md) - /docs/lsp (ok,mode=html)\n- [docs__mcp-servers.ext.md](./docs__mcp-servers.ext.md) - /docs/mcp-servers (ok,mode=html)\n- [docs__models.ext.md](./docs__models.ext.md) - /docs/models (ok,mode=html)\n- [docs__modes.ext.md](./docs__modes.ext.md) - /docs/modes (ok,mode=html)\n- [docs__network.ext.md](./docs__network.ext.md) - /docs/network (ok,mode=html)\n- [docs__permissions.ext.md](./docs__permissions.ext.md) - /docs/permissions (ok,mode=html)\n- [docs__plugins.ext.md](./docs__plugins.ext.md) - /docs/plugins (ok,mode=html)\n- [docs__providers.ext.md](./docs__providers.ext.md) - /docs/providers (ok,mode=html)\n- [docs__rules.ext.md](./docs__rules.ext.md) - /docs/rules (ok,mode=html)\n- [docs__sdk.ext.md](./docs__sdk.ext.md) - /docs/sdk (ok,mode=html)\n- [docs__server.ext.md](./docs__server.ext.md) - /docs/server (ok,mode=html)\n- [docs__share.ext.md](./docs__share.ext.md) - /docs/share (ok,mode=html)\n- [docs__skills.ext.md](./docs__skills.ext.md) - /docs/skills (ok,mode=html)\n- [docs__themes.ext.md](./docs__themes.ext.md) - /docs/themes (ok,mode=html)\n- [docs__tools.ext.md](./docs__tools.ext.md) - /docs/tools (ok,mode=html)\n- [docs__troubleshooting.ext.md](./docs__troubleshooting.ext.md) - /docs/troubleshooting (ok,mode=html)\n- [docs__tui.ext.md](./docs__tui.ext.md) - /docs/tui (ok,mode=html)\n- [docs__web.ext.md](./docs__web.ext.md) - /docs/web (ok,mode=html)\n- [docs__windows-wsl.ext.md](./docs__windows-wsl.ext.md) - /docs/windows-wsl (ok,mode=html)\n- [docs__zen.ext.md](./docs__zen.ext.md) - /docs/zen (ok,mode=html)\n\n----\n## Notes / Comments / Lessons\n\n- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\n- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\n- Capture results: success=34, failed=0.\n----\n",
              "additions": 55,
              "deletions": 0,
              "status": "added"
            },
            {
              "file": "scripts/scrape_opencode_docs.sh.ts",
              "before": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};\n\nconst SOURCE_KEY = \"opencode\";\nconst DOCS_ROOT = \"https://opencode.ai/docs\";\nconst SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\nconst DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\nconst CONCURRENCY = 4;\nconst SUMMARY_MAX_CHARS = 240;\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replaceAll(\"&amp;\", \"&\")\n    .replaceAll(\"&quot;\", '\"')\n    .replaceAll(\"&apos;\", \"'\")\n    .replaceAll(\"&#x27;\", \"'\")\n    .replaceAll(\"&#39;\", \"'\")\n    .replaceAll(\"&nbsp;\", \" \")\n    .replaceAll(\"&lt;\", \"<\")\n    .replaceAll(\"&gt;\", \">\");\n}\n\nfunction stripJinaEnvelope(markdown: string): string {\n  return markdown\n    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n    .trim();\n}\n\nfunction stripTags(value: string): string {\n  return value.replace(/<[^>]+>/g, \"\");\n}\n\nfunction plainTextFromHtml(value: string): string {\n  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n}\n\nfunction extractMainHtml(html: string): string {\n  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n  if (articleMatch?.[1]) {\n    return articleMatch[1];\n  }\n\n  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n  if (mainMatch?.[1]) {\n    return mainMatch[1];\n  }\n\n  return html;\n}\n\nfunction htmlToMarkdown(html: string): string {\n  let content = extractMainHtml(html);\n\n  content = content\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n\n  content = content.replace(\n    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n    (_match, code) => {\n      const normalizedCode = decodeEntities(\n        stripTags(code)\n          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n          .replace(/\\n{3,}/g, \"\\n\\n\")\n          .trim(),\n      );\n\n      if (!normalizedCode) {\n        return \"\";\n      }\n\n      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n    },\n  );\n\n  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n    const normalizedCode = decodeEntities(stripTags(code)).trim();\n    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n  });\n\n  content = content.replace(\n    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n    (_match, href, label) => {\n      const text = plainTextFromHtml(label);\n      if (!text) {\n        return \"\";\n      }\n\n      return `[${text}](${decodeEntities(href)})`;\n    },\n  );\n\n  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n    const heading = plainTextFromHtml(inner);\n    if (!heading) {\n      return \"\";\n    }\n\n    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n  });\n\n  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n    const line = plainTextFromHtml(inner);\n    return line ? `- ${line}\\n` : \"\";\n  });\n\n  content = content\n    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n      const cell = plainTextFromHtml(inner);\n      return cell ? `${cell} ` : \"\";\n    });\n\n  content = decodeEntities(content)\n    .replace(/<[^>]+>/g, \"\")\n    .replace(/[ \\t]+\\n/g, \"\\n\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .trim();\n\n  return content;\n}\n\nfunction sanitizeSegment(value: string): string {\n  const clean = decodeURIComponent(value)\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return clean || \"page\";\n}\n\nfunction sourcePathFromUrl(url: string): string {\n  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n  return pathname;\n}\n\nfunction fileStemFromUrl(url: string): string {\n  const sourcePath = sourcePathFromUrl(url);\n\n  if (sourcePath === \"/docs\") {\n    return \"docs\";\n  }\n\n  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n  const segments = relative\n    .split(\"/\")\n    .filter(Boolean)\n    .map(sanitizeSegment);\n\n  if (segments.length === 0) {\n    return \"docs\";\n  }\n\n  return [\"docs\", ...segments].join(\"__\");\n}\n\nfunction extractSummary(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  let inCodeBlock = false;\n\n  for (const rawLine of lines) {\n    const line = rawLine.trim();\n\n    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n      inCodeBlock = !inCodeBlock;\n      continue;\n    }\n\n    if (inCodeBlock) {\n      continue;\n    }\n\n    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n      continue;\n    }\n\n    if (line.length <= 25) {\n      continue;\n    }\n\n    if (line.length > SUMMARY_MAX_CHARS) {\n      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n    }\n\n    return line;\n  }\n\n  return \"OpenCode documentation page snapshot.\";\n}\n\nfunction keywordsForPath(sourcePath: string): string {\n  const dynamic = sourcePath\n    .split(\"/\")\n    .filter(Boolean)\n    .slice(1)\n    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n    .filter(Boolean)\n    .join(\", \");\n\n  const base = \"opencode, docs, ai coding assistant, cli\";\n  return dynamic ? `${base}, ${dynamic}` : base;\n}\n\nfunction buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n  const pageSummary = result.ok\n    ? extractSummary(result.markdown ?? \"\")\n    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  const pageBody = result.ok\n    ? result.markdown?.trim() ?? \"\"\n    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  return [\n    \"----\",\n    \"## External Docs Snapshot // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Source page: ${result.sourcePath}`,\n    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n    `- Summary: ${pageSummary}`,\n    \"----\",\n    \"\",\n    `Source: ${result.url}`,\n    \"\",\n    pageBody,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Collection method: sitemap discovery + markdown conversion.\",\n    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nfunction buildIndexMarkdown(\n  artifacts: PageArtifact[],\n  capturedAt: string,\n  outputDirRelative: string,\n): string {\n  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n  const failureCount = artifacts.length - successCount;\n\n  const pageList = artifacts\n    .map((artifact) => {\n      const status = artifact.ok ? \"ok\" : \"failed\";\n      const mode = artifact.mode ?? \"unknown\";\n      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n    })\n    .join(\"\\n\");\n\n  return [\n    \"----\",\n    \"## External Docs Index // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Output directory: ${outputDirRelative}`,\n    `- Scope: ${artifacts.length} pages under /docs`,\n    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n    \"----\",\n    \"\",\n    \"## Pages\",\n    \"\",\n    pageList,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nasync function fetchText(url: string): Promise<string> {\n  const response = await fetch(url, {\n    headers: {\n      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Request failed (${response.status}) for ${url}`);\n  }\n\n  return await response.text();\n}\n\nfunction extractLocUrls(xml: string): string[] {\n  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n    decodeEntities(match[1]?.trim() ?? \"\"),\n  ).filter(Boolean);\n}\n\nasync function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n  const visited = new Set<string>();\n  const pending: string[] = [sitemapUrl];\n  const docsUrls = new Set<string>();\n\n  while (pending.length > 0) {\n    const current = pending.pop();\n    if (!current || visited.has(current)) {\n      continue;\n    }\n\n    visited.add(current);\n\n    let xml: string;\n    try {\n      xml = await fetchText(current);\n    } catch {\n      continue;\n    }\n\n    const locUrls = extractLocUrls(xml);\n    for (const locUrl of locUrls) {\n      if (locUrl.endsWith(\".xml\")) {\n        if (!visited.has(locUrl)) {\n          pending.push(locUrl);\n        }\n        continue;\n      }\n\n      if (!locUrl.startsWith(DOCS_ROOT)) {\n        continue;\n      }\n\n      if (locUrl.includes(\"#\")) {\n        continue;\n      }\n\n      docsUrls.add(locUrl);\n    }\n  }\n\n  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n}\n\nasync function mapConcurrent<T, R>(\n  values: T[],\n  limit: number,\n  map: (value: T, index: number) => Promise<R>,\n): Promise<R[]> {\n  const results = new Array<R>(values.length);\n  let index = 0;\n\n  async function worker(): Promise<void> {\n    while (true) {\n      const currentIndex = index;\n      index += 1;\n\n      if (currentIndex >= values.length) {\n        return;\n      }\n\n      results[currentIndex] = await map(values[currentIndex], currentIndex);\n    }\n  }\n\n  const workerCount = Math.min(limit, values.length);\n  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n  return results;\n}\n\nasync function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n\n  try {\n    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n\n    try {\n      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n      if (markdown) {\n        return {\n          url,\n          ok: true,\n          markdown,\n          mode: \"jina\",\n        };\n      }\n    } catch {\n      // Fall through to direct HTML scrape.\n    }\n\n    const html = await fetchText(url);\n    const markdown = htmlToMarkdown(html);\n\n    if (!markdown) {\n      return {\n        url,\n        ok: false,\n        error: \"No markdown content returned from HTML fallback\",\n      };\n    }\n\n    return {\n      url,\n      ok: true,\n      markdown,\n      mode: \"html\",\n    };\n  } catch (error) {\n    return {\n      url,\n      ok: false,\n      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n    };\n  }\n}\n\nfunction resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n  if (!outputArg) {\n    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n  }\n\n  const resolved = resolve(repoRoot, outputArg);\n  if (resolved.endsWith(\".md\")) {\n    return dirname(resolved);\n  }\n\n  return resolved;\n}\n\nfunction clearExistingExtFiles(outputDir: string): void {\n  if (!existsSync(outputDir)) {\n    return;\n  }\n\n  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n    if (!entry.isFile()) {\n      continue;\n    }\n\n    if (!entry.name.endsWith(\".ext.md\")) {\n      continue;\n    }\n\n    rmSync(resolve(outputDir, entry.name));\n  }\n}\n\nconst repoRoot = findRepoRoot(import.meta.dir);\nconst outputArg = Bun.argv[2];\nconst outputDir = resolveOutputDirectory(repoRoot, outputArg);\nconst outputDirRelative = outputDir.startsWith(repoRoot)\n  ? outputDir.slice(repoRoot.length + 1)\n  : outputDir;\n\nmkdirSync(outputDir, { recursive: true });\nclearExistingExtFiles(outputDir);\n\nconst docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n\nif (docsUrls.length === 0) {\n  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n}\n\nconst scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n  scrapeDocsPage(url, index + 1, docsUrls.length),\n);\n\nconst usedNames = new Map<string, number>();\nconst artifacts: PageArtifact[] = scrapeResults.map((result) => {\n  const stem = fileStemFromUrl(result.url);\n  const seen = usedNames.get(stem) ?? 0;\n  usedNames.set(stem, seen + 1);\n\n  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n  const fileName = `${stem}${suffix}.ext.md`;\n\n  return {\n    ...result,\n    fileName,\n    sourcePath: sourcePathFromUrl(result.url),\n  };\n});\n\nconst capturedAt = new Date().toISOString();\n\nfor (const artifact of artifacts) {\n  const pagePath = resolve(outputDir, artifact.fileName);\n  const pageContent = buildPageMarkdown(artifact, capturedAt);\n  await Bun.write(pagePath, pageContent);\n}\n\nconst indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\nawait Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n\nconst successCount = artifacts.filter((artifact) => artifact.ok).length;\nconst failureCount = artifacts.length - successCount;\nconst blockedPages = artifacts\n  .filter((artifact) => !artifact.ok)\n  .map((artifact) => artifact.sourcePath)\n  .join(\",\");\n\nconsole.log(\n  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n);\n",
              "after": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};\n\nconst SOURCE_KEY = \"opencode\";\nconst DOCS_ROOT = \"https://opencode.ai/docs\";\nconst SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\nconst DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\nconst CONCURRENCY = 4;\nconst SUMMARY_MAX_CHARS = 240;\nconst DEFAULT_LANGUAGE = \"en\";\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replaceAll(\"&amp;\", \"&\")\n    .replaceAll(\"&quot;\", '\"')\n    .replaceAll(\"&apos;\", \"'\")\n    .replaceAll(\"&#x27;\", \"'\")\n    .replaceAll(\"&#39;\", \"'\")\n    .replaceAll(\"&nbsp;\", \" \")\n    .replaceAll(\"&lt;\", \"<\")\n    .replaceAll(\"&gt;\", \">\");\n}\n\nfunction stripJinaEnvelope(markdown: string): string {\n  return markdown\n    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n    .trim();\n}\n\nfunction stripTags(value: string): string {\n  return value.replace(/<[^>]+>/g, \"\");\n}\n\nfunction plainTextFromHtml(value: string): string {\n  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n}\n\nfunction extractMainHtml(html: string): string {\n  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n  if (articleMatch?.[1]) {\n    return articleMatch[1];\n  }\n\n  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n  if (mainMatch?.[1]) {\n    return mainMatch[1];\n  }\n\n  return html;\n}\n\nfunction htmlToMarkdown(html: string): string {\n  let content = extractMainHtml(html);\n\n  content = content\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n\n  content = content.replace(\n    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n    (_match, code) => {\n      const normalizedCode = decodeEntities(\n        stripTags(code)\n          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n          .replace(/\\n{3,}/g, \"\\n\\n\")\n          .trim(),\n      );\n\n      if (!normalizedCode) {\n        return \"\";\n      }\n\n      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n    },\n  );\n\n  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n    const normalizedCode = decodeEntities(stripTags(code)).trim();\n    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n  });\n\n  content = content.replace(\n    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n    (_match, href, label) => {\n      const text = plainTextFromHtml(label);\n      if (!text) {\n        return \"\";\n      }\n\n      return `[${text}](${decodeEntities(href)})`;\n    },\n  );\n\n  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n    const heading = plainTextFromHtml(inner);\n    if (!heading) {\n      return \"\";\n    }\n\n    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n  });\n\n  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n    const line = plainTextFromHtml(inner);\n    return line ? `- ${line}\\n` : \"\";\n  });\n\n  content = content\n    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n      const cell = plainTextFromHtml(inner);\n      return cell ? `${cell} ` : \"\";\n    });\n\n  content = decodeEntities(content)\n    .replace(/<[^>]+>/g, \"\")\n    .replace(/[ \\t]+\\n/g, \"\\n\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .trim();\n\n  return content;\n}\n\nfunction sanitizeSegment(value: string): string {\n  const clean = decodeURIComponent(value)\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return clean || \"page\";\n}\n\nfunction sourcePathFromUrl(url: string): string {\n  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n  return pathname;\n}\n\nfunction fileStemFromUrl(url: string): string {\n  const sourcePath = sourcePathFromUrl(url);\n\n  if (sourcePath === \"/docs\") {\n    return \"docs\";\n  }\n\n  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n  const segments = relative\n    .split(\"/\")\n    .filter(Boolean)\n    .map(sanitizeSegment);\n\n  if (segments.length === 0) {\n    return \"docs\";\n  }\n\n  return [\"docs\", ...segments].join(\"__\");\n}\n\nfunction extractSummary(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  let inCodeBlock = false;\n\n  for (const rawLine of lines) {\n    const line = rawLine.trim();\n\n    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n      inCodeBlock = !inCodeBlock;\n      continue;\n    }\n\n    if (inCodeBlock) {\n      continue;\n    }\n\n    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n      continue;\n    }\n\n    if (line.length <= 25) {\n      continue;\n    }\n\n    if (line.length > SUMMARY_MAX_CHARS) {\n      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n    }\n\n    return line;\n  }\n\n  return \"OpenCode documentation page snapshot.\";\n}\n\nfunction keywordsForPath(sourcePath: string): string {\n  const dynamic = sourcePath\n    .split(\"/\")\n    .filter(Boolean)\n    .slice(1)\n    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n    .filter(Boolean)\n    .join(\", \");\n\n  const base = \"opencode, docs, ai coding assistant, cli\";\n  return dynamic ? `${base}, ${dynamic}` : base;\n}\n\nfunction buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n  const pageSummary = result.ok\n    ? extractSummary(result.markdown ?? \"\")\n    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  const pageBody = result.ok\n    ? result.markdown?.trim() ?? \"\"\n    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  return [\n    \"----\",\n    \"## External Docs Snapshot // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Source page: ${result.sourcePath}`,\n    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n    `- Summary: ${pageSummary}`,\n    \"----\",\n    \"\",\n    `Source: ${result.url}`,\n    \"\",\n    pageBody,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Collection method: sitemap discovery + markdown conversion.\",\n    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nfunction buildIndexMarkdown(\n  artifacts: PageArtifact[],\n  capturedAt: string,\n  outputDirRelative: string,\n): string {\n  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n  const failureCount = artifacts.length - successCount;\n\n  const pageList = artifacts\n    .map((artifact) => {\n      const status = artifact.ok ? \"ok\" : \"failed\";\n      const mode = artifact.mode ?? \"unknown\";\n      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n    })\n    .join(\"\\n\");\n\n  return [\n    \"----\",\n    \"## External Docs Index // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Output directory: ${outputDirRelative}`,\n    `- Scope: ${artifacts.length} pages under /docs`,\n    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n    \"----\",\n    \"\",\n    \"## Pages\",\n    \"\",\n    pageList,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nasync function fetchText(url: string): Promise<string> {\n  const response = await fetch(url, {\n    headers: {\n      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Request failed (${response.status}) for ${url}`);\n  }\n\n  return await response.text();\n}\n\nfunction extractLocUrls(xml: string): string[] {\n  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n    decodeEntities(match[1]?.trim() ?? \"\"),\n  ).filter(Boolean);\n}\n\nasync function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n  const visited = new Set<string>();\n  const pending: string[] = [sitemapUrl];\n  const docsUrls = new Set<string>();\n\n  while (pending.length > 0) {\n    const current = pending.pop();\n    if (!current || visited.has(current)) {\n      continue;\n    }\n\n    visited.add(current);\n\n    let xml: string;\n    try {\n      xml = await fetchText(current);\n    } catch {\n      continue;\n    }\n\n    const locUrls = extractLocUrls(xml);\n    for (const locUrl of locUrls) {\n      if (locUrl.endsWith(\".xml\")) {\n        if (!visited.has(locUrl)) {\n          pending.push(locUrl);\n        }\n        continue;\n      }\n\n      if (!locUrl.startsWith(DOCS_ROOT)) {\n        continue;\n      }\n\n      if (locUrl.includes(\"#\")) {\n        continue;\n      }\n\n      docsUrls.add(locUrl);\n    }\n  }\n\n  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n}\n\nfunction isEnglishDocsUrl(url: string): boolean {\n  const pathname = new URL(url).pathname;\n  if (!pathname.startsWith(\"/docs\")) {\n    return false;\n  }\n\n  const relative = pathname.replace(/^\\/docs\\/?/, \"\");\n  if (!relative) {\n    return true;\n  }\n\n  const firstSegment = relative.split(\"/\")[0]?.toLowerCase() ?? \"\";\n  if (!firstSegment) {\n    return true;\n  }\n\n  if (firstSegment === \"en\" || firstSegment === \"english\") {\n    return true;\n  }\n\n  if (/^[a-z]{2}(?:-[a-z]{2})?$/.test(firstSegment)) {\n    return false;\n  }\n\n  return true;\n}\n\nasync function mapConcurrent<T, R>(\n  values: T[],\n  limit: number,\n  map: (value: T, index: number) => Promise<R>,\n): Promise<R[]> {\n  const results = new Array<R>(values.length);\n  let index = 0;\n\n  async function worker(): Promise<void> {\n    while (true) {\n      const currentIndex = index;\n      index += 1;\n\n      if (currentIndex >= values.length) {\n        return;\n      }\n\n      results[currentIndex] = await map(values[currentIndex], currentIndex);\n    }\n  }\n\n  const workerCount = Math.min(limit, values.length);\n  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n  return results;\n}\n\nasync function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n\n  try {\n    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n\n    try {\n      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n      if (markdown) {\n        return {\n          url,\n          ok: true,\n          markdown,\n          mode: \"jina\",\n        };\n      }\n    } catch {\n      // Fall through to direct HTML scrape.\n    }\n\n    const html = await fetchText(url);\n    const markdown = htmlToMarkdown(html);\n\n    if (!markdown) {\n      return {\n        url,\n        ok: false,\n        error: \"No markdown content returned from HTML fallback\",\n      };\n    }\n\n    return {\n      url,\n      ok: true,\n      markdown,\n      mode: \"html\",\n    };\n  } catch (error) {\n    return {\n      url,\n      ok: false,\n      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n    };\n  }\n}\n\nfunction resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n  if (!outputArg) {\n    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n  }\n\n  const resolved = resolve(repoRoot, outputArg);\n  if (resolved.endsWith(\".md\")) {\n    return dirname(resolved);\n  }\n\n  return resolved;\n}\n\nfunction clearExistingExtFiles(outputDir: string): void {\n  if (!existsSync(outputDir)) {\n    return;\n  }\n\n  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n    if (!entry.isFile()) {\n      continue;\n    }\n\n    if (!entry.name.endsWith(\".ext.md\")) {\n      continue;\n    }\n\n    rmSync(resolve(outputDir, entry.name));\n  }\n}\n\nconst repoRoot = findRepoRoot(import.meta.dir);\nconst outputArg = Bun.argv[2];\nconst outputDir = resolveOutputDirectory(repoRoot, outputArg);\nconst outputDirRelative = outputDir.startsWith(repoRoot)\n  ? outputDir.slice(repoRoot.length + 1)\n  : outputDir;\n\nmkdirSync(outputDir, { recursive: true });\nclearExistingExtFiles(outputDir);\n\nconst requestedLanguage = (Bun.env.DOCS_LANGUAGE ?? DEFAULT_LANGUAGE).toLowerCase();\nconst discoveredUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\nconst docsUrls =\n  requestedLanguage === \"en\" || requestedLanguage === \"english\"\n    ? discoveredUrls.filter(isEnglishDocsUrl)\n    : discoveredUrls;\n\nif (docsUrls.length === 0) {\n  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n}\n\nconst scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n  scrapeDocsPage(url, index + 1, docsUrls.length),\n);\n\nconst usedNames = new Map<string, number>();\nconst artifacts: PageArtifact[] = scrapeResults.map((result) => {\n  const stem = fileStemFromUrl(result.url);\n  const seen = usedNames.get(stem) ?? 0;\n  usedNames.set(stem, seen + 1);\n\n  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n  const fileName = `${stem}${suffix}.ext.md`;\n\n  return {\n    ...result,\n    fileName,\n    sourcePath: sourcePathFromUrl(result.url),\n  };\n});\n\nconst capturedAt = new Date().toISOString();\n\nfor (const artifact of artifacts) {\n  const pagePath = resolve(outputDir, artifact.fileName);\n  const pageContent = buildPageMarkdown(artifact, capturedAt);\n  await Bun.write(pagePath, pageContent);\n}\n\nconst indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\nawait Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n\nconst successCount = artifacts.filter((artifact) => artifact.ok).length;\nconst failureCount = artifacts.length - successCount;\nconst blockedPages = artifacts\n  .filter((artifact) => !artifact.ok)\n  .map((artifact) => artifact.sourcePath)\n  .join(\",\");\n\nconsole.log(\n  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},lang=${requestedLanguage},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n);\n",
              "additions": 35,
              "deletions": 2,
              "status": "modified"
            }
          ]
        },
        "agent": "build",
        "model": {
          "providerID": "openai",
          "modelID": "gpt-5.3-codex"
        },
        "variant": "low",
        "id": "msg_c64a667e1001oSCNckxNgJGDO0",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "text",
          "text": "Woah - is that multi-language? What if we only did en / english/",
          "id": "prt_c64a667e1002ku32ByI8SZpFbV",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a667e1001oSCNckxNgJGDO0"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215153132,
          "completed": 1771215171801
        },
        "parentID": "msg_c64a667e1001oSCNckxNgJGDO0",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 32983,
          "input": 15974,
          "output": 1009,
          "reasoning": 287,
          "cache": {
            "read": 16000,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a667ec001upy9EWpZOpvly1",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "1552fd43035ae4ad0a2b79f1c9cff4e3c3c2cce4",
          "id": "prt_c64a670ff001w72TznSUQ8CN6q",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a667ec001upy9EWpZOpvly1"
        },
        {
          "type": "reasoning",
          "text": "**Adding language filtering to docs script**",
          "metadata": {
            "openai": {
              "itemId": "rs_00659a47e38da45001699299355b508194a241d944dc6727b4",
              "reasoningEncryptedContent": "gAAAAABpkpk7ADCyLMRbhU4eiHHJBQwLC1d3NdTZctYLLDWwRo8XJx1nozDeClDyvuztaTRUsBy9ySkUsXJZdAFiwx7QAz2BqdnoUPk02x8T4DVbYVZJLf45_qJ22V8LlGwBuVjQiXf3iH5UFYDYcKwrIUOHUJUU7SlHHgicMN9uda1LbjJr2inmV00rDZEXI6u02S-FakB61B793353uW3yU7epqoQjz5BhfV58i97n_3fCbN1_RxSKAbn0JkfcWrpGSg1mZeb_UBX5zuRuJmdgZ-Ooq7jvuHu-FVEwug9rADCnXbOVzD0GjUk8NoQ9LAEdtVZ80qBjBhzKjY_MM-K_Cq33pCTebEWytusuRb_S4VCPYqbB3gQG2knenXhSIWFcxmyQUDMqCWCDkqs7YIs4KGxrgmRnm0iyQ1by0buUpbReyypMxGDw9lq38YbzUJ3Ql2ciHhmmDqH7ZxLx_TQD3QNa74oRMvj1LXOZSVcKDI7eK-lVegPg6Ub0lYoRcf-c94T4DDNM4jeCKNFOY0N7L5kHmjb0H1q2OJsYGhz72GBnfpq5Lm5yOmSNY52d2qihs-CG8BiWmsxvYXLzjHVfjywqTKX67w6fEqyAGw2elX4WNckF4a8K8QwJM5qLqjkt2JDYnRVdC3S_lin9Su4gAjsjUK6fVinPK-PAY4t0vgzM1MIGA-mZzYZ4alJVnorvOQnXsK2DSUtQlnD9ttyVKM3I1vkD-pkZ2oaN1aGsxCitc1x_KHantzZu4e4CtpzfQPw8CvWzr7HGxm-sX0wISUCzR7-aXn-OWKJ8gNDsvUWAa_xDuZHfiYAV78j9aYNTvbWk05voA6GRLb837Nb-V-mdPAIya0A_nQD_PxxTdJkPJTybRfjYyFmruCS004exsSDLn22Hn99AS9dFFvvH_uKU_8j9Q6mJiDiO75b_SrukhholdB9ZbIAQpPZYcATdG_1F0unV1_2WFr_not7JlDQQEyEIV41XK1ITGXWNKYaHKHOXl6ccaTTwKvLYp2jlIF2HPnrSTpT0kDNARilSJ0ICK0UFuIsV6YeFGZgROT9mIgNSvkuZxU4v_CxuZ7lA9q45qT042BydX4zTFBpAHAFqu2yEvHofMDNS66BLZronz_ee5_bDMmiDe5o2OfRB4geJJX6s30gF1FzAq4XBhb4eP6yqL-GtyG8Cs1BMF57hD0HCfdMd_1J3xg9vETvHa1BY0JUboyOeOp67p9A58oehKSAOHJJovJD5cpqRtKw9Vk3zYlBtu_hHJDHGtdW0fHnyqA5018IjlVBu-zeQlqC6a8_2igCB7NbOcyhWB8RheDwXP-TItIyE9p2Tms4YTeqQvN5DZ-HSi8nNU8looC_3lfju2ZaLJACYlRUms98qb8oOqtpQBid6YeRyyJhRaGdbPvvSK9WyXUcAfS2Ge37MEhOqsoeFPK3paWTsGs3o7t66OCsbhOdXPTiedwvUuy--w1U1dR1DpkD7nmJ68sGb1jEeukrT6OXHAG8tSuCPZQMAaubMFSpmH2T60xG02H2JqiLY6hY8fYyAUIX-pUvEhwlAn2_mSJZKQTmyfjnTD68AZNkRRcKUuAnfujX9ywO0acjIMrsfhEf-67OmwYTIzr6TuOWbXdtdYWG5jmhI9sdW4vDaGrcD-9aZ8hmFkFfdOuXAAnzdWoe5Y_xsR580F0JNzIRr0zIk1qcurMZ3UoPkpYvBJwzXmvjOH_qLsNp3O5_KFOfPS3k7juZHORU11wrOxx9Q27kb8881wcS-9jrIwgTdavhte-7St8KBxQ3DLFibKrcIv78MYqgf3Qt48VVN8J37jYmOPykzVKnJFWIAlNmkjCQCCossJqAy57IIeKRzd9Ccz4dU6MRdkZ1pjeUjpqKmrKW3hZVtGE26YEx1xwVUys7fzcQZXXQhKnUgwne66IX3u3bwjDOE7H3pGAEJOfgQ1hnL2nzQmsTgsc2pFi6AclORHfNKl6U0qSipG-wOpdk0XFrIdIrLLGJXayvhVR6bZDZ_aGcp1j5qSNiQQRqlk1BB76Vhcd7C5R_T3GfDG-ZjVhoHXQlvSaF-f7r1NclUgp7yN-7d6vD4k7eBUu4LzD1_DJEnhYI3QIXojc-ILS00ScfPKXsPLE44r55ArAKABH7BRFCGhRbRWuoZXBaPZQ_novUSgsW9y3LGfsYjoi5oBIfVDagV4csWuHnfMbRyYKowhL0MOZb1tkQBuwvfgnNSa7gNsMK_Ijafe3ia7LJcDoZo6HXgohMMCTclRNaKAldRIfZSxyGQrxO63zVootSLkFjIGLoee4Zo3W0bzpuKoCECno7qZdrP7ufDe_fdEc51JGy8V3x43nuIHajeGPS66ZGAmAym2MliBMLrmvgXtLIM2dFKxk_unRSrOmeEputPBYmth6A6K43XbqJwgopWz6ss9dBq1s9rusJZZb7PmvA3ECxPCV0tqPXgZxoTAWP3QV9nJniwO7Uhk8nOuuHYPDVHeA9OdIqCyc_JTXS6lt1i0oPad6yetXpnw-alISeuqSJauqzRRCXVm6vjJ5Xj26ZZidtEpsYfnIR1CfSSrkmZF37pqNN9aVOUmP5PFa6GMapvwaiv9cq4VoJYps1e8BeNajpD2TERCk68j7ecFZFahmTeJP8WibmAcBBtCOjbUawhzEGd9Pu1Bjx2O64tufZFTGG1uS8pKW0NWK3ftIfbsCXneclCgzynJZxp0NsAAXqsBCMA0kNHlrXaho4RBjZB4uyNIJnQff38aWwSJDIfUDV43HqH6RB-9ttHU_YQoZaAu9kKlm0yXVpHMmGp0BHw2kOtUxb_UV99JttBDVQ1L-LjV_kMIjNzsg=="
            }
          },
          "time": {
            "start": 1771215157392,
            "end": 1771215163602
          },
          "id": "prt_c64a678900014QDOaBQq9OHbi9",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a667ec001upy9EWpZOpvly1"
        },
        {
          "type": "tool",
          "callID": "call_4E808rT8fDNiOkWYK0pTmJpT",
          "tool": "apply_patch",
          "state": {
            "status": "completed",
            "input": {
              "patchText": "*** Begin Patch\n*** Update File: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n@@\n const SOURCE_KEY = \"opencode\";\n const DOCS_ROOT = \"https://opencode.ai/docs\";\n const SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\n const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\n const CONCURRENCY = 4;\n const SUMMARY_MAX_CHARS = 240;\n+const DEFAULT_LANGUAGE = \"en\";\n+const KNOWN_NON_EN_DOC_PREFIXES = new Set([\n+  \"ar\",\n+  \"de\",\n+  \"es\",\n+  \"fr\",\n+  \"it\",\n+  \"ja\",\n+  \"ko\",\n+  \"pt\",\n+  \"ru\",\n+  \"tr\",\n+  \"vi\",\n+  \"zh\",\n+  \"zh-cn\",\n+  \"zh-tw\",\n+]);\n@@\n async function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n@@\n   return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n }\n+\n+function isEnglishDocsUrl(url: string): boolean {\n+  const pathname = new URL(url).pathname;\n+  if (!pathname.startsWith(\"/docs\")) {\n+    return false;\n+  }\n+\n+  const relative = pathname.replace(/^\\/docs\\/?/, \"\");\n+  if (!relative) {\n+    return true;\n+  }\n+\n+  const firstSegment = relative.split(\"/\")[0]?.toLowerCase() ?? \"\";\n+  if (!firstSegment) {\n+    return true;\n+  }\n+\n+  if (firstSegment === \"en\" || firstSegment === \"english\") {\n+    return true;\n+  }\n+\n+  if (KNOWN_NON_EN_DOC_PREFIXES.has(firstSegment)) {\n+    return false;\n+  }\n+\n+  return true;\n+}\n@@\n-const docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+const requestedLanguage = (Bun.env.DOCS_LANGUAGE ?? DEFAULT_LANGUAGE).toLowerCase();\n+const discoveredUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+const docsUrls =\n+  requestedLanguage === \"en\" || requestedLanguage === \"english\"\n+    ? discoveredUrls.filter(isEnglishDocsUrl)\n+    : discoveredUrls;\n@@\n console.log(\n-  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n+  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},lang=${requestedLanguage},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n );\n*** End Patch"
            },
            "output": "Success. Updated the following files:\nM scripts/scrape_opencode_docs.sh.ts",
            "title": "Success. Updated the following files:\nM scripts/scrape_opencode_docs.sh.ts",
            "metadata": {
              "diff": "Index: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n+++ /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n@@ -24,8 +24,25 @@\n const SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\n const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\n const CONCURRENCY = 4;\n const SUMMARY_MAX_CHARS = 240;\n+const DEFAULT_LANGUAGE = \"en\";\n+const KNOWN_NON_EN_DOC_PREFIXES = new Set([\n+  \"ar\",\n+  \"de\",\n+  \"es\",\n+  \"fr\",\n+  \"it\",\n+  \"ja\",\n+  \"ko\",\n+  \"pt\",\n+  \"ru\",\n+  \"tr\",\n+  \"vi\",\n+  \"zh\",\n+  \"zh-cn\",\n+  \"zh-tw\",\n+]);\n \n function decodeEntities(value: string): string {\n   return value\n     .replaceAll(\"&amp;\", \"&\")\n@@ -365,8 +382,35 @@\n \n   return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n }\n \n+function isEnglishDocsUrl(url: string): boolean {\n+  const pathname = new URL(url).pathname;\n+  if (!pathname.startsWith(\"/docs\")) {\n+    return false;\n+  }\n+\n+  const relative = pathname.replace(/^\\/docs\\/?/, \"\");\n+  if (!relative) {\n+    return true;\n+  }\n+\n+  const firstSegment = relative.split(\"/\")[0]?.toLowerCase() ?? \"\";\n+  if (!firstSegment) {\n+    return true;\n+  }\n+\n+  if (firstSegment === \"en\" || firstSegment === \"english\") {\n+    return true;\n+  }\n+\n+  if (KNOWN_NON_EN_DOC_PREFIXES.has(firstSegment)) {\n+    return false;\n+  }\n+\n+  return true;\n+}\n+\n async function mapConcurrent<T, R>(\n   values: T[],\n   limit: number,\n   map: (value: T, index: number) => Promise<R>,\n@@ -478,9 +522,14 @@\n \n mkdirSync(outputDir, { recursive: true });\n clearExistingExtFiles(outputDir);\n \n-const docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+const requestedLanguage = (Bun.env.DOCS_LANGUAGE ?? DEFAULT_LANGUAGE).toLowerCase();\n+const discoveredUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+const docsUrls =\n+  requestedLanguage === \"en\" || requestedLanguage === \"english\"\n+    ? discoveredUrls.filter(isEnglishDocsUrl)\n+    : discoveredUrls;\n \n if (docsUrls.length === 0) {\n   throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n }\n@@ -523,6 +572,6 @@\n   .map((artifact) => artifact.sourcePath)\n   .join(\",\");\n \n console.log(\n-  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n+  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},lang=${requestedLanguage},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n );\n\n",
              "files": [
                {
                  "filePath": "/Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts",
                  "relativePath": "scripts/scrape_opencode_docs.sh.ts",
                  "type": "update",
                  "diff": "Index: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n+++ /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n@@ -24,8 +24,25 @@\n const SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\n const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\n const CONCURRENCY = 4;\n const SUMMARY_MAX_CHARS = 240;\n+const DEFAULT_LANGUAGE = \"en\";\n+const KNOWN_NON_EN_DOC_PREFIXES = new Set([\n+  \"ar\",\n+  \"de\",\n+  \"es\",\n+  \"fr\",\n+  \"it\",\n+  \"ja\",\n+  \"ko\",\n+  \"pt\",\n+  \"ru\",\n+  \"tr\",\n+  \"vi\",\n+  \"zh\",\n+  \"zh-cn\",\n+  \"zh-tw\",\n+]);\n \n function decodeEntities(value: string): string {\n   return value\n     .replaceAll(\"&amp;\", \"&\")\n@@ -365,8 +382,35 @@\n \n   return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n }\n \n+function isEnglishDocsUrl(url: string): boolean {\n+  const pathname = new URL(url).pathname;\n+  if (!pathname.startsWith(\"/docs\")) {\n+    return false;\n+  }\n+\n+  const relative = pathname.replace(/^\\/docs\\/?/, \"\");\n+  if (!relative) {\n+    return true;\n+  }\n+\n+  const firstSegment = relative.split(\"/\")[0]?.toLowerCase() ?? \"\";\n+  if (!firstSegment) {\n+    return true;\n+  }\n+\n+  if (firstSegment === \"en\" || firstSegment === \"english\") {\n+    return true;\n+  }\n+\n+  if (KNOWN_NON_EN_DOC_PREFIXES.has(firstSegment)) {\n+    return false;\n+  }\n+\n+  return true;\n+}\n+\n async function mapConcurrent<T, R>(\n   values: T[],\n   limit: number,\n   map: (value: T, index: number) => Promise<R>,\n@@ -478,9 +522,14 @@\n \n mkdirSync(outputDir, { recursive: true });\n clearExistingExtFiles(outputDir);\n \n-const docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+const requestedLanguage = (Bun.env.DOCS_LANGUAGE ?? DEFAULT_LANGUAGE).toLowerCase();\n+const discoveredUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n+const docsUrls =\n+  requestedLanguage === \"en\" || requestedLanguage === \"english\"\n+    ? discoveredUrls.filter(isEnglishDocsUrl)\n+    : discoveredUrls;\n \n if (docsUrls.length === 0) {\n   throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n }\n@@ -523,6 +572,6 @@\n   .map((artifact) => artifact.sourcePath)\n   .join(\",\");\n \n console.log(\n-  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n+  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},lang=${requestedLanguage},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n );\n",
                  "before": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};\n\nconst SOURCE_KEY = \"opencode\";\nconst DOCS_ROOT = \"https://opencode.ai/docs\";\nconst SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\nconst DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\nconst CONCURRENCY = 4;\nconst SUMMARY_MAX_CHARS = 240;\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replaceAll(\"&amp;\", \"&\")\n    .replaceAll(\"&quot;\", '\"')\n    .replaceAll(\"&apos;\", \"'\")\n    .replaceAll(\"&#x27;\", \"'\")\n    .replaceAll(\"&#39;\", \"'\")\n    .replaceAll(\"&nbsp;\", \" \")\n    .replaceAll(\"&lt;\", \"<\")\n    .replaceAll(\"&gt;\", \">\");\n}\n\nfunction stripJinaEnvelope(markdown: string): string {\n  return markdown\n    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n    .trim();\n}\n\nfunction stripTags(value: string): string {\n  return value.replace(/<[^>]+>/g, \"\");\n}\n\nfunction plainTextFromHtml(value: string): string {\n  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n}\n\nfunction extractMainHtml(html: string): string {\n  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n  if (articleMatch?.[1]) {\n    return articleMatch[1];\n  }\n\n  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n  if (mainMatch?.[1]) {\n    return mainMatch[1];\n  }\n\n  return html;\n}\n\nfunction htmlToMarkdown(html: string): string {\n  let content = extractMainHtml(html);\n\n  content = content\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n\n  content = content.replace(\n    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n    (_match, code) => {\n      const normalizedCode = decodeEntities(\n        stripTags(code)\n          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n          .replace(/\\n{3,}/g, \"\\n\\n\")\n          .trim(),\n      );\n\n      if (!normalizedCode) {\n        return \"\";\n      }\n\n      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n    },\n  );\n\n  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n    const normalizedCode = decodeEntities(stripTags(code)).trim();\n    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n  });\n\n  content = content.replace(\n    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n    (_match, href, label) => {\n      const text = plainTextFromHtml(label);\n      if (!text) {\n        return \"\";\n      }\n\n      return `[${text}](${decodeEntities(href)})`;\n    },\n  );\n\n  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n    const heading = plainTextFromHtml(inner);\n    if (!heading) {\n      return \"\";\n    }\n\n    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n  });\n\n  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n    const line = plainTextFromHtml(inner);\n    return line ? `- ${line}\\n` : \"\";\n  });\n\n  content = content\n    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n      const cell = plainTextFromHtml(inner);\n      return cell ? `${cell} ` : \"\";\n    });\n\n  content = decodeEntities(content)\n    .replace(/<[^>]+>/g, \"\")\n    .replace(/[ \\t]+\\n/g, \"\\n\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .trim();\n\n  return content;\n}\n\nfunction sanitizeSegment(value: string): string {\n  const clean = decodeURIComponent(value)\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return clean || \"page\";\n}\n\nfunction sourcePathFromUrl(url: string): string {\n  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n  return pathname;\n}\n\nfunction fileStemFromUrl(url: string): string {\n  const sourcePath = sourcePathFromUrl(url);\n\n  if (sourcePath === \"/docs\") {\n    return \"docs\";\n  }\n\n  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n  const segments = relative\n    .split(\"/\")\n    .filter(Boolean)\n    .map(sanitizeSegment);\n\n  if (segments.length === 0) {\n    return \"docs\";\n  }\n\n  return [\"docs\", ...segments].join(\"__\");\n}\n\nfunction extractSummary(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  let inCodeBlock = false;\n\n  for (const rawLine of lines) {\n    const line = rawLine.trim();\n\n    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n      inCodeBlock = !inCodeBlock;\n      continue;\n    }\n\n    if (inCodeBlock) {\n      continue;\n    }\n\n    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n      continue;\n    }\n\n    if (line.length <= 25) {\n      continue;\n    }\n\n    if (line.length > SUMMARY_MAX_CHARS) {\n      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n    }\n\n    return line;\n  }\n\n  return \"OpenCode documentation page snapshot.\";\n}\n\nfunction keywordsForPath(sourcePath: string): string {\n  const dynamic = sourcePath\n    .split(\"/\")\n    .filter(Boolean)\n    .slice(1)\n    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n    .filter(Boolean)\n    .join(\", \");\n\n  const base = \"opencode, docs, ai coding assistant, cli\";\n  return dynamic ? `${base}, ${dynamic}` : base;\n}\n\nfunction buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n  const pageSummary = result.ok\n    ? extractSummary(result.markdown ?? \"\")\n    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  const pageBody = result.ok\n    ? result.markdown?.trim() ?? \"\"\n    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  return [\n    \"----\",\n    \"## External Docs Snapshot // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Source page: ${result.sourcePath}`,\n    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n    `- Summary: ${pageSummary}`,\n    \"----\",\n    \"\",\n    `Source: ${result.url}`,\n    \"\",\n    pageBody,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Collection method: sitemap discovery + markdown conversion.\",\n    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nfunction buildIndexMarkdown(\n  artifacts: PageArtifact[],\n  capturedAt: string,\n  outputDirRelative: string,\n): string {\n  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n  const failureCount = artifacts.length - successCount;\n\n  const pageList = artifacts\n    .map((artifact) => {\n      const status = artifact.ok ? \"ok\" : \"failed\";\n      const mode = artifact.mode ?? \"unknown\";\n      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n    })\n    .join(\"\\n\");\n\n  return [\n    \"----\",\n    \"## External Docs Index // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Output directory: ${outputDirRelative}`,\n    `- Scope: ${artifacts.length} pages under /docs`,\n    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n    \"----\",\n    \"\",\n    \"## Pages\",\n    \"\",\n    pageList,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nasync function fetchText(url: string): Promise<string> {\n  const response = await fetch(url, {\n    headers: {\n      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Request failed (${response.status}) for ${url}`);\n  }\n\n  return await response.text();\n}\n\nfunction extractLocUrls(xml: string): string[] {\n  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n    decodeEntities(match[1]?.trim() ?? \"\"),\n  ).filter(Boolean);\n}\n\nasync function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n  const visited = new Set<string>();\n  const pending: string[] = [sitemapUrl];\n  const docsUrls = new Set<string>();\n\n  while (pending.length > 0) {\n    const current = pending.pop();\n    if (!current || visited.has(current)) {\n      continue;\n    }\n\n    visited.add(current);\n\n    let xml: string;\n    try {\n      xml = await fetchText(current);\n    } catch {\n      continue;\n    }\n\n    const locUrls = extractLocUrls(xml);\n    for (const locUrl of locUrls) {\n      if (locUrl.endsWith(\".xml\")) {\n        if (!visited.has(locUrl)) {\n          pending.push(locUrl);\n        }\n        continue;\n      }\n\n      if (!locUrl.startsWith(DOCS_ROOT)) {\n        continue;\n      }\n\n      if (locUrl.includes(\"#\")) {\n        continue;\n      }\n\n      docsUrls.add(locUrl);\n    }\n  }\n\n  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n}\n\nasync function mapConcurrent<T, R>(\n  values: T[],\n  limit: number,\n  map: (value: T, index: number) => Promise<R>,\n): Promise<R[]> {\n  const results = new Array<R>(values.length);\n  let index = 0;\n\n  async function worker(): Promise<void> {\n    while (true) {\n      const currentIndex = index;\n      index += 1;\n\n      if (currentIndex >= values.length) {\n        return;\n      }\n\n      results[currentIndex] = await map(values[currentIndex], currentIndex);\n    }\n  }\n\n  const workerCount = Math.min(limit, values.length);\n  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n  return results;\n}\n\nasync function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n\n  try {\n    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n\n    try {\n      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n      if (markdown) {\n        return {\n          url,\n          ok: true,\n          markdown,\n          mode: \"jina\",\n        };\n      }\n    } catch {\n      // Fall through to direct HTML scrape.\n    }\n\n    const html = await fetchText(url);\n    const markdown = htmlToMarkdown(html);\n\n    if (!markdown) {\n      return {\n        url,\n        ok: false,\n        error: \"No markdown content returned from HTML fallback\",\n      };\n    }\n\n    return {\n      url,\n      ok: true,\n      markdown,\n      mode: \"html\",\n    };\n  } catch (error) {\n    return {\n      url,\n      ok: false,\n      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n    };\n  }\n}\n\nfunction resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n  if (!outputArg) {\n    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n  }\n\n  const resolved = resolve(repoRoot, outputArg);\n  if (resolved.endsWith(\".md\")) {\n    return dirname(resolved);\n  }\n\n  return resolved;\n}\n\nfunction clearExistingExtFiles(outputDir: string): void {\n  if (!existsSync(outputDir)) {\n    return;\n  }\n\n  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n    if (!entry.isFile()) {\n      continue;\n    }\n\n    if (!entry.name.endsWith(\".ext.md\")) {\n      continue;\n    }\n\n    rmSync(resolve(outputDir, entry.name));\n  }\n}\n\nconst repoRoot = findRepoRoot(import.meta.dir);\nconst outputArg = Bun.argv[2];\nconst outputDir = resolveOutputDirectory(repoRoot, outputArg);\nconst outputDirRelative = outputDir.startsWith(repoRoot)\n  ? outputDir.slice(repoRoot.length + 1)\n  : outputDir;\n\nmkdirSync(outputDir, { recursive: true });\nclearExistingExtFiles(outputDir);\n\nconst docsUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\n\nif (docsUrls.length === 0) {\n  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n}\n\nconst scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n  scrapeDocsPage(url, index + 1, docsUrls.length),\n);\n\nconst usedNames = new Map<string, number>();\nconst artifacts: PageArtifact[] = scrapeResults.map((result) => {\n  const stem = fileStemFromUrl(result.url);\n  const seen = usedNames.get(stem) ?? 0;\n  usedNames.set(stem, seen + 1);\n\n  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n  const fileName = `${stem}${suffix}.ext.md`;\n\n  return {\n    ...result,\n    fileName,\n    sourcePath: sourcePathFromUrl(result.url),\n  };\n});\n\nconst capturedAt = new Date().toISOString();\n\nfor (const artifact of artifacts) {\n  const pagePath = resolve(outputDir, artifact.fileName);\n  const pageContent = buildPageMarkdown(artifact, capturedAt);\n  await Bun.write(pagePath, pageContent);\n}\n\nconst indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\nawait Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n\nconst successCount = artifacts.filter((artifact) => artifact.ok).length;\nconst failureCount = artifacts.length - successCount;\nconst blockedPages = artifacts\n  .filter((artifact) => !artifact.ok)\n  .map((artifact) => artifact.sourcePath)\n  .join(\",\");\n\nconsole.log(\n  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n);\n",
                  "after": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};\n\nconst SOURCE_KEY = \"opencode\";\nconst DOCS_ROOT = \"https://opencode.ai/docs\";\nconst SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\nconst DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\nconst CONCURRENCY = 4;\nconst SUMMARY_MAX_CHARS = 240;\nconst DEFAULT_LANGUAGE = \"en\";\nconst KNOWN_NON_EN_DOC_PREFIXES = new Set([\n  \"ar\",\n  \"de\",\n  \"es\",\n  \"fr\",\n  \"it\",\n  \"ja\",\n  \"ko\",\n  \"pt\",\n  \"ru\",\n  \"tr\",\n  \"vi\",\n  \"zh\",\n  \"zh-cn\",\n  \"zh-tw\",\n]);\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replaceAll(\"&amp;\", \"&\")\n    .replaceAll(\"&quot;\", '\"')\n    .replaceAll(\"&apos;\", \"'\")\n    .replaceAll(\"&#x27;\", \"'\")\n    .replaceAll(\"&#39;\", \"'\")\n    .replaceAll(\"&nbsp;\", \" \")\n    .replaceAll(\"&lt;\", \"<\")\n    .replaceAll(\"&gt;\", \">\");\n}\n\nfunction stripJinaEnvelope(markdown: string): string {\n  return markdown\n    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n    .trim();\n}\n\nfunction stripTags(value: string): string {\n  return value.replace(/<[^>]+>/g, \"\");\n}\n\nfunction plainTextFromHtml(value: string): string {\n  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n}\n\nfunction extractMainHtml(html: string): string {\n  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n  if (articleMatch?.[1]) {\n    return articleMatch[1];\n  }\n\n  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n  if (mainMatch?.[1]) {\n    return mainMatch[1];\n  }\n\n  return html;\n}\n\nfunction htmlToMarkdown(html: string): string {\n  let content = extractMainHtml(html);\n\n  content = content\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n\n  content = content.replace(\n    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n    (_match, code) => {\n      const normalizedCode = decodeEntities(\n        stripTags(code)\n          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n          .replace(/\\n{3,}/g, \"\\n\\n\")\n          .trim(),\n      );\n\n      if (!normalizedCode) {\n        return \"\";\n      }\n\n      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n    },\n  );\n\n  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n    const normalizedCode = decodeEntities(stripTags(code)).trim();\n    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n  });\n\n  content = content.replace(\n    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n    (_match, href, label) => {\n      const text = plainTextFromHtml(label);\n      if (!text) {\n        return \"\";\n      }\n\n      return `[${text}](${decodeEntities(href)})`;\n    },\n  );\n\n  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n    const heading = plainTextFromHtml(inner);\n    if (!heading) {\n      return \"\";\n    }\n\n    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n  });\n\n  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n    const line = plainTextFromHtml(inner);\n    return line ? `- ${line}\\n` : \"\";\n  });\n\n  content = content\n    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n      const cell = plainTextFromHtml(inner);\n      return cell ? `${cell} ` : \"\";\n    });\n\n  content = decodeEntities(content)\n    .replace(/<[^>]+>/g, \"\")\n    .replace(/[ \\t]+\\n/g, \"\\n\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .trim();\n\n  return content;\n}\n\nfunction sanitizeSegment(value: string): string {\n  const clean = decodeURIComponent(value)\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return clean || \"page\";\n}\n\nfunction sourcePathFromUrl(url: string): string {\n  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n  return pathname;\n}\n\nfunction fileStemFromUrl(url: string): string {\n  const sourcePath = sourcePathFromUrl(url);\n\n  if (sourcePath === \"/docs\") {\n    return \"docs\";\n  }\n\n  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n  const segments = relative\n    .split(\"/\")\n    .filter(Boolean)\n    .map(sanitizeSegment);\n\n  if (segments.length === 0) {\n    return \"docs\";\n  }\n\n  return [\"docs\", ...segments].join(\"__\");\n}\n\nfunction extractSummary(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  let inCodeBlock = false;\n\n  for (const rawLine of lines) {\n    const line = rawLine.trim();\n\n    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n      inCodeBlock = !inCodeBlock;\n      continue;\n    }\n\n    if (inCodeBlock) {\n      continue;\n    }\n\n    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n      continue;\n    }\n\n    if (line.length <= 25) {\n      continue;\n    }\n\n    if (line.length > SUMMARY_MAX_CHARS) {\n      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n    }\n\n    return line;\n  }\n\n  return \"OpenCode documentation page snapshot.\";\n}\n\nfunction keywordsForPath(sourcePath: string): string {\n  const dynamic = sourcePath\n    .split(\"/\")\n    .filter(Boolean)\n    .slice(1)\n    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n    .filter(Boolean)\n    .join(\", \");\n\n  const base = \"opencode, docs, ai coding assistant, cli\";\n  return dynamic ? `${base}, ${dynamic}` : base;\n}\n\nfunction buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n  const pageSummary = result.ok\n    ? extractSummary(result.markdown ?? \"\")\n    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  const pageBody = result.ok\n    ? result.markdown?.trim() ?? \"\"\n    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  return [\n    \"----\",\n    \"## External Docs Snapshot // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Source page: ${result.sourcePath}`,\n    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n    `- Summary: ${pageSummary}`,\n    \"----\",\n    \"\",\n    `Source: ${result.url}`,\n    \"\",\n    pageBody,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Collection method: sitemap discovery + markdown conversion.\",\n    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nfunction buildIndexMarkdown(\n  artifacts: PageArtifact[],\n  capturedAt: string,\n  outputDirRelative: string,\n): string {\n  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n  const failureCount = artifacts.length - successCount;\n\n  const pageList = artifacts\n    .map((artifact) => {\n      const status = artifact.ok ? \"ok\" : \"failed\";\n      const mode = artifact.mode ?? \"unknown\";\n      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n    })\n    .join(\"\\n\");\n\n  return [\n    \"----\",\n    \"## External Docs Index // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Output directory: ${outputDirRelative}`,\n    `- Scope: ${artifacts.length} pages under /docs`,\n    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n    \"----\",\n    \"\",\n    \"## Pages\",\n    \"\",\n    pageList,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nasync function fetchText(url: string): Promise<string> {\n  const response = await fetch(url, {\n    headers: {\n      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Request failed (${response.status}) for ${url}`);\n  }\n\n  return await response.text();\n}\n\nfunction extractLocUrls(xml: string): string[] {\n  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n    decodeEntities(match[1]?.trim() ?? \"\"),\n  ).filter(Boolean);\n}\n\nasync function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n  const visited = new Set<string>();\n  const pending: string[] = [sitemapUrl];\n  const docsUrls = new Set<string>();\n\n  while (pending.length > 0) {\n    const current = pending.pop();\n    if (!current || visited.has(current)) {\n      continue;\n    }\n\n    visited.add(current);\n\n    let xml: string;\n    try {\n      xml = await fetchText(current);\n    } catch {\n      continue;\n    }\n\n    const locUrls = extractLocUrls(xml);\n    for (const locUrl of locUrls) {\n      if (locUrl.endsWith(\".xml\")) {\n        if (!visited.has(locUrl)) {\n          pending.push(locUrl);\n        }\n        continue;\n      }\n\n      if (!locUrl.startsWith(DOCS_ROOT)) {\n        continue;\n      }\n\n      if (locUrl.includes(\"#\")) {\n        continue;\n      }\n\n      docsUrls.add(locUrl);\n    }\n  }\n\n  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n}\n\nfunction isEnglishDocsUrl(url: string): boolean {\n  const pathname = new URL(url).pathname;\n  if (!pathname.startsWith(\"/docs\")) {\n    return false;\n  }\n\n  const relative = pathname.replace(/^\\/docs\\/?/, \"\");\n  if (!relative) {\n    return true;\n  }\n\n  const firstSegment = relative.split(\"/\")[0]?.toLowerCase() ?? \"\";\n  if (!firstSegment) {\n    return true;\n  }\n\n  if (firstSegment === \"en\" || firstSegment === \"english\") {\n    return true;\n  }\n\n  if (KNOWN_NON_EN_DOC_PREFIXES.has(firstSegment)) {\n    return false;\n  }\n\n  return true;\n}\n\nasync function mapConcurrent<T, R>(\n  values: T[],\n  limit: number,\n  map: (value: T, index: number) => Promise<R>,\n): Promise<R[]> {\n  const results = new Array<R>(values.length);\n  let index = 0;\n\n  async function worker(): Promise<void> {\n    while (true) {\n      const currentIndex = index;\n      index += 1;\n\n      if (currentIndex >= values.length) {\n        return;\n      }\n\n      results[currentIndex] = await map(values[currentIndex], currentIndex);\n    }\n  }\n\n  const workerCount = Math.min(limit, values.length);\n  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n  return results;\n}\n\nasync function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n\n  try {\n    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n\n    try {\n      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n      if (markdown) {\n        return {\n          url,\n          ok: true,\n          markdown,\n          mode: \"jina\",\n        };\n      }\n    } catch {\n      // Fall through to direct HTML scrape.\n    }\n\n    const html = await fetchText(url);\n    const markdown = htmlToMarkdown(html);\n\n    if (!markdown) {\n      return {\n        url,\n        ok: false,\n        error: \"No markdown content returned from HTML fallback\",\n      };\n    }\n\n    return {\n      url,\n      ok: true,\n      markdown,\n      mode: \"html\",\n    };\n  } catch (error) {\n    return {\n      url,\n      ok: false,\n      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n    };\n  }\n}\n\nfunction resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n  if (!outputArg) {\n    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n  }\n\n  const resolved = resolve(repoRoot, outputArg);\n  if (resolved.endsWith(\".md\")) {\n    return dirname(resolved);\n  }\n\n  return resolved;\n}\n\nfunction clearExistingExtFiles(outputDir: string): void {\n  if (!existsSync(outputDir)) {\n    return;\n  }\n\n  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n    if (!entry.isFile()) {\n      continue;\n    }\n\n    if (!entry.name.endsWith(\".ext.md\")) {\n      continue;\n    }\n\n    rmSync(resolve(outputDir, entry.name));\n  }\n}\n\nconst repoRoot = findRepoRoot(import.meta.dir);\nconst outputArg = Bun.argv[2];\nconst outputDir = resolveOutputDirectory(repoRoot, outputArg);\nconst outputDirRelative = outputDir.startsWith(repoRoot)\n  ? outputDir.slice(repoRoot.length + 1)\n  : outputDir;\n\nmkdirSync(outputDir, { recursive: true });\nclearExistingExtFiles(outputDir);\n\nconst requestedLanguage = (Bun.env.DOCS_LANGUAGE ?? DEFAULT_LANGUAGE).toLowerCase();\nconst discoveredUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\nconst docsUrls =\n  requestedLanguage === \"en\" || requestedLanguage === \"english\"\n    ? discoveredUrls.filter(isEnglishDocsUrl)\n    : discoveredUrls;\n\nif (docsUrls.length === 0) {\n  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n}\n\nconst scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n  scrapeDocsPage(url, index + 1, docsUrls.length),\n);\n\nconst usedNames = new Map<string, number>();\nconst artifacts: PageArtifact[] = scrapeResults.map((result) => {\n  const stem = fileStemFromUrl(result.url);\n  const seen = usedNames.get(stem) ?? 0;\n  usedNames.set(stem, seen + 1);\n\n  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n  const fileName = `${stem}${suffix}.ext.md`;\n\n  return {\n    ...result,\n    fileName,\n    sourcePath: sourcePathFromUrl(result.url),\n  };\n});\n\nconst capturedAt = new Date().toISOString();\n\nfor (const artifact of artifacts) {\n  const pagePath = resolve(outputDir, artifact.fileName);\n  const pageContent = buildPageMarkdown(artifact, capturedAt);\n  await Bun.write(pagePath, pageContent);\n}\n\nconst indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\nawait Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n\nconst successCount = artifacts.filter((artifact) => artifact.ok).length;\nconst failureCount = artifacts.length - successCount;\nconst blockedPages = artifacts\n  .filter((artifact) => !artifact.ok)\n  .map((artifact) => artifact.sourcePath)\n  .join(\",\");\n\nconsole.log(\n  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},lang=${requestedLanguage},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n);\n",
                  "additions": 51,
                  "deletions": 2
                }
              ],
              "diagnostics": {},
              "truncated": false
            },
            "time": {
              "start": 1771215171573,
              "end": 1771215171651
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_00659a47e38da450016992993b8a008194991ca37821f20317"
            }
          },
          "id": "prt_c64a690d4001hXuM2e4cYnd3yQ",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a667ec001upy9EWpZOpvly1"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "fee217b94c19234485a1e582174078d5ed9d3d86",
          "cost": 0,
          "tokens": {
            "total": 32983,
            "input": 15974,
            "output": 1009,
            "reasoning": 287,
            "cache": {
              "read": 16000,
              "write": 0
            }
          },
          "id": "prt_c64a6b046001ylKYb0YK1W7l0v",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a667ec001upy9EWpZOpvly1"
        },
        {
          "type": "patch",
          "hash": "1552fd43035ae4ad0a2b79f1c9cff4e3c3c2cce4",
          "files": [
            "/Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts"
          ],
          "id": "prt_c64a6b0cf0010WHUv5rILTDuoe",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a667ec001upy9EWpZOpvly1"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215171805,
          "completed": 1771215178487
        },
        "parentID": "msg_c64a667e1001oSCNckxNgJGDO0",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 33284,
          "input": 1139,
          "output": 273,
          "reasoning": 25,
          "cache": {
            "read": 31872,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a6b0dd001P3tJyNMgCmiKmp",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fee217b94c19234485a1e582174078d5ed9d3d86",
          "id": "prt_c64a6ba2c001fmSFJkt0fPx1Mj",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6b0dd001P3tJyNMgCmiKmp"
        },
        {
          "type": "reasoning",
          "text": "**Updating README and script docs**",
          "metadata": {
            "openai": {
              "itemId": "rs_0733e9504293b7fa016992994679c08196931b82d270f88c84",
              "reasoningEncryptedContent": "gAAAAABpkplHyvASRxO4QCJ9p1DGw3t-PhAuv_s418-82xsh0D_F2F7Yoka9zOOQjJ39l--SBmaeGHfPUnmmOVJVwywHC_z1aQtaTisEmgIqi0T2S-Pzvr77vBYl8v9LdA_Qia7EI8tDFY4KUGfqaCArJ70MTqqHHu-kFDiL78aLbmfTvWWJetucypg6S6aD9hiz7jut1LR7AwtFilaSGA7ObyIzg1e1DhkLZqnBWdpMVEkNkMJFIHpZqj-PcIeXU7lnBuEFtWX_QUJtbEvEXz1TeL-NCfrT4VfozszouZ4hWaBsjZzF2WWFiiDoZ0-rTIlc9xkFR6-MAO0XWMcnD9Z0hzwhJWKy7oFAUQqOMAtbcpP3_Oe7jqH5HgSxp41nefiRztAqOrpglnsb6uwjO6VBeaIPPFHmCEBDRoWb3CF_JFAeWGQwhy-LfRHxO7607wXgKL0yf1jJl8yFjdcGXBcKuh5reFWli3zx20twTRgQ1dMl9LvIKd9_bGubwVfJK3Yq--LraYrwaHc-N50lk4_WO5zWVctP6uhQjXjeWKOJJ5jiEMX6VfHJGBbplEZ7009ZXz5qECoJfIQ8Z82sreG92OHnP2t31hUPEqkeMd7mGUdw1PJ2FzEYOYtYlW0istH6mPy-RespQVCcBnWiJPGlIhmZOSeqZ9QtlAls2FZ32RY9ifmZKhTkoxtao891lNU7whJhIZWWcOnfb9ToCR8L3jvn59kwvt9R16WFbAfIOT-PfonO1ODaRVzBUmC0KVoIwv1X_J--4u9t0e2yBpADO4zzmQgqgI7XQbCjgh0IPW5HXWzoqFbGRLDwAlGa5aaSaFaCRO0n-0X278BtIuhaH-1bLMiZucWNrOj_fGSXGOFZjgsn5WeUIlribhmu4uajTyuqa1Rc4u5SApZkwVFFsfZKrK7Pn9lXhskUnnNFtt4i8WPFj8OCP7dPgV3Vl-jt1e0H42jccXqDjDhfVsbLW5-oKI1aHQ=="
            }
          },
          "time": {
            "start": 1771215174598,
            "end": 1771215175376
          },
          "id": "prt_c64a6bbc6001friqRRy6LbTmi2",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6b0dd001P3tJyNMgCmiKmp"
        },
        {
          "type": "tool",
          "callID": "call_zQ1tc8hTvUkBtkwAyv4WmgOY",
          "tool": "apply_patch",
          "state": {
            "status": "completed",
            "input": {
              "patchText": "*** Begin Patch\n*** Update File: /Users/alex/repos/vfp/dark-factory/README.md\n@@\n - `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n - `scripts/scrape_moon_docs.sh.ts` captures moonrepo docs as split per-page `docs/external/moonrepo/*.ext.md` files plus `docs/external/moonrepo/index.ext.md`.\n+- `scripts/scrape_opencode_docs.sh.ts` captures OpenCode docs as split per-page `docs/external/opencode/*.ext.md` files plus `docs/external/opencode/index.ext.md`.\n+  - Defaults to English docs only (`DOCS_LANGUAGE=en`), with optional override via `DOCS_LANGUAGE`.\n - OpenCode skill reference: `.opencode/skills/proto-install/SKILL.md`.\n - OpenCode skill reference: `.opencode/skills/script-authoring/SKILL.md`.\n - OpenCode skill reference: `.opencode/skills/docs-scraping/SKILL.md`.\n*** End Patch"
            },
            "output": "Success. Updated the following files:\nM README.md",
            "title": "Success. Updated the following files:\nM README.md",
            "metadata": {
              "diff": "Index: /Users/alex/repos/vfp/dark-factory/README.md\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/README.md\n+++ /Users/alex/repos/vfp/dark-factory/README.md\n@@ -35,8 +35,10 @@\n - Shared helpers live in `scripts/helpers/`.\n - `scripts/install.sh.ts` runs an ordered array of install steps from repository root.\n - `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n - `scripts/scrape_moon_docs.sh.ts` captures moonrepo docs as split per-page `docs/external/moonrepo/*.ext.md` files plus `docs/external/moonrepo/index.ext.md`.\n+- `scripts/scrape_opencode_docs.sh.ts` captures OpenCode docs as split per-page `docs/external/opencode/*.ext.md` files plus `docs/external/opencode/index.ext.md`.\n+  - Defaults to English docs only (`DOCS_LANGUAGE=en`), with optional override via `DOCS_LANGUAGE`.\n - OpenCode skill reference: `.opencode/skills/proto-install/SKILL.md`.\n - OpenCode skill reference: `.opencode/skills/script-authoring/SKILL.md`.\n - OpenCode skill reference: `.opencode/skills/docs-scraping/SKILL.md`.\n \n\n",
              "files": [
                {
                  "filePath": "/Users/alex/repos/vfp/dark-factory/README.md",
                  "relativePath": "README.md",
                  "type": "update",
                  "diff": "Index: /Users/alex/repos/vfp/dark-factory/README.md\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/README.md\n+++ /Users/alex/repos/vfp/dark-factory/README.md\n@@ -35,8 +35,10 @@\n - Shared helpers live in `scripts/helpers/`.\n - `scripts/install.sh.ts` runs an ordered array of install steps from repository root.\n - `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n - `scripts/scrape_moon_docs.sh.ts` captures moonrepo docs as split per-page `docs/external/moonrepo/*.ext.md` files plus `docs/external/moonrepo/index.ext.md`.\n+- `scripts/scrape_opencode_docs.sh.ts` captures OpenCode docs as split per-page `docs/external/opencode/*.ext.md` files plus `docs/external/opencode/index.ext.md`.\n+  - Defaults to English docs only (`DOCS_LANGUAGE=en`), with optional override via `DOCS_LANGUAGE`.\n - OpenCode skill reference: `.opencode/skills/proto-install/SKILL.md`.\n - OpenCode skill reference: `.opencode/skills/script-authoring/SKILL.md`.\n - OpenCode skill reference: `.opencode/skills/docs-scraping/SKILL.md`.\n \n",
                  "before": "# Dark Factory - Autonomous Agentic Development At Scale\n\n# Concept\n\n- A central `dark-factory` \"core\" is used to track `products`\n- A `product` is the canonical definition of a code product we want to work on\n  - In Stage 0 this is identified by a local path-based locator key\n  - Locators are path/url-like identifiers, currently using `@local://{abs_path}`\n  - `product` may optionally include a `display_name` for human-friendly rendering\n- A `variant` is a spawned instance of a `product` where work actually runs\n  - In Stage 0 a product immediately gets one default variant on creation\n  - Variant identity follows the same locator pattern with a fragment suffix:\n    - `@local://{abs_path}#default`\n  - Future variants can use other suffixes (example: `#wt-main`) when we support parallel instances\n- Stage 0 topology is intentionally strict and simple:\n  - One product locator\n  - One default variant locator\n  - One actor bound to that variant\n- `actor` is a spawned agent that operates on a variant\n  - Can be various agent backends (currently scoped in OpenCode, Codex and a custom agent), but first iteration is JUST OpenCode\n  - Future work will allow multiple variants per product and multiple actors where operations allow\n\n# Stack + Tools\n\n- Agentic Coding: `opencode`\n- Main languages: `rust` and `bun` / `typescript`\n- Scripting: shebanged Bun TypeScript scripts under `scripts/` (`*.sh.ts`)\n- Optional build system: `moon` / `proto`\n- Common Schema Definition: `prisma`\n  - [ ] TODO: Investigate use of protobuf\n\n# Scripts\n\n- Project shell-style scripts are Bun TypeScript files with shebangs: `#!/usr/bin/env bun`.\n- Shared helpers live in `scripts/helpers/`.\n- `scripts/install.sh.ts` runs an ordered array of install steps from repository root.\n- `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n- `scripts/scrape_moon_docs.sh.ts` captures moonrepo docs as split per-page `docs/external/moonrepo/*.ext.md` files plus `docs/external/moonrepo/index.ext.md`.\n- OpenCode skill reference: `.opencode/skills/proto-install/SKILL.md`.\n- OpenCode skill reference: `.opencode/skills/script-authoring/SKILL.md`.\n- OpenCode skill reference: `.opencode/skills/docs-scraping/SKILL.md`.\n\n# Components\n\n## Core\n\n- Central service that manages tracking of all products/variants/actors/settings, etc.\n  - TBD: will either be stateless w/ DB and route all commands just to the agents\n    - OR: a background API service (REST even) we can query from frontends\n- Currently looks like it will be Bun + Elysia JS\n\n## Frontends\n\n- Various frontends that invoke / connect to Core\n- Main way of iterating with the system\n- Uses the Core API to communicate (REST / WS or GRPC in the future)\n- Some Frontends:\n  - Rust TUI (Ratatui.rs) - First One\n  - Web Client (Bun + Vite + Shadcn + React)\n  - Pure CLI (Rust)\n\n## Agents\n\n- Abstracted communication with actual agents doing work\n- First is OpenCode\n",
                  "after": "# Dark Factory - Autonomous Agentic Development At Scale\n\n# Concept\n\n- A central `dark-factory` \"core\" is used to track `products`\n- A `product` is the canonical definition of a code product we want to work on\n  - In Stage 0 this is identified by a local path-based locator key\n  - Locators are path/url-like identifiers, currently using `@local://{abs_path}`\n  - `product` may optionally include a `display_name` for human-friendly rendering\n- A `variant` is a spawned instance of a `product` where work actually runs\n  - In Stage 0 a product immediately gets one default variant on creation\n  - Variant identity follows the same locator pattern with a fragment suffix:\n    - `@local://{abs_path}#default`\n  - Future variants can use other suffixes (example: `#wt-main`) when we support parallel instances\n- Stage 0 topology is intentionally strict and simple:\n  - One product locator\n  - One default variant locator\n  - One actor bound to that variant\n- `actor` is a spawned agent that operates on a variant\n  - Can be various agent backends (currently scoped in OpenCode, Codex and a custom agent), but first iteration is JUST OpenCode\n  - Future work will allow multiple variants per product and multiple actors where operations allow\n\n# Stack + Tools\n\n- Agentic Coding: `opencode`\n- Main languages: `rust` and `bun` / `typescript`\n- Scripting: shebanged Bun TypeScript scripts under `scripts/` (`*.sh.ts`)\n- Optional build system: `moon` / `proto`\n- Common Schema Definition: `prisma`\n  - [ ] TODO: Investigate use of protobuf\n\n# Scripts\n\n- Project shell-style scripts are Bun TypeScript files with shebangs: `#!/usr/bin/env bun`.\n- Shared helpers live in `scripts/helpers/`.\n- `scripts/install.sh.ts` runs an ordered array of install steps from repository root.\n- `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n- `scripts/scrape_moon_docs.sh.ts` captures moonrepo docs as split per-page `docs/external/moonrepo/*.ext.md` files plus `docs/external/moonrepo/index.ext.md`.\n- `scripts/scrape_opencode_docs.sh.ts` captures OpenCode docs as split per-page `docs/external/opencode/*.ext.md` files plus `docs/external/opencode/index.ext.md`.\n  - Defaults to English docs only (`DOCS_LANGUAGE=en`), with optional override via `DOCS_LANGUAGE`.\n- OpenCode skill reference: `.opencode/skills/proto-install/SKILL.md`.\n- OpenCode skill reference: `.opencode/skills/script-authoring/SKILL.md`.\n- OpenCode skill reference: `.opencode/skills/docs-scraping/SKILL.md`.\n\n# Components\n\n## Core\n\n- Central service that manages tracking of all products/variants/actors/settings, etc.\n  - TBD: will either be stateless w/ DB and route all commands just to the agents\n    - OR: a background API service (REST even) we can query from frontends\n- Currently looks like it will be Bun + Elysia JS\n\n## Frontends\n\n- Various frontends that invoke / connect to Core\n- Main way of iterating with the system\n- Uses the Core API to communicate (REST / WS or GRPC in the future)\n- Some Frontends:\n  - Rust TUI (Ratatui.rs) - First One\n  - Web Client (Bun + Vite + Shadcn + React)\n  - Pure CLI (Rust)\n\n## Agents\n\n- Abstracted communication with actual agents doing work\n- First is OpenCode\n",
                  "additions": 2,
                  "deletions": 0
                }
              ],
              "diagnostics": {},
              "truncated": false
            },
            "time": {
              "start": 1771215178389,
              "end": 1771215178402
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_0733e9504293b7fa0169929947486881969dd8d87978257ab7"
            }
          },
          "id": "prt_c64a6bed10010jDVhqtfAUmT9r",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6b0dd001P3tJyNMgCmiKmp"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "f25f3b120aca2cf2c6eb14692cec113bab68f52f",
          "cost": 0,
          "tokens": {
            "total": 33284,
            "input": 1139,
            "output": 273,
            "reasoning": 25,
            "cache": {
              "read": 31872,
              "write": 0
            }
          },
          "id": "prt_c64a6cac5001XDlk9bJp97XZUv",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6b0dd001P3tJyNMgCmiKmp"
        },
        {
          "type": "patch",
          "hash": "fee217b94c19234485a1e582174078d5ed9d3d86",
          "files": [
            "/Users/alex/repos/vfp/dark-factory/README.md"
          ],
          "id": "prt_c64a6caf20012XKm765CndfgEn",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6b0dd001P3tJyNMgCmiKmp"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215178490,
          "completed": 1771215185852
        },
        "parentID": "msg_c64a667e1001oSCNckxNgJGDO0",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 33522,
          "input": 1049,
          "output": 217,
          "reasoning": 0,
          "cache": {
            "read": 32256,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a6cafa001WL6ltzmdCwTroQ",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "f25f3b120aca2cf2c6eb14692cec113bab68f52f",
          "id": "prt_c64a6d46e001oiRe5osaDvB18q",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6cafa001WL6ltzmdCwTroQ"
        },
        {
          "type": "tool",
          "callID": "call_IdYh1CLm8NqZ709eGSoo2KU7",
          "tool": "apply_patch",
          "state": {
            "status": "completed",
            "input": {
              "patchText": "*** Begin Patch\n*** Update File: /Users/alex/repos/vfp/dark-factory/AGENTS.md\n@@\n - `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n - `scripts/scrape_moon_docs.sh.ts` scrapes moonrepo docs into split per-page `docs/external/moonrepo/*.ext.md` files and writes `docs/external/moonrepo/index.ext.md`.\n+- `scripts/scrape_opencode_docs.sh.ts` scrapes OpenCode docs into split per-page `docs/external/opencode/*.ext.md` files and writes `docs/external/opencode/index.ext.md`.\n+  - Default language filter is English (`DOCS_LANGUAGE=en`) to avoid multi-language captures unless overridden.\n - After a new command sequence succeeds in a conversation, suggest capturing it into a reusable script via `.opencode/commands/capture_script_from_context.md`.\n*** End Patch"
            },
            "output": "Success. Updated the following files:\nM AGENTS.md",
            "title": "Success. Updated the following files:\nM AGENTS.md",
            "metadata": {
              "diff": "Index: /Users/alex/repos/vfp/dark-factory/AGENTS.md\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/AGENTS.md\n+++ /Users/alex/repos/vfp/dark-factory/AGENTS.md\n@@ -77,8 +77,10 @@\n - Shared script helpers live under `scripts/helpers/`.\n - `scripts/install.sh.ts` runs a reusable ordered list of install steps.\n - `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n - `scripts/scrape_moon_docs.sh.ts` scrapes moonrepo docs into split per-page `docs/external/moonrepo/*.ext.md` files and writes `docs/external/moonrepo/index.ext.md`.\n+- `scripts/scrape_opencode_docs.sh.ts` scrapes OpenCode docs into split per-page `docs/external/opencode/*.ext.md` files and writes `docs/external/opencode/index.ext.md`.\n+  - Default language filter is English (`DOCS_LANGUAGE=en`) to avoid multi-language captures unless overridden.\n - After a new command sequence succeeds in a conversation, suggest capturing it into a reusable script via `.opencode/commands/capture_script_from_context.md`.\n \n ## 9) Keep This File Updated\n \n\n",
              "files": [
                {
                  "filePath": "/Users/alex/repos/vfp/dark-factory/AGENTS.md",
                  "relativePath": "AGENTS.md",
                  "type": "update",
                  "diff": "Index: /Users/alex/repos/vfp/dark-factory/AGENTS.md\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/AGENTS.md\n+++ /Users/alex/repos/vfp/dark-factory/AGENTS.md\n@@ -77,8 +77,10 @@\n - Shared script helpers live under `scripts/helpers/`.\n - `scripts/install.sh.ts` runs a reusable ordered list of install steps.\n - `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n - `scripts/scrape_moon_docs.sh.ts` scrapes moonrepo docs into split per-page `docs/external/moonrepo/*.ext.md` files and writes `docs/external/moonrepo/index.ext.md`.\n+- `scripts/scrape_opencode_docs.sh.ts` scrapes OpenCode docs into split per-page `docs/external/opencode/*.ext.md` files and writes `docs/external/opencode/index.ext.md`.\n+  - Default language filter is English (`DOCS_LANGUAGE=en`) to avoid multi-language captures unless overridden.\n - After a new command sequence succeeds in a conversation, suggest capturing it into a reusable script via `.opencode/commands/capture_script_from_context.md`.\n \n ## 9) Keep This File Updated\n \n",
                  "before": "# Dark Factory - Agent Operating Guide\n\nThis file is for coding agents working in `dark-factory`.\nIt reflects only what is currently true in this repository.\n\n## 1) Current Repository Context\n\n- The repo is early-stage and mostly docs/config right now.\n- Tracked project files currently include:\n  - `README.md`\n  - `TODO.md`\n  - `AGENTS.md`\n  - `opencode.jsonc`\n  - `.opencode/agents/gitter.md`\n  - `.opencode/skills/gitter-commit/SKILL.md`\n- No application code tree is committed yet (`src/`, `apps/`, `crates/`, etc.).\n\n## 2) Build/Lint/Test Status (Current Truth)\n\n- There are no validated build, lint, typecheck, or test commands yet.\n- Do not invent or assume project commands in commits or PR notes.\n- If new tooling is added, document only commands that are verified in this repo.\n\n## 3) Cursor and Copilot Rules\n\n- Checked and currently absent:\n  - `.cursor/rules/`\n  - `.cursorrules`\n  - `.github/copilot-instructions.md`\n- If any of these files appear later, treat them as authoritative and update this guide.\n\n## 4) Coding Style (Minimal Baseline)\n\nUntil language/tool-specific configs exist, follow pragmatic defaults:\n\n- Favor readable, explicit code over clever shortcuts.\n- Keep functions focused and avoid hidden side effects.\n- Avoid dead code, unused imports, and speculative abstractions.\n- Keep naming consistent (`PascalCase` types, `camelCase` values/functions, `UPPER_SNAKE_CASE` constants).\n- Handle errors with context; do not swallow exceptions silently.\n- Never log secrets or credentials.\n- Log messages should follow: `System // Optional Sub system // Message (Metadata)`.\n  - Example: `Core // HTTP // Listening (env=development,host=127.0.0.1,port=4150)`.\n\n## 5) Git Workflow\n\n- Commit meaningful units of work; avoid giant mixed commits.\n- Do not push unless the user explicitly requests it.\n- Commit message format:\n  - `{Component/Meta} // {Optional Addition} // {Short Description} (Optional,Tags)`\n- Examples:\n  - `Docs // Added converted PDF docs`\n  - `Pipelines // ODM // Added initial ODM pipeline (WIP)`\n- In commit body, add a short rationale and signature when possible:\n  - `// Chappie/Model (your model if known)`\n\n## 6) OpenCode Integration\n\n- `.opencode/agents/gitter.md` is the git-focused subagent.\n- `.opencode/skills/gitter-commit/SKILL.md` documents when to route commit tasks to `@gitter`.\n- `.opencode/skills/proto-install/SKILL.md` documents standardized script-based `proto install` usage.\n- `.opencode/skills/protobuf-schema-authoring/SKILL.md` documents how to author proto2/proto3 schemas and provide Rust/TypeScript codegen workflows.\n- `.opencode/skills/script-authoring/SKILL.md` documents how to build reusable Bun scripts from prompt/example/bash/context.\n- `.opencode/skills/docs-scraping/SKILL.md` documents generic user-request driven external docs scraping workflows.\n- Use `@gitter` when the user asks for commit support or cleanup.\n\n## 7) Local Fork Workflow (`elysia-protobuf`)\n\n- `elysia-protobuf` is also cloned locally at `~/repos/vfp/elysia-protobuf`.\n- If Core hits a bug in that dependency, patch it in the local fork repo, push the fork, then update the pinned git ref in `core/package.json` and refresh `core/bun.lock`.\n- Core currently tracks `elysia-protobuf` from the fork `master` branch in `core/package.json`; after pushing fork changes, refresh `core/bun.lock` in this repo.\n\n## 8) Script Conventions\n\n- Project scripts use shebanged Bun TypeScript files (`#!/usr/bin/env bun`) under `scripts/`.\n- Script naming uses `*.sh.ts` to indicate executable shell-style Bun scripts.\n- Shared script helpers live under `scripts/helpers/`.\n- `scripts/install.sh.ts` runs a reusable ordered list of install steps.\n- `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n- `scripts/scrape_moon_docs.sh.ts` scrapes moonrepo docs into split per-page `docs/external/moonrepo/*.ext.md` files and writes `docs/external/moonrepo/index.ext.md`.\n- After a new command sequence succeeds in a conversation, suggest capturing it into a reusable script via `.opencode/commands/capture_script_from_context.md`.\n\n## 9) Keep This File Updated\n\n- Update this file when real code, tooling, or CI is added.\n- Keep instructions tied to verified repository behavior.\n- Prefer short, accurate guidance over aspirational process docs.\n",
                  "after": "# Dark Factory - Agent Operating Guide\n\nThis file is for coding agents working in `dark-factory`.\nIt reflects only what is currently true in this repository.\n\n## 1) Current Repository Context\n\n- The repo is early-stage and mostly docs/config right now.\n- Tracked project files currently include:\n  - `README.md`\n  - `TODO.md`\n  - `AGENTS.md`\n  - `opencode.jsonc`\n  - `.opencode/agents/gitter.md`\n  - `.opencode/skills/gitter-commit/SKILL.md`\n- No application code tree is committed yet (`src/`, `apps/`, `crates/`, etc.).\n\n## 2) Build/Lint/Test Status (Current Truth)\n\n- There are no validated build, lint, typecheck, or test commands yet.\n- Do not invent or assume project commands in commits or PR notes.\n- If new tooling is added, document only commands that are verified in this repo.\n\n## 3) Cursor and Copilot Rules\n\n- Checked and currently absent:\n  - `.cursor/rules/`\n  - `.cursorrules`\n  - `.github/copilot-instructions.md`\n- If any of these files appear later, treat them as authoritative and update this guide.\n\n## 4) Coding Style (Minimal Baseline)\n\nUntil language/tool-specific configs exist, follow pragmatic defaults:\n\n- Favor readable, explicit code over clever shortcuts.\n- Keep functions focused and avoid hidden side effects.\n- Avoid dead code, unused imports, and speculative abstractions.\n- Keep naming consistent (`PascalCase` types, `camelCase` values/functions, `UPPER_SNAKE_CASE` constants).\n- Handle errors with context; do not swallow exceptions silently.\n- Never log secrets or credentials.\n- Log messages should follow: `System // Optional Sub system // Message (Metadata)`.\n  - Example: `Core // HTTP // Listening (env=development,host=127.0.0.1,port=4150)`.\n\n## 5) Git Workflow\n\n- Commit meaningful units of work; avoid giant mixed commits.\n- Do not push unless the user explicitly requests it.\n- Commit message format:\n  - `{Component/Meta} // {Optional Addition} // {Short Description} (Optional,Tags)`\n- Examples:\n  - `Docs // Added converted PDF docs`\n  - `Pipelines // ODM // Added initial ODM pipeline (WIP)`\n- In commit body, add a short rationale and signature when possible:\n  - `// Chappie/Model (your model if known)`\n\n## 6) OpenCode Integration\n\n- `.opencode/agents/gitter.md` is the git-focused subagent.\n- `.opencode/skills/gitter-commit/SKILL.md` documents when to route commit tasks to `@gitter`.\n- `.opencode/skills/proto-install/SKILL.md` documents standardized script-based `proto install` usage.\n- `.opencode/skills/protobuf-schema-authoring/SKILL.md` documents how to author proto2/proto3 schemas and provide Rust/TypeScript codegen workflows.\n- `.opencode/skills/script-authoring/SKILL.md` documents how to build reusable Bun scripts from prompt/example/bash/context.\n- `.opencode/skills/docs-scraping/SKILL.md` documents generic user-request driven external docs scraping workflows.\n- Use `@gitter` when the user asks for commit support or cleanup.\n\n## 7) Local Fork Workflow (`elysia-protobuf`)\n\n- `elysia-protobuf` is also cloned locally at `~/repos/vfp/elysia-protobuf`.\n- If Core hits a bug in that dependency, patch it in the local fork repo, push the fork, then update the pinned git ref in `core/package.json` and refresh `core/bun.lock`.\n- Core currently tracks `elysia-protobuf` from the fork `master` branch in `core/package.json`; after pushing fork changes, refresh `core/bun.lock` in this repo.\n\n## 8) Script Conventions\n\n- Project scripts use shebanged Bun TypeScript files (`#!/usr/bin/env bun`) under `scripts/`.\n- Script naming uses `*.sh.ts` to indicate executable shell-style Bun scripts.\n- Shared script helpers live under `scripts/helpers/`.\n- `scripts/install.sh.ts` runs a reusable ordered list of install steps.\n- `scripts/proto_install.sh.ts` runs `proto install` from repository root.\n- `scripts/scrape_moon_docs.sh.ts` scrapes moonrepo docs into split per-page `docs/external/moonrepo/*.ext.md` files and writes `docs/external/moonrepo/index.ext.md`.\n- `scripts/scrape_opencode_docs.sh.ts` scrapes OpenCode docs into split per-page `docs/external/opencode/*.ext.md` files and writes `docs/external/opencode/index.ext.md`.\n  - Default language filter is English (`DOCS_LANGUAGE=en`) to avoid multi-language captures unless overridden.\n- After a new command sequence succeeds in a conversation, suggest capturing it into a reusable script via `.opencode/commands/capture_script_from_context.md`.\n\n## 9) Keep This File Updated\n\n- Update this file when real code, tooling, or CI is added.\n- Keep instructions tied to verified repository behavior.\n- Prefer short, accurate guidance over aspirational process docs.\n",
                  "additions": 2,
                  "deletions": 0
                }
              ],
              "diagnostics": {},
              "truncated": false
            },
            "time": {
              "start": 1771215185693,
              "end": 1771215185709
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_04c1250959c7eb5f016992994eb47c819392c27e490dd99429"
            }
          },
          "id": "prt_c64a6db97001tIoOeExrj5ctVD",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6cafa001WL6ltzmdCwTroQ"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "f9e0e662167c83cab6b250dabad052fa42cfbd5d",
          "cost": 0,
          "tokens": {
            "total": 33522,
            "input": 1049,
            "output": 217,
            "reasoning": 0,
            "cache": {
              "read": 32256,
              "write": 0
            }
          },
          "id": "prt_c64a6e788001NbcO1CANnaKCn6",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6cafa001WL6ltzmdCwTroQ"
        },
        {
          "type": "patch",
          "hash": "f25f3b120aca2cf2c6eb14692cec113bab68f52f",
          "files": [
            "/Users/alex/repos/vfp/dark-factory/AGENTS.md"
          ],
          "id": "prt_c64a6e7b9001sFAaDaWvCyEt4x",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6cafa001WL6ltzmdCwTroQ"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215185855,
          "completed": 1771215213868
        },
        "parentID": "msg_c64a667e1001oSCNckxNgJGDO0",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 33691,
          "input": 18761,
          "output": 82,
          "reasoning": 43,
          "cache": {
            "read": 14848,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a6e7bf0015rP8HXqEnRpRw3",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "f9e0e662167c83cab6b250dabad052fa42cfbd5d",
          "id": "prt_c64a6ef7d0013Ymj33NdILR0iL",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6e7bf0015rP8HXqEnRpRw3"
        },
        {
          "type": "reasoning",
          "text": "**Running initial script**",
          "metadata": {
            "openai": {
              "itemId": "rs_08615dbbf8071d2701699299549a20819687e57e20858cdca7",
              "reasoningEncryptedContent": "gAAAAABpkplWxx-fRrG0h0A9v2LF16v3DJOp1hidBHFS3r8UjIp_x5iGtdoxUIZsIdx5J5NbGWo8BSWYccAE4gA2nlNfHmF5lqqRyutlU8mdM8TqAs_CWVoZveq26hd8beqjDo3e88HoteDNXUrdgRAXMvQs6Z_h8gbrG-RUgCJKYCjMUWkei3qWAXOrdCL_L1-RTPBzffjozcLt-MxNSyVSaCOqFA7S_eaQZNJWp6UCJntggWTeW3o8Lq7VRgV5q_314a50q27qPBxFHkfGyqu6KYqzxWHI9vxReSsINLXWfDJnQ0_cx229IWPgDFaTRbPIO8U4WtZbDdAdV8p_6_7Kbd7ECuqwtUgLvfUYfzttcUjOtGLRuHsLm-MI3PYU2wfZNjTSGVfej7kuX1Kg_ryceSakao_FUI0H3KP2WdnEy-j2RA2pqwHJhCmH7TKEZVRUrlsUkCu9DMXhVptf318PDgdj9W6gB4wAke9yMIOvcCXi2-GQ7_F0vHU_1OSBou6BX3gFY5Ids2rIMWCw2VyYitcV1mk-LFPrcwKB5IbE8hGekAnO4r-BMjsCHiKWg8YPnexgsEjxZBE0KHXD-MNbgfYkY3DXrA48eCF-dQjW5LHlqd13H-nXSY7boZzmuvBlmhEqmXAcZzuoehrvZuf12itcqRnUrKgBv5GZc5phT8hOPVijF_jzV5qQpW1Lw_rKbmQPoJh1Z1KJns3XP2JTY_1YZ5fHF84TffnJCapFB8_0h5L0stfkmwo-olKILVhUU2uQMxX1SZ2IHfjCGyIoiWQYMEWAgG8-g9NrHY8Whm5Tr9gHwwMqMTpdr86i-aWh7lFzdpm8qqCpemuL5G40lscQPXCYr3skg0uYKuG7O46Ub6rV3LT7Ay8k3LXZesxQc_DsZgQzAXw8XLkObdBTLwZD93GQshqhULOgAhTe9hdQKnAzZzB-IxzLcKMB7sV1Z7axmVJTnvYx_nQCYzB5MYYXPFLoxhHA5iFpaxvyiGF8og8aB8EQp0CkoNS6hxuX-UNdkrDXR3qj7sh_OHpdeOPIz4Aczo00PMfiJfrGXK3v3-tR-r3a4X9WtXvBVQ4TBmW1XUDWIKL3_ChHlmSjK2sr1J_zyQ=="
            }
          },
          "time": {
            "start": 1771215188637,
            "end": 1771215190192
          },
          "id": "prt_c64a6f29d001cFFynvHzjt4U1h",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6e7bf0015rP8HXqEnRpRw3"
        },
        {
          "type": "tool",
          "callID": "call_kMtpef4OmSFOyRm0uEYp3eRO",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "bun scripts/scrape_opencode_docs.sh.ts",
              "description": "Run OpenCode scraper with English default"
            },
            "output": "Docs // Scrape // 1/204 https://opencode.ai/docs/\nDocs // Scrape // 2/204 https://opencode.ai/docs/acp\nDocs // Scrape // 3/204 https://opencode.ai/docs/agents\nDocs // Scrape // 4/204 https://opencode.ai/docs/cli\nDocs // Scrape // 5/204 https://opencode.ai/docs/commands\nDocs // Scrape // 6/204 https://opencode.ai/docs/config\nDocs // Scrape // 7/204 https://opencode.ai/docs/custom-tools\nDocs // Scrape // 8/204 https://opencode.ai/docs/da/\nDocs // Scrape // 9/204 https://opencode.ai/docs/da/acp\nDocs // Scrape // 10/204 https://opencode.ai/docs/da/agents\nDocs // Scrape // 11/204 https://opencode.ai/docs/da/cli\nDocs // Scrape // 12/204 https://opencode.ai/docs/da/commands\nDocs // Scrape // 13/204 https://opencode.ai/docs/da/config\nDocs // Scrape // 14/204 https://opencode.ai/docs/da/custom-tools\nDocs // Scrape // 15/204 https://opencode.ai/docs/da/ecosystem\nDocs // Scrape // 16/204 https://opencode.ai/docs/da/enterprise\nDocs // Scrape // 17/204 https://opencode.ai/docs/da/formatters\nDocs // Scrape // 18/204 https://opencode.ai/docs/da/github\nDocs // Scrape // 19/204 https://opencode.ai/docs/da/gitlab\nDocs // Scrape // 20/204 https://opencode.ai/docs/da/ide\nDocs // Scrape // 21/204 https://opencode.ai/docs/da/keybinds\nDocs // Scrape // 22/204 https://opencode.ai/docs/da/lsp\nDocs // Scrape // 23/204 https://opencode.ai/docs/da/mcp-servers\nDocs // Scrape // 24/204 https://opencode.ai/docs/da/models\nDocs // Scrape // 25/204 https://opencode.ai/docs/da/modes\nDocs // Scrape // 26/204 https://opencode.ai/docs/da/network\nDocs // Scrape // 27/204 https://opencode.ai/docs/da/permissions\nDocs // Scrape // 28/204 https://opencode.ai/docs/da/plugins\nDocs // Scrape // 29/204 https://opencode.ai/docs/da/providers\nDocs // Scrape // 30/204 https://opencode.ai/docs/da/rules\nDocs // Scrape // 31/204 https://opencode.ai/docs/da/sdk\nDocs // Scrape // 32/204 https://opencode.ai/docs/da/server\nDocs // Scrape // 33/204 https://opencode.ai/docs/da/share\nDocs // Scrape // 34/204 https://opencode.ai/docs/da/skills\nDocs // Scrape // 35/204 https://opencode.ai/docs/da/themes\nDocs // Scrape // 36/204 https://opencode.ai/docs/da/tools\nDocs // Scrape // 37/204 https://opencode.ai/docs/da/troubleshooting\nDocs // Scrape // 38/204 https://opencode.ai/docs/da/tui\nDocs // Scrape // 39/204 https://opencode.ai/docs/da/web\nDocs // Scrape // 40/204 https://opencode.ai/docs/da/windows-wsl\nDocs // Scrape // 41/204 https://opencode.ai/docs/da/zen\nDocs // Scrape // 42/204 https://opencode.ai/docs/ecosystem\nDocs // Scrape // 43/204 https://opencode.ai/docs/enterprise\nDocs // Scrape // 44/204 https://opencode.ai/docs/formatters\nDocs // Scrape // 45/204 https://opencode.ai/docs/github\nDocs // Scrape // 46/204 https://opencode.ai/docs/gitlab\nDocs // Scrape // 47/204 https://opencode.ai/docs/ide\nDocs // Scrape // 48/204 https://opencode.ai/docs/keybinds\nDocs // Scrape // 49/204 https://opencode.ai/docs/lsp\nDocs // Scrape // 50/204 https://opencode.ai/docs/mcp-servers\nDocs // Scrape // 51/204 https://opencode.ai/docs/models\nDocs // Scrape // 52/204 https://opencode.ai/docs/modes\nDocs // Scrape // 53/204 https://opencode.ai/docs/nb/\nDocs // Scrape // 54/204 https://opencode.ai/docs/nb/acp\nDocs // Scrape // 55/204 https://opencode.ai/docs/nb/agents\nDocs // Scrape // 56/204 https://opencode.ai/docs/nb/cli\nDocs // Scrape // 57/204 https://opencode.ai/docs/nb/commands\nDocs // Scrape // 58/204 https://opencode.ai/docs/nb/config\nDocs // Scrape // 59/204 https://opencode.ai/docs/nb/custom-tools\nDocs // Scrape // 60/204 https://opencode.ai/docs/nb/ecosystem\nDocs // Scrape // 61/204 https://opencode.ai/docs/nb/enterprise\nDocs // Scrape // 62/204 https://opencode.ai/docs/nb/formatters\nDocs // Scrape // 63/204 https://opencode.ai/docs/nb/github\nDocs // Scrape // 64/204 https://opencode.ai/docs/nb/gitlab\nDocs // Scrape // 65/204 https://opencode.ai/docs/nb/ide\nDocs // Scrape // 66/204 https://opencode.ai/docs/nb/keybinds\nDocs // Scrape // 67/204 https://opencode.ai/docs/nb/lsp\nDocs // Scrape // 68/204 https://opencode.ai/docs/nb/mcp-servers\nDocs // Scrape // 69/204 https://opencode.ai/docs/nb/models\nDocs // Scrape // 70/204 https://opencode.ai/docs/nb/modes\nDocs // Scrape // 71/204 https://opencode.ai/docs/nb/network\nDocs // Scrape // 72/204 https://opencode.ai/docs/nb/permissions\nDocs // Scrape // 73/204 https://opencode.ai/docs/nb/plugins\nDocs // Scrape // 74/204 https://opencode.ai/docs/nb/providers\nDocs // Scrape // 75/204 https://opencode.ai/docs/nb/rules\nDocs // Scrape // 76/204 https://opencode.ai/docs/nb/sdk\nDocs // Scrape // 77/204 https://opencode.ai/docs/nb/server\nDocs // Scrape // 78/204 https://opencode.ai/docs/nb/share\nDocs // Scrape // 79/204 https://opencode.ai/docs/nb/skills\nDocs // Scrape // 80/204 https://opencode.ai/docs/nb/themes\nDocs // Scrape // 81/204 https://opencode.ai/docs/nb/tools\nDocs // Scrape // 82/204 https://opencode.ai/docs/nb/troubleshooting\nDocs // Scrape // 83/204 https://opencode.ai/docs/nb/tui\nDocs // Scrape // 84/204 https://opencode.ai/docs/nb/web\nDocs // Scrape // 85/204 https://opencode.ai/docs/nb/windows-wsl\nDocs // Scrape // 86/204 https://opencode.ai/docs/nb/zen\nDocs // Scrape // 87/204 https://opencode.ai/docs/network\nDocs // Scrape // 88/204 https://opencode.ai/docs/permissions\nDocs // Scrape // 89/204 https://opencode.ai/docs/pl/\nDocs // Scrape // 90/204 https://opencode.ai/docs/pl/acp\nDocs // Scrape // 91/204 https://opencode.ai/docs/pl/agents\nDocs // Scrape // 92/204 https://opencode.ai/docs/pl/cli\nDocs // Scrape // 93/204 https://opencode.ai/docs/pl/commands\nDocs // Scrape // 94/204 https://opencode.ai/docs/pl/config\nDocs // Scrape // 95/204 https://opencode.ai/docs/pl/custom-tools\nDocs // Scrape // 96/204 https://opencode.ai/docs/pl/ecosystem\nDocs // Scrape // 97/204 https://opencode.ai/docs/pl/enterprise\nDocs // Scrape // 98/204 https://opencode.ai/docs/pl/formatters\nDocs // Scrape // 99/204 https://opencode.ai/docs/pl/github\nDocs // Scrape // 100/204 https://opencode.ai/docs/pl/gitlab\nDocs // Scrape // 101/204 https://opencode.ai/docs/pl/ide\nDocs // Scrape // 102/204 https://opencode.ai/docs/pl/keybinds\nDocs // Scrape // 103/204 https://opencode.ai/docs/pl/lsp\nDocs // Scrape // 104/204 https://opencode.ai/docs/pl/mcp-servers\nDocs // Scrape // 105/204 https://opencode.ai/docs/pl/models\nDocs // Scrape // 106/204 https://opencode.ai/docs/pl/modes\nDocs // Scrape // 107/204 https://opencode.ai/docs/pl/network\nDocs // Scrape // 108/204 https://opencode.ai/docs/pl/permissions\nDocs // Scrape // 109/204 https://opencode.ai/docs/pl/plugins\nDocs // Scrape // 110/204 https://opencode.ai/docs/pl/providers\nDocs // Scrape // 111/204 https://opencode.ai/docs/pl/rules\nDocs // Scrape // 112/204 https://opencode.ai/docs/pl/sdk\nDocs // Scrape // 113/204 https://opencode.ai/docs/pl/server\nDocs // Scrape // 114/204 https://opencode.ai/docs/pl/share\nDocs // Scrape // 115/204 https://opencode.ai/docs/pl/skills\nDocs // Scrape // 116/204 https://opencode.ai/docs/pl/themes\nDocs // Scrape // 117/204 https://opencode.ai/docs/pl/tools\nDocs // Scrape // 118/204 https://opencode.ai/docs/pl/troubleshooting\nDocs // Scrape // 119/204 https://opencode.ai/docs/pl/tui\nDocs // Scrape // 120/204 https://opencode.ai/docs/pl/web\nDocs // Scrape // 121/204 https://opencode.ai/docs/pl/windows-wsl\nDocs // Scrape // 122/204 https://opencode.ai/docs/pl/zen\nDocs // Scrape // 123/204 https://opencode.ai/docs/plugins\nDocs // Scrape // 124/204 https://opencode.ai/docs/providers\nDocs // Scrape // 125/204 https://opencode.ai/docs/pt-br/\nDocs // Scrape // 126/204 https://opencode.ai/docs/pt-br/acp\nDocs // Scrape // 127/204 https://opencode.ai/docs/pt-br/agents\nDocs // Scrape // 128/204 https://opencode.ai/docs/pt-br/cli\nDocs // Scrape // 129/204 https://opencode.ai/docs/pt-br/commands\nDocs // Scrape // 130/204 https://opencode.ai/docs/pt-br/config\nDocs // Scrape // 131/204 https://opencode.ai/docs/pt-br/custom-tools\nDocs // Scrape // 132/204 https://opencode.ai/docs/pt-br/ecosystem\nDocs // Scrape // 133/204 https://opencode.ai/docs/pt-br/enterprise\nDocs // Scrape // 134/204 https://opencode.ai/docs/pt-br/formatters\nDocs // Scrape // 135/204 https://opencode.ai/docs/pt-br/github\nDocs // Scrape // 136/204 https://opencode.ai/docs/pt-br/gitlab\nDocs // Scrape // 137/204 https://opencode.ai/docs/pt-br/ide\nDocs // Scrape // 138/204 https://opencode.ai/docs/pt-br/keybinds\nDocs // Scrape // 139/204 https://opencode.ai/docs/pt-br/lsp\nDocs // Scrape // 140/204 https://opencode.ai/docs/pt-br/mcp-servers\nDocs // Scrape // 141/204 https://opencode.ai/docs/pt-br/models\nDocs // Scrape // 142/204 https://opencode.ai/docs/pt-br/modes\nDocs // Scrape // 143/204 https://opencode.ai/docs/pt-br/network\nDocs // Scrape // 144/204 https://opencode.ai/docs/pt-br/permissions\nDocs // Scrape // 145/204 https://opencode.ai/docs/pt-br/plugins\nDocs // Scrape // 146/204 https://opencode.ai/docs/pt-br/providers\nDocs // Scrape // 147/204 https://opencode.ai/docs/pt-br/rules\nDocs // Scrape // 148/204 https://opencode.ai/docs/pt-br/sdk\nDocs // Scrape // 149/204 https://opencode.ai/docs/pt-br/server\nDocs // Scrape // 150/204 https://opencode.ai/docs/pt-br/share\nDocs // Scrape // 151/204 https://opencode.ai/docs/pt-br/skills\nDocs // Scrape // 152/204 https://opencode.ai/docs/pt-br/themes\nDocs // Scrape // 153/204 https://opencode.ai/docs/pt-br/tools\nDocs // Scrape // 154/204 https://opencode.ai/docs/pt-br/troubleshooting\nDocs // Scrape // 155/204 https://opencode.ai/docs/pt-br/tui\nDocs // Scrape // 156/204 https://opencode.ai/docs/pt-br/web\nDocs // Scrape // 157/204 https://opencode.ai/docs/pt-br/windows-wsl\nDocs // Scrape // 158/204 https://opencode.ai/docs/pt-br/zen\nDocs // Scrape // 159/204 https://opencode.ai/docs/rules\nDocs // Scrape // 160/204 https://opencode.ai/docs/sdk\nDocs // Scrape // 161/204 https://opencode.ai/docs/server\nDocs // Scrape // 162/204 https://opencode.ai/docs/share\nDocs // Scrape // 163/204 https://opencode.ai/docs/skills\nDocs // Scrape // 164/204 https://opencode.ai/docs/th/\nDocs // Scrape // 165/204 https://opencode.ai/docs/th/acp\nDocs // Scrape // 166/204 https://opencode.ai/docs/th/agents\nDocs // Scrape // 167/204 https://opencode.ai/docs/th/cli\nDocs // Scrape // 168/204 https://opencode.ai/docs/th/commands\nDocs // Scrape // 169/204 https://opencode.ai/docs/th/config\nDocs // Scrape // 170/204 https://opencode.ai/docs/th/custom-tools\nDocs // Scrape // 171/204 https://opencode.ai/docs/th/ecosystem\nDocs // Scrape // 172/204 https://opencode.ai/docs/th/enterprise\nDocs // Scrape // 173/204 https://opencode.ai/docs/th/formatters\nDocs // Scrape // 174/204 https://opencode.ai/docs/th/github\nDocs // Scrape // 175/204 https://opencode.ai/docs/th/gitlab\nDocs // Scrape // 176/204 https://opencode.ai/docs/th/ide\nDocs // Scrape // 177/204 https://opencode.ai/docs/th/keybinds\nDocs // Scrape // 178/204 https://opencode.ai/docs/th/lsp\nDocs // Scrape // 179/204 https://opencode.ai/docs/th/mcp-servers\nDocs // Scrape // 180/204 https://opencode.ai/docs/th/models\nDocs // Scrape // 181/204 https://opencode.ai/docs/th/modes\nDocs // Scrape // 182/204 https://opencode.ai/docs/th/network\nDocs // Scrape // 183/204 https://opencode.ai/docs/th/permissions\nDocs // Scrape // 184/204 https://opencode.ai/docs/th/plugins\nDocs // Scrape // 185/204 https://opencode.ai/docs/th/providers\nDocs // Scrape // 186/204 https://opencode.ai/docs/th/rules\nDocs // Scrape // 187/204 https://opencode.ai/docs/th/sdk\nDocs // Scrape // 188/204 https://opencode.ai/docs/th/server\nDocs // Scrape // 189/204 https://opencode.ai/docs/th/share\nDocs // Scrape // 190/204 https://opencode.ai/docs/th/skills\nDocs // Scrape // 191/204 https://opencode.ai/docs/th/themes\nDocs // Scrape // 192/204 https://opencode.ai/docs/th/tools\nDocs // Scrape // 193/204 https://opencode.ai/docs/th/troubleshooting\nDocs // Scrape // 194/204 https://opencode.ai/docs/th/tui\nDocs // Scrape // 195/204 https://opencode.ai/docs/th/web\nDocs // Scrape // 196/204 https://opencode.ai/docs/th/windows-wsl\nDocs // Scrape // 197/204 https://opencode.ai/docs/th/zen\nDocs // Scrape // 198/204 https://opencode.ai/docs/themes\nDocs // Scrape // 199/204 https://opencode.ai/docs/tools\nDocs // Scrape // 200/204 https://opencode.ai/docs/troubleshooting\nDocs // Scrape // 201/204 https://opencode.ai/docs/tui\nDocs // Scrape // 202/204 https://opencode.ai/docs/web\nDocs // Scrape // 203/204 https://opencode.ai/docs/windows-wsl\nDocs // Scrape // 204/204 https://opencode.ai/docs/zen\nDocs // Scrape // Wrote split external docs (source=opencode,lang=en,pages=204,ok=204,failed=0,blocked=none,dir=/Users/alex/repos/vfp/dark-factory/docs/external/opencode)\n",
            "title": "Run OpenCode scraper with English default",
            "metadata": {
              "output": "Docs // Scrape // 1/204 https://opencode.ai/docs/\nDocs // Scrape // 2/204 https://opencode.ai/docs/acp\nDocs // Scrape // 3/204 https://opencode.ai/docs/agents\nDocs // Scrape // 4/204 https://opencode.ai/docs/cli\nDocs // Scrape // 5/204 https://opencode.ai/docs/commands\nDocs // Scrape // 6/204 https://opencode.ai/docs/config\nDocs // Scrape // 7/204 https://opencode.ai/docs/custom-tools\nDocs // Scrape // 8/204 https://opencode.ai/docs/da/\nDocs // Scrape // 9/204 https://opencode.ai/docs/da/acp\nDocs // Scrape // 10/204 https://opencode.ai/docs/da/agents\nDocs // Scrape // 11/204 https://opencode.ai/docs/da/cli\nDocs // Scrape // 12/204 https://opencode.ai/docs/da/commands\nDocs // Scrape // 13/204 https://opencode.ai/docs/da/config\nDocs // Scrape // 14/204 https://opencode.ai/docs/da/custom-tools\nDocs // Scrape // 15/204 https://opencode.ai/docs/da/ecosystem\nDocs // Scrape // 16/204 https://opencode.ai/docs/da/enterprise\nDocs // Scrape // 17/204 https://opencode.ai/docs/da/formatters\nDocs // Scrape // 18/204 https://opencode.ai/docs/da/github\nDocs // Scrape // 19/204 https://opencode.ai/docs/da/gitlab\nDocs // Scrape // 20/204 https://opencode.ai/docs/da/ide\nDocs // Scrape // 21/204 https://opencode.ai/docs/da/keybinds\nDocs // Scrape // 22/204 https://opencode.ai/docs/da/lsp\nDocs // Scrape // 23/204 https://opencode.ai/docs/da/mcp-servers\nDocs // Scrape // 24/204 https://opencode.ai/docs/da/models\nDocs // Scrape // 25/204 https://opencode.ai/docs/da/modes\nDocs // Scrape // 26/204 https://opencode.ai/docs/da/network\nDocs // Scrape // 27/204 https://opencode.ai/docs/da/permissions\nDocs // Scrape // 28/204 https://opencode.ai/docs/da/plugins\nDocs // Scrape // 29/204 https://opencode.ai/docs/da/providers\nDocs // Scrape // 30/204 https://opencode.ai/docs/da/rules\nDocs // Scrape // 31/204 https://opencode.ai/docs/da/sdk\nDocs // Scrape // 32/204 https://opencode.ai/docs/da/server\nDocs // Scrape // 33/204 https://opencode.ai/docs/da/share\nDocs // Scrape // 34/204 https://opencode.ai/docs/da/skills\nDocs // Scrape // 35/204 https://opencode.ai/docs/da/themes\nDocs // Scrape // 36/204 https://opencode.ai/docs/da/tools\nDocs // Scrape // 37/204 https://opencode.ai/docs/da/troubleshooting\nDocs // Scrape // 38/204 https://opencode.ai/docs/da/tui\nDocs // Scrape // 39/204 https://opencode.ai/docs/da/web\nDocs // Scrape // 40/204 https://opencode.ai/docs/da/windows-wsl\nDocs // Scrape // 41/204 https://opencode.ai/docs/da/zen\nDocs // Scrape // 42/204 https://opencode.ai/docs/ecosystem\nDocs // Scrape // 43/204 https://opencode.ai/docs/enterprise\nDocs // Scrape // 44/204 https://opencode.ai/docs/formatters\nDocs // Scrape // 45/204 https://opencode.ai/docs/github\nDocs // Scrape // 46/204 https://opencode.ai/docs/gitlab\nDocs // Scrape // 47/204 https://opencode.ai/docs/ide\nDocs // Scrape // 48/204 https://opencode.ai/docs/keybinds\nDocs // Scrape // 49/204 https://opencode.ai/docs/lsp\nDocs // Scrape // 50/204 https://opencode.ai/docs/mcp-servers\nDocs // Scrape // 51/204 https://opencode.ai/docs/models\nDocs // Scrape // 52/204 https://opencode.ai/docs/modes\nDocs // Scrape // 53/204 https://opencode.ai/docs/nb/\nDocs // Scrape // 54/204 https://opencode.ai/docs/nb/acp\nDocs // Scrape // 55/204 https://opencode.ai/docs/nb/agents\nDocs // Scrape // 56/204 https://opencode.ai/docs/nb/cli\nDocs // Scrape // 57/204 https://opencode.ai/docs/nb/commands\nDocs // Scrape // 58/204 https://opencode.ai/docs/nb/config\nDocs // Scrape // 59/204 https://opencode.ai/docs/nb/custom-tools\nDocs // Scrape // 60/204 https://opencode.ai/docs/nb/ecosystem\nDocs // Scrape // 61/204 https://opencode.ai/docs/nb/enterprise\nDocs // Scrape // 62/204 https://opencode.ai/docs/nb/formatters\nDocs // Scrape // 63/204 https://opencode.ai/docs/nb/github\nDocs // Scrape // 64/204 https://opencode.ai/docs/nb/gitlab\nDocs // Scrape // 65/204 https://opencode.ai/docs/nb/ide\nDocs // Scrape // 66/204 https://opencode.ai/docs/nb/keybinds\nDocs // Scrape // 67/204 https://opencode.ai/docs/nb/lsp\nDocs // Scrape // 68/204 https://opencode.ai/docs/nb/mcp-servers\nDocs // Scrape // 69/204 https://opencode.ai/docs/nb/models\nDocs // Scrape // 70/204 https://opencode.ai/docs/nb/modes\nDocs // Scrape // 71/204 https://opencode.ai/docs/nb/network\nDocs // Scrape // 72/204 https://opencode.ai/docs/nb/permissions\nDocs // Scrape // 73/204 https://opencode.ai/docs/nb/plugins\nDocs // Scrape // 74/204 https://opencode.ai/docs/nb/providers\nDocs // Scrape // 75/204 https://opencode.ai/docs/nb/rules\nDocs // Scrape // 76/204 https://opencode.ai/docs/nb/sdk\nDocs // Scrape // 77/204 https://opencode.ai/docs/nb/server\nDocs // Scrape // 78/204 https://opencode.ai/docs/nb/share\nDocs // Scrape // 79/204 https://opencode.ai/docs/nb/skills\nDocs // Scrape // 80/204 https://opencode.ai/docs/nb/themes\nDocs // Scrape // 81/204 https://opencode.ai/docs/nb/tools\nDocs // Scrape // 82/204 https://opencode.ai/docs/nb/troubleshooting\nDocs // Scrape // 83/204 https://opencode.ai/docs/nb/tui\nDocs // Scrape // 84/204 https://opencode.ai/docs/nb/web\nDocs // Scrape // 85/204 https://opencode.ai/docs/nb/windows-wsl\nDocs // Scrape // 86/204 https://opencode.ai/docs/nb/zen\nDocs // Scrape // 87/204 https://opencode.ai/docs/network\nDocs // Scrape // 88/204 https://opencode.ai/docs/permissions\nDocs // Scrape // 89/204 https://opencode.ai/docs/pl/\nDocs // Scrape // 90/204 https://opencode.ai/docs/pl/acp\nDocs // Scrape // 91/204 https://opencode.ai/docs/pl/agents\nDocs // Scrape // 92/204 https://opencode.ai/docs/pl/cli\nDocs // Scrape // 93/204 https://opencode.ai/docs/pl/commands\nDocs // Scrape // 94/204 https://opencode.ai/docs/pl/config\nDocs // Scrape // 95/204 https://opencode.ai/docs/pl/custom-tools\nDocs // Scrape // 96/204 https://opencode.ai/docs/pl/ecosystem\nDocs // Scrape // 97/204 https://opencode.ai/docs/pl/enterprise\nDocs // Scrape // 98/204 https://opencode.ai/docs/pl/formatters\nDocs // Scrape // 99/204 https://opencode.ai/docs/pl/github\nDocs // Scrape // 100/204 https://opencode.ai/docs/pl/gitlab\nDocs // Scrape // 101/204 https://opencode.ai/docs/pl/ide\nDocs // Scrape // 102/204 https://opencode.ai/docs/pl/keybinds\nDocs // Scrape // 103/204 https://opencode.ai/docs/pl/lsp\nDocs // Scrape // 104/204 https://opencode.ai/docs/pl/mcp-servers\nDocs // Scrape // 105/204 https://opencode.ai/docs/pl/models\nDocs // Scrape // 106/204 https://opencode.ai/docs/pl/modes\nDocs // Scrape // 107/204 https://opencode.ai/docs/pl/network\nDocs // Scrape // 108/204 https://opencode.ai/docs/pl/permissions\nDocs // Scrape // 109/204 https://opencode.ai/docs/pl/plugins\nDocs // Scrape // 110/204 https://opencode.ai/docs/pl/providers\nDocs // Scrape // 111/204 https://opencode.ai/docs/pl/rules\nDocs // Scrape // 112/204 https://opencode.ai/docs/pl/sdk\nDocs // Scrape // 113/204 https://opencode.ai/docs/pl/server\nDocs // Scrape // 114/204 https://opencode.ai/docs/pl/share\nDocs // Scrape // 115/204 https://opencode.ai/docs/pl/skills\nDocs // Scrape // 116/204 https://opencode.ai/docs/pl/themes\nDocs // Scrape // 117/204 https://opencode.ai/docs/pl/tools\nDocs // Scrape // 118/204 https://opencode.ai/docs/pl/troubleshooting\nDocs // Scrape // 119/204 https://opencode.ai/docs/pl/tui\nDocs // Scrape // 120/204 https://opencode.ai/docs/pl/web\nDocs // Scrape // 121/204 https://opencode.ai/docs/pl/windows-wsl\nDocs // Scrape // 122/204 https://opencode.ai/docs/pl/zen\nDocs // Scrape // 123/204 https://opencode.ai/docs/plugins\nDocs // Scrape // 124/204 https://opencode.ai/docs/providers\nDocs // Scrape // 125/204 https://opencode.ai/docs/pt-br/\nDocs // Scrape // 126/204 https://opencode.ai/docs/pt-br/acp\nDocs // Scrape // 127/204 https://opencode.ai/docs/pt-br/agents\nDocs // Scrape // 128/204 https://opencode.ai/docs/pt-br/cli\nDocs // Scrape // 129/204 https://opencode.ai/docs/pt-br/commands\nDocs // Scrape // 130/204 https://opencode.ai/docs/pt-br/config\nDocs // Scrape // 131/204 https://opencode.ai/docs/pt-br/custom-tools\nDocs // Scrape // 132/204 https://opencode.ai/docs/pt-br/ecosystem\nDocs // Scrape // 133/204 https://opencode.ai/docs/pt-br/enterprise\nDocs // Scrape // 134/204 https://opencode.ai/docs/pt-br/formatters\nDocs // Scrape // 135/204 https://opencode.ai/docs/pt-br/github\nDocs // Scrape // 136/204 https://opencode.ai/docs/pt-br/gitlab\nDocs // Scrape // 137/204 https://opencode.ai/docs/pt-br/ide\nDocs // Scrape // 138/204 https://opencode.ai/docs/pt-br/keybinds\nDocs // Scrape // 139/204 https://opencode.ai/docs/pt-br/lsp\nDocs // Scrape // 140/204 https://opencode.ai/docs/pt-br/mcp-servers\nDocs // Scrape // 141/204 https://opencode.ai/docs/pt-br/models\nDocs // Scrape // 142/204 https://opencode.ai/docs/pt-br/modes\nDocs // Scrape // 143/204 https://opencode.ai/docs/pt-br/network\nDocs // Scrape // 144/204 https://opencode.ai/docs/pt-br/permissions\nDocs // Scrape // 145/204 https://opencode.ai/docs/pt-br/plugins\nDocs // Scrape // 146/204 https://opencode.ai/docs/pt-br/providers\nDocs // Scrape // 147/204 https://opencode.ai/docs/pt-br/rules\nDocs // Scrape // 148/204 https://opencode.ai/docs/pt-br/sdk\nDocs // Scrape // 149/204 https://opencode.ai/docs/pt-br/server\nDocs // Scrape // 150/204 https://opencode.ai/docs/pt-br/share\nDocs // Scrape // 151/204 https://opencode.ai/docs/pt-br/skills\nDocs // Scrape // 152/204 https://opencode.ai/docs/pt-br/themes\nDocs // Scrape // 153/204 https://opencode.ai/docs/pt-br/tools\nDocs // Scrape // 154/204 https://opencode.ai/docs/pt-br/troubleshooting\nDocs // Scrape // 155/204 https://opencode.ai/docs/pt-br/tui\nDocs // Scrape // 156/204 https://opencode.ai/docs/pt-br/web\nDocs // Scrape // 157/204 https://opencode.ai/docs/pt-br/windows-wsl\nDocs // Scrape // 158/204 https://opencode.ai/docs/pt-br/zen\nDocs // Scrape // 159/204 https://opencode.ai/docs/rules\nDocs // Scrape // 160/204 https://opencode.ai/docs/sdk\nDocs // Scrape // 161/204 https://opencode.ai/docs/server\nDocs // Scrape // 162/204 https://opencode.ai/docs/share\nDocs // Scrape // 163/204 https://opencode.ai/docs/skills\nDocs // Scrape // 164/204 https://opencode.ai/docs/th/\nDocs // Scrape // 165/204 https://opencode.ai/docs/th/acp\nDocs // Scrape // 166/204 https://opencode.ai/docs/th/agents\nDocs // Scrape // 167/204 https://opencode.ai/docs/th/cli\nDocs // Scrape // 168/204 https://opencode.ai/docs/th/commands\nDocs // Scrape // 169/204 https://opencode.ai/docs/th/config\nDocs // Scrape // 170/204 https://opencode.ai/docs/th/custom-tools\nDocs // Scrape // 171/204 https://opencode.ai/docs/th/ecosystem\nDocs // Scrape // 172/204 https://opencode.ai/docs/th/enterprise\nDocs // Scrape // 173/204 https://opencode.ai/docs/th/formatters\nDocs // Scrape // 174/204 https://opencode.ai/docs/th/github\nDocs // Scrape // 175/204 https://opencode.ai/docs/th/gitlab\nDocs // Scrape // 176/204 https://opencode.ai/docs/th/ide\nDocs // Scrape // 177/204 https://opencode.ai/docs/th/keybinds\nDocs // Scrape // 178/204 https://opencode.ai/docs/th/lsp\nDocs // Scrape // 179/204 https://opencode.ai/docs/th/mcp-servers\nDocs // Scrape // 180/204 https://opencode.ai/docs/th/models\nDocs // Scrape // 181/204 https://opencode.ai/docs/th/modes\nDocs // Scrape // 182/204 https://opencode.ai/docs/th/network\nDocs // Scrape // 183/204 https://opencode.ai/docs/th/permissions\nDocs // Scrape // 184/204 https://opencode.ai/docs/th/plugins\nDocs // Scrape // 185/204 https://opencode.ai/docs/th/providers\nDocs // Scrape // 186/204 https://opencode.ai/docs/th/rules\nDocs // Scrape // 187/204 https://opencode.ai/docs/th/sdk\nDocs // Scrape // 188/204 https://opencode.ai/docs/th/server\nDocs // Scrape // 189/204 https://opencode.ai/docs/th/share\nDocs // Scrape // 190/204 https://opencode.ai/docs/th/skills\nDocs // Scrape // 191/204 https://opencode.ai/docs/th/themes\nDocs // Scrape // 192/204 https://opencode.ai/docs/th/tools\nDocs // Scrape // 193/204 https://opencode.ai/docs/th/troubleshooting\nDocs // Scrape // 194/204 https://opencode.ai/docs/th/tui\nDocs // Scrape // 195/204 https://opencode.ai/docs/th/web\nDocs // Scrape // 196/204 https://opencode.ai/docs/th/windows-wsl\nDocs // Scrape // 197/204 https://opencode.ai/docs/th/zen\nDocs // Scrape // 198/204 https://opencode.ai/docs/themes\nDocs // Scrape // 199/204 https://opencode.ai/docs/tools\nDocs // Scrape // 200/204 https://opencode.ai/docs/troubleshooting\nDocs // Scrape // 201/204 https://opencode.ai/docs/tui\nDocs // Scrape // 202/204 https://opencode.ai/docs/web\nDocs // Scrape // 203/204 https://opencode.ai/docs/windows-wsl\nDocs // Scrape // 204/204 https://opencode.ai/docs/zen\nDocs // Scrape // Wrote split external docs (source=opencode,lang=en,pages=204,ok=204,failed=0,blocked=none,dir=/Users/alex/repos/vfp/dark-factory/docs/external/opencode)\n",
              "exit": 0,
              "description": "Run OpenCode scraper with English default",
              "truncated": false
            },
            "time": {
              "start": 1771215190325,
              "end": 1771215213680
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_08615dbbf8071d27016992995620d08196977f403ebf47f89d"
            }
          },
          "id": "prt_c64a6f8b0001AMZ7QvEdy4rBSb",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6e7bf0015rP8HXqEnRpRw3"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "d412c2edd6e6e75c5ce57674f969da59cb139fcc",
          "cost": 0,
          "tokens": {
            "total": 33691,
            "input": 18761,
            "output": 82,
            "reasoning": 43,
            "cache": {
              "read": 14848,
              "write": 0
            }
          },
          "id": "prt_c64a75471001f0T3rGAgOXUUP3",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6e7bf0015rP8HXqEnRpRw3"
        },
        {
          "type": "patch",
          "hash": "f9e0e662167c83cab6b250dabad052fa42cfbd5d",
          "files": [
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/index.ext.md"
          ],
          "id": "prt_c64a75529001IfSrVqsJ69UicB",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a6e7bf0015rP8HXqEnRpRw3"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215213871,
          "completed": 1771215224733
        },
        "parentID": "msg_c64a667e1001oSCNckxNgJGDO0",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 38192,
          "input": 4155,
          "output": 501,
          "reasoning": 237,
          "cache": {
            "read": 33536,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a7552f001z1wGyKY217fa6O",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "d412c2edd6e6e75c5ce57674f969da59cb139fcc",
          "id": "prt_c64a75e46001WWAYghX2MoijiB",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7552f001z1wGyKY217fa6O"
        },
        {
          "type": "reasoning",
          "text": "**Refining locale filter logic**",
          "metadata": {
            "openai": {
              "itemId": "rs_0ed51d6b99c3e307016992997095588194859f4573229a4424",
              "reasoningEncryptedContent": "gAAAAABpkpl2-br0HZPNqxV_9rsmwlAxsiuifB-MdAFlTUAohXCYedj1qclMyh7KY0b7jJYN5UosyZU7l7So7cn5zRD1KYedg3m84odQ2UkskPEVEaVFz1eSR_S1HUSflbyjh1g-uq8lw_WDf2BQOaGr0opw_Wak1RGllb5MPM21iwT0uAEzJKvxzsTPkhNAwyG5MnpathZelb1Yh9Y8cZTFGSMoOankbA6TE_qLZU-D52kjYZu2ZtKowK2_ZtyDYaSJNu45bxkCNH-dMItQf7kt6SauveB5Vs_2zOA8I-fMM-O9dULPVWnHV7klhXWfxZ8C-eX3BKF69EMEp3uk7kvJJxrx1hTZM-Y-yTeAqo9BrUBYE5D0KrCBXrucnaGmQHEkvvoCDS-n9Ja-Jx7C2iz6U7pTVcNdKMbR86zLiuq6ZBuHctRoVmuC7qER7PmI9tvBWj31wLfXlPd7zm1ysxkMoumPgyy9nafT5VD3-qakZjQu1J71wyoAqIytVCAv-nhrzB9V5jayTZ3FiyU4rhpFKzbRzXwfQL_sZnd4vd-MliTNszUDOytb6IGEpQwL_XvW2eG30iiWfFCXG1h58yNUd_DcC3q0QZIkWQQNjZzLrjPQxZECFqzSq96lhOBic3hKk3IBWGN0QVT8I3u_1uzdbNNLS_7bKDNLGGkU4bd4CHaQbdJ8EZX24X1WoKf4bk3elipmRd6mKubgedXmS6WP66TCORYZnBrwOLZnGzFULENz5LR3O0oB5iLLmB2TVidHz0Sf3HGajKzia7TucRLTJAB6qJHBLXUD51ntyqzti4V3FtLm7cw2AZsC2Y16OihvcSk9OspV3QANLere5vBnlOg_PxTEtRz255ITrFsOuH8k2TzHm_tGKYooZNDqQlihwW-PEZ7yMo1Hgwn8u2vqjokPvXG_1NGBKJEO2LGbwRZVaBGJ1Kx_iA0soc6vny1yFjIDeRTXZTZ_XjCOPS3axG2FHvSFF5I0Kr4ruCtDv5UHMWing3cfzPXXkw8Do1lHV8nwH6KGgBSVwr1UpvErG4bVa7waeeE9qbNopngujKV81dyq4OaKYsNWaXo2WTWITNQw53bf007CGqFQtuOgBbgMeUUCLSlxIzD25g8Wv4tGRxSmXi2fSXD8062swkrGmSezEjwT1oo0wJrsypske8LrqbYsa0v11RNsmC842dnpM3jnFjpUtqDtaO_itKiP5AgM5MmtioVTJDL79xsnuKo6I570lKXBSPm3Bko7SOmGOPmZxv0AzslapEZdA1NxJQXYryAoc6P9LB40Met8IpZLFBmDslUe8e4hoNC5DJSHtweJCO4aC3BoOL07WlMNLUnXJG-3jUOVgcglo1dsSfatmjPulgDUD4A0sLgfniiVWlm5R2rAhakzftHN0Tyt9JvUZZY67eP7_y15y3Gyea0zGJVL-dqgh9DubRtHAgGmWNXBUe7bNZuVBZ4jCIl_PrTBPq3zp98cACTcs0MD6-wznXHKRoocs0qQJtdN9-VZnbQcTQBw3Wg1uWeYlCL9fau9pkmIEI03jEShgJ_jhh1Smu_smvyKH_i8KT20KhviUWipXYJ6mQyqXuBv0Bid9sZUn25tcgmQMj0c9healh28F5cefAeZtXIGR4EaFoF0X_3PdGqzADu67EgoHi4d884RuBCDQkOUdSG1PtPaGwtPt12WnnGozVuemBqOGR0EOPZIltc5oimDrf25AjIh4NqqHdeZ8zDbxBCwX7p3m_fmHN2-Ud-rdTk_xCgKnaX7WqVZXBgea58aBcSgfnJMa1WnjuZN_-rkCY0lLFXfq4IIetgPHWRsuIZqb4UFlj6t-DbKBEzCWCxpYbtRx4BdQwenIpyHFsWkLLigxKMwbRBryu4zHP2cMTAh0cQ_QbIhFgPnGZ06dDvc6nSHa_VTs-gzuWavOU9YWQRLwyqQHp4bXveKRz4uwqJeRDy5ZhEkh6KY5akJQxxYe-5Scq23Ad5x-FVzvkylDqJftEKElCfi856WBw=="
            }
          },
          "time": {
            "start": 1771215216612,
            "end": 1771215222414
          },
          "id": "prt_c64a75fe40014UvhJLSdr7DHxr",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7552f001z1wGyKY217fa6O"
        },
        {
          "type": "tool",
          "callID": "call_8Pej7B6NvhC0dKb9IdKsN1ob",
          "tool": "apply_patch",
          "state": {
            "status": "completed",
            "input": {
              "patchText": "*** Begin Patch\n*** Update File: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n@@\n const DEFAULT_LANGUAGE = \"en\";\n-const KNOWN_NON_EN_DOC_PREFIXES = new Set([\n-  \"ar\",\n-  \"de\",\n-  \"es\",\n-  \"fr\",\n-  \"it\",\n-  \"ja\",\n-  \"ko\",\n-  \"pt\",\n-  \"ru\",\n-  \"tr\",\n-  \"vi\",\n-  \"zh\",\n-  \"zh-cn\",\n-  \"zh-tw\",\n-]);\n@@\n function isEnglishDocsUrl(url: string): boolean {\n@@\n   if (firstSegment === \"en\" || firstSegment === \"english\") {\n     return true;\n   }\n \n-  if (KNOWN_NON_EN_DOC_PREFIXES.has(firstSegment)) {\n+  if (/^[a-z]{2}(?:-[a-z]{2})?$/.test(firstSegment)) {\n     return false;\n   }\n*** End Patch"
            },
            "output": "Success. Updated the following files:\nM scripts/scrape_opencode_docs.sh.ts",
            "title": "Success. Updated the following files:\nM scripts/scrape_opencode_docs.sh.ts",
            "metadata": {
              "diff": "Index: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n+++ /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n@@ -25,24 +25,8 @@\n const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\n const CONCURRENCY = 4;\n const SUMMARY_MAX_CHARS = 240;\n const DEFAULT_LANGUAGE = \"en\";\n-const KNOWN_NON_EN_DOC_PREFIXES = new Set([\n-  \"ar\",\n-  \"de\",\n-  \"es\",\n-  \"fr\",\n-  \"it\",\n-  \"ja\",\n-  \"ko\",\n-  \"pt\",\n-  \"ru\",\n-  \"tr\",\n-  \"vi\",\n-  \"zh\",\n-  \"zh-cn\",\n-  \"zh-tw\",\n-]);\n \n function decodeEntities(value: string): string {\n   return value\n     .replaceAll(\"&amp;\", \"&\")\n@@ -402,9 +386,9 @@\n   if (firstSegment === \"en\" || firstSegment === \"english\") {\n     return true;\n   }\n \n-  if (KNOWN_NON_EN_DOC_PREFIXES.has(firstSegment)) {\n+  if (/^[a-z]{2}(?:-[a-z]{2})?$/.test(firstSegment)) {\n     return false;\n   }\n \n   return true;\n\n",
              "files": [
                {
                  "filePath": "/Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts",
                  "relativePath": "scripts/scrape_opencode_docs.sh.ts",
                  "type": "update",
                  "diff": "Index: /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n===================================================================\n--- /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n+++ /Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts\n@@ -25,24 +25,8 @@\n const DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\n const CONCURRENCY = 4;\n const SUMMARY_MAX_CHARS = 240;\n const DEFAULT_LANGUAGE = \"en\";\n-const KNOWN_NON_EN_DOC_PREFIXES = new Set([\n-  \"ar\",\n-  \"de\",\n-  \"es\",\n-  \"fr\",\n-  \"it\",\n-  \"ja\",\n-  \"ko\",\n-  \"pt\",\n-  \"ru\",\n-  \"tr\",\n-  \"vi\",\n-  \"zh\",\n-  \"zh-cn\",\n-  \"zh-tw\",\n-]);\n \n function decodeEntities(value: string): string {\n   return value\n     .replaceAll(\"&amp;\", \"&\")\n@@ -402,9 +386,9 @@\n   if (firstSegment === \"en\" || firstSegment === \"english\") {\n     return true;\n   }\n \n-  if (KNOWN_NON_EN_DOC_PREFIXES.has(firstSegment)) {\n+  if (/^[a-z]{2}(?:-[a-z]{2})?$/.test(firstSegment)) {\n     return false;\n   }\n \n   return true;\n",
                  "before": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};\n\nconst SOURCE_KEY = \"opencode\";\nconst DOCS_ROOT = \"https://opencode.ai/docs\";\nconst SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\nconst DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\nconst CONCURRENCY = 4;\nconst SUMMARY_MAX_CHARS = 240;\nconst DEFAULT_LANGUAGE = \"en\";\nconst KNOWN_NON_EN_DOC_PREFIXES = new Set([\n  \"ar\",\n  \"de\",\n  \"es\",\n  \"fr\",\n  \"it\",\n  \"ja\",\n  \"ko\",\n  \"pt\",\n  \"ru\",\n  \"tr\",\n  \"vi\",\n  \"zh\",\n  \"zh-cn\",\n  \"zh-tw\",\n]);\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replaceAll(\"&amp;\", \"&\")\n    .replaceAll(\"&quot;\", '\"')\n    .replaceAll(\"&apos;\", \"'\")\n    .replaceAll(\"&#x27;\", \"'\")\n    .replaceAll(\"&#39;\", \"'\")\n    .replaceAll(\"&nbsp;\", \" \")\n    .replaceAll(\"&lt;\", \"<\")\n    .replaceAll(\"&gt;\", \">\");\n}\n\nfunction stripJinaEnvelope(markdown: string): string {\n  return markdown\n    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n    .trim();\n}\n\nfunction stripTags(value: string): string {\n  return value.replace(/<[^>]+>/g, \"\");\n}\n\nfunction plainTextFromHtml(value: string): string {\n  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n}\n\nfunction extractMainHtml(html: string): string {\n  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n  if (articleMatch?.[1]) {\n    return articleMatch[1];\n  }\n\n  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n  if (mainMatch?.[1]) {\n    return mainMatch[1];\n  }\n\n  return html;\n}\n\nfunction htmlToMarkdown(html: string): string {\n  let content = extractMainHtml(html);\n\n  content = content\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n\n  content = content.replace(\n    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n    (_match, code) => {\n      const normalizedCode = decodeEntities(\n        stripTags(code)\n          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n          .replace(/\\n{3,}/g, \"\\n\\n\")\n          .trim(),\n      );\n\n      if (!normalizedCode) {\n        return \"\";\n      }\n\n      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n    },\n  );\n\n  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n    const normalizedCode = decodeEntities(stripTags(code)).trim();\n    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n  });\n\n  content = content.replace(\n    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n    (_match, href, label) => {\n      const text = plainTextFromHtml(label);\n      if (!text) {\n        return \"\";\n      }\n\n      return `[${text}](${decodeEntities(href)})`;\n    },\n  );\n\n  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n    const heading = plainTextFromHtml(inner);\n    if (!heading) {\n      return \"\";\n    }\n\n    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n  });\n\n  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n    const line = plainTextFromHtml(inner);\n    return line ? `- ${line}\\n` : \"\";\n  });\n\n  content = content\n    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n      const cell = plainTextFromHtml(inner);\n      return cell ? `${cell} ` : \"\";\n    });\n\n  content = decodeEntities(content)\n    .replace(/<[^>]+>/g, \"\")\n    .replace(/[ \\t]+\\n/g, \"\\n\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .trim();\n\n  return content;\n}\n\nfunction sanitizeSegment(value: string): string {\n  const clean = decodeURIComponent(value)\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return clean || \"page\";\n}\n\nfunction sourcePathFromUrl(url: string): string {\n  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n  return pathname;\n}\n\nfunction fileStemFromUrl(url: string): string {\n  const sourcePath = sourcePathFromUrl(url);\n\n  if (sourcePath === \"/docs\") {\n    return \"docs\";\n  }\n\n  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n  const segments = relative\n    .split(\"/\")\n    .filter(Boolean)\n    .map(sanitizeSegment);\n\n  if (segments.length === 0) {\n    return \"docs\";\n  }\n\n  return [\"docs\", ...segments].join(\"__\");\n}\n\nfunction extractSummary(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  let inCodeBlock = false;\n\n  for (const rawLine of lines) {\n    const line = rawLine.trim();\n\n    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n      inCodeBlock = !inCodeBlock;\n      continue;\n    }\n\n    if (inCodeBlock) {\n      continue;\n    }\n\n    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n      continue;\n    }\n\n    if (line.length <= 25) {\n      continue;\n    }\n\n    if (line.length > SUMMARY_MAX_CHARS) {\n      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n    }\n\n    return line;\n  }\n\n  return \"OpenCode documentation page snapshot.\";\n}\n\nfunction keywordsForPath(sourcePath: string): string {\n  const dynamic = sourcePath\n    .split(\"/\")\n    .filter(Boolean)\n    .slice(1)\n    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n    .filter(Boolean)\n    .join(\", \");\n\n  const base = \"opencode, docs, ai coding assistant, cli\";\n  return dynamic ? `${base}, ${dynamic}` : base;\n}\n\nfunction buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n  const pageSummary = result.ok\n    ? extractSummary(result.markdown ?? \"\")\n    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  const pageBody = result.ok\n    ? result.markdown?.trim() ?? \"\"\n    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  return [\n    \"----\",\n    \"## External Docs Snapshot // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Source page: ${result.sourcePath}`,\n    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n    `- Summary: ${pageSummary}`,\n    \"----\",\n    \"\",\n    `Source: ${result.url}`,\n    \"\",\n    pageBody,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Collection method: sitemap discovery + markdown conversion.\",\n    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nfunction buildIndexMarkdown(\n  artifacts: PageArtifact[],\n  capturedAt: string,\n  outputDirRelative: string,\n): string {\n  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n  const failureCount = artifacts.length - successCount;\n\n  const pageList = artifacts\n    .map((artifact) => {\n      const status = artifact.ok ? \"ok\" : \"failed\";\n      const mode = artifact.mode ?? \"unknown\";\n      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n    })\n    .join(\"\\n\");\n\n  return [\n    \"----\",\n    \"## External Docs Index // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Output directory: ${outputDirRelative}`,\n    `- Scope: ${artifacts.length} pages under /docs`,\n    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n    \"----\",\n    \"\",\n    \"## Pages\",\n    \"\",\n    pageList,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nasync function fetchText(url: string): Promise<string> {\n  const response = await fetch(url, {\n    headers: {\n      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Request failed (${response.status}) for ${url}`);\n  }\n\n  return await response.text();\n}\n\nfunction extractLocUrls(xml: string): string[] {\n  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n    decodeEntities(match[1]?.trim() ?? \"\"),\n  ).filter(Boolean);\n}\n\nasync function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n  const visited = new Set<string>();\n  const pending: string[] = [sitemapUrl];\n  const docsUrls = new Set<string>();\n\n  while (pending.length > 0) {\n    const current = pending.pop();\n    if (!current || visited.has(current)) {\n      continue;\n    }\n\n    visited.add(current);\n\n    let xml: string;\n    try {\n      xml = await fetchText(current);\n    } catch {\n      continue;\n    }\n\n    const locUrls = extractLocUrls(xml);\n    for (const locUrl of locUrls) {\n      if (locUrl.endsWith(\".xml\")) {\n        if (!visited.has(locUrl)) {\n          pending.push(locUrl);\n        }\n        continue;\n      }\n\n      if (!locUrl.startsWith(DOCS_ROOT)) {\n        continue;\n      }\n\n      if (locUrl.includes(\"#\")) {\n        continue;\n      }\n\n      docsUrls.add(locUrl);\n    }\n  }\n\n  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n}\n\nfunction isEnglishDocsUrl(url: string): boolean {\n  const pathname = new URL(url).pathname;\n  if (!pathname.startsWith(\"/docs\")) {\n    return false;\n  }\n\n  const relative = pathname.replace(/^\\/docs\\/?/, \"\");\n  if (!relative) {\n    return true;\n  }\n\n  const firstSegment = relative.split(\"/\")[0]?.toLowerCase() ?? \"\";\n  if (!firstSegment) {\n    return true;\n  }\n\n  if (firstSegment === \"en\" || firstSegment === \"english\") {\n    return true;\n  }\n\n  if (KNOWN_NON_EN_DOC_PREFIXES.has(firstSegment)) {\n    return false;\n  }\n\n  return true;\n}\n\nasync function mapConcurrent<T, R>(\n  values: T[],\n  limit: number,\n  map: (value: T, index: number) => Promise<R>,\n): Promise<R[]> {\n  const results = new Array<R>(values.length);\n  let index = 0;\n\n  async function worker(): Promise<void> {\n    while (true) {\n      const currentIndex = index;\n      index += 1;\n\n      if (currentIndex >= values.length) {\n        return;\n      }\n\n      results[currentIndex] = await map(values[currentIndex], currentIndex);\n    }\n  }\n\n  const workerCount = Math.min(limit, values.length);\n  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n  return results;\n}\n\nasync function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n\n  try {\n    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n\n    try {\n      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n      if (markdown) {\n        return {\n          url,\n          ok: true,\n          markdown,\n          mode: \"jina\",\n        };\n      }\n    } catch {\n      // Fall through to direct HTML scrape.\n    }\n\n    const html = await fetchText(url);\n    const markdown = htmlToMarkdown(html);\n\n    if (!markdown) {\n      return {\n        url,\n        ok: false,\n        error: \"No markdown content returned from HTML fallback\",\n      };\n    }\n\n    return {\n      url,\n      ok: true,\n      markdown,\n      mode: \"html\",\n    };\n  } catch (error) {\n    return {\n      url,\n      ok: false,\n      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n    };\n  }\n}\n\nfunction resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n  if (!outputArg) {\n    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n  }\n\n  const resolved = resolve(repoRoot, outputArg);\n  if (resolved.endsWith(\".md\")) {\n    return dirname(resolved);\n  }\n\n  return resolved;\n}\n\nfunction clearExistingExtFiles(outputDir: string): void {\n  if (!existsSync(outputDir)) {\n    return;\n  }\n\n  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n    if (!entry.isFile()) {\n      continue;\n    }\n\n    if (!entry.name.endsWith(\".ext.md\")) {\n      continue;\n    }\n\n    rmSync(resolve(outputDir, entry.name));\n  }\n}\n\nconst repoRoot = findRepoRoot(import.meta.dir);\nconst outputArg = Bun.argv[2];\nconst outputDir = resolveOutputDirectory(repoRoot, outputArg);\nconst outputDirRelative = outputDir.startsWith(repoRoot)\n  ? outputDir.slice(repoRoot.length + 1)\n  : outputDir;\n\nmkdirSync(outputDir, { recursive: true });\nclearExistingExtFiles(outputDir);\n\nconst requestedLanguage = (Bun.env.DOCS_LANGUAGE ?? DEFAULT_LANGUAGE).toLowerCase();\nconst discoveredUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\nconst docsUrls =\n  requestedLanguage === \"en\" || requestedLanguage === \"english\"\n    ? discoveredUrls.filter(isEnglishDocsUrl)\n    : discoveredUrls;\n\nif (docsUrls.length === 0) {\n  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n}\n\nconst scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n  scrapeDocsPage(url, index + 1, docsUrls.length),\n);\n\nconst usedNames = new Map<string, number>();\nconst artifacts: PageArtifact[] = scrapeResults.map((result) => {\n  const stem = fileStemFromUrl(result.url);\n  const seen = usedNames.get(stem) ?? 0;\n  usedNames.set(stem, seen + 1);\n\n  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n  const fileName = `${stem}${suffix}.ext.md`;\n\n  return {\n    ...result,\n    fileName,\n    sourcePath: sourcePathFromUrl(result.url),\n  };\n});\n\nconst capturedAt = new Date().toISOString();\n\nfor (const artifact of artifacts) {\n  const pagePath = resolve(outputDir, artifact.fileName);\n  const pageContent = buildPageMarkdown(artifact, capturedAt);\n  await Bun.write(pagePath, pageContent);\n}\n\nconst indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\nawait Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n\nconst successCount = artifacts.filter((artifact) => artifact.ok).length;\nconst failureCount = artifacts.length - successCount;\nconst blockedPages = artifacts\n  .filter((artifact) => !artifact.ok)\n  .map((artifact) => artifact.sourcePath)\n  .join(\",\");\n\nconsole.log(\n  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},lang=${requestedLanguage},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n);\n",
                  "after": "#!/usr/bin/env bun\n\nimport { existsSync, mkdirSync, readdirSync, rmSync } from \"node:fs\";\nimport { dirname, resolve } from \"node:path\";\nimport { findRepoRoot } from \"./helpers/run_root.sh.ts\";\n\ntype ScrapeMode = \"jina\" | \"html\";\n\ntype ScrapeResult = {\n  url: string;\n  ok: boolean;\n  markdown?: string;\n  error?: string;\n  mode?: ScrapeMode;\n};\n\ntype PageArtifact = ScrapeResult & {\n  fileName: string;\n  sourcePath: string;\n};\n\nconst SOURCE_KEY = \"opencode\";\nconst DOCS_ROOT = \"https://opencode.ai/docs\";\nconst SITEMAP_URL = \"https://opencode.ai/sitemap.xml\";\nconst DEFAULT_OUTPUT_DIR_RELATIVE = \"docs/external/opencode\";\nconst CONCURRENCY = 4;\nconst SUMMARY_MAX_CHARS = 240;\nconst DEFAULT_LANGUAGE = \"en\";\n\nfunction decodeEntities(value: string): string {\n  return value\n    .replaceAll(\"&amp;\", \"&\")\n    .replaceAll(\"&quot;\", '\"')\n    .replaceAll(\"&apos;\", \"'\")\n    .replaceAll(\"&#x27;\", \"'\")\n    .replaceAll(\"&#39;\", \"'\")\n    .replaceAll(\"&nbsp;\", \" \")\n    .replaceAll(\"&lt;\", \"<\")\n    .replaceAll(\"&gt;\", \">\");\n}\n\nfunction stripJinaEnvelope(markdown: string): string {\n  return markdown\n    .replace(/^Title:.*?\\nURL Source:.*?\\nMarkdown Content:\\n/s, \"\")\n    .trim();\n}\n\nfunction stripTags(value: string): string {\n  return value.replace(/<[^>]+>/g, \"\");\n}\n\nfunction plainTextFromHtml(value: string): string {\n  return decodeEntities(stripTags(value).replace(/\\s+/g, \" \")).trim();\n}\n\nfunction extractMainHtml(html: string): string {\n  const articleMatch = html.match(/<article[^>]*>([\\s\\S]*?)<\\/article>/i);\n  if (articleMatch?.[1]) {\n    return articleMatch[1];\n  }\n\n  const mainMatch = html.match(/<main[^>]*>([\\s\\S]*?)<\\/main>/i);\n  if (mainMatch?.[1]) {\n    return mainMatch[1];\n  }\n\n  return html;\n}\n\nfunction htmlToMarkdown(html: string): string {\n  let content = extractMainHtml(html);\n\n  content = content\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \"\")\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \"\")\n    .replace(/<noscript[\\s\\S]*?<\\/noscript>/gi, \"\")\n    .replace(/<svg[\\s\\S]*?<\\/svg>/gi, \"\")\n    .replace(/<button[^>]*>[\\s\\S]*?<\\/button>/gi, \"\");\n\n  content = content.replace(\n    /<pre[^>]*><code[^>]*>([\\s\\S]*?)<\\/code><\\/pre>/gi,\n    (_match, code) => {\n      const normalizedCode = decodeEntities(\n        stripTags(code)\n          .replace(/<br\\s*\\/?>/gi, \"\\n\")\n          .replace(/\\n{3,}/g, \"\\n\\n\")\n          .trim(),\n      );\n\n      if (!normalizedCode) {\n        return \"\";\n      }\n\n      return `\\n\\n\\`\\`\\`\\n${normalizedCode}\\n\\`\\`\\`\\n\\n`;\n    },\n  );\n\n  content = content.replace(/<code[^>]*>([\\s\\S]*?)<\\/code>/gi, (_match, code) => {\n    const normalizedCode = decodeEntities(stripTags(code)).trim();\n    return normalizedCode ? `\\`${normalizedCode}\\`` : \"\";\n  });\n\n  content = content.replace(\n    /<a[^>]*href=\"([^\"]+)\"[^>]*>([\\s\\S]*?)<\\/a>/gi,\n    (_match, href, label) => {\n      const text = plainTextFromHtml(label);\n      if (!text) {\n        return \"\";\n      }\n\n      return `[${text}](${decodeEntities(href)})`;\n    },\n  );\n\n  content = content.replace(/<h([1-6])[^>]*>([\\s\\S]*?)<\\/h\\1>/gi, (_match, level, inner) => {\n    const heading = plainTextFromHtml(inner);\n    if (!heading) {\n      return \"\";\n    }\n\n    return `\\n\\n${\"#\".repeat(Number(level))} ${heading}\\n\\n`;\n  });\n\n  content = content.replace(/<li[^>]*>([\\s\\S]*?)<\\/li>/gi, (_match, inner) => {\n    const line = plainTextFromHtml(inner);\n    return line ? `- ${line}\\n` : \"\";\n  });\n\n  content = content\n    .replace(/<br\\s*\\/?>/gi, \"\\n\")\n    .replace(/<\\/(p|div|section|article|header|ul|ol|table|tr)>/gi, \"\\n\\n\")\n    .replace(/<(p|div|section|article|header|ul|ol|table|tr)[^>]*>/gi, \"\\n\")\n    .replace(/<t[hd][^>]*>([\\s\\S]*?)<\\/t[hd]>/gi, (_match, inner) => {\n      const cell = plainTextFromHtml(inner);\n      return cell ? `${cell} ` : \"\";\n    });\n\n  content = decodeEntities(content)\n    .replace(/<[^>]+>/g, \"\")\n    .replace(/[ \\t]+\\n/g, \"\\n\")\n    .replace(/\\n{3,}/g, \"\\n\\n\")\n    .trim();\n\n  return content;\n}\n\nfunction sanitizeSegment(value: string): string {\n  const clean = decodeURIComponent(value)\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n\n  return clean || \"page\";\n}\n\nfunction sourcePathFromUrl(url: string): string {\n  const pathname = new URL(url).pathname.replace(/\\/+$/, \"\") || \"/docs\";\n  return pathname;\n}\n\nfunction fileStemFromUrl(url: string): string {\n  const sourcePath = sourcePathFromUrl(url);\n\n  if (sourcePath === \"/docs\") {\n    return \"docs\";\n  }\n\n  const relative = sourcePath.replace(/^\\/docs\\/?/, \"\");\n  const segments = relative\n    .split(\"/\")\n    .filter(Boolean)\n    .map(sanitizeSegment);\n\n  if (segments.length === 0) {\n    return \"docs\";\n  }\n\n  return [\"docs\", ...segments].join(\"__\");\n}\n\nfunction extractSummary(markdown: string): string {\n  const lines = markdown.split(\"\\n\");\n  let inCodeBlock = false;\n\n  for (const rawLine of lines) {\n    const line = rawLine.trim();\n\n    if (line.startsWith(\"```\") || line.startsWith(\"~~~\")) {\n      inCodeBlock = !inCodeBlock;\n      continue;\n    }\n\n    if (inCodeBlock) {\n      continue;\n    }\n\n    if (!line || line.startsWith(\"#\") || line.startsWith(\"- [\") || line.startsWith(\"```\")) {\n      continue;\n    }\n\n    if (line.length <= 25) {\n      continue;\n    }\n\n    if (line.length > SUMMARY_MAX_CHARS) {\n      return `${line.slice(0, SUMMARY_MAX_CHARS - 3)}...`;\n    }\n\n    return line;\n  }\n\n  return \"OpenCode documentation page snapshot.\";\n}\n\nfunction keywordsForPath(sourcePath: string): string {\n  const dynamic = sourcePath\n    .split(\"/\")\n    .filter(Boolean)\n    .slice(1)\n    .map((part) => part.replace(/[^a-zA-Z0-9]+/g, \" \"))\n    .filter(Boolean)\n    .join(\", \");\n\n  const base = \"opencode, docs, ai coding assistant, cli\";\n  return dynamic ? `${base}, ${dynamic}` : base;\n}\n\nfunction buildPageMarkdown(result: PageArtifact, capturedAt: string): string {\n  const pageSummary = result.ok\n    ? extractSummary(result.markdown ?? \"\")\n    : `Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  const pageBody = result.ok\n    ? result.markdown?.trim() ?? \"\"\n    : `> Scrape failed: ${result.error ?? \"unknown error\"}`;\n\n  return [\n    \"----\",\n    \"## External Docs Snapshot // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Source page: ${result.sourcePath}`,\n    `- Keywords: ${keywordsForPath(result.sourcePath)}`,\n    `- Summary: ${pageSummary}`,\n    \"----\",\n    \"\",\n    `Source: ${result.url}`,\n    \"\",\n    pageBody,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Collection method: sitemap discovery + markdown conversion.\",\n    `- Conversion path: ${result.mode === \"html\" ? \"direct HTML fallback parser\" : \"r.jina.ai markdown proxy\"}.`,\n    \"- This file is one page-level external snapshot in markdown `.ext.md` format.\",\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nfunction buildIndexMarkdown(\n  artifacts: PageArtifact[],\n  capturedAt: string,\n  outputDirRelative: string,\n): string {\n  const successCount = artifacts.filter((artifact) => artifact.ok).length;\n  const failureCount = artifacts.length - successCount;\n\n  const pageList = artifacts\n    .map((artifact) => {\n      const status = artifact.ok ? \"ok\" : \"failed\";\n      const mode = artifact.mode ?? \"unknown\";\n      return `- [${artifact.fileName}](./${artifact.fileName}) - ${artifact.sourcePath} (${status},mode=${mode})`;\n    })\n    .join(\"\\n\");\n\n  return [\n    \"----\",\n    \"## External Docs Index // opencode\",\n    \"\",\n    `- Captured: ${capturedAt}`,\n    `- Source root: ${DOCS_ROOT}`,\n    `- Output directory: ${outputDirRelative}`,\n    `- Scope: ${artifacts.length} pages under /docs`,\n    \"- Keywords: opencode, docs index, ai coding assistant, cli\",\n    \"- Summary: This index links one `.ext.md` file per docs page snapshot for OpenCode.\",\n    \"----\",\n    \"\",\n    \"## Pages\",\n    \"\",\n    pageList,\n    \"\",\n    \"----\",\n    \"## Notes / Comments / Lessons\",\n    \"\",\n    \"- Per-page files are flattened in this directory and prefixed with `docs` in the filename stem.\",\n    \"- Regenerate by re-running the scraper script; old `.ext.md` files in this directory are replaced.\",\n    `- Capture results: success=${successCount}, failed=${failureCount}.`,\n    \"----\",\n    \"\",\n  ].join(\"\\n\");\n}\n\nasync function fetchText(url: string): Promise<string> {\n  const response = await fetch(url, {\n    headers: {\n      \"user-agent\": \"dark-factory-doc-scraper/1.0\",\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Request failed (${response.status}) for ${url}`);\n  }\n\n  return await response.text();\n}\n\nfunction extractLocUrls(xml: string): string[] {\n  return Array.from(xml.matchAll(/<loc>(.*?)<\\/loc>/g), (match) =>\n    decodeEntities(match[1]?.trim() ?? \"\"),\n  ).filter(Boolean);\n}\n\nasync function discoverDocsUrlsFromSitemap(sitemapUrl: string): Promise<string[]> {\n  const visited = new Set<string>();\n  const pending: string[] = [sitemapUrl];\n  const docsUrls = new Set<string>();\n\n  while (pending.length > 0) {\n    const current = pending.pop();\n    if (!current || visited.has(current)) {\n      continue;\n    }\n\n    visited.add(current);\n\n    let xml: string;\n    try {\n      xml = await fetchText(current);\n    } catch {\n      continue;\n    }\n\n    const locUrls = extractLocUrls(xml);\n    for (const locUrl of locUrls) {\n      if (locUrl.endsWith(\".xml\")) {\n        if (!visited.has(locUrl)) {\n          pending.push(locUrl);\n        }\n        continue;\n      }\n\n      if (!locUrl.startsWith(DOCS_ROOT)) {\n        continue;\n      }\n\n      if (locUrl.includes(\"#\")) {\n        continue;\n      }\n\n      docsUrls.add(locUrl);\n    }\n  }\n\n  return Array.from(docsUrls).sort((a, b) => a.localeCompare(b));\n}\n\nfunction isEnglishDocsUrl(url: string): boolean {\n  const pathname = new URL(url).pathname;\n  if (!pathname.startsWith(\"/docs\")) {\n    return false;\n  }\n\n  const relative = pathname.replace(/^\\/docs\\/?/, \"\");\n  if (!relative) {\n    return true;\n  }\n\n  const firstSegment = relative.split(\"/\")[0]?.toLowerCase() ?? \"\";\n  if (!firstSegment) {\n    return true;\n  }\n\n  if (firstSegment === \"en\" || firstSegment === \"english\") {\n    return true;\n  }\n\n  if (/^[a-z]{2}(?:-[a-z]{2})?$/.test(firstSegment)) {\n    return false;\n  }\n\n  return true;\n}\n\nasync function mapConcurrent<T, R>(\n  values: T[],\n  limit: number,\n  map: (value: T, index: number) => Promise<R>,\n): Promise<R[]> {\n  const results = new Array<R>(values.length);\n  let index = 0;\n\n  async function worker(): Promise<void> {\n    while (true) {\n      const currentIndex = index;\n      index += 1;\n\n      if (currentIndex >= values.length) {\n        return;\n      }\n\n      results[currentIndex] = await map(values[currentIndex], currentIndex);\n    }\n  }\n\n  const workerCount = Math.min(limit, values.length);\n  await Promise.all(Array.from({ length: workerCount }, () => worker()));\n  return results;\n}\n\nasync function scrapeDocsPage(url: string, count: number, total: number): Promise<ScrapeResult> {\n  const jinaUrl = `https://r.jina.ai/http://${url.replace(/^https?:\\/\\//, \"\")}`;\n\n  try {\n    console.log(`Docs // Scrape // ${count}/${total} ${url}`);\n\n    try {\n      const markdown = stripJinaEnvelope(await fetchText(jinaUrl));\n      if (markdown) {\n        return {\n          url,\n          ok: true,\n          markdown,\n          mode: \"jina\",\n        };\n      }\n    } catch {\n      // Fall through to direct HTML scrape.\n    }\n\n    const html = await fetchText(url);\n    const markdown = htmlToMarkdown(html);\n\n    if (!markdown) {\n      return {\n        url,\n        ok: false,\n        error: \"No markdown content returned from HTML fallback\",\n      };\n    }\n\n    return {\n      url,\n      ok: true,\n      markdown,\n      mode: \"html\",\n    };\n  } catch (error) {\n    return {\n      url,\n      ok: false,\n      error: error instanceof Error ? error.message : \"Unknown scrape error\",\n    };\n  }\n}\n\nfunction resolveOutputDirectory(repoRoot: string, outputArg?: string): string {\n  if (!outputArg) {\n    return resolve(repoRoot, DEFAULT_OUTPUT_DIR_RELATIVE);\n  }\n\n  const resolved = resolve(repoRoot, outputArg);\n  if (resolved.endsWith(\".md\")) {\n    return dirname(resolved);\n  }\n\n  return resolved;\n}\n\nfunction clearExistingExtFiles(outputDir: string): void {\n  if (!existsSync(outputDir)) {\n    return;\n  }\n\n  for (const entry of readdirSync(outputDir, { withFileTypes: true })) {\n    if (!entry.isFile()) {\n      continue;\n    }\n\n    if (!entry.name.endsWith(\".ext.md\")) {\n      continue;\n    }\n\n    rmSync(resolve(outputDir, entry.name));\n  }\n}\n\nconst repoRoot = findRepoRoot(import.meta.dir);\nconst outputArg = Bun.argv[2];\nconst outputDir = resolveOutputDirectory(repoRoot, outputArg);\nconst outputDirRelative = outputDir.startsWith(repoRoot)\n  ? outputDir.slice(repoRoot.length + 1)\n  : outputDir;\n\nmkdirSync(outputDir, { recursive: true });\nclearExistingExtFiles(outputDir);\n\nconst requestedLanguage = (Bun.env.DOCS_LANGUAGE ?? DEFAULT_LANGUAGE).toLowerCase();\nconst discoveredUrls = await discoverDocsUrlsFromSitemap(SITEMAP_URL);\nconst docsUrls =\n  requestedLanguage === \"en\" || requestedLanguage === \"english\"\n    ? discoveredUrls.filter(isEnglishDocsUrl)\n    : discoveredUrls;\n\nif (docsUrls.length === 0) {\n  throw new Error(`No docs URLs found from sitemap discovery (${SITEMAP_URL})`);\n}\n\nconst scrapeResults = await mapConcurrent(docsUrls, CONCURRENCY, (url, index) =>\n  scrapeDocsPage(url, index + 1, docsUrls.length),\n);\n\nconst usedNames = new Map<string, number>();\nconst artifacts: PageArtifact[] = scrapeResults.map((result) => {\n  const stem = fileStemFromUrl(result.url);\n  const seen = usedNames.get(stem) ?? 0;\n  usedNames.set(stem, seen + 1);\n\n  const suffix = seen === 0 ? \"\" : `__${seen + 1}`;\n  const fileName = `${stem}${suffix}.ext.md`;\n\n  return {\n    ...result,\n    fileName,\n    sourcePath: sourcePathFromUrl(result.url),\n  };\n});\n\nconst capturedAt = new Date().toISOString();\n\nfor (const artifact of artifacts) {\n  const pagePath = resolve(outputDir, artifact.fileName);\n  const pageContent = buildPageMarkdown(artifact, capturedAt);\n  await Bun.write(pagePath, pageContent);\n}\n\nconst indexContent = buildIndexMarkdown(artifacts, capturedAt, outputDirRelative);\nawait Bun.write(resolve(outputDir, \"index.ext.md\"), indexContent);\n\nconst successCount = artifacts.filter((artifact) => artifact.ok).length;\nconst failureCount = artifacts.length - successCount;\nconst blockedPages = artifacts\n  .filter((artifact) => !artifact.ok)\n  .map((artifact) => artifact.sourcePath)\n  .join(\",\");\n\nconsole.log(\n  `Docs // Scrape // Wrote split external docs (source=${SOURCE_KEY},lang=${requestedLanguage},pages=${artifacts.length},ok=${successCount},failed=${failureCount},blocked=${blockedPages || \"none\"},dir=${outputDir})`,\n);\n",
                  "additions": 1,
                  "deletions": 17
                }
              ],
              "diagnostics": {},
              "truncated": false
            },
            "time": {
              "start": 1771215224626,
              "end": 1771215224643
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_0ed51d6b99c3e307016992997653948194ba862bc0b45479f4"
            }
          },
          "id": "prt_c64a7768f001Z4ixwtq86m0v7Q",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7552f001z1wGyKY217fa6O"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "fbc7e837b5b635cfba835d94a6fbbe7aa90e5772",
          "cost": 0,
          "tokens": {
            "total": 38192,
            "input": 4155,
            "output": 501,
            "reasoning": 237,
            "cache": {
              "read": 33536,
              "write": 0
            }
          },
          "id": "prt_c64a77f65001OgxmMWz0Jhv9V1",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7552f001z1wGyKY217fa6O"
        },
        {
          "type": "patch",
          "hash": "d412c2edd6e6e75c5ce57674f969da59cb139fcc",
          "files": [
            "/Users/alex/repos/vfp/dark-factory/scripts/scrape_opencode_docs.sh.ts"
          ],
          "id": "prt_c64a77f94001FXEm99Ib2vzXXX",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7552f001z1wGyKY217fa6O"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215224741,
          "completed": 1771215231978
        },
        "parentID": "msg_c64a667e1001oSCNckxNgJGDO0",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 38267,
          "input": 204,
          "output": 47,
          "reasoning": 8,
          "cache": {
            "read": 38016,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a77fa5001FMjk17L0scy1XW",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fbc7e837b5b635cfba835d94a6fbbe7aa90e5772",
          "id": "prt_c64a788a9001oaC5EIfbVOLNV7",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a77fa5001FMjk17L0scy1XW"
        },
        {
          "type": "reasoning",
          "text": "",
          "metadata": {
            "openai": {
              "itemId": "rs_01351526835d7a82016992997cc50c819487d0cdd68667d247",
              "reasoningEncryptedContent": "gAAAAABpkpl9ucOkEkROSXG_JiXrbTQ0fVKr-ApeIpxhcY1iIj0zicoGcWF57SJPh5NtM25CwtNTqQCRdLh-bDXUmUWL8iOwFsGsRd0NzknuiLktKreizA_31-MD0kZj55RP2bCZWUXbt4SEK7Q8IwafrnA_29wXQPqsNdfcdQXSEy-pEwhEiPuExA1IvgjAH3r4lM3kNJfohGygDf7XeyCMVz-tdtgqn6nW0PgPJTOzRvPv9_ZIRRSLyF_kKkX87tNllhUB_N5JaNmRQzIxqWDLoACV-4RkfQu_t1rvX324J2BI9Ksz-ek6xyAPCWCqMHXCVJwzNC0HF_ojfJKGrsCUXwAxb9wKMvXDUfKIAiQJYh5NGqEGMTntPNxQjyVxv2o5cwjeK5RqLinMgUgEsEvhc4Tsx_3Q0Br1ipJekvyMN45ffFSa7G41_yem6KTplArQQDbW_WRYKbOw7eZn0m6dMxost7A03aJj6rxGRv3an4cWYnoMvi7WzdmXIyE27Fl9y0O-BCj55DIqjCM8qja4NnO6pPiEFJQeQ0Q4WDawwJFU0nYerCiQQ_5OvcQQHM8ZNG1Lahjmb1KykuSxA2mw3qLFqyv7vMXEHnk8tCDMSl4RNOi59R8K8eo78ggy_rOa10dmyrjRjx9nVkl-_iZ7Lrz9_ri940-SG8CKsxY3612NxKjP-uB98GkXJugv9OalS9SjZkPf5AasqE6HAuSavV8XkwpddyMoABErCfbFwDURJzzURzo1YNyP4wZTO33G-2hkZBulwm3exlNIy8Djr4TMXBroP1cABEBhvKPC0B0NZfl6YBnmKcMasWm93DIPjf3mnBUUlUbAm93BIU0QX3JMeOcrBA=="
            }
          },
          "time": {
            "start": 1771215228801,
            "end": 1771215229188
          },
          "id": "prt_c64a78f81001D1wyC81joCdn7z",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a77fa5001FMjk17L0scy1XW"
        },
        {
          "type": "tool",
          "callID": "call_fANoUsUT6Y4M7Tya3VEj53d8",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "bun scripts/scrape_opencode_docs.sh.ts",
              "description": "Re-run scraper after language filter fix"
            },
            "output": "Docs // Scrape // 1/34 https://opencode.ai/docs/\nDocs // Scrape // 2/34 https://opencode.ai/docs/acp\nDocs // Scrape // 3/34 https://opencode.ai/docs/agents\nDocs // Scrape // 4/34 https://opencode.ai/docs/cli\nDocs // Scrape // 5/34 https://opencode.ai/docs/commands\nDocs // Scrape // 6/34 https://opencode.ai/docs/config\nDocs // Scrape // 7/34 https://opencode.ai/docs/custom-tools\nDocs // Scrape // 8/34 https://opencode.ai/docs/ecosystem\nDocs // Scrape // 9/34 https://opencode.ai/docs/enterprise\nDocs // Scrape // 10/34 https://opencode.ai/docs/formatters\nDocs // Scrape // 11/34 https://opencode.ai/docs/github\nDocs // Scrape // 12/34 https://opencode.ai/docs/gitlab\nDocs // Scrape // 13/34 https://opencode.ai/docs/ide\nDocs // Scrape // 14/34 https://opencode.ai/docs/keybinds\nDocs // Scrape // 15/34 https://opencode.ai/docs/lsp\nDocs // Scrape // 16/34 https://opencode.ai/docs/mcp-servers\nDocs // Scrape // 17/34 https://opencode.ai/docs/models\nDocs // Scrape // 18/34 https://opencode.ai/docs/modes\nDocs // Scrape // 19/34 https://opencode.ai/docs/network\nDocs // Scrape // 20/34 https://opencode.ai/docs/permissions\nDocs // Scrape // 21/34 https://opencode.ai/docs/plugins\nDocs // Scrape // 22/34 https://opencode.ai/docs/providers\nDocs // Scrape // 23/34 https://opencode.ai/docs/rules\nDocs // Scrape // 24/34 https://opencode.ai/docs/sdk\nDocs // Scrape // 25/34 https://opencode.ai/docs/server\nDocs // Scrape // 26/34 https://opencode.ai/docs/share\nDocs // Scrape // 27/34 https://opencode.ai/docs/skills\nDocs // Scrape // 28/34 https://opencode.ai/docs/themes\nDocs // Scrape // 29/34 https://opencode.ai/docs/tools\nDocs // Scrape // 30/34 https://opencode.ai/docs/troubleshooting\nDocs // Scrape // 31/34 https://opencode.ai/docs/tui\nDocs // Scrape // 32/34 https://opencode.ai/docs/web\nDocs // Scrape // 33/34 https://opencode.ai/docs/windows-wsl\nDocs // Scrape // 34/34 https://opencode.ai/docs/zen\nDocs // Scrape // Wrote split external docs (source=opencode,lang=en,pages=34,ok=34,failed=0,blocked=none,dir=/Users/alex/repos/vfp/dark-factory/docs/external/opencode)\n",
            "title": "Re-run scraper after language filter fix",
            "metadata": {
              "output": "Docs // Scrape // 1/34 https://opencode.ai/docs/\nDocs // Scrape // 2/34 https://opencode.ai/docs/acp\nDocs // Scrape // 3/34 https://opencode.ai/docs/agents\nDocs // Scrape // 4/34 https://opencode.ai/docs/cli\nDocs // Scrape // 5/34 https://opencode.ai/docs/commands\nDocs // Scrape // 6/34 https://opencode.ai/docs/config\nDocs // Scrape // 7/34 https://opencode.ai/docs/custom-tools\nDocs // Scrape // 8/34 https://opencode.ai/docs/ecosystem\nDocs // Scrape // 9/34 https://opencode.ai/docs/enterprise\nDocs // Scrape // 10/34 https://opencode.ai/docs/formatters\nDocs // Scrape // 11/34 https://opencode.ai/docs/github\nDocs // Scrape // 12/34 https://opencode.ai/docs/gitlab\nDocs // Scrape // 13/34 https://opencode.ai/docs/ide\nDocs // Scrape // 14/34 https://opencode.ai/docs/keybinds\nDocs // Scrape // 15/34 https://opencode.ai/docs/lsp\nDocs // Scrape // 16/34 https://opencode.ai/docs/mcp-servers\nDocs // Scrape // 17/34 https://opencode.ai/docs/models\nDocs // Scrape // 18/34 https://opencode.ai/docs/modes\nDocs // Scrape // 19/34 https://opencode.ai/docs/network\nDocs // Scrape // 20/34 https://opencode.ai/docs/permissions\nDocs // Scrape // 21/34 https://opencode.ai/docs/plugins\nDocs // Scrape // 22/34 https://opencode.ai/docs/providers\nDocs // Scrape // 23/34 https://opencode.ai/docs/rules\nDocs // Scrape // 24/34 https://opencode.ai/docs/sdk\nDocs // Scrape // 25/34 https://opencode.ai/docs/server\nDocs // Scrape // 26/34 https://opencode.ai/docs/share\nDocs // Scrape // 27/34 https://opencode.ai/docs/skills\nDocs // Scrape // 28/34 https://opencode.ai/docs/themes\nDocs // Scrape // 29/34 https://opencode.ai/docs/tools\nDocs // Scrape // 30/34 https://opencode.ai/docs/troubleshooting\nDocs // Scrape // 31/34 https://opencode.ai/docs/tui\nDocs // Scrape // 32/34 https://opencode.ai/docs/web\nDocs // Scrape // 33/34 https://opencode.ai/docs/windows-wsl\nDocs // Scrape // 34/34 https://opencode.ai/docs/zen\nDocs // Scrape // Wrote split external docs (source=opencode,lang=en,pages=34,ok=34,failed=0,blocked=none,dir=/Users/alex/repos/vfp/dark-factory/docs/external/opencode)\n",
              "exit": 0,
              "description": "Re-run scraper after language filter fix",
              "truncated": false
            },
            "time": {
              "start": 1771215229536,
              "end": 1771215231899
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_01351526835d7a82016992997d262c81948a79bd55220085f6"
            }
          },
          "id": "prt_c64a791050013w6wpZaR5Gi5rj",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a77fa5001FMjk17L0scy1XW"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "cost": 0,
          "tokens": {
            "total": 38267,
            "input": 204,
            "output": 47,
            "reasoning": 8,
            "cache": {
              "read": 38016,
              "write": 0
            }
          },
          "id": "prt_c64a79b9b001aG6TB1xf2kzBHS",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a77fa5001FMjk17L0scy1XW"
        },
        {
          "type": "patch",
          "hash": "fbc7e837b5b635cfba835d94a6fbbe7aa90e5772",
          "files": [
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__da__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__nb__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pl__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__pt-br__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__acp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__agents.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__cli.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__commands.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__config.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__custom-tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__ecosystem.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__enterprise.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__formatters.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__github.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__gitlab.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__ide.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__keybinds.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__lsp.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__mcp-servers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__models.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__modes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__network.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__permissions.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__plugins.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__providers.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__rules.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__sdk.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__server.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__share.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__skills.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__th__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__themes.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__tools.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__troubleshooting.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__tui.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__web.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__windows-wsl.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__zen.ext.md",
            "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/index.ext.md"
          ],
          "id": "prt_c64a79be2001nuEDcf7uxqxOr2",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a77fa5001FMjk17L0scy1XW"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215231987,
          "completed": 1771215237244
        },
        "parentID": "msg_c64a667e1001oSCNckxNgJGDO0",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 39004,
          "input": 792,
          "output": 68,
          "reasoning": 28,
          "cache": {
            "read": 38144,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a79bf3001b5Yg4EcMDM0dZB",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "id": "prt_c64a7a56c001fMtrGaoyv5H36B",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a79bf3001b5Yg4EcMDM0dZB"
        },
        {
          "type": "reasoning",
          "text": "**Planning file verification and indexing**",
          "metadata": {
            "openai": {
              "itemId": "rs_095b0ec02c4cbe1401699299841adc8193aea1c41fedae3e0a",
              "reasoningEncryptedContent": "gAAAAABpkpmExodba716KrLjyZ91SpP0_P_z_Ld7jvR_kh5BuX4UjbdS7ZijMDk3zJ-KkpMMVnMpkjb7Y0Iynj26ZZ5OrrKV1DIwWGrwxdiHBf-he-6tJKvCFnOtbQkLGD2BsQrN7_351WGhSkz0M2AnjMpoGX24ZizbFBrNLiJpD4s0ZYDo8B6WEdO5JU4rl_0AjTeRFxIH7vfK5FQ-TIklYcDe03Xf5YXdhApIyg7alMRJEHchXPIw0FHUVzEB40D5hWgbxhcuIK1uUf_wdNOiVdPT-rtlQxB4NbIIPIXut0ihtmToCT89nZzZ70AhH-nfcPqhgzANw6aim3A32NC3E2aCqUg5syilmq7aPkqO3BUjlJRV09q49CHtxj43UKdQDVejgp9RP_2K5tlb7-ae0ZC8QhqBuf5DieD7yrdmiJpG5niDn9jKc2XzW1DqubxR82OZXc2X7eEJwE3HXzEqdjyy3lXL0BdZkP2gAAPM4H2XguYwoFGlIi9jdfPoW5tLqoDQAcUhCdHO1aCukgoGh2q58hJhEtxsHIdU6nPLuMbhFQgRKJIgGtpfjzVBGv5CXKislnFI5XjfCQpmihvbLRvfLlpAEyAEJGMJfBtAVA7d_cwFsHQA_DEZSRY2eSyMWzdh_i2P6Y0hq1JS1ohDo7SfoqlO62uIBobL3bx535Qy2-Kd-2nRyVRrl-6N7ij5CuikE8bYiGrY9ptYKYPfQUjukUmRQ34xi3wHivPveYUx7HxXD6olAOqzIhBqhlEp5O8tytJKVc5V3_IJNykciZ6DUBAZigBOhmcuQcPNCFBWsNjDYipbqplljt6t5UFpw7FdTLPA26Ap9XuddxwNcsGncq0l3FEju9GYiUxpSxsKWT-zlKlqsTWB2XFgPnb_mgJ0skqPogRJgVURNy_h-pmFa4lhE20W2q73Snr3NLWyOWz3uBZET96INSYouGnJYd_ZNmb67n1Wq6XSy0l6BazQpT4WKST3iota6JYzeS_6U9vcR8E="
            }
          },
          "time": {
            "start": 1771215236229,
            "end": 1771215237049
          },
          "id": "prt_c64a7ac85001l6fvJuLOoAQMSG",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a79bf3001b5Yg4EcMDM0dZB"
        },
        {
          "type": "tool",
          "callID": "call_Gnm4pMjiuPX0Set9oOqU4AJf",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "docs/external/opencode/*.ext.md",
              "path": "/Users/alex/repos/vfp/dark-factory"
            },
            "output": "/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__zen.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/index.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__windows-wsl.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__troubleshooting.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__web.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__tools.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__themes.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__tui.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__skills.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__sdk.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__server.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__share.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__modes.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__permissions.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__providers.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__rules.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__plugins.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__network.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__keybinds.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__gitlab.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__github.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__mcp-servers.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__models.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__lsp.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__ide.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__formatters.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__ecosystem.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__custom-tools.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__agents.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__config.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__commands.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__cli.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__enterprise.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs__acp.ext.md\n/Users/alex/repos/vfp/dark-factory/docs/external/opencode/docs.ext.md",
            "title": "",
            "metadata": {
              "count": 35,
              "truncated": false
            },
            "time": {
              "start": 1771215237145,
              "end": 1771215237159
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_095b0ec02c4cbe140169929984dd9c8193980e50961ef85979"
            }
          },
          "id": "prt_c64a7afba001vAWnJVG0tHgrF9",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a79bf3001b5Yg4EcMDM0dZB"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "cost": 0,
          "tokens": {
            "total": 39004,
            "input": 792,
            "output": 68,
            "reasoning": 28,
            "cache": {
              "read": 38144,
              "write": 0
            }
          },
          "id": "prt_c64a7b04c001usxHESQWp3pw9z",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a79bf3001b5Yg4EcMDM0dZB"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215237248,
          "completed": 1771215245845
        },
        "parentID": "msg_c64a667e1001oSCNckxNgJGDO0",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 40184,
          "input": 884,
          "output": 388,
          "reasoning": 76,
          "cache": {
            "read": 38912,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "stop",
        "id": "msg_c64a7b0800011t89ETRuXo3lOr",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "id": "prt_c64a7ba7d001LOl6Z611UIBred",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7b0800011t89ETRuXo3lOr"
        },
        {
          "type": "reasoning",
          "text": "**Summarizing completion details**",
          "metadata": {
            "openai": {
              "itemId": "rs_03b02e3278b36105016992998834c48190b867989abcb97a2e",
              "reasoningEncryptedContent": "gAAAAABpkpmJAXuhIXs_sU4Us0Wfk1urptsynge8Uq4lK3z5t2yNX24TfGVTtvJrFNAPuiqWZz860EOExBzwT3IA9_V5L23Ln01ACHgix1BbMMppbmOp6vapB9Ygod0jEp1gXuK6PqaxdC9OZX3H0Z-k50vdHUynU7JLtnJcwbyIEj_-xbiBqukpF7E39zt0D25hA4gql1DaqjqihYFFufeT54H4MlIBzxhvJt-MN-TGr6dGMN-6yzGZFzRVHUBg6AC3SeL6laWpbvAeUorF311Qhlt3kwwudhrg3KisU91h5xUlLaBi49mcX66HP035_4VQQ1uvQPd1bhd1if3leLfLvyx8ePqc8EVzu_iC-Ze7M8t0ZedmJOccQLvWp9MgRfeKg_gtyZG9TQbwY0FJX4CcngsZM6kX1I3usti6D7Dd4fCDbURduy-UDi4_DKD1OkZvXw1qE0fUlV54jPBvaiyq1_VQw9K2lQZndpnLe5pEod1LCUjpzOvam-gzu0DpScOcLNeR-kFmYKHG-x-Jd7lHT8rbbhh483hC-fD6zn5WtYI1isK-D6DLfMc3D6VVU78RILOAOo7m7Sjpqwuhn_s3Av43XRjCYD6PTy4ME71tAlqLRfFVElJ27xw7XXermBTq7IAIXpakhevPO3TDUDMcEQUbqlhddRGyepo7drcNEAozHyDgGUY3DXo72R8l_lQcyBDGpaCKenKKVJwmD8MvqfJ3BuTd6b3wsb1oK5eL5B0Bt0wbzzypiLuOVixoA1v03t1Ggb4QfNlvEZnJDq9jLyqy8ajM0h2ULRHYJIvCI1mnBrW8pYulf7ijYP9dSdoLotBQz_r1hTp5Hi0myzOXBtuo35J9efr2n527TUE5XbkCCe1kiMbbpm3MX4x5nc0YQPlFneqZYOyCXiW6rxz7EmgC8oPEZ_-jR7Zvn0E4OluU_plz5i3Ur0UVZEozKcy9z-SYCymitSkdvsIYVRbWgWI7jl2IO1SbMOTrVHtV-yEEHRP8yRst_7wS2oHE02r1Gf6myflbkuvOErwLXkkP9lP5ycG1beCPUniWlI-HYLElBi8evDiMSIn_PMIfkAnioHqnBlBKOroQyWHPXt0p4sV6Uuew3IUcjY-xaHHPPjmpaMtBzD4xxAvcQHlO5CUY6heXLSuymn9ll-yU-Xz4eP-9z0fQdwEwMfwbp9YYGf9GJHVGj3JQx9EJ_rI4lBymK5Xxa3O_9qoBIkglrkIUBxqOQYanjV_igAf1LywayOthrqJRNxS4M0IoQ_iS-__uQgjDFPvj_s5hxCmkPDoj5yd0Stbq3M_U7TR3jWopgTvaFqYnyjnGiXkxZtUh4EPxdSAx06S0gG72v6JnL4bQZXRfDiT2flEXULgv5LPIkq9j68HsrHs="
            }
          },
          "time": {
            "start": 1771215240237,
            "end": 1771215241775
          },
          "id": "prt_c64a7bc2d001ggnAShRKLoSHgT",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7b0800011t89ETRuXo3lOr"
        },
        {
          "type": "text",
          "text": "Yep  good catch. The OpenCode sitemap is multi-language, so I updated the scraper to default to English-only capture.\n\n- I added language filtering in `scripts/scrape_opencode_docs.sh.ts` so `DOCS_LANGUAGE=en` (default) keeps only canonical English routes under `/docs` and skips locale-prefixed paths like `/docs/da/*`, `/docs/nb/*`, `/docs/pl/*`, `/docs/pt-br/*`, `/docs/th/*`.\n- I reran the scrape after the fix and regenerated `docs/external/opencode/` with split `.ext.md` pages plus `docs/external/opencode/index.ext.md`.\n- Discovery strategy used: recursive sitemap discovery from `https://opencode.ai/sitemap.xml` (follows sitemap links, then filters docs URLs).\n- Capture totals (English): `pages=34`, `ok=34`, `failed=0`, blocked pages: none.\n- I also documented the new entrypoint and language behavior in `README.md` and `AGENTS.md`.\n\nUpdated paths:\n- `scripts/scrape_opencode_docs.sh.ts`\n- `docs/external/opencode/index.ext.md`\n- `docs/external/opencode/*.ext.md`\n- `README.md`\n- `AGENTS.md`\n\nExact rerun command:\n- `bun scripts/scrape_opencode_docs.sh.ts`\n\nOptional override (if you ever want all locales):\n- `DOCS_LANGUAGE=all bun scripts/scrape_opencode_docs.sh.ts`",
          "time": {
            "start": 1771215245748,
            "end": 1771215245748
          },
          "metadata": {
            "openai": {
              "itemId": "msg_03b02e3278b361050169929989ba4c8190bc0718ae0b5fd8f2"
            }
          },
          "id": "prt_c64a7c2310016yHKyvePx8zZAl",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7b0800011t89ETRuXo3lOr"
        },
        {
          "type": "step-finish",
          "reason": "stop",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "cost": 0,
          "tokens": {
            "total": 40184,
            "input": 884,
            "output": 388,
            "reasoning": 76,
            "cache": {
              "read": 38912,
              "write": 0
            }
          },
          "id": "prt_c64a7d1e60016kq6tUGXcLo84T",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a7b0800011t89ETRuXo3lOr"
        }
      ]
    },
    {
      "info": {
        "role": "user",
        "time": {
          "created": 1771215258953
        },
        "summary": {
          "title": "Commit message: gitter commit your work",
          "diffs": []
        },
        "agent": "build",
        "model": {
          "providerID": "openai",
          "modelID": "gpt-5.3-codex"
        },
        "variant": "low",
        "id": "msg_c64a80544001W2chLTnfXdQMdG",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "text",
          "text": "@gitter commit your work",
          "id": "prt_c64a80544002zhk1LVyMrCYjVf",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a80544001W2chLTnfXdQMdG"
        },
        {
          "type": "agent",
          "name": "gitter",
          "source": {
            "value": "@gitter",
            "start": 0,
            "end": 7
          },
          "id": "prt_c64a80545001LEhfqgOymOrw47",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a80544001W2chLTnfXdQMdG"
        },
        {
          "type": "text",
          "text": " Use the above message and context to generate a prompt and call the task tool with subagent: gitter",
          "synthetic": true,
          "id": "prt_c64a80549003Syy8TanEAOa8o0",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a80544001W2chLTnfXdQMdG"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215258961,
          "completed": 1771215307591
        },
        "parentID": "msg_c64a80544001W2chLTnfXdQMdG",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 39762,
          "input": 7626,
          "output": 264,
          "reasoning": 19,
          "cache": {
            "read": 31872,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "tool-calls",
        "id": "msg_c64a80551001E0Hw86QExmZmeK",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "id": "prt_c64a80cd7001Cw7boB6JhHTn10",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a80551001E0Hw86QExmZmeK"
        },
        {
          "type": "reasoning",
          "text": "",
          "metadata": {
            "openai": {
              "itemId": "rs_03c02028d4931e3e016992999d59f081938a89b63780f65d26",
              "reasoningEncryptedContent": "gAAAAABpkpmea8X-K_OhTqZbjqDHp2HEVKrJVYZ5mCX9vvAtls9IwHzchxwSYJ7pkevoN3i-6Ylh0WPaAAiMmrX5r1SJgZLJGJwZ0r0lX5BYLXfOj9klCLjASwuQ8p1HeBCrWGzhHAqhJtWL0Pgs6PUgUJTr4BCeI4x3kEw-a2UwjeLdH8jA87N8pqHt4lt0bJes9v9f2ngOwhTW8W7sZ7CSCcjd2skCrV3mUXmin0fsTOOAAai2YNDtbnzAjwEoPI8RaIdHVdK6URpT3vl8L2OdU6jF-2Fjojg8JpKiYqZ2bx-7yb7Drd27D-BFgu1TrKak5BlztY7ZyI1VDUB0X6zm1L5Ir9eyoHi258JF4CWUi5QkXucOoLDqvpKGfMQlo9n14rwslNfDfxbq1OCQI4q098KXotgJVQupxQvF4dm74klKAKyuMBjQNQxyMJVl8a5zXTZ3xQq-kHitBVt9vl0Y7mMAkOiLtoTD6eNYV1efIJx7BEB5fKCkqOgPCw1vwobMG67HC35CuOJ_T4Q0udwSrLMokA0joh6oYDZKki4j8Zw9Bp1FyQF9GEK67-b6OTMUYhynBWDCyojsUZ_2vKhOuadClNl_yJYUn6W_e9fZARs3QJvzsX7HUV7lfSPQmpfk1HMk7hjbuV6AmKkdUv6FWTuYKLDZ49py8wp4AwnsEOzZzDGtBOri4ju-xNu55Ufy1aVBGCTTQc8Mcaon25i2q3pOMFt8NF5NR7xfWASoAT-wOmxWd33Q_1qerBAk-IRoDyTETb1lbEmm3HGyBJTfIB9QaaWzzprn-a-exmXFszcyex_-VEvUX11hMcCwGcjDCsw5OwhMqbOTHF100rPYa67SEO1mzCFnFwZyjZi_pP8rqZb9qj69oGTHgjZr1q4CM5IsNOX7U1DvD5-TMY9hj2lJlplWYg=="
            }
          },
          "time": {
            "start": 1771215261380,
            "end": 1771215262397
          },
          "id": "prt_c64a80ec40013q3xK31lb45sho",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a80551001E0Hw86QExmZmeK"
        },
        {
          "type": "tool",
          "callID": "call_BEVNBoruarTexYEO6ygzdFyb",
          "tool": "task",
          "state": {
            "status": "completed",
            "input": {
              "description": "Commit scraper updates",
              "subagent_type": "gitter",
              "prompt": "User requested: \"@gitter commit your work\".\n\nPlease perform the full commit workflow in this repository:\n1) Run git status, git diff, and recent git log to review pending changes and commit style.\n2) Analyze staged/unstaged/untracked changes from this conversation:\n   - Added/updated OpenCode docs scraper script with English-only default language filter and sitemap-based discovery.\n   - Generated split external docs snapshots under docs/external/opencode/ including index.ext.md.\n   - Updated README.md and AGENTS.md with new scraper entrypoint and language behavior.\n3) Stage relevant files and create one commit using repository commit message conventions from AGENTS.md.\n4) Run git status after committing and report result.\n\nImportant constraints:\n- Do not push.\n- Do not amend unless strictly required by hook auto-fixes and allowed by policy.\n- Avoid committing unrelated files if present.\n\nReturn:\n- Commit hash\n- Commit message\n- Files committed\n- Final git status summary"
            },
            "output": "task_id: ses_39b57e1ecffecKa65ZOsALdNcH (for resuming to continue this task if needed)\n\n<task_result>\nCommitted successfully with only the requested scraper/docs changes.\n\n- Commit hash: `32031504db48fc3f641724ab10113f5dc04d2062`\n- Commit message: `Tooling // Docs Scrape // Add OpenCode sitemap snapshots (en default)`\n- Commit body:\n  - `Track OpenCode docs with sitemap-based split snapshots and a default English filter for stable refreshes.`\n  - `// Agent (gpt-5.3-codex)`\n\nFiles committed:\n- `AGENTS.md`\n- `README.md`\n- `scripts/scrape_opencode_docs.sh.ts`\n- `docs/external/opencode/index.ext.md`\n- `docs/external/opencode/docs.ext.md`\n- `docs/external/opencode/docs__acp.ext.md`\n- `docs/external/opencode/docs__agents.ext.md`\n- `docs/external/opencode/docs__cli.ext.md`\n- `docs/external/opencode/docs__commands.ext.md`\n- `docs/external/opencode/docs__config.ext.md`\n- `docs/external/opencode/docs__custom-tools.ext.md`\n- `docs/external/opencode/docs__ecosystem.ext.md`\n- `docs/external/opencode/docs__enterprise.ext.md`\n- `docs/external/opencode/docs__formatters.ext.md`\n- `docs/external/opencode/docs__github.ext.md`\n- `docs/external/opencode/docs__gitlab.ext.md`\n- `docs/external/opencode/docs__ide.ext.md`\n- `docs/external/opencode/docs__keybinds.ext.md`\n- `docs/external/opencode/docs__lsp.ext.md`\n- `docs/external/opencode/docs__mcp-servers.ext.md`\n- `docs/external/opencode/docs__models.ext.md`\n- `docs/external/opencode/docs__modes.ext.md`\n- `docs/external/opencode/docs__network.ext.md`\n- `docs/external/opencode/docs__permissions.ext.md`\n- `docs/external/opencode/docs__plugins.ext.md`\n- `docs/external/opencode/docs__providers.ext.md`\n- `docs/external/opencode/docs__rules.ext.md`\n- `docs/external/opencode/docs__sdk.ext.md`\n- `docs/external/opencode/docs__server.ext.md`\n- `docs/external/opencode/docs__share.ext.md`\n- `docs/external/opencode/docs__skills.ext.md`\n- `docs/external/opencode/docs__themes.ext.md`\n- `docs/external/opencode/docs__tools.ext.md`\n- `docs/external/opencode/docs__troubleshooting.ext.md`\n- `docs/external/opencode/docs__tui.ext.md`\n- `docs/external/opencode/docs__web.ext.md`\n- `docs/external/opencode/docs__windows-wsl.ext.md`\n- `docs/external/opencode/docs__zen.ext.md`\n\nFinal `git status` summary:\n- Branch `main` is ahead of `origin/main` by 8 commits.\n- Remaining unrelated changes were left untouched:\n  - Modified: `docs/designs/core_gen1.design.md`\n  - Untracked: `schemas/`\n- No push performed.\n</task_result>",
            "title": "Commit scraper updates",
            "metadata": {
              "sessionId": "ses_39b57e1ecffecKa65ZOsALdNcH",
              "model": {
                "modelID": "gpt-5.3-codex",
                "providerID": "openai"
              },
              "truncated": false
            },
            "time": {
              "start": 1771215265301,
              "end": 1771215307545
            }
          },
          "metadata": {
            "openai": {
              "itemId": "fc_03c02028d4931e3e016992999e5d4481939513bfda45881132"
            }
          },
          "id": "prt_c64a812be001kN9qmsG7Wq0y2e",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a80551001E0Hw86QExmZmeK"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "cost": 0,
          "tokens": {
            "total": 39762,
            "input": 7626,
            "output": 264,
            "reasoning": 19,
            "cache": {
              "read": 31872,
              "write": 0
            }
          },
          "id": "prt_c64a8c319001BjCltm5SMRv3b1",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a80551001E0Hw86QExmZmeK"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1771215307595,
          "completed": 1771215312123
        },
        "parentID": "msg_c64a80544001W2chLTnfXdQMdG",
        "modelID": "gpt-5.3-codex",
        "providerID": "openai",
        "mode": "build",
        "agent": "build",
        "path": {
          "cwd": "/Users/alex/repos/vfp/dark-factory",
          "root": "/Users/alex/repos/vfp/dark-factory"
        },
        "cost": 0,
        "tokens": {
          "total": 40620,
          "input": 1043,
          "output": 153,
          "reasoning": 0,
          "cache": {
            "read": 39424,
            "write": 0
          }
        },
        "variant": "low",
        "finish": "stop",
        "id": "msg_c64a8c34b001ivke3kR4O67J2p",
        "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "id": "prt_c64a8ca38001m81wXiB0HrEFk8",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a8c34b001ivke3kR4O67J2p"
        },
        {
          "type": "text",
          "text": "Done  I used the `gitter` subagent and committed the scraper work.\n\n- Commit: `32031504db48fc3f641724ab10113f5dc04d2062`\n- Message: `Tooling // Docs Scrape // Add OpenCode sitemap snapshots (en default)`\n- Included:\n  - `scripts/scrape_opencode_docs.sh.ts`\n  - `docs/external/opencode/index.ext.md`\n  - `docs/external/opencode/*.ext.md` (English snapshot set)\n  - `README.md`\n  - `AGENTS.md`\n- Left untouched (unrelated): `docs/designs/core_gen1.design.md` and untracked `schemas/`\n- No push performed.",
          "time": {
            "start": 1771215312022,
            "end": 1771215312022
          },
          "metadata": {
            "openai": {
              "itemId": "msg_0da6e71a0f1133d701699299cdc4708190b4d48eb6c05c0522"
            }
          },
          "id": "prt_c64a8cc220015wL9tkWUkfMrSA",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a8c34b001ivke3kR4O67J2p"
        },
        {
          "type": "step-finish",
          "reason": "stop",
          "snapshot": "27057cf534a73e3f48292607b8794072916a3cde",
          "cost": 0,
          "tokens": {
            "total": 40620,
            "input": 1043,
            "output": 153,
            "reasoning": 0,
            "cache": {
              "read": 39424,
              "write": 0
            }
          },
          "id": "prt_c64a8d4c8001ZZs3ZqCRBuUOR3",
          "sessionID": "ses_39b5bd57fffeoHgocdtybSVa3d",
          "messageID": "msg_c64a8c34b001ivke3kR4O67J2p"
        }
      ]
    }
  ]
}
