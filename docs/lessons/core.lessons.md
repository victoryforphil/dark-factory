- Keep this file short and practical: bullets only, target 10-50 lines, always under 100 lines.
- Capture durable, reusable lessons from normal work (not one-off task logs).
- Save successful troubleshooting patterns and command sequences once they are verified.
- Include relevant rule/behavior updates from `.opencode/commands/rule.md` when they should guide future tasks.
- Capture user feedback and style nits when they are likely to repeat.
- When user critique identifies a miss, fix the current output first, then codify durable guidance in rules and lessons.
- Never store secrets, credentials, tokens, or sensitive environment details.
- Prefer generic phrasing that future agents can apply across similar tasks.
- Read lessons files early in each task before planning implementation details.
- Prune duplicates and stale bullets so signal stays high as work evolves.
- When logging metadata in `dark_core`, prefer `meta={...}` JSON via `formatLogMetadata` instead of comma-separated `key=value` strings.
- For TUI overlays/popups, gate render prop builders with the same `is_*_open()` state used by input handling; hit-test guards alone do not prevent default-open rendering artifacts.
- For spatial TUI parity work, use a tight loop: parallel `@explore` path-mapping + per-view `@designer` critiques + small code slices + immediate `cargo check -p dark_tui`.
- Add deterministic Ratatui `TestBackend` + `insta` snapshots before visual polish so each layout iteration can be reviewed as text diffs instead of manual terminal captures.
- Keep one command path to run spatial snapshots (`scripts/tui_spatial_snapshots.sh.ts`), with `--update` setting `INSTA_UPDATE=always` to accept intended fixture changes.
